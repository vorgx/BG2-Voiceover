<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="generator" content="hevea 2.34">
<style type="text/css">
.c000{border-spacing:0;}
.c001{border-spacing:6px;border-collapse:separate;}
.c002{color:red}
.c003{font-family:monospace}
.c004{font-family:monospace;color:red}
.c005{font-family:monospace;font-weight:bold}
.c006{font-style:italic}
.c007{font-weight:bold}
.c008{text-align:center;border:solid 1px;white-space:nowrap}
.c009{text-align:center;white-space:nowrap}
.c010{text-align:left;white-space:nowrap}
.c011{text-align:right;white-space:nowrap}
.c012{vertical-align:top;text-align:center;border:solid 1px;white-space:nowrap}
.c013{vertical-align:top;text-align:left;}
.c014{vertical-align:top;text-align:left;border:solid 1px;}
.c015{vertical-align:top;text-align:left;border:solid 1px;white-space:nowrap}
.li-itemize{margin:1ex 0ex;}
.li-enumerate{margin:1ex 0ex;}
div.footnotetext P{margin:0px; text-indent:1em;}
.title{margin:2ex auto;text-align:center}
.titlemain{margin:1ex 2ex 2ex 1ex;}
.titlerest{margin:0ex 2ex;}
div table{margin-left:inherit;margin-right:inherit;margin-bottom:2px;margin-top:2px}
td table{margin:auto;}
table{border-collapse:collapse;}
td{padding:0;}
.cellpadding1 tr td{padding:1px;}
pre{text-align:left;margin-left:0ex;margin-right:auto;}
blockquote{margin-left:4ex;margin-right:4ex;text-align:left;}
td p{margin:0px;}
.hbar{border:none;height:2px;width:100%;background-color:black;}
body{background-color:white}



.title{background-color:#00B200}
.titlemain{background-color:#00B200}
.titlerest{ackground-color:#00B200}
.section{padding:.5ex;background-color:#2DE52D}
.subsection{padding:0.3ex;background-color:#66FF66}
.ftoc1{list-style:none;margin:0ex 1ex;padding:0ex 1ex;border-left:1ex solid #00CC00}
.ftoc2{list-style:none;margin:1ex 1ex;padding:0ex 1ex;border-left:1ex solid #2DE52D}
</style>
<title>WeiDU Documentation
</title>
</head>
<body>
<!--HEVEA command line is: hevea article.hva fancysection.hva -fix -O README.tex -->
<!--CUT STYLE article--><!--CUT DEF section 1 --><table class="title"><tr><td style="padding:1ex"><h1 class="titlemain">WeiDU Documentation</h1><h3 class="titlerest">Fredrik Lindgren, a.k.a. Wisp<br>
<a href="mailto:lindgren.fredrik@gmail.com">lindgren.fredrik@gmail.com</a><br>
edited according to the GPL from source code by <br>
Valerio Bigiani, AKA The Bigg <br>
<a href="mailto:thebigg@spellholdstudios.net">thebigg@spellholdstudios.net</a> and<br>
Westley Weimer<br>
<a href="mailto:weimer@cs.berkley.edu">weimer@cs.berkley.edu</a></h3></td></tr>
</table><!--TOC section id="sec1" Contents-->
<h2 class="section" id="sec1">Contents</h2><!--SEC END --><ul class="ftoc1"><li class="li-toc">
<a href="#sec2">1  About WeiDU</a>
</li><li class="li-toc"><a href="#sec3">2  Don’t Panic!</a>
</li><li class="li-toc"><a href="#sec4">3  <span class="c003">D and <span class="c007">DLG</span> File Concepts</span></a>
</li><li class="li-toc"><a href="#sec5">4  <span class="c003">D</span> Dialogue File Format</a>
</li><li class="li-toc"><a href="#sec6">5  Scripts</a>
</li><li class="li-toc"><a href="#sec7">6  Command Line Options</a>
</li><li class="li-toc"><a href="#sec8">7  Example Uses</a>
</li><li class="li-toc"><a href="#sec9">8  WeiDU Tutorials</a>
<ul class="ftoc2"><li class="li-toc">
<a href="#sec10">8.1  <span class="c003">Multisay</span></a>
</li><li class="li-toc"><a href="#sec11">8.2  <span class="c003">CHAIN</span></a>
</li><li class="li-toc"><a href="#sec12">8.3  <span class="c003">COPY_TRANS</span></a>
</li><li class="li-toc"><a href="#sec13">8.4  <span class="c003">INTERJECT</span></a>
</li><li class="li-toc"><a href="#sec14">8.5  <span class="c003">INTERJECT_COPY_TRANS</span></a>
</li><li class="li-toc"><a href="#sec15">8.6  <span class="c003">INTERJECT_COPY_TRANS2</span></a>
</li><li class="li-toc"><a href="#sec16">8.7  <span class="c003">state WEIGHTs</span></a>
</li><li class="li-toc"><a href="#sec17">8.8  <span class="c003">TRA</span> Translation Files</a>
</li><li class="li-toc"><a href="#sec18">8.9  Converting a “hard-coded” <span class="c003">D to a D/TRA pair (Last Update: v200)</span></a>
</li><li class="li-toc"><a href="#sec19">8.10  <span class="c003">REPLACE_ACTION_TEXT</span></a>
</li><li class="li-toc"><a href="#sec20">8.11  <span class="c003">ALTER_TRANS</span> (Last Update: 204.)</a>
</li></ul>
</li><li class="li-toc"><a href="#TP2">9  Module Packaging: <span class="c005">TP2</span> Files</a>
</li><li class="li-toc"><a href="#sec22">10  WeiDU <span class="c003">TP2 Tutorials</span></a>
<ul class="ftoc2"><li class="li-toc">
<a href="#sec23">10.1  <span class="c003">COPY_EXISTING_REGEXP (Last update: v232)</span></a>
</li><li class="li-toc"><a href="#sec24">10.2  <span class="c003">EXTEND_TOP_REGEXP</span></a>
</li><li class="li-toc"><a href="#sec25">10.3  <span class="c003">READ_BYTE and PATCH_IF (Last update: v232)</span></a>
</li><li class="li-toc"><a href="#sec26">10.4  <span class="c003">values and expressions (Last update: v232)</span></a>
</li><li class="li-toc"><a href="#sec27">10.5  <span class="c003">ADD_STORE_ITEM</span> (Last Update: v211)</a>
</li><li class="li-toc"><a href="#sec28">10.6  <span class="c003">ADD_GAM_NPC</span></a>
</li><li class="li-toc"><a href="#sec29">10.7  <span class="c003">SET_2DA_ENTRY</span></a>
</li><li class="li-toc"><a href="#sec30">10.8  <span class="c003">WHILE</span> Loops (Last update: v232)</a>
</li><li class="li-toc"><a href="#sec31">10.9  Bitwise Operators (Last update: v232)</a>
</li><li class="li-toc"><a href="#sec32">10.10  Scripting Styles (Last Update: v232)</a>
</li><li class="li-toc"><a href="#sec33">10.11  TP2 <span class="c003">SUBCOMPONENT</span> Groups (Last Update: v192)</a>
</li><li class="li-toc"><a href="#sec34">10.12  <span class="c003">ADD_CRE_ITEM</span> (Last Update: v240)</a>
</li><li class="li-toc"><a href="#Prompt%20Customization">10.13  <span class="c005">Prompt Customization</span></a>
</li><li class="li-toc"><a href="#sec36">10.14  <span class="c003">INNER_ACTION</span></a>
</li><li class="li-toc"><a href="#sec37">10.15  <span class="c003">SET_2DA_ENTRY_LATER</span> and <span class="c003">SET_2DA_ENTRIES_NOW</span> (Last Update: v241)</a>
</li><li class="li-toc"><a href="#sec38">10.16  <span class="c003">READ_2DA_ENTRIES_NOW</span> and <span class="c003">READ_2DA_ENTRY_FORMER</span> (Last Update: v241)</a>
</li><li class="li-toc"><a href="#sec39">10.17  <span class="c003">DEFINE,LAUNCH,LOCAL</span> and everything else about personal <span class="c005">macros</span> (Last Update: v188)</a>
</li><li class="li-toc"><a href="#sec40">10.18  standard macros (Last Update: v188)</a>
</li><li class="li-toc"><a href="#sec41">10.19  <span class="c003">GROUP</span> (Last update: V221)</a>
</li><li class="li-toc"><a href="#sec42">10.20  <span class="c003">array construct</span></a>
</li><li class="li-toc"><a href="#sec43">10.21  <span class="c003">MODDER</span> (Last update: v247)</a>
</li><li class="li-toc"><a href="#sec44">10.22  <span class="c003">READLN</span> (Last update: v203)</a>
</li><li class="li-toc"><a href="#sec45">10.23  <span class="c003">Functions</span> (Last update: V247)</a>
</li><li class="li-toc"><a href="#sec46">10.24  <span class="c003">GET_OFFSET_ARRAY</span> and <span class="c003">GET_OFFSET_ARRAY2</span> (last edit: 218)</a>
</li><li class="li-toc"><a href="#sec47">10.25  <span class="c003">MATCH</span> and <span class="c003">TRY</span> (last edit: 245)</a>
</li><li class="li-toc"><a href="#sec48">10.26  <span class="c003">QUICK_MENU</span> (last edit: 227)</a>
</li><li class="li-toc"><a href="#sec49">10.27  <span class="c003">HANDLE_AUDIO</span> and <span class="c003">HANDLE_TILESETS</span></a>
</li></ul>
</li><li class="li-toc"><a href="#Code%20dumps">11  <span class="c005">Code dumps</span></a>
</li><li class="li-toc"><a href="#sec51">12  Macros Listing</a>
<ul class="ftoc2"><li class="li-toc">
<a href="#sec52">12.1  Store-related functions</a>
</li><li class="li-toc"><a href="#fj_are_structure">12.2  <span class="c005">fj_are_structure</span></a>
</li><li class="li-toc"><a href="#sc#addWmpAre">12.3  <span class="c005">sc#addWmpAre</span></a>
</li></ul>
</li><li class="li-toc"><a href="#Module%20Distribution">13  <span class="c005">Module Distribution</span>: <span class="c003">Setup-MyMod.exe</span></a>
<ul class="ftoc2"><li class="li-toc">
<a href="#sec56">13.1  Module Distribution Conventions</a>
</li><li class="li-toc"><a href="#sec57">13.2  WeiDU Return Values</a>
</li></ul>
</li><li class="li-toc"><a href="#sec58">14  Regular Expressions</a>
</li><li class="li-toc"><a href="#constant">15  WeiDU <span class="c005">constant</span>s</a>
</li><li class="li-toc"><a href="#sec60">16  Common File Formats</a>
</li><li class="li-toc"><a href="#sec61">17  The Source Code</a>
</li><li class="li-toc"><a href="#Special%20Thanks">18  <span class="c005">Special Thanks</span></a>
</li><li class="li-toc"><a href="#sec63">19  Informal Copyright Notice</a>
</li><li class="li-toc"><a href="#sec64">20  Undocumented Features</a>
</li><li class="li-toc"><a href="#sec65">21  Index of Terms</a>
</li><li class="li-toc"><a href="#sec67">22  Changes</a>
</li></ul>
<!--TOC section id="sec2" About WeiDU-->
<h2 class="section" id="sec2">1  About WeiDU</h2><!--SEC END --><p>The main home page for WeiDU is:
<a href="http://weidu.org/"><span class="c003">http://weidu.org/</span></a>.
I encourage you to download the latest version.</p><p>WeiDU is designed to make it easier to write and distribute modifications
to Infinity Engine games. It can load and modify Infinity Engine resources
according to instructions you provide. WeiDU is ideal for packaging
modifications that include dialogue or that want to be compatible with
other modifications.</p><p>I’ll be honest with you up front: WeiDU is initially harder to use than
some of its alternatives. However, most users report that (1) the
alternatives are insufficient because they lack features that only WeiDU
provides and (2) WeiDU grows on you over time.</p><p>You are welcome to use these utilities to make and distribute your own
Infinity Engine mods. This utility is covered by the GNU General Public
License, but you are also allowed to distribute an unmodified binary copy
of <span class="c003">WeiDU.EXE</span> (without the source code) with your mod if you like.</p><p>I decided to write my own Infinity Engine <a href="#DLG"><span class="c003">DLG</span></a> and <a href="#TLK"><span class="c003">TLK</span></a>
utilities because I was unable to get the TeamBG DLG Editor and Mass
Converter to work properly. Either they wouldn’t parse the strings or they
would mangle the text or they would randomly crash ... it was bad all
around. Also, they were all GUIs. As a unix weenie I’m in love with command
line utilities and as a PL doctoral student I love making little languages
and compilers. WeiDU was originally a family of small programs with
unimaginative names like DC, DD and TP. The more appealing term “WeiDU”
(which rhymes with “IDU”, Eye-Dee-You) was coined by Jason Compton and
Ghreyfain, noted BGII mod authors.</p>
<!--TOC section id="sec3" Don’t Panic!-->
<h2 class="section" id="sec3">2  Don’t Panic!</h2><!--SEC END --><p>Step-By-Step Beginner’s Guide to WeiDU:</p><ol class="enumerate" type=1><li class="li-enumerate">Don’t Panic. Many of you are children of the GUI era. But programs
that run from the command line can be your friend, and in the long run are
often much faster and, yes, easier to use.</li><li class="li-enumerate">The Best Way To Learn How To Write Code In WeiDU’s <a href="#D"><span class="c003">D</span></a> Format
Is To <em>Read</em> Code Written In WeiDU’s <a href="#D"><span class="c003">D</span></a> Format. Start by decompiling
existing in-game <a href="#DLG"><span class="c003">DLG</span></a>s that you understand and read through them.
Compare how they appear in WeiDU to how they appear in other BG2 editing
tools you may be more comfortable with, such as Near Infinity or Infinity
Explorer.</li><li class="li-enumerate">The Best Way To Learn How To Write Code In WeiDU’s <a href="#D"><span class="c003">D</span></a> Format
Is To <em>Read</em> Code Written In WeiDU’s <a href="#D"><span class="c003">D</span></a> Format, Part 2. A growing
number of BG2 add-on packs are being created using WeiDU. A list is
available at
<a href="http://www.pocketplane.net/modlist/"><span class="c003">http://www.pocketplane.net/modlist/</span></a>.
These
can help you understand how WeiDU’s advanced features, such as dialogue
appending, script and <a href="#2DA"><span class="c003">2DA</span></a> patching, and item/spell/creature
patching work in a “real-world” setting. Make it a point to download some
of them and understand HOW they work.</li><li class="li-enumerate">Take a look at some of the examples in this document.
There is a lovely WeiDU tutorial (written by
Japheth) available at
<a href="http://forums.pocketplane.net/index.php?topic=55.0"><span class="c003">http://forums.pocketplane.net/index.php?topic=55.0</span></a>.
If you
are feeling overwhelmed, start there first. It also covers installation.
Ghreyfain also has a “how to create an NPC with WeiDU” tutorial at
<a href="http://forums.pocketplane.net/index.php?topic=52.0"><span class="c003">http://forums.pocketplane.net/index.php?topic=52.0</span></a>.</li><li class="li-enumerate">There is a WeiDU discussion board at
<a href="http://forums.pocketplane.net/index.php?board=50.0"><span class="c003">http://forums.pocketplane.net/index.php?board=50.0</span></a>. The
discussion board is the best place to have your WeiDU (and mod-making)
questions answered.</li><li class="li-enumerate">Finally, if you are using a Mac and you want to play around with
WeiDU, check out <a href="http://weidu.org/Mac.html"><span class="c003">http://weidu.org/Mac.html</span></a> for more
information on obtaining a copy of WeiDU that works under OS X.</li></ol><p><a id="DLG"></a></p>
<!--TOC section id="sec4" <span class="c003">D and </span><span class="c003"><span class="c007">DLG</span></span><span class="c003"> File Concepts</span>-->
<h2 class="section" id="sec4">3  <a href="#D"><span class="c003">D</span></a> and <span class="c005">DLG</span><a id="hevea_default0"></a> File Concepts</h2><!--SEC END --><p>This section is a gentle introduction to how Infinity Engine <a href="#DLG"><span class="c003">DLG</span></a>
files are structured. First, let’s use WeiDU to create
<span class="c003">SCSARLES.</span><a href="#D"><span class="c003">D</span></a> and take a look at the dialogue of Sir Sarles.</p><p>You may install <span class="c003">WeiDU.exe</span> anywhere on your system. However, I recommend
that you put it in your Baldur’s Gate 2 installation directory. However,
WeiDU will use the Windows Registry to attempt to locate your BG2 game
files.</p><p>To run the effect described, open up a DOS prompt window and change
directories to get to your BGII directory. Then just type in the
 <span class="c004">text in red</span> at the DOS Prompt.</p><p><span class="c003">C:</span>\<span class="c003">Program Files</span>\<span class="c003">Black Isle</span>\<span class="c003">BGII - SoA</span>\<span class="c003">&gt;  <span class="c002">weidu SCSARLES.DLG</span> </span></p><p>This will create a text file called <span class="c003">SCSARLES.D</span> in the current
directory. Open it up with Notepad or Microsoft Word or something. It’s
just a text file that describes the game dialogue.</p><p>It will look something like:

<pre width="80"><font color="#219121">// creator  : c:\bgate\weidu\weidu.exe
</font><font color="#219121">// argument : SCSARLES.DLG
</font><font color="#219121">// game     : C:\Program Files\Black Isle\BGII - SoA
</font><font color="#219121">// source   : C:\Program Files\Black Isle\BGII - SoA\data\Dialog.bif
</font><font color="#219121">// dialog   : C:\Program Files\Black Isle\BGII - SoA\DIALOG.TLK
</font><font color="#219121">// dialogF  : (none)
</font>
<font color="#3159D1">BEGIN <font color="#868626">~SCSARLES~</font>

IF <font color="#868626">~NumTimesTalkedTo(0)~</font> THEN BEGIN <font color="#0000FF">0</font> <font color="#219121">// from:
</font>  SAY <font color="#0000FF">#28655</font> <font color="#219121">/* ~Who is it? Might I ask why you have disturbed my
    meditations? My creative muse must be gently awakened, and your
    stomping about is simply not conducive to this.~ [SARLES02] */</font>
  IF <font color="#868626">~~</font> THEN REPLY <font color="#0000FF">#28656</font> <font color="#219121">/* ~My apologies. I will leave you to your
    thinking.~ */</font> GOTO <font color="#0000FF">1</font>
  IF <font color="#868626">~~</font> THEN REPLY <font color="#0000FF">#28657</font> <font color="#219121">/* ~I apologize, but I have come to request your
    talent on a commissioned artwork.~ */</font>
      DO <font color="#868626">~SetGlobal("TalkedToSarles","GLOBAL",1)~</font> GOTO <font color="#0000FF">2</font>
END

IF <font color="#868626">~~</font> THEN BEGIN <font color="#0000FF">1</font> <font color="#219121">// from: 0.0
</font>  SAY <font color="#0000FF">#28661</font> <font color="#219121">/* ~Then I shall forget you were ever here. Actually, it is an
    astoundingly easy thing to do.~ */</font>
  IF <font color="#868626">~~</font> THEN DO <font color="#868626">~SetNumTimesTalkedTo(0)~</font> EXIT
END</font></pre>
 Dialogues in Infinity Engine games behave like finite state machines. If
you aren’t familiar with the concept of a finite state machine, see
<a href="http://whatis.techtarget.com/definition/0,,sid9_gci213052,00.html"><span class="c003">http://whatis.techtarget.com/definition/0,,sid9_gci213052,00.html</span></a> or
<a href="http://www.c3.lanl.gov/mega-math/workbk/machine/mabkgd.html"><span class="c003">http://www.c3.lanl.gov/mega-math/workbk/machine/mabkgd.html</span></a>.
Each block of the form:

<pre width="80">  <font color="#3159D1">IF <font color="#868626">~Initial Condition~</font> THEN BEGIN</font> state1
    <font color="#3159D1">SAY <font color="#868626">~Something~</font>
    IF <font color="#868626">~Reply Condition~</font> THEN REPLY <font color="#868626">~Reply Text~</font> GOTO</font> state2
  <font color="#3159D1">END</font></pre>
 represents a <a href="#state"><span class="c003">state</span></a> (more details below). When the player starts a
conversation with an NPC, the game engine scans through all
of the <a href="#state"><span class="c003">state</span></a>s in that NPC’s <a href="#DLG"><span class="c003">DLG</span></a> file in a special
<a href="#WEIGHT"><span class="c003">WEIGHT</span></a>ed order and picks the one with a non-empty and true "Initial
Condition". If no state has a non-empty and true "Initial Condition" then
you get that “Bob - has nothing to say to you.” message. Don’t worry about
the weighting process for now.</p><p>The speaker (in this case, Sir Sarles) then says whatever appears after
<a href="#SAY"><span class="c003">SAY</span></a>. The <a href="#REPLY"><span class="c003">REPLY</span></a> lines represent responses the PC can say
back. If the "Reply Condition" is true, the player is given the option of
saying the "Reply Text" and moving to another state in the dialogue (where
Sarles will probably say something else).</p><p>Remember: <a href="#SAY"><span class="c003">SAY</span></a> is for what the NPC says, <a href="#REPLY"><span class="c003">REPLY</span></a> is for what
the player says back. If you think carefully, you’ll notice that all
dialogue in Infinity Engine games is structed in this manner.</p><p>Conditions use the same syntax as triggers do in Infinity Engine
<a href="#BCS"><span class="c003">BCS</span></a> scripting. You will need to learn Infinity Engine scripting
before too long. <a href="#String"><span class="c003">String</span></a>s are delineated by tildes or %%
or "" (your choice, but WeiDU uses the tilde by default). After
<a href="#SAY"><span class="c003">SAY</span></a> or <a href="#REPLY"><span class="c003">REPLY</span></a> or <a href="#JOURNAL"><span class="c003">JOURNAL</span></a> you may give two
<a href="#String"><span class="c003">String</span></a>s
instead of one. The first is used with <span class="c003">DIALOG.</span><a href="#TLK"><span class="c003">TLK</span></a>, the second
is used with <span class="c003">DIALOGF.</span><a href="#TLK"><span class="c003">TLK</span></a> (foreign language version for when the
main character is female). If you do not give two <a href="#String"><span class="c003">String</span></a>s, the one
<a href="#String"><span class="c003">String</span></a> you gave is used for both.</p><p>You may also use raw numbers prefaced with a number sign (like <span class="c003">#1234</span>)
to specify a strref inside <span class="c003">DIALOG.</span><a href="#TLK"><span class="c003">TLK</span></a> directly. This is useful
when modifying existing dialogues (say, the Fate Spirit in ToB) so that you
if a foreign user installs your dialogue they will retain all of the
foreign versions of the strings you didn’t change or add. Normally
the string reference numbers are put right after the <a href="#SAY"><span class="c003">SAY</span></a> keyword
and the string text is put in comments. The <span class="c003">--text</span> command-line option
causes string text to be emitted with the string number in comments.</p><p>You may also indicate that a sound file (WAV/WAVC) should be associated
with a given <a href="#String"><span class="c003">String</span></a> by including its up-to-8-letter resource name in
<span class="c003">[brackets]</span> after the string, as in:

<pre width="80">  <font color="#3159D1">SAY</font> <font color="#868626">~Hello~</font> [HELLO]
</pre>

Comments are C/C++ style: everything from // to the end of the line is a
comment, as is /* everything in these star-slash things */. Comments are
ignored by WeiDU. They are there for your benefit. Example:

<pre width="80">  <font color="#3159D1">SAY</font> <font color="#868626">~Hello~</font> [HELLO]   <font color="#219121">// this is a comment        ... way out to here!
  <font color="#3159D1">IF</font> /* this is also a comment */</font> <font color="#868626">~~</font> <font color="#3159D1">THEN</font> <font color="#3159D1">EXIT</font>
</pre>

Replies can also contain actions (using the <a href="#DO"><span class="c003">DO</span></a> keyword) which
behave just like Infinity Engine <a href="#BCS"><span class="c003">BCS</span></a> script actions. They can also
add Journal entries, end the dialogue or transfer to another speaker.</p><p>Examples:

<pre width="80">  <font color="#3159D1">IF <font color="#868626">~~</font> THEN BEGIN</font> <font color="#0000FF">2</font> <font color="#219121">// from: 0.1
</font></pre>

This line marks the beginning of <a href="#state"><span class="c003">state</span></a> 2 in a dialogue. The comment
tells you that it can be reached by the first reply <a href="#transition"><span class="c003">transition</span></a> from
state 0.

<pre width="80">  <font color="#3159D1">IF <font color="#868626">~~</font> THEN REPLY <font color="#868626">~My apologies. I will leave you to your thinking.~</font> <font color="#219121">// </font><font color="#0000FF">#28656</font>
      GOTO</font> <font color="#0000FF">1</font>
</pre>

This <a href="#REPLY"><span class="c003">REPLY</span></a> can always be chosen and involves the spoken text "My
apologies...". That text is string reference number 28656. If the PC
chooses that reply, it transitions to state 1.</p><p>Finally, a <a href="#transition"><span class="c003">transition</span></a> may also take the form:

<pre width="80">  <font color="#3159D1">COPY_TRANS</font> filename label
</pre>

During processing, <a href="#COPY_TRANS"><span class="c003">COPY_TRANS</span></a> will be replaced by all of the
transitions from state "label" of file "filename". The copying takes place
before all other <a href="#D"><span class="c003">D</span></a> actions.</p>
<!--TOC section id="sec5" <span class="c003">D</span> Dialogue File Format-->
<h2 class="section" id="sec5">4  <span class="c003">D</span> Dialogue File Format</h2><!--SEC END --><p> <a id="D"></a>
</p><p>The <a href="#D"><span class="c003">D</span></a> file format is a way of describing Infinity Engine dialogues
and modifications to Infinity Engine Dialogues in a portable,
easy-to-understand format. It supports foreign language translations and
allows you to describe extensions to existing game dialogues without
forcing you to describe their content. This allows you to write mods that
work with mods written by others.</p><p>The <a href="#D"><span class="c003">D</span></a> file format is presented here in an extended context-free
grammar notation. If you are unfamiliar with CFGs, take a look
<a href="http://www.wikipedia.com/wiki/Context-free_grammar"><span class="c003">http://www.wikipedia.com/wiki/Context-free_grammar</span></a>,
<a href="http://cs.wpi.edu/~kal/PLT/PLT2.1.2.html"><span class="c003">http://cs.wpi.edu/~kal/PLT/PLT2.1.2.html</span></a>
or
<a href="http://www.cs.rochester.edu/users/faculty/nelson/courses/csc_173/grammars/cfg.html"><span class="c003">http://www.cs.rochester.edu/users/faculty/nelson/courses/csc_173/grammars/cfg.html</span></a>.
You don’t really need to understand a CFG formally, though.</p><p>To get a real idea of how they work, use WeiDU to create JAHEIRA.D for
yourself and look at it in a text editor. You can also browse the <span class="c003">examples</span>
and <span class="c003">test</span> directories that come with WeiDU.</p><p>All of the syntax keywords are given in a <span class="c003">UPPERCASE COURIER</span>.
All other keywords are symbolic. Notes:
</p><ul class="itemize"><li class="li-itemize">
bar <span class="c002"> list </span>means "0 or more copies of bar".
</li><li class="li-itemize"><span class="c002"> [ </span>foo <span class="c002"> ] </span>means "an optional foo" or "0 or 1 copies of foo".
</li><li class="li-itemize">foo bar ... means "you may repeat foo bar as often as you like here".
</li></ul><table class="c000 cellpadding1" border=1><tr><td class="c012">
<span class="c005">D File</span><a id="D File"></a><a id="hevea_default1"></a></td><td class="c014">&nbsp;</td><td class="c014"> A <a href="#D%20File"><span class="c003">D File</span></a> is a text file that contains a number of <a href="#D%20Action"><span class="c003">D Action</span></a>s.
<a href="#D%20File"><span class="c003">D File</span></a>s tell WeiDU how to create and modify Infinity
Engine <a href="#DLG"><span class="c003">DLG</span></a> files. </td></tr>
<tr><td class="c012">
is</td><td class="c014"><a href="#D%20Action"><span class="c003">D Action</span></a> <span class="c002"> list </span></td><td class="c014"> A <a href="#D%20File"><span class="c003">D File</span></a> is a list of <a href="#D%20Action"><span class="c003">D Action</span></a>s. Typically the first and
only one is <a href="#BEGIN"><span class="c003">BEGIN</span></a>, which defines the content of a new dialogue.
Other <a href="#D%20Action"><span class="c003">D Action</span></a>s can be used to modify existing dialogues. </td></tr>
<tr><td class="c012">&nbsp;</td></tr>
<tr><td class="c012">
<span class="c005">D Action</span><a id="D Action"></a><a id="hevea_default2"></a></td><td class="c014">&nbsp;</td><td class="c014"> A <a href="#D%20Action"><span class="c003">D Action</span></a> tells WeiDU how to create or modify Infinity Engine
<a href="#DLG"><span class="c003">DLG</span></a> files. </td></tr>
<tr><td class="c012">
is</td><td class="c014"><span class="c005">BEGIN</span><a id="BEGIN"></a><a id="hevea_default3"></a> filename <span class="c002"> [ </span><span class="c005">nonPausing</span><a id="nonPausing"></a><a id="hevea_default4"></a> <span class="c002"> ] </span><a href="#state"><span class="c003">state</span></a> <span class="c002"> list </span></td><td class="c014"> <a href="#BEGIN"><span class="c003">BEGIN</span></a> tells WeiDU that you are creating a new DLG file from
scratch. Any existing DLG file with the same name will be overwritten.
The new DLG file contains exactly the <a href="#state"><span class="c003">state</span></a>s in the list.
If you set <a href="#nonPausing"><span class="c003">nonPausing</span></a> to a non-zero integer, the game will not
“stop time” while the conversation takes place. By default time stops
during conversations. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">APPEND</span><a id="APPEND"></a><a id="hevea_default5"></a> <span class="c002"> [ </span><span class="c003">IF_FILE_EXISTS</span> <span class="c002"> ] </span>filename <a href="#state"><span class="c003">state</span></a> <span class="c002"> list </span><span class="c003">END</span></td><td class="c014"> This tells WeiDU to place the given <a href="#state"><span class="c003">state</span></a>s at the end of the
already-existing dialogue <span class="c003">filename.</span><a href="#DLG"><span class="c003">DLG</span></a>. If there is IF_FILE_EXISTS
and the file doesn’t exists, this action is skipped. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">APPEND_EARLY</span><a id="APPEND_EARLY"></a><a id="hevea_default6"></a> <span class="c002"> [ </span><span class="c003">IF_FILE_EXISTS</span> <span class="c002"> ] </span>filename <a href="#state"><span class="c003">state</span></a> <span class="c002"> list </span><span class="c003">END</span></td><td class="c014"> Works like <a href="#APPEND"><span class="c003">APPEND</span></a>, but the <a href="#state"><span class="c003">state</span></a>s are added early on in
the compilation timeline (just after <a href="#BEGIN"><span class="c003">BEGIN</span></a> is processed). Thus
they can be the targets for <a href="#INTERJECT_COPY_TRANS"><span class="c003">INTERJECT_COPY_TRANS</span></a> and friends.
</td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">CHAIN</span><a id="CHAIN"></a><a id="hevea_default7"></a>
<span class="c002"> [ </span><span class="c003">IF</span> <span class="c002"> [ </span><span class="c003">WEIGHT</span> <span class="c003">#</span>weight <span class="c002"> ] </span><span class="c003">stateTriggerString</span> <span class="c003">THEN</span> <span class="c002"> ]  [ </span><span class="c003">IF_FILE_EXISTS</span> <span class="c002"> ] </span>entryFilename entryLabel <a href="#chainText"><span class="c003">chainText</span></a> <span class="c002"> list </span><a href="#chainEpilogue"><span class="c003">chainEpilogue</span></a></td><td class="c014"> This instructs WeiDU to make a long conversation in which the PC can say
nothing. This is useful when you want the NPCs to talk among themselves
for a long time. It and its friends, <a href="#INTERJECT"><span class="c003">INTERJECT</span></a> and
<a href="#INTERJECT_COPY_TRANS"><span class="c003">INTERJECT_COPY_TRANS</span></a> can incredible time-savers when you’re
writing non-trivial dialogue. See the examples for ideas. <a href="#CHAIN"><span class="c003">CHAIN</span></a>
will only append to existing dialogues. You cannot use <a href="#CHAIN"><span class="c003">CHAIN</span></a> to
create a new DLG. If the entryFilename file is missing and there is IF_FILE_EXISTS,
the whole CHAIN is not compiled.
</td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">INTERJECT</span><a id="INTERJECT"></a><a id="hevea_default8"></a> entryFilename entryLabel <span class="c003">globalVariable</span>
<a href="#chainText"><span class="c003">chainText</span></a> <span class="c002"> list </span><a href="#chainEpilogue"><span class="c003">chainEpilogue</span></a></td><td class="c014"> Behaves like <a href="#CHAIN"><span class="c003">CHAIN</span></a> except that all of the <a href="#chainText"><span class="c003">chainText</span></a> is
additionally guarded by the <a href="#transition"><span class="c003">transition</span></a> predicate <span class="c003">Global("globalVariable","GLOBAL",0)</span> and accompanied by the action <span class="c003">SetGlobal("globalVariable","GLOBAL",1)</span>. If you pick <span class="c003">globalVariable </span> to be unique, this will ensure that the <a href="#chainText"><span class="c003">chainText</span></a> is only ever seen once per game. This is useful for making interjections. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">INTERJECT_COPY_TRANS</span><a id="INTERJECT_COPY_TRANS"></a><a id="hevea_default9"></a> <span class="c002"> [ </span><span class="c003">SAFE</span> <span class="c002"> ] </span>entryFilename
entryLabel <span class="c003">globalVariable</span> <a href="#chainText"><span class="c003">chainText</span></a> <span class="c002"> list </span></td><td class="c014"> This behaves just like <a href="#INTERJECT"><span class="c003">INTERJECT</span></a> except that the
exitFilename and exitLabel are not present. Instead, whenever the
dialogue would pass out of the <a href="#chainText"><span class="c003">chainText</span></a> it follows a copy
of the <a href="#transition"><span class="c003">transition</span></a>s that were at the <a href="#state"><span class="c003">state</span></a> with
<a href="#stateLabel"><span class="c003">stateLabel</span></a> originally. This is convenient for making quick
interjections from NPCs that do not actually change the true flow of
the conversation. See the <a href="#transition"><span class="c003">transition</span></a> <a href="#COPY_TRANS"><span class="c003">COPY_TRANS</span></a> and
the <a href="#sec-interject-copy-trans"><span class="c003">INTERJECT_COPY_TRANS</span> tutorial</a> for more information about
this idea. If <span class="c003">SAFE</span> is specified, <a href="#INTERJECT_COPY_TRANS"><span class="c003">INTERJECT_COPY_TRANS</span></a>
will not warn about potentially unsafe uses (use this if you know it
is safe).
</td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">INTERJECT_COPY_TRANS2</span><a id="INTERJECT_COPY_TRANS2"></a><a id="hevea_default10"></a> <span class="c002"> [ </span><span class="c003">SAFE</span> <span class="c002"> ] </span>entryFilename entryLabel <span class="c003">globalVariable</span> <a href="#chainText"><span class="c003">chainText</span></a> <span class="c002"> list </span></td><td class="c014"> This works just like <a href="#INTERJECT_COPY_TRANS"><span class="c003">INTERJECT_COPY_TRANS</span></a>, except that any
actions taken in the transitions of the state specified by entryFilename
and entryLabel are preserved and kept with the speaker associated with
entryFilename (rather than being mistakenly performed by your new
speaker). See the <a href="#sec-interject-copy-trans2"><span class="c003">INTERJECT_COPY_TRANS2</span> tutorial</a>.
</td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">INTERJECT_COPY_TRANS3</span><a id="INTERJECT_COPY_TRANS3"></a><a id="hevea_default11"></a> <span class="c002"> [ </span><span class="c003">SAFE</span> <span class="c002"> ] </span>entryFilename entryLabel <span class="c003">globalVariable</span> <a href="#chainText"><span class="c003">chainText</span></a> <span class="c002"> list </span></td><td class="c014"> This works just like <a href="#INTERJECT_COPY_TRANS"><span class="c003">INTERJECT_COPY_TRANS</span></a>, except that all
states in chainText get a link in the entry state, rather than only the
first one. Expecting documentation.
</td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">INTERJECT_COPY_TRANS4</span><a id="INTERJECT_COPY_TRANS4"></a><a id="hevea_default12"></a> <span class="c002"> [ </span><span class="c003">SAFE</span> <span class="c002"> ] </span>entryFilename entryLabel <span class="c003">globalVariable</span> <a href="#chainText"><span class="c003">chainText</span></a> <span class="c002"> list </span></td><td class="c014"> This is either <a href="#INTERJECT_COPY_TRANS3"><span class="c003">INTERJECT_COPY_TRANS3</span></a> with <a href="#INTERJECT_COPY_TRANS2"><span class="c003">INTERJECT_COPY_TRANS2</span></a>-style
action handling, or <a href="#INTERJECT_COPY_TRANS2"><span class="c003">INTERJECT_COPY_TRANS2</span></a> with the extended
<a href="#INTERJECT_COPY_TRANS3"><span class="c003">INTERJECT_COPY_TRANS3</span></a> state creation rules, depending at how you
look at it.
</td></tr>
<tr><td class="c012">
or</td><td class="c014"> <span class="c005">EXTEND_TOP</span><a id="EXTEND_TOP"></a><a id="hevea_default13"></a>
filename <a href="#stateLabel"><span class="c003">stateLabel</span></a> <span class="c002"> list  [ </span><span class="c003">#positionNumber</span> <span class="c002"> ] </span><a href="#transition"><span class="c003">transition</span></a> <span class="c002"> list </span><span class="c003">END</span></td><td class="c014"> This instructs WeiDU to add the <a href="#transition"><span class="c003">transition</span></a>s in list to the top of
the <a href="#transition"><span class="c003">transition</span></a> list for the specified states in <span class="c003">filename.</span><a href="#DLG"><span class="c003">DLG</span></a>
(which must already exist).<p>If a <span class="c003">positionNumber</span> is given, WeiDU to insert the <a href="#transition"><span class="c003">transition</span></a>s
just between already-existing transitions <span class="c003">#positionNumber</span> and
<span class="c003">#positionNumber+1</span> in the given states for the given file. The first
<a href="#transition"><span class="c003">transition</span></a> is number 1. </p></td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">EXTEND_BOTTOM</span><a id="EXTEND_BOTTOM"></a><a id="hevea_default14"></a> filename <a href="#stateNumber"><span class="c003">stateNumber</span></a> <span class="c002"> list  [ </span><span class="c003">#positionNumber</span> <span class="c002"> ] </span><a href="#transition"><span class="c003">transition</span></a> <span class="c002"> list </span><span class="c003">END</span></td><td class="c014"> Behaves just like <a href="#EXTEND_TOP"><span class="c003">EXTEND_TOP</span></a> but adds the transitions to the
bottom of the list instead. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">ADD_STATE_TRIGGER</span><a id="ADD_STATE_TRIGGER"></a><a id="hevea_default15"></a> filename <a href="#stateNumber"><span class="c003">stateNumber</span></a>
<a href="#stateTriggerString"><span class="c003">stateTriggerString</span></a> <span class="c002"> [ </span><a href="#stateNumber"><span class="c003">stateNumber</span></a> <span class="c002"> list  ] </span>	<a href="#dActionWhen"><span class="c003">dActionWhen</span></a> <span class="c002"> list </span></td><td class="c014"> This instructs WeiDU to add the <a href="#stateTriggerString"><span class="c003">stateTriggerString</span></a> to all
of the <a href="#state"><span class="c003">state</span></a>s with the given <a href="#stateNumber"><span class="c003">stateNumber</span></a>s in
the file <span class="c003">filename.</span><a href="#DLG"><span class="c003">DLG</span></a> (which must already exist). This is handy for
adding extra conditions to an existing dialogue <a href="#state"><span class="c003">state</span></a>. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">ADD_TRANS_TRIGGER</span><a id="ADD_TRANS_TRIGGER"></a><a id="hevea_default16"></a> filename <a href="#stateNumber"><span class="c003">stateNumber</span></a>
<a href="#transTriggerString"><span class="c003">transTriggerString</span></a> <span class="c002"> [ </span><a href="#stateNumber">moreStateNumbers</a> <span class="c002"> list  ]  [ </span><span class="c003">DO</span> <span class="c003">transNumber</span> <span class="c002"> list  ] </span><a href="#dActionWhen"><span class="c003">dActionWhen</span></a> <span class="c002"> list </span></td><td class="c014"> This instructs WeiDU to add the <a href="#transTriggerString"><span class="c003">transTriggerString</span></a> to all
of the <a href="#transition"><span class="c003">transition</span></a>s in all of the <a href="#state"><span class="c003">state</span></a>s with the given
<a href="#stateNumber"><span class="c003">stateNumber</span></a>s in the file <span class="c003">filename.</span><a href="#DLG"><span class="c003">DLG</span></a> (which must already
exist). This is often used in conjunction with <a href="#EXTEND_BOTTOM"><span class="c003">EXTEND_BOTTOM</span></a> to
make a new branch in an existing <a href="#state"><span class="c003">state</span></a>. Use
<a href="#ADD_TRANS_TRIGGER"><span class="c003">ADD_TRANS_TRIGGER</span></a> to add the negation of some predicate to all of
the existing <a href="#transition"><span class="c003">transition</span></a>s, then use <a href="#EXTEND_BOTTOM"><span class="c003">EXTEND_BOTTOM</span></a> to add a
<a href="#transition"><span class="c003">transition</span></a> with that predicate to that <a href="#state"><span class="c003">state</span></a>.
If a list of <span class="c003">transNumber</span>s is specified, only those transitions
will have <a href="#transTriggerString"><span class="c003">transTriggerString</span></a> added to them. If such a list is not
specified, every transition in every specified state will be modified.
Note that the “first” transition is number 0.
</td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">ADD_TRANS_ACTION</span><a id="ADD_TRANS_ACTION"></a><a id="hevea_default17"></a> filename
<span class="c003">BEGIN</span> <a href="#stateNumber"><span class="c003">stateNumber</span></a> <span class="c002"> list </span><span class="c003">END</span>
<span class="c003">BEGIN</span> <span class="c003">transNumber</span> <span class="c002"> list </span><span class="c003">END</span>
<span class="c003">transActionString</span> <a href="#dActionWhen"><span class="c003">dActionWhen</span></a> <span class="c002"> list </span></td><td class="c014"> This instructs WeiDU to add the <span class="c003">transActionString</span> to all
of the actions in all the <a href="#transition"><span class="c003">transition</span></a>s in all of the <a href="#state"><span class="c003">state</span></a>s specified by the
<span class="c003">stateNumber</span> list and the <span class="c003">transNumber</span> list. You may use
state labels in the <span class="c003">stateNumber</span> list. If the <span class="c003">transNumber</span> list
is empty, the text added to all transitions on all listed states.
Note that the <span class="c003">BEGIN</span> and <span class="c003">END</span> keywords must be present, even if you
specify an empty list of <span class="c003">transNumber</span>s.
The “first” transition is number 0. Any out-of-bounds <span class="c003">transNumbers</span>
are silently ignored. The <span class="c003">transActionString</span> is prepended to any
existing action text on a per-<a href="#transition"><span class="c003">transition</span></a>, per-<a href="#state"><span class="c003">state</span></a>
basis.</td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">REPLACE_TRANS_ACTION</span><a id="REPLACE_TRANS_ACTION"></a><a id="hevea_default18"></a> filename
<span class="c003">BEGIN</span> <a href="#stateNumber"><span class="c003">stateNumber</span></a> <span class="c002"> list </span><span class="c003">END</span>
<span class="c003">BEGIN</span> <span class="c003">transNumber</span> <span class="c002"> list </span><span class="c003">END</span>
oldText newText <a href="#dActionWhen"><span class="c003">dActionWhen</span></a> <span class="c002"> list </span></td><td class="c014"> This instructs WeiDU to replace all instances of oldText in newText to all
of the actions in all the <a href="#transition"><span class="c003">transition</span></a>s in all of the <a href="#state"><span class="c003">state</span></a>s specified by the
<span class="c003">stateNumber</span> list and the <span class="c003">transNumber</span> list. You may use
state labels in the <span class="c003">stateNumber</span> list. If the <span class="c003">transNumber</span> list
is empty, the text added to all transitions on all listed states.
Note that the <span class="c003">BEGIN</span> and <span class="c003">END</span> keywords must be present, even if you
specify an empty list of <span class="c003">transNumber</span>s.
The “first” transition is number 0. Any out-of-bounds <span class="c003">transNumbers</span>
are silently ignored.</td></tr>
<tr><td class="c012"> or</td><td class="c014"><span class="c005">REPLACE_TRANS_TRIGGER</span><a id="REPLACE_TRANS_TRIGGER"></a><a id="hevea_default19"></a> filename
<span class="c003">BEGIN</span> <a href="#stateNumber"><span class="c003">stateNumber</span></a> <span class="c002"> list </span><span class="c003">END</span>
<span class="c003">BEGIN</span> <span class="c003">transNumber</span> <span class="c002"> list </span><span class="c003">END</span>
oldText newText <a href="#dActionWhen"><span class="c003">dActionWhen</span></a> <span class="c002"> list </span></td><td class="c014"> This instructs WeiDU to replace all instances of oldText in newText to all
of the triggers in all of the <a href="#transition"><span class="c003">transition</span></a>s in all of the <a href="#state"><span class="c003">state</span></a>s specified by the
<span class="c003">stateNumber</span> list and the <span class="c003">transNumber</span> list. You may use
state labels in the <span class="c003">stateNumber</span> list. If the <span class="c003">transNumber</span> list
is empty, the text added to all transitions on all listed states.
Note that the <span class="c003">BEGIN</span> and <span class="c003">END</span> keywords must be present, even if you
specify an empty list of <span class="c003">transNumber</span>s.
The “first” transition is number 0. Any out-of-bounds <span class="c003">transNumbers</span>
are silently ignored.</td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">ALTER_TRANS</span><a id="ALTER_TRANS"></a><a id="hevea_default20"></a> filename
<span class="c003">BEGIN</span> <a href="#stateNumber"><span class="c003">stateNumber</span></a> <span class="c002"> list </span><span class="c003">END</span>
<span class="c003">BEGIN</span> <span class="c003">transNumber</span> <span class="c002"> list </span><span class="c003">END</span>
<span class="c003">BEGIN</span> changeWhat changeInto <span class="c002"> list </span><span class="c003">END</span></td><td class="c014"> Fine altering of a single transition. See the <a href="#sec-alter-trans"><span class="c003">ALTER_TRANS</span> tutorial</a>.</td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">REPLACE</span><a id="REPLACE"></a><a id="hevea_default21"></a> filename <a href="#state"><span class="c003">state</span></a> <span class="c002"> list </span><span class="c003">END</span></td><td class="c014"> This instructs WeiDU to load <span class="c003">filename.</span><a href="#DLG"><span class="c003">DLG</span></a> and replace some of its
<a href="#state"><span class="c003">state</span></a>s with the new ones described in the <a href="#state"><span class="c003">state</span></a> list.
All of the <a href="#state"><span class="c003">state</span></a>s should have numeric stateLabels (e.g., "5" or
"67"). A new <a href="#state"><span class="c003">state</span></a> with label <span class="c003">X</span> will replace the old
<a href="#state"><span class="c003">state</span></a> number <span class="c003">X</span>. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">SET_WEIGHT</span><a id="SET_WEIGHT"></a><a id="hevea_default22"></a> filename <a href="#stateLabel"><span class="c003">stateLabel</span></a> <span class="c003">#stateWeight</span></td><td class="c014"> This instructs WeiDU to destructively change the <a href="#WEIGHT"><span class="c003">WEIGHT</span></a> of the
given <a href="#state"><span class="c003">state</span></a> in <span class="c003">filename.</span><a href="#DLG"><span class="c003">DLG</span></a> (which must exist). This should only
be used to patch or workaround existing dialogues. Never use
<a href="#SET_WEIGHT"><span class="c003">SET_WEIGHT</span></a> if you can help it. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">REPLACE_SAY</span><a id="REPLACE_SAY"></a><a id="hevea_default23"></a> filename <a href="#stateLabel"><span class="c003">stateLabel</span></a> <a href="#sayText"><span class="c003">sayText</span></a></td><td class="c014"> This instructs WeiDU to destructively change the <a href="#sayText"><span class="c003">sayText</span></a> of the
given <a href="#state"><span class="c003">state</span></a> in <span class="c003">filename.</span><a href="#DLG"><span class="c003">DLG</span></a> (which must exist). This should only
be used to patch or workaround existing dialogues. Never use
<a href="#REPLACE_SAY"><span class="c003">REPLACE_SAY</span></a> if you can help it. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">REPLACE_STATE_TRIGGER</span><a id="REPLACE_STATE_TRIGGER"></a><a id="hevea_default24"></a> filename <a href="#stateNumber"><span class="c003">stateNumber</span></a>
<a href="#stateTriggerString"><span class="c003">stateTriggerString</span></a> <span class="c002"> [ </span><a href="#stateNumber"><span class="c003">stateNumber</span></a> <span class="c002"> list  ] </span>	<a href="#dActionWhen"><span class="c003">dActionWhen</span></a> <span class="c002"> list </span></td><td class="c014"> This instructs WeiDU to destructively set the
<a href="#stateTriggerString"><span class="c003">stateTriggerString</span></a> of all of the <a href="#state"><span class="c003">state</span></a>s with the given
<a href="#stateNumber"><span class="c003">stateNumber</span></a>s in the file <span class="c003">filename.</span><a href="#DLG"><span class="c003">DLG</span></a> (which must already
exist). It should be used with caution. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">REPLACE_TRIGGER_TEXT</span><a id="REPLACE_TRIGGER_TEXT"></a><a id="hevea_default25"></a> filename oldText newText
<a href="#dActionWhen"><span class="c003">dActionWhen</span></a> <span class="c002"> list </span></td><td class="c014"> This instructs WeiDU to destructively replace every occurrence of oldText
(which may be a <a href="#regexp"><span class="c003">regexp</span></a>) in the <a href="#stateTriggerString"><span class="c003">stateTriggerString</span></a>s and
<a href="#transTriggerString"><span class="c003">transTriggerString</span></a>s of <span class="c003">filename.</span><a href="#DLG"><span class="c003">DLG</span></a> (which must exist).
This should only be used to patch or workaround existing dialogues. Never
use this if you can help it. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">REPLACE_TRIGGER_TEXT_REGEXP</span><a id="REPLACE_TRIGGER_TEXT_REGEXP"></a><a id="hevea_default26"></a> filenameRegexp oldText newText
<a href="#dActionWhen"><span class="c003">dActionWhen</span></a> <span class="c002"> list </span></td><td class="c014"> Just like <a href="#REPLACE_TRIGGER_TEXT"><span class="c003">REPLACE_TRIGGER_TEXT</span></a> but the filename is a
<a href="#regexp"><span class="c003">regexp</span></a>. The .<a href="#DLG"><span class="c003">DLG</span></a> is implied. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">REPLACE_ACTION_TEXT</span><a id="REPLACE_ACTION_TEXT"></a><a id="hevea_default27"></a> filename oldText newText
<span class="c002"> [ </span>moreFilenames <span class="c002"> ] </span><a href="#dActionWhen"><span class="c003">dActionWhen</span></a> <span class="c002"> list </span></td><td class="c014"> This instructs WeiDU to destructively replace every occurrence of oldText
(which may be a <a href="#regexp"><span class="c003">regexp</span></a>) in the <a href="#stateActionString"><span class="c003">stateActionString</span></a>s
of <span class="c003">filename.</span><a href="#DLG"><span class="c003">DLG</span></a> (which must exist). This should only be used
to patch or workaround existing dialogues. Never use this if you can help
it. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">REPLACE_ACTION_TEXT_REGEXP</span><a id="REPLACE_ACTION_TEXT_REGEXP"></a><a id="hevea_default28"></a> filenameRegexp oldText newText
<span class="c002"> [ </span>moreFilenameRegexps <span class="c002"> ] </span><a href="#dActionWhen"><span class="c003">dActionWhen</span></a> <span class="c002"> list </span></td><td class="c014"> Just like <a href="#REPLACE_ACTION_TEXT"><span class="c003">REPLACE_ACTION_TEXT</span></a> but the filenames are
<a href="#regexp"><span class="c003">regexp</span></a>s. The .<a href="#DLG"><span class="c003">DLG</span></a> is implied, do not include it in your
<a href="#regexp"><span class="c003">regexp</span></a>s. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">REPLACE_ACTION_TEXT_PROCESS</span><a id="REPLACE_ACTION_TEXT_PROCESS"></a><a id="hevea_default29"></a> filename oldText newText
<span class="c002"> [ </span>moreFilenames <span class="c002"> ] </span><a href="#dActionWhen"><span class="c003">dActionWhen</span></a> <span class="c002"> list </span></td><td class="c014"> This instructs WeiDU to destructively replace every occurrence of oldText
(which may be a <a href="#regexp"><span class="c003">regexp</span></a>) in the <a href="#stateActionString"><span class="c003">stateActionString</span></a>s
of <span class="c003">filename.</span><a href="#DLG"><span class="c003">DLG</span></a> (which must exist) with newText. However,
newText is first compiled as a <a href="#BAF"><span class="c003">BAF</span></a> action list. In particular,
this means that replacing with commands like:
<pre class="verbatim">~DisplayString(Myself,@123)~
</pre>
... will do what you expect. This should only be used to patch or
workaround existing dialogues. Never use this if you can help it. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">R_A_T_P_R</span><a id="R_A_T_P_R"></a><a id="hevea_default30"></a>
filenameRegexp oldText newText
<span class="c002"> [ </span>moreFilenameRegexps <span class="c002"> ] </span><a href="#dActionWhen"><span class="c003">dActionWhen</span></a> <span class="c002"> list </span></td><td class="c014"> Just like <a href="#REPLACE_ACTION_TEXT_PROCESS"><span class="c003">REPLACE_ACTION_TEXT_PROCESS</span></a>, but the filenames are
<a href="#regexp"><span class="c003">regexp</span></a>s. The .<a href="#DLG"><span class="c003">DLG</span></a> is implied. R_A_T_P_R is
shorthand for REPLACE_ACTION_TEXT_PROCESS_REGEXP (to avoid undue scrollbars
in the readme on a 1024x768 monitor). </td></tr>
<tr><td class="c012">&nbsp;</td></tr>
<tr><td class="c012">
<span class="c005">dActionWhen</span><a id="dActionWhen"></a><a id="hevea_default31"></a></td><td class="c014">defines when a D action (E.G. <a href="#ADD_TRANS_ACTION"><span class="c003">ADD_TRANS_ACTION</span></a>) will
be processed or not. </td></tr>
<tr><td class="c012">is</td><td class="c014"><span class="c005">IF</span><a id="hevea_default32"></a> String</td><td class="c014">The action is processed if the element being
altered/replaced/added to contains a substring matching against the String
regexp. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">UNLESS</span><a id="hevea_default33"></a> String</td><td class="c014">The action is not processed if the element being
altered/replaced/added to contains a substring matching against the String
regexp. </td></tr>
<tr><td class="c012">&nbsp;</td></tr>
<tr><td class="c012">
<span class="c005">chainEpilogue</span><a id="chainEpilogue"></a><a id="hevea_default34"></a></td><td class="c014">&nbsp;</td><td class="c014">Determines where the dialogue should flow at the
end of the <a href="#CHAIN"><span class="c003">CHAIN</span></a>. </td></tr>
<tr><td class="c012">is</td><td class="c014"><span class="c003">END</span> filename stateNumber</td><td class="c014">Transfer to the given state in the given dialogue file. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c003">EXTERN</span> filename stateNumber</td><td class="c014">Transfer to the given state in the given dialogue file. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c003">COPY_TRANS</span> <span class="c002"> [ </span><span class="c003">SAFE</span> <span class="c002"> ] </span>filename stateNumber</td><td class="c014">At the end of the
<a href="#CHAIN"><span class="c003">CHAIN</span></a> text, copy all transitions from the given state in the
given file. This is useful for interjections (see <a href="#INTERJECT"><span class="c003">INTERJECT</span></a>). If <span class="c003">SAFE</span> is specified, <a href="#CHAIN"><span class="c003">CHAIN</span></a> will not warn about potentially unsafe uses of <span class="c003">COPY_TRANS</span> (use this if you know it is safe). </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c003">COPY_TRANS_LATE</span> <span class="c002"> [ </span><span class="c003">SAFE</span> <span class="c002"> ] </span>filename stateNumber</td><td class="c014">Same as above, but only copy after all the other <a href="#D%20Action"><span class="c003">D Action</span></a>s have been applied. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c003">EXIT</span></td><td class="c014">At the end of the <a href="#CHAIN"><span class="c003">CHAIN</span></a> text, exit the dialogue.</td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c003">END</span> <a href="#transition"><span class="c003">transition</span></a> <span class="c002"> list </span></td><td class="c014">Execute the given <a href="#transition"><span class="c003">transition</span></a>s
after the final state in the <a href="#CHAIN"><span class="c003">CHAIN</span></a>. </td></tr>
<tr><td class="c012">&nbsp;</td></tr>
<tr><td class="c012">
<span class="c005">state</span><a id="state"></a><a id="hevea_default35"></a></td><td class="c014">&nbsp;</td><td class="c014">In Infinity Engine games, this is the fundamental unit
of dialogue. </td></tr>
<tr><td class="c012">is</td><td class="c014"><span class="c003">IF</span> <span class="c002"> [ </span><span class="c005">WEIGHT</span><a id="WEIGHT"></a><a id="hevea_default36"></a> <span class="c003">#weightNumber</span> <span class="c002"> ] </span><span class="c005">stateTriggerString</span><a id="stateTriggerString"></a><a id="hevea_default37"></a> <span class="c002"> [ </span><span class="c003">THEN</span> <span class="c002"> ]  [ </span><span class="c003">BEGIN</span> <span class="c002"> ] </span><span class="c007"><span class="c003">stateLabel</span><a id="stateLabel"></a><a id="hevea_default38"></a> <span class="c003">SAY</span></span><a id="SAY"></a><a id="hevea_default39"></a> <a href="#sayText"><span class="c003">sayText</span></a> <span class="c002"> [ </span><span class="c003">=</span>
<a href="#sayText"><span class="c003">sayText</span></a> ... <span class="c002"> ] </span><a href="#transition"><span class="c003">transition</span></a> <span class="c002"> list </span><span class="c003">END</span></td><td class="c014"> When you start conversing with a creature that uses a <a href="#DLG"><span class="c003">DLG</span></a> file, the
Infinity Engine searches through all of the <a href="#state"><span class="c003">state</span></a>s in that file
in order of increasing <a href="#WEIGHT"><span class="c003">WEIGHT</span></a> and selects the first one it finds
for which the <a href="#stateTriggerString"><span class="c003">stateTriggerString</span></a> is both true and not empty.
The creature then says all of the associated <a href="#sayText"><span class="c003">sayText</span></a>. Finally,
the <a href="#transition"><span class="c003">transition</span></a>s are evaluated in bottom-up (i.e., reverse) order.
If a <a href="#transition"><span class="c003">transition</span></a> is found with a <a href="#transTriggerString"><span class="c003">transTriggerString</span></a> that
evaluates to True and no <a href="#replyText"><span class="c003">replyText</span></a>, that <a href="#transition"><span class="c003">transition</span></a> is
immediately executed. Otherwise, all of the <a href="#transition"><span class="c003">transition</span></a>s are
presented as options to the PC.<p>

If a <a href="#stateLabel"><span class="c003">stateLabel</span></a> is an integer it is called a
<span class="c005">stateNumber</span><a id="stateNumber"></a><a id="hevea_default40"></a>. All of the states in the <a href="#DLG"><span class="c003">DLG</span></a> files that
come with the original game use <a href="#stateNumber"><span class="c003">stateNumber</span></a>s. Only <a href="#D"><span class="c003">D</span></a>
files use symbolic strings for <a href="#stateLabel"><span class="c003">stateLabel</span></a>s.</p><p>

Including more than one bit of <a href="#sayText"><span class="c003">sayText</span></a> here is often called
<a href="#Multisay"><span class="c003">Multisay</span></a>.</p><p>

Finally, once you are familiar with the syntax you may omit the <span class="c003">THEN</span>
and <span class="c003">BEGIN</span> keywords if you like.
</p></td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">APPENDI</span><a id="APPENDI"></a><a id="hevea_default41"></a> filename <a href="#state"><span class="c003">state</span></a> <span class="c002"> list </span><span class="c003">END</span></td><td class="c014"> This is legacy syntax that behaves just like the <a href="#D%20Action"><span class="c003">D Action</span></a>
<a href="#APPEND"><span class="c003">APPEND</span></a> but is considered a <a href="#state"><span class="c003">state</span></a>. Avoid it. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">CHAIN2</span><a id="CHAIN2"></a><a id="hevea_default42"></a> entryFilename entryLabel
<span class="c003">chain2Text</span> <span class="c002"> list </span>exitFilename exitLabel</td><td class="c014"> This is legacy syntax that behaves somewhat like the <a href="#D%20Action"><span class="c003">D Action</span></a>
<a href="#CHAIN"><span class="c003">CHAIN</span></a> but is considered a <a href="#state"><span class="c003">state</span></a>. In addition,
<span class="c003">chain2Text</span> is slightly different from <a href="#chainText"><span class="c003">chainText</span></a>. Avoid
this construction. </td></tr>
<tr><td class="c012">&nbsp;</td></tr>
<tr><td class="c012">
<span class="c005">sayText</span><a id="sayText"></a><a id="hevea_default43"></a></td><td class="c014">&nbsp;</td><td class="c014"><span class="c003">sayText</span> and <span class="c005">replyText</span><a id="replyText"></a><a id="hevea_default44"></a> are displayed to
the user as part of a dialogue. </td></tr>
<tr><td class="c012">is</td><td class="c014"><a href="#text"><span class="c003">text</span></a></td><td class="c014"><span class="c003">sayText</span> and <span class="c003">replyText</span> are both <a href="#text"><span class="c003">text</span></a>. </td></tr>
<tr><td class="c012">&nbsp;</td></tr>
<tr><td class="c012">
<span class="c005">transition</span><a id="transition"></a><a id="hevea_default45"></a></td><td class="c014">&nbsp;</td><td class="c014">Transitions determine how dialogue flows from one
state to another. </td></tr>
<tr><td class="c012">
is</td><td class="c014"><span class="c003">IF</span> <span class="c005">transTriggerString</span><a id="transTriggerString"></a><a id="hevea_default46"></a> <span class="c002"> [ </span><span class="c003">THEN</span> <span class="c002"> ] </span><a href="#transFeature"><span class="c003">transFeature</span></a> <span class="c002"> list </span><a href="#transNext"><span class="c003">transNext</span></a></td><td class="c014"> If the <a href="#transTriggerString"><span class="c003">transTriggerString</span></a> evaluates to true or is empty, this
<a href="#transition"><span class="c003">transition</span></a> is viable. If it contains no <a href="#replyText"><span class="c003">replyText</span></a>
within its <a href="#transFeature"><span class="c003">transFeature</span></a> list, it is immediately taken.
Otherwise, the <a href="#replyText"><span class="c003">replyText</span></a> is presented as an option to the user.
If the transition is taken, any actions in the <a href="#transFeature"><span class="c003">transFeature</span></a>
list are performed and the dialogue flows to the point indicated by the
<a href="#transNext"><span class="c003">transNext</span></a>.
<a href="#transition"><span class="c003">transition</span></a>s are evaluated in "reverse order". That is, the "bottom"
or "last" response for a <a href="#state"><span class="c003">state</span></a> is checked first. If its
<a href="#transTriggerString"><span class="c003">transTriggerString</span></a>
evaluates to true and it has no <a href="#REPLY"><span class="c003">REPLY</span></a> text, that transition is
immediately taken. See <span class="c003">SAREV25A</span> <a href="#state"><span class="c003">state</span></a> 1 for an example of a
<a href="#state"><span class="c003">state</span></a> with all kinds of <a href="#transition"><span class="c003">transition</span></a>s. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c003">+</span> <span class="c002"> [ </span><a href="#transTriggerString"><span class="c003">transTriggerString</span></a> <span class="c002"> ] </span><span class="c003">+</span> <a href="#replyText"><span class="c003">replyText</span></a>
<a href="#transFeature"><span class="c003">transFeature</span></a> <span class="c002"> list </span><a href="#transNext"><span class="c003">transNext</span></a></td><td class="c014"> This abbreviated syntax for transitions that would contain <a href="#REPLY"><span class="c003">REPLY</span></a>
(which is by far the most common case) allows you to save yourself
some time and typing. It behaves like the full form above. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">COPY_TRANS</span><a id="COPY_TRANS"></a><a id="hevea_default47"></a> <span class="c002"> [ </span><span class="c003">SAFE</span> <span class="c002"> ] </span>filename <a href="#stateLabel"><span class="c003">stateLabel</span></a></td><td class="c014"> This instructs WeiDU to copy all of the <a href="#transition"><span class="c003">transition</span></a>s from the
<a href="#state"><span class="c003">state</span></a> with the given <a href="#stateLabel"><span class="c003">stateLabel</span></a> in <span class="c003">filename.</span><a href="#DLG"><span class="c003">DLG</span></a>. This
copying takes place before all other <a href="#D%20Action"><span class="c003">D Action</span></a>s. For example,
this is a valid <a href="#transition"><span class="c003">transition</span></a> list:

<pre width="40"><font color="#3159D1">IF <font color="#868626">~Before()~</font> THEN GOTO</font> my_state
<font color="#3159D1">COPY_TRANS</font> PLAYER1 <font color="#0000FF">33</font>
<font color="#3159D1">IF <font color="#868626">~After()~</font> THEN EXTERN</font> SOLA <font color="#0000FF">55</font></pre>

If <span class="c003">SAFE</span> is specified, <a href="#COPY_TRANS"><span class="c003">COPY_TRANS</span></a> will not warn about potentially unsafe uses (use this if you know it is safe). </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">COPY_TRANS_LATE</span><a id="COPY_TRANS_LATE"></a><a id="hevea_default48"></a> <span class="c002"> [ </span><span class="c003">SAFE</span> <span class="c002"> ] </span>filename <a href="#stateLabel"><span class="c003">stateLabel</span></a></td><td class="c014"> Same as <a href="#COPY_TRANS"><span class="c003">COPY_TRANS</span></a>, but is invoked after all other <a href="#D%20Action"><span class="c003">D Action</span></a>s. </td></tr>
<tr><td class="c012">&nbsp;</td></tr>
<tr><td class="c012">
<span class="c005">transFeature</span><a id="transFeature"></a><a id="hevea_default49"></a></td><td class="c014">&nbsp;</td><td class="c014">These are features or actions associated with
taking a transition. </td></tr>
<tr><td class="c012">is</td><td class="c014"><span class="c005">REPLY</span><a id="REPLY"></a><a id="hevea_default50"></a> <a href="#replyText"><span class="c003">replyText</span></a></td><td class="c014"> If this <a href="#transition"><span class="c003">transition</span></a> is taken, the PC says the <a href="#replyText"><span class="c003">replyText</span></a>. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c007"><span class="c003">DO</span><a id="DO"></a><a id="hevea_default51"></a> <span class="c003">stateActionString</span></span><a id="stateActionString"></a><a id="hevea_default52"></a></td><td class="c014"> If this <a href="#transition"><span class="c003">transition</span></a> is taken, the <a href="#stateActionString"><span class="c003">stateActionString</span></a> is
executed. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">JOURNAL</span><a id="JOURNAL"></a><a id="hevea_default53"></a> <a href="#text"><span class="c003">text</span></a></td><td class="c014"> If this <a href="#transition"><span class="c003">transition</span></a> is taken, the <a href="#text"><span class="c003">text</span></a> is added to the
PC’s journal. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">SOLVED_JOURNAL</span><a id="SOLVED_JOURNAL"></a><a id="hevea_default54"></a> <a href="#text"><span class="c003">text</span></a></td><td class="c014"> If this <a href="#transition"><span class="c003">transition</span></a> is taken, the <a href="#text"><span class="c003">text</span></a> is added to the
“solved” section of the PC’s journal. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">UNSOLVED_JOURNAL</span><a id="UNSOLVED_JOURNAL"></a><a id="hevea_default55"></a> <a href="#text"><span class="c003">text</span></a></td><td class="c014"> If this <a href="#transition"><span class="c003">transition</span></a> is taken, the <a href="#text"><span class="c003">text</span></a> is added to the
“unsolved” section of the PC’s journal. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">FLAGS</span><a id="FLAGS"></a><a id="hevea_default56"></a> integer</td><td class="c014"> This allows you to set the features associated with a transition directly
using the binary format of <a href="#DLG"><span class="c003">DLG</span></a> files. </td></tr>
<tr><td class="c012">&nbsp;</td></tr>
<tr><td class="c012">
<span class="c005">transNext</span><a id="transNext"></a><a id="hevea_default57"></a></td><td class="c014">&nbsp;</td><td class="c014">This determines where dialogue flows after a
transition has been taken. </td></tr>
<tr><td class="c012">is</td><td class="c014"><span class="c005">GOTO</span><a id="GOTO"></a><a id="hevea_default58"></a> <a href="#stateLabel"><span class="c003">stateLabel</span></a></td><td class="c014"> The dialogue continues at the state with label <a href="#stateLabel"><span class="c003">stateLabel</span></a> in the
same <a href="#DLG"><span class="c003">DLG</span></a> file as the current <a href="#state"><span class="c003">state</span></a>. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">EXTERN</span><a id="EXTERN"></a><a id="hevea_default59"></a> <span class="c002"> [ </span><span class="c003">IF_FILE_EXISTS</span> <span class="c002"> ] </span>filename <a href="#stateLabel"><span class="c003">stateLabel</span></a></td><td class="c014"> The dialogue continues at the state with label <a href="#stateLabel"><span class="c003">stateLabel</span></a> in the
file <span class="c003">filename.</span><a href="#DLG"><span class="c003">DLG</span></a>. The whole transition is not compiled if there’s
<span class="c003">IF_FILE_EXISTS</span> and the file filename doesn’t exist. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">EXIT</span><a id="EXIT"></a><a id="hevea_default60"></a></td><td class="c014"> The conversation ends. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c003">+</span> <a href="#stateLabel"><span class="c003">stateLabel</span></a></td><td class="c014"> This is a synonym for <a href="#GOTO"><span class="c003">GOTO</span></a>. </td></tr>
<tr><td class="c012">&nbsp;</td></tr>
<tr><td class="c012">
<span class="c005">chainText</span><a id="chainText"></a><a id="hevea_default61"></a></td><td class="c014">&nbsp;</td><td class="c014">This is a rapid shorthand for chaining together many
little bits of dialogue when the PC is not saying anything. </td></tr>
<tr><td class="c012">is</td><td class="c014"><span class="c002"> [ </span><span class="c003">IF</span> <a href="#transTriggerString"><span class="c003">transTriggerString</span></a> <span class="c003">THEN</span> <span class="c002"> ] </span><a href="#sayText"><span class="c003">sayText</span></a>
<span class="c003">=</span> <a href="#sayText"><span class="c003">sayText</span></a> ...</td><td class="c014">&nbsp;</td></tr>
<tr><td class="c012">followed by</td><td class="c014"> <span class="c002"> [ </span><span class="c003">==</span> <span class="c002"> [ </span><span class="c003">IF_FILE_EXISTS</span> <span class="c002"> ] </span>fileName
<span class="c002"> [ </span><span class="c003">IF</span> <a href="#transTriggerString"><span class="c003">transTriggerString</span></a> <span class="c003">THEN</span> <span class="c002"> ] </span><a href="#sayText"><span class="c003">sayText</span></a>
<span class="c003">=</span> <a href="#sayText"><span class="c003">sayText</span></a> ... <span class="c002"> ] </span></td><td class="c014"> The <span class="c003">==</span> (that’s two consecutive equal signs) marks the beginning of a
new speaker (indicated by fileName). If the
<a href="#transTriggerString"><span class="c003">transTriggerString</span></a> is true or if it is not present, this new
speaker says all of its <a href="#sayText"><span class="c003">sayText</span></a> in order. If the <span class="c003">IF_FILE_EXISTS</span>
part is present, these lines are not compiled at all if the current file is
not missing.
</td></tr>
<tr><td class="c012">or followed by</td><td class="c014"> <span class="c003">BRANCH</span> <a href="#transTriggerString"><span class="c003">transTriggerString</span></a> <span class="c003">BEGIN</span>
<span class="c002"> [ </span><span class="c003">==</span> <span class="c002"> [ </span><span class="c003">IF_FILE_EXISTS</span> <span class="c002"> ] </span>fileName
<span class="c002"> [ </span><span class="c003">IF</span> <a href="#transTriggerString"><span class="c003">transTriggerString</span></a> <span class="c003">THEN</span> <span class="c002"> ] </span><a href="#sayText"><span class="c003">sayText</span></a>
<span class="c003">=</span> <a href="#sayText"><span class="c003">sayText</span></a> ... <span class="c002"> ] </span><span class="c003">END</span></td><td class="c014"> As above, except that the first transTriggerString is appended to all
existing dialogue units.</td></tr>
<tr><td class="c012">&nbsp;</td></tr>
<tr><td class="c012">
<span class="c005">text</span><a id="text"></a><a id="hevea_default62"></a></td><td class="c014">&nbsp;</td><td class="c014">This represents strings that are shown to the player,
rather than strings that the game uses internally for predicates and
actions. </td></tr>
<tr><td class="c012">is</td><td class="c014"><a href="#String"><span class="c003">String</span></a> <span class="c002"> [ </span><span class="c003">[WAVEFILE]</span> <span class="c002"> ] </span></td><td class="c014">The given string is used for both male and
female players. The optional <span class="c003">[WAVEFILE]</span> is the associated sound. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><a href="#String"><span class="c003">String</span></a> <span class="c002"> [ </span><span class="c003">[WAVEFILE]</span> <span class="c002"> ] </span><a href="#String"><span class="c003">String</span></a> <span class="c002"> [ </span><span class="c003">[WAVEFILE]</span> <span class="c002"> ] </span></td><td class="c014">The first string and sound file are used if the PC is male, the second
string and sound file are used if the PC is female. This is useful mainly
for international versions of Infinity Engine games. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c003">!integer</span> <a href="#text"><span class="c003">text</span></a></td><td class="c014"><span class="c005">Forced String Reference</span><a id="Forced String Reference"></a><a id="hevea_default63"></a>. As with
<a href="#text"><span class="c003">text</span></a> in general, but rather than being assigned a new,
previously-unused <span class="c003">DIALOG.TLK</span> string entry (or merging with an existing
one that has the same <a href="#text"><span class="c003">text</span></a>), this <a href="#text"><span class="c003">text</span></a> is written over
<span class="c003">DIALOG.TLK</span> string entry #<span class="c003">integer</span>. <em>Do not use this without a real reason.</em>
</td></tr>
<tr><td class="c012">or</td><td class="c014"><a href="#reference"><span class="c003">reference</span></a></td><td class="c014">&nbsp;</td></tr>
<tr><td class="c012">&nbsp;</td></tr>
<tr><td class="c012">
<span class="c005">reference</span><a id="reference"></a><a id="hevea_default64"></a></td><td class="c014">&nbsp;</td><td class="c014">This is a subset of <a href="#text"><span class="c003">text</span></a>. </td></tr>
<tr><td class="c012">is</td><td class="c014"><span class="c003">#integer</span></td><td class="c014">The string with reference number <span class="c003">#integer</span> from
<span class="c003">DIALOG.</span><a href="#TLK"><span class="c003">TLK</span></a> should be used unchanged. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c003">@integer</span></td><td class="c014">The last definition of the translation string
<span class="c003">@integer</span> given in any <a href="#TRA"><span class="c003">TRA</span></a> file should be used.</td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c003">( AT <span class="c007">"</span>var<span class="c007">"</span> )</span></td><td class="c014">The last definition of the translation string
(with value defined by a variable) given in any <a href="#TRA"><span class="c003">TRA</span></a> file should be used.</td></tr>
<tr><td class="c012">&nbsp;</td></tr>
<tr><td class="c012">
<span class="c005">String</span><a id="String"></a><a id="hevea_default65"></a><a id="string"></a></td><td class="c014">&nbsp;</td><td class="c014">This is how you tell WeiDU what text you want shown
to the player. For international mods or international translations, you
may use any encoding you like (that is, you are not restricted to 7-bit
characters or Latin-1 or anything like that). </td></tr>
<tr><td class="c012">is</td><td class="c014"><span class="c007">"</span>abcdef<span class="c007">"</span></td><td class="c014">A string can be any sequence of characters not
including a " that is enclosed in ""s. </td></tr>
<tr><td class="c012">or</td><td class="c014"><code><span class="c007">~</span></code>abcdef<code><span class="c007">~</span></code></td><td class="c014">A string can be any sequence of
characters not including a <code>~</code> that is enclosed in
<code>~~</code>s. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c007">%</span>abcdef<span class="c007">%</span></td><td class="c014">A string can be any sequence of characters not
including a % that is enclosed in %%s. This is handy for Big5
translations, since " and <code>~</code> can be part of Big5-encoded characters.
</td></tr>
<tr><td class="c012">or</td><td class="c014"><code><span class="c007">~~~~~</span></code>abcdef<code><span class="c007">~~~~~</span></code></td><td class="c014">That’s five consecutive
tildes on each side. A string can be any
sequence of characters not including <code>~~~~~</code> that is enclosed in
<code>~~~~~</code>s. For example,
string #8750 is
<code><span class="c002">~!@#$\%^&amp;*()_+-=[]{}\|;:'",&lt;.&gt;/?</span></code>
and can be given to WeiDU as
<code>~~~~~<span class="c002">~!@#$\%^&amp;*()_+-=[]{}\|;:'",&lt;.&gt;/?</span>~~~~~</code>
(the content of the string is shown in red for clarity).
</td></tr>
<tr><td class="c012">or</td><td class="c014"><a href="#String"><span class="c003">String</span></a> <span class="c003">^</span> <a href="#String"><span class="c003">String</span></a></td><td class="c014">String literal concatenation.
The second string is appended to the first string. No whitespace is added.
Thus <span class="c003">"hello" ^ "World"</span> is the same as <span class="c003">"helloWorld"</span>.</td></tr>
</table>
<!--TOC section id="sec6" Scripts-->
<h2 class="section" id="sec6">5  Scripts</h2><!--SEC END --><p>The Infinity Engine uses scripts in a bytecode format, known as
<span class="c003">BCS</span>. Bytecode is not human-friendly, and the textual format
<span class="c003">BAF</span> was derived from <span class="c003">BCS</span>. WeiDU includes a <span class="c003">BAF</span> compiler
for turning <span class="c003">BAF</span> scripts into <span class="c003">BCS</span> scripts and a decompiler for
the reverse transformation. The <span class="c003">BCS</span> format will not be documented
here, but the format is described by the
<a href="https://gibberlings3.github.io/iesdp/file_formats/ie_formats/bcs.htm">IESDP</a>.</p><p>The <span class="c003">BAF</span> format accepted by WeiDU’s compiler is documented here in an extended context-free grammar notation.</p><p>Syntactical keywords are given in a <span class="c003">UPPERCASE COURIER</span>.
Other keywords are symbolic, with the exception of <span class="c003">TriggerOverride</span> which is not symbolic and not written in uppercase. Notes:
</p><ul class="itemize"><li class="li-itemize">
foo <span class="c002"> list </span>means zero or more copies of foo.
</li><li class="li-itemize"><span class="c002"> [ </span>foo <span class="c002"> ] </span>means an optional foo or zero or one copies of foo.
</li><li class="li-itemize">foo bar ... means one or more copies of foo bar.
</li></ul><table class="c000 cellpadding1" border=1><tr><td class="c012"><span class="c005">BAF File</span><a id="BAF File"></a><a id="hevea_default66"></a><a id="BAF"></a></td><td class="c014">&nbsp;</td><td class="c014">
A <a href="#BAF%20File"><span class="c003">BAF File</span></a> is a text file that contains zero or more script
blocks. <a href="#BAF%20File"><span class="c003">BAF File</span></a>s are compiled into <span class="c003">BCS</span> files, either by
the <a href="#COMPILE"><span class="c003">COMPILE</span></a> <span class="c003">TP2</span> action or on the command line. </td></tr>
<tr><td class="c012">
is</td><td class="c014"><a href="#script%20block"><span class="c003">script block</span></a> <span class="c002"> list </span></td><td class="c014">&nbsp;</td></tr>
<tr><td class="c012">&nbsp;</td></tr>
<tr><td class="c012">
<span class="c005">script block</span><a id="script block"></a><a id="hevea_default67"></a></td><td class="c014">&nbsp;</td><td class="c014">&nbsp;</td></tr>
<tr><td class="c012">
is</td><td class="c014"><span class="c003">IF</span> <a href="#script%20trigger"><span class="c003">script trigger</span></a> ... <span class="c003">THEN</span> <a href="#script%20response"><span class="c003">script response</span></a> ... <span class="c003">END</span></td><td class="c014">
If the <a href="#script%20trigger"><span class="c003">script trigger</span></a>(s) are true, the <a href="#script%20response"><span class="c003">script response</span></a>(s)
are evaluated. </td></tr>
<tr><td class="c012">&nbsp;</td></tr>
<tr><td class="c012">
<span class="c005">script trigger</span><a id="script trigger"></a><a id="hevea_default68"></a></td><td class="c014">&nbsp;</td><td class="c014">&nbsp;</td></tr>
<tr><td class="c012">
is</td><td class="c014"><span class="c002"> [ </span>!<span class="c002"> ] </span><a href="#Infinity%20Engine%20trigger"><span class="c003">Infinity Engine trigger</span></a></td><td class="c014">
What constitutes an <span class="c005">Infinity Engine trigger</span><a id="Infinity Engine trigger"></a><a id="hevea_default69"></a> (trigger)
varies between different versions of the Infinity Engine and will
not be documented here. Refer to the right section of the
<a href="https://gibberlings3.github.io/iesdp/scripting/triggers/index.htm">IESDP</a>.
A preceding exclamation mark negates the trigger. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c002"> [ </span>!<span class="c002"> ] </span><span class="c003">TriggerOverride</span>(<a href="#Infinity%20Engine%20object"><span class="c003">Infinity Engine object</span></a>,<a href="#Infinity%20Engine%20trigger"><span class="c003">Infinity Engine trigger</span></a>)</td><td class="c014">
<span class="c003">TriggerOverride</span>() is a form of syntactical sugar enabled by
WeiDU. It does not constitute a trigger of itself, does not exist in
<span class="c003">BCS</span> form and it is only available on versions of the Infinity
Engine which implement the <span class="c003">NextObjectTrigger</span>()
trigger. <span class="c003">TriggerOverride</span>() is compiled into
<span class="c003">NextObjectTrigger</span>() and <span class="c003">NextObjectTrigger</span>() is decompiled
into <span class="c003">TriggerOverride</span>(). Use of <span class="c003">TriggerOverride</span>() is
semantically identical to use of <span class="c003">NextObjectTrigger</span>() but may be
a syntactically preferable short-hand. An exclamation mark before
<span class="c003">TriggerOverride</span> negates the trigger.<p>What constitutes an <span class="c005">Infinity Engine object</span><a id="Infinity Engine object"></a><a id="hevea_default70"></a> varies between
different versions of the Infinity Engine and will not be documented
here. </p></td></tr>
<tr><td class="c012">&nbsp;</td></tr>
<tr><td class="c012">
<span class="c005">script response</span><a id="script response"></a><a id="hevea_default71"></a></td><td class="c014">&nbsp;</td><td class="c014">&nbsp;</td></tr>
<tr><td class="c012">
is</td><td class="c014"><span class="c003">RESPONSE</span> <span class="c003">#</span>weight <a href="#Infinity%20Engine%20action"><span class="c003">Infinity Engine action</span></a> ...</td><td class="c014">
weight is a non-negative integer that gives the evaluation
probability of the response block relative to any other response
blocks in the same <a href="#script%20block"><span class="c003">script block</span></a>. What constitutes an
<span class="c005">Infinity Engine action</span><a id="Infinity Engine action"></a><a id="hevea_default72"></a> (action) varies between different
versions of the Infinity Engine and will not be documented
here. Refer to the right section of the
<a href="https://gibberlings3.github.io/iesdp/scripting/actions/index.htm">IESDP</a>.
Any time an Infinity Engine String Reference (strref) is expected by
an action, you can use <a href="#text"><span class="c003">text</span></a>. When the script is compiled,
WeiDU will add the text as a string and insert the corresponding
strref in its stead. </td></tr>
</table>
<!--TOC section id="sec7" Command Line Options-->
<h2 class="section" id="sec7">6  Command Line Options</h2><!--SEC END --><p>WeiDU is a command-line utility. GUIs are available, but this document only
describes command-line invocation. Use the DOS Shell ("command" or "cmd")
to run WeiDU. You control its behavior by passing arguments to it on the
command line.</p><p>You invoke WeiDU by typing <span class="c003">WeiDU</span> and then any number of options and
files, as described below.</p><p>Note: since it may not be obvious, if an option accepts ’X’ and says to be
cumulative, if you want to apply it multiple times you have to use the following
hideousness:
</p><pre class="verbatim">weidu --string 1 --string 2 --string 3
</pre><p>
This does not apply to *-rest commands like --biff-get-rest and --force-install-rest.</p><p>Moreover, *-rest commands must be the last, EG
</p><pre class="verbatim">weidu --biff-get-rest sw1h01.itm --out foo
</pre><p>
will try to extract sw1h01.itm, --out and foo from the biffs; you have to express the above as
</p><pre class="verbatim">weidu --out foo --biff-get-rest sw1h01.itm
</pre><p>*-list commands work like the -rest variants, except that they stop parsing for the current
switch once they find an option starting with ’-’. Basically, this works like you’d expect:
</p><pre class="verbatim">weidu --biff-get-list sw1h01.itm --out foo
</pre><table class="c000 cellpadding1" border=1><tr><td class="c008" colspan=2> <span class="c002"> Compiling And Decompiling </span> </td></tr>
<tr><td class="c015"><span class="c003">FILE.</span><a href="#D"><span class="c003">D</span></a></td><td class="c014">Compile <span class="c003">FILE</span> to a <a href="#DLG"><span class="c003">DLG</span></a> (dialogue file). </td></tr>
<tr><td class="c015"><span class="c003">FILE.</span><a href="#DLG"><span class="c003">DLG</span></a></td><td class="c014">Decompile <span class="c003">FILE</span> to a <a href="#D"><span class="c003">D</span></a> (dialogue text file). </td></tr>
<tr><td class="c015"><span class="c003">number</span></td><td class="c014">When decompiling a <a href="#DLG"><span class="c003">DLG</span></a> file to a <a href="#D"><span class="c003">D</span></a>
file, emit only state <span class="c003">number</span>. You may specify this multiple times and
only the states you specify will be emitted. </td></tr>
<tr><td class="c015"><span class="c003">numberA-numberB</span></td><td class="c014">When decompiling a <a href="#DLG"><span class="c003">DLG</span></a> file to a
<a href="#D"><span class="c003">D</span></a> file, emit only states between <span class="c003">numberA</span> and <span class="c003">numberB</span>
(inclusive). You may specify this multiple times and only the states you
specify will be emitted. </td></tr>
<tr><td class="c015"><span class="c003">FILE.</span><a href="#BAF"><span class="c003">BAF</span></a></td><td class="c014">Compile <span class="c003">FILE</span> to a <a href="#BCS"><span class="c003">BCS</span></a> (script file). </td></tr>
<tr><td class="c015"><span class="c003">FILE.</span><a href="#BCS"><span class="c003">BCS</span></a></td><td class="c014">Decompile <span class="c003">FILE</span> to a <a href="#BAF"><span class="c003">BAF</span></a> (script text file). </td></tr>
<tr><td class="c015"><span class="c005">--script-style</span><a id="--script-style"></a><a id="hevea_default73"></a> <span class="c003">X</span></td><td class="c014">Use the given <a href="#BAF"><span class="c003">BAF</span></a>/<a href="#BCS"><span class="c003">BCS</span></a>
scripting style. <span class="c003">X</span> must be <span class="c003">BG</span> or <span class="c003">BG1</span> or <span class="c003">BG2</span> or <span class="c003">PST</span> or <span class="c003">IWD</span> or <span class="c003">IWD1</span>
or <span class="c003">IWD2</span>. </td></tr>
<tr><td class="c015"><span class="c005">--transin</span><a id="--transin"></a><a id="hevea_default74"></a> <span class="c003">X</span></td><td class="c014">Use <span class="c003">FILE</span> as a source of translation strings
when processing <a href="#D"><span class="c003">D</span></a> and <a href="#BAF"><span class="c003">BAF</span></a> files. </td></tr>
<tr><td class="c015"><span class="c003">FILE.</span><a href="#TRA"><span class="c003">TRA</span></a></td><td class="c014">Equivalent to <a href="#--transin"><span class="c003">--transin</span></a> <span class="c003">FILE.TRA</span>. </td></tr>
<tr><td class="c015">&nbsp;</td></tr>
<tr><td class="c008" colspan=2> <span class="c002"> Module Packaging Input And Control</span> </td></tr>
<tr><td class="c015"><span class="c003">FILE.</span><a href="#TP"><span class="c003">TP</span></a> or
<span class="c003">FILE.</span><a href="#TP2"><span class="c003">TP2</span></a></td><td class="c014">Read <span class="c003">FILE</span> and ask the user whether to install,
reinstall or uninstall its <a href="#TP2"><span class="c003">TP2</span></a> <a href="#Component"><span class="c003">Component</span></a>s. </td></tr>
<tr><td class="c015"><span class="c005">--yes</span><a id="--yes"></a><a id="hevea_default75"></a></td><td class="c014">Answer all <a href="#TP2"><span class="c003">TP2</span></a> questions with ’Yes’ and do not
prompt for a key to be pressed at the end of <a href="#TP2"><span class="c003">TP2</span></a> processing. </td></tr>
<tr><td class="c015"><span class="c005">--uninstall</span><a id="--uninstall"></a><a id="hevea_default76"></a> 	</td><td class="c014">Answer all <a href="#TP2"><span class="c003">TP2</span></a> questions with ’Uninstall’
and do not prompt for a key to be pressed at the end of <a href="#TP2"><span class="c003">TP2</span></a>
processing. </td></tr>
<tr><td class="c015"><span class="c005">--reinstall</span><a id="--reinstall"></a><a id="hevea_default77"></a> 	</td><td class="c014">Re-install all <a href="#TP2"><span class="c003">TP2</span></a> components that are
already installed and do not prompt for a key to be pressed at the end of
<a href="#TP2"><span class="c003">TP2</span></a> processing. </td></tr>
<tr><td class="c015"><span class="c005">--language</span><a id="--language"></a><a id="hevea_default78"></a> <span class="c003">X</span></td><td class="c014">Sets the <a href="#TP2"><span class="c003">TP2</span></a> <a href="#Language"><span class="c003">Language</span></a> to the one
passed here. Has no effect if the value is bigger than the language count
(I.E. you’ll get asked for the language, unless you gave --uninstall, --reinstall
or --force-uninstall). </td></tr>
<tr><td class="c015"><span class="c005">--force-install</span><a id="--force-install"></a><a id="hevea_default79"></a> <span class="c003">X</span></td><td class="c014">installs component number X, skips the others (cumulative). </td></tr>
<tr><td class="c015"><span class="c005">--force-uninstall</span><a id="--force-uninstall"></a><a id="hevea_default80"></a> <span class="c003">X</span></td><td class="c014">uninstalls component number X, skips the others (cumulative).
If there is no --force-install, you don’t get asked for the language. </td></tr>
<tr><td class="c015"><span class="c005">--force-install-rest</span><a id="--force-install-rest"></a><a id="hevea_default81"></a> <span class="c003">X Y...</span></td><td class="c014">installs component number X Y...,
skips the others (cumulative). </td></tr>
<tr><td class="c015"><span class="c005">--force-uninstall-rest</span><a id="--force-uninstall-rest"></a><a id="hevea_default82"></a> <span class="c003">X Y...</span></td><td class="c014">uninstalls component number X Y...,
skips the others (cumulative). </td></tr>
<tr><td class="c015"><span class="c005">--force-install-list</span><a id="--force-install-list"></a><a id="hevea_default83"></a> <span class="c003">X Y...</span></td><td class="c014">installs component number X Y...,
skips the others (cumulative). </td></tr>
<tr><td class="c015"><span class="c005">--force-uninstall-list</span><a id="--force-uninstall-list"></a><a id="hevea_default84"></a> <span class="c003">X Y...</span></td><td class="c014">uninstalls component number X Y...,
skips the others (cumulative). </td></tr>
<tr><td class="c015"><span class="c005">--quick-menu</span><a id="--quick-menu"></a><a id="hevea_default85"></a> <span class="c003">X</span></td><td class="c014">installs the <a href="#QUICK_MENU"><span class="c003">QUICK_MENU</span></a> selection X. Can be combined with
--force-install and friends, but only if the latter components are defined in ALWAYS_ASK.
</td></tr>
<tr><td class="c015"><span class="c005">--skip-at-view</span><a id="--skip-at-view"></a><a id="hevea_default86"></a></td><td class="c014">AT_*  VIEW this  actions (and the extra chromosome versions like
 NOTEPAD this ) aren’t processed, while still processing batch files and similia. </td></tr>
<tr><td class="c015"><span class="c005">--safe-exit</span><a id="--safe-exit"></a><a id="hevea_default87"></a></td><td class="c014">Save weidu.log every time a component installation is begun.
This makes it impossible to uninstall components (don’t ask), but allows the user to kill
the weidu process (E.G. closing the DOS console via the X button) without leaving the game in an
unrecoverably inconsistent state (you can [R]e or [U]ninstall the component and the game will be
consistent again). This might break with mods using overly complicated AT_* actions (basically
don’t use this with Big Mods). </td></tr>
<tr><td class="c015"><span class="c005">--save-components-name</span><a id="--save-components-name"></a><a id="hevea_default88"></a></td><td class="c014">Reprints weidu.log. Useful if you install with --quick-log. </td></tr>
<tr><td class="c015"><span class="c005">--ask-every</span><a id="--ask-every"></a><a id="hevea_default89"></a></td><td class="c014">Behave as if <a href="#ASK_EVERY_COMPONENT"><span class="c003">ASK_EVERY_COMPONENT</span></a> were
present for all <a href="#TP2"><span class="c003">TP2</span></a> components. </td></tr>
<tr><td class="c015"><span class="c005">--ask-only</span><a id="--ask-only"></a><a id="hevea_default90"></a> <span class="c003">X Y ...</span></td><td class="c014">Limit the interactive installer to
only asking about components number X Y..., skipping the others
(cumulative) </td></tr>
<tr><td class="c015"><span class="c005">--continue</span><a id="--continue"></a><a id="hevea_default91"></a></td><td class="c014">Continue <a href="#TP2"><span class="c003">TP2</span></a> processing despite
<a href="#TP2%20Action"><span class="c003">TP2 Action</span></a> errors. </td></tr>
<tr><td class="c015"><span class="c005">--args</span><a id="--args"></a><a id="hevea_default92"></a> <span class="c003">X</span></td><td class="c014">X will be stored in the tp2 variable <code>%argv[n]%</code>, where
n is 0 for the first argument, 1 for the second, etc.<p>If the installation is non-interactive, said variables will be loaded from the last interactive
session. </p></td></tr>
<tr><td class="c015"><span class="c005">--args-rest</span><a id="--args-rest"></a><a id="hevea_default93"></a> <span class="c003">X Y...</span></td><td class="c014">X Y Z will be stored in the tp2 variables <code>%argv[n]%</code>,
where n is 0 for the first argument, 1 for the second, etc.<p>If the installation is non-interactive, said variables will be loaded from the last interactive
session. </p></td></tr>
<tr><td class="c015"><span class="c005">--args-list</span><a id="--args-list"></a><a id="hevea_default94"></a> <span class="c003">X Y...</span></td><td class="c014">X Y Z will be stored in the tp2 variables <code>%argv[n]%</code>,
where n is 0 for the first argument, 1 for the second, etc.<p>If the installation is non-interactive, said variables will be loaded from the last interactive
session. </p></td></tr>
<tr><td class="c015"><span class="c005">--debug-assign</span><a id="--debug-assign"></a><a id="hevea_default95"></a></td><td class="c014">Print out all values assigned to <a href="#TP2"><span class="c003">TP2</span></a>
variables (even implicit ones created by <span class="c003">WeiDU</span>). </td></tr>
<tr><td class="c015"><span class="c005">--debug-value</span><a id="--debug-value"></a><a id="hevea_default96"></a></td><td class="c014">Print out all <a href="#value"><span class="c003">value</span></a>s encountered in
<a href="#TP2"><span class="c003">TP2</span></a> processing and the results they evaluate to. Among other
things, this is useful for catching parenthesis errors in your
<a href="#value"><span class="c003">value</span></a>s. </td></tr>
<tr><td class="c015"><span class="c005">--modder</span><a id="--modder"></a><a id="hevea_default97"></a><span class="c003"> <span class="c002"> [ </span>X Y <span class="c002"> ]  list </span></span></td><td class="c014">enables the
<a href="#MODDER"><span class="c003">MODDER</span></a> mode and sets the <a href="#MODDER"><span class="c003">MODDER</span></a> option X to Y (cumulative,
-list syntax).
</td></tr>
<tr><td class="c015"><span class="c005">--clear-memory</span><a id="--clear-memory"></a><a id="hevea_default98"></a></td><td class="c014">calls <a href="#CLEAR_MEMORY"><span class="c003">CLEAR_MEMORY</span></a> after every <a href="#TP2"><span class="c003">TP2</span></a> action.
</td></tr>
<tr><td class="c008" colspan=2> <span class="c002"> Automatic Updating Options </span> </td></tr>
<tr><td class="c015"><span class="c005">--update-all</span><a id="--update-all"></a><a id="hevea_default99"></a></td><td class="c014">Auto-update all <span class="c003">WeiDU</span> setup files (e.g.,
<span class="c003">Setup-MyMod.exe</span>) in the current directory. </td></tr>
<tr><td class="c015"><span class="c005">--noautoupdate</span><a id="--noautoupdate"></a><a id="hevea_default100"></a></td><td class="c014">If you are running <span class="c003">WeiDU</span> as
<span class="c003">Setup-MyMod.exe</span>, do not attempt to update yourself or any other mod. </td></tr>
<tr><td class="c015"><span class="c005">--no-auto-tp2</span><a id="--no-auto-tp2"></a><a id="hevea_default101"></a></td><td class="c014">Do not run <span class="c003">setup-mymod.tp2</span> even if <span class="c003">WeiDU</span> is
running as <span class="c003">setup-mymod.exe</span>. </td></tr>
<tr><td class="c015"><span class="c005">--noselfupdatemsg</span><a id="--noselfupdatemsg"></a><a id="hevea_default102"></a></td><td class="c014">If you are running <span class="c003">WeiDU</span> as
<span class="c003">Setup-MyMod.exe</span> and it automatically updates itself, do not display a
message or ask the user to press return. </td></tr>
<tr><td class="c015">&nbsp;</td></tr>
<tr><td class="c008" colspan=2> <span class="c002"> Infinity Engine Game Location Options </span> </td></tr>
<tr><td class="c015"><span class="c005">--game</span><a id="--game"></a><a id="hevea_default103"></a><span class="c003"> X	</span></td><td class="c014">Set main game directory to <span class="c003">X</span>. WeiDU looks for
<span class="c003">CHITIN.</span><a href="#KEY"><span class="c003">KEY</span></a> and <span class="c003">DIALOG.</span><a href="#TLK"><span class="c003">TLK</span></a> and the <span class="c003">override</span>
directory in the main game directory (but see <a href="#--tlkin"><span class="c003">--tlkin</span></a> and
<a href="#--search"><span class="c003">--search</span></a>). WeiDU will look in the current directory and use the
registry to find your game. If this fails, you will need to run WeiDU using
the <a href="#--game"><span class="c003">--game</span></a> switch to define the full path to the BG2 directory.
WeiDU will also search for BG1, IWD and PST. </td></tr>
<tr><td class="c015"><span class="c005">--nogame</span><a id="--nogame"></a><a id="hevea_default104"></a></td><td class="c014">Do not
load any default game files. Unless you also specified <a href="#--tlkin"><span class="c003">--tlkin</span></a>, no
<span class="c003">DIALOG.TLK</span> will be loaded. Unless you also specified <a href="#--search"><span class="c003">--search</span></a>,
no <span class="c003">override</span> directory will be used. </td></tr>
<tr><td class="c015"><span class="c005">--game-by-type</span><a id="--game-by-type"></a><a id="hevea_default105"></a><span class="c003"> X</span></td><td class="c014">tries to guess the game path by reading
the registry; X can be one of BG1, BG2, PST, IWD1 or IWD2. BGEE is unsupported.
</td></tr>
<tr><td class="c015"><span class="c005">--search</span><a id="--search"></a><a id="hevea_default106"></a> <span class="c003">X</span>	</td><td class="c014">Look in <span class="c003">X</span> for input files (cumulative).
<span class="c003">X</span> is treated as an <span class="c003">override</span> directory and is given priority over
the default <span class="c003">override</span> directory. </td></tr>
<tr><td class="c015">&nbsp;</td></tr>
<tr><td class="c008" colspan=2> <span class="c002"> Game Text (</span><a href="#TLK"><span class="c004">TLK</span></a><span class="c002">) File Input</span> </td></tr>
<tr><td class="c015"><span class="c005">--use-lang</span><a id="--use-lang"></a><a id="hevea_default107"></a> <span class="c003">X</span></td><td class="c014">On multi-language games (e.g., BGEE), use the files
in lang/X/ instead of asking which lang/X/ to use. This answer is saved
and --use-lang can override a previously saved answer.</td></tr>
<tr><td class="c015"><span class="c005">--tlkin</span><a id="--tlkin"></a><a id="hevea_default108"></a> <span class="c003">X</span></td><td class="c014">Use <span class="c003">X</span> as <span class="c003">DIALOG.</span><a href="#TLK"><span class="c003">TLK</span></a> (instead
of looking for <span class="c003">DIALOG.TLK</span> in the game directory). </td></tr>
<tr><td class="c015"><span class="c005">--ftlkin</span><a id="--ftlkin"></a><a id="hevea_default109"></a> <span class="c003">X</span></td><td class="c014">Use <span class="c003">X</span> as <span class="c003">DIALOGF.</span><a href="#TLK"><span class="c003">TLK</span></a> (instead
of looking for <span class="c003">DIALOGF.TLK</span> in the game directory). </td></tr>
<tr><td class="c015"><span class="c003">FILE.</span><a href="#TLK"><span class="c003">TLK</span></a></td><td class="c014">Equivalent to <a href="#--tlkin"><span class="c003">--tlkin</span></a> <span class="c003">X</span>. </td></tr>
<tr><td class="c015"><span class="c005">--tlkmerge</span><a id="--tlkmerge"></a><a id="hevea_default110"></a> <span class="c003">X</span>	</td><td class="c014">Merge strings from <span class="c003">X</span> over the strings from any other loaded <span class="c003">DIALOG.</span><a href="#TLK"><span class="c003">TLK</span></a><span class="c003">.</span> </td></tr>
<tr><td class="c015">&nbsp;</td></tr>
<tr><td class="c008" colspan=2> <span class="c002"> General Output Options</span> </td></tr>
<tr><td class="c015"><span class="c005">--out</span><a id="--out"></a><a id="hevea_default111"></a> <span class="c003">X</span></td><td class="c014">	Emit most output files generated by command-line
options (e.g., <a href="#D"><span class="c003">D</span></a>, <a href="#DLG"><span class="c003">DLG</span></a>, kits, <a href="#--biff-get"><span class="c003">--biff-get</span></a>,
<a href="#BAF"><span class="c003">BAF</span></a>, <a href="#BCS"><span class="c003">BCS</span></a>, <a href="#--automate"><span class="c003">--automate</span></a>, <a href="#--traify-tlk"><span class="c003">--traify-tlk</span></a>,
<a href="#--extract-kits"><span class="c003">--extract-kits</span></a>, <a href="#--list-biffs"><span class="c003">--list-biffs</span></a>, <a href="#--cmp-from"><span class="c003">--cmp-from</span></a>,
<a href="#--dcmp-from"><span class="c003">--dcmp-from</span></a>, etc.) to file <span class="c003">X</span>. If <span class="c003">X</span> is a directory,
certain commands (e.g., <a href="#D"><span class="c003">D</span></a>, <a href="#DLG"><span class="c003">DLG</span></a>, <a href="#--biff-get"><span class="c003">--biff-get</span></a>, etc.)
will place their output there. Does not affect <a href="#TP2"><span class="c003">TP2</span></a> processing. </td></tr>
<tr><td class="c015"><span class="c005">--append</span><a id="--append"></a><a id="hevea_default112"></a> <span class="c003">X</span></td><td class="c014">Like <a href="#--out"><span class="c003">--out</span></a>, but if <span class="c003">X</span> is an existing
file then the result will be appended to it instead of overwriting it. </td></tr>
<tr><td class="c015"><span class="c005">--backup</span><a id="--backup"></a><a id="hevea_default113"></a> <span class="c003">X</span></td><td class="c014">	Backup files to directory <span class="c003">X</span> before overwriting. Does not affect <a href="#TP2"><span class="c003">TP2</span></a> processing. </td></tr>
<tr><td class="c015"><span class="c005">--tlkout</span><a id="--tlkout"></a><a id="hevea_default114"></a> <span class="c003">X</span></td><td class="c014">Redirect the output dialog to X. If any strings were added to or changed in the loaded <span class="c003">DIALOG.TLK</span>, emit <span class="c003">X</span> as an updated version that reflects those changes. Many operations (e.g., compiling <span class="c003">D</span> files, <a href="#--tlkmerge"><span class="c003">--tlkmerge</span></a>, <a href="#STRING_SET"><span class="c003">STRING_SET</span></a>) can add to or modify <span class="c003">DIALOG.TLK</span>. If this option is not provided, the output dialog is the same as the input dialog. </td></tr>
<tr><td class="c015"><span class="c005">--ftlkout</span><a id="--ftlkout"></a><a id="hevea_default115"></a> <span class="c003">X</span></td><td class="c014">Redirect the output dialogf to X. If any strings were added to or changed in the
loaded <span class="c003">DIALOGF.TLK</span>, emit <span class="c003">X</span> as an updated version that reflects
those changes. If this options is not provided, the output dialogf is the same as the input dialogf. </td></tr>
<tr><td class="c015"><span class="c005">--version</span><a id="--version"></a><a id="hevea_default116"></a></td><td class="c014">Print version number and exit. </td></tr>
<tr><td class="c015"><span class="c005">--parse-check</span><a id="--parse-check"></a><a id="hevea_default117"></a> <span class="c003">X</span> <span class="c003">Y</span></td><td class="c014">Parses file <span class="c003">Y</span> as file type
<span class="c003">X</span> and returns 0 if the file was parsed without errors. <span class="c003">X</span> must
be one of <span class="c003">D</span>, <span class="c003">BAF</span>, <span class="c003">TP2</span>, <span class="c003">TPA</span>, or <span class="c003">TPP</span>. </td></tr>
<tr><td class="c015">&nbsp;</td></tr>
<tr><td class="c008" colspan=2> <span class="c002"> Dialogue Text File (</span><a href="#D"><span class="c004">D</span></a><span class="c002">) Options</span> </td></tr>
<tr><td class="c015"><span class="c005">--noheader</span><a id="--noheader"></a><a id="hevea_default118"></a></td><td class="c014">	Do not emit <a href="#D"><span class="c003">D</span></a> header comments. </td></tr>
<tr><td class="c015"><span class="c005">--nofrom</span><a id="--nofrom"></a><a id="hevea_default119"></a></td><td class="c014">	Do not emit <a href="#D"><span class="c003">D</span></a> <span class="c003">// from:</span> comments. </td></tr>
<tr><td class="c015"><span class="c005">--full-from</span><a id="--full-from"></a><a id="hevea_default120"></a></td><td class="c014">Generate complete <span class="c003">// from:</span> comments with a
slower two-pass process. </td></tr>
<tr><td class="c015"><span class="c005">--nocom</span><a id="--nocom"></a><a id="hevea_default121"></a></td><td class="c014">Do not emit ANY <a href="#D"><span class="c003">D</span></a> or <a href="#BAF"><span class="c003">BAF</span></a> comments. </td></tr>
<tr><td class="c015"><span class="c005">--text</span><a id="--text"></a><a id="hevea_default122"></a></td><td class="c014">Emit string text with string references in comments. </td></tr>
<tr><td class="c015"><span class="c005">--transitive</span><a id="--transitive"></a><a id="hevea_default123"></a></td><td class="c014">Follow <a href="#EXTERN"><span class="c003">EXTERN</span></a> links when making <a href="#D"><span class="c003">D</span></a>
files. See the tutorial on <a href="#--transitive"><span class="c003">--transitive</span></a>. </td></tr>
<tr><td class="c015"><span class="c005">--toplevel</span><a id="--toplevel"></a><a id="hevea_default124"></a></td><td class="c014">Emit only top-level dialogue states -- that is,
states with non-empty triggers. </td></tr>
<tr><td class="c015">&nbsp;</td></tr>
<tr><td class="c008" colspan=2> <span class="c002"> Translation Options</span> </td></tr>
<tr><td class="c015"><span class="c005">--traify</span><a id="--traify"></a><a id="hevea_default125"></a> <span class="c003">X</span></td><td class="c014">Convert <span class="c003">X</span> (which should be a <a href="#D"><span class="c003">D</span></a> or <a href="#TP2"><span class="c003">TP2</span></a> or <a href="#BAF"><span class="c003">BAF</span></a>) so that it uses translation references instead of literal strings. Use <a href="#--out"><span class="c003">--out</span></a> <span class="c003">Y</span> to specify a name for the transformed version of <span class="c003">X</span> and its new <a href="#TRA"><span class="c003">TRA</span></a> file. </td></tr>
<tr><td class="c015"><span class="c003">--traify#</span> <span class="c003">X</span></td><td class="c014">	Use with <a href="#--traify"><span class="c003">--traify</span></a> and <a href="#--traify-tlk"><span class="c003">--traify-tlk</span></a>. Start the newly-created <a href="#TRA"><span class="c003">TRA</span></a> file at translation string <span class="c003">@X</span> instead of <span class="c003">@0</span>. </td></tr>
<tr><td class="c015"><span class="c005">--traify-old-tra</span><a id="--traify-old-tra"></a><a id="hevea_default126"></a> <span class="c003">X</span></td><td class="c014">Assumes file X to contain strings already in .tra format.
Use this over <span class="c003">--traify#</span> for merging new strings in an already traified <a href="#D"><span class="c003">D</span></a> or <a href="#TP2"><span class="c003">TP2</span></a> or <a href="#BAF"><span class="c003">BAF</span></a> file.
</td></tr>
<tr><td class="c015"><span class="c005">--traify-comment</span><a id="--traify-comment"></a><a id="hevea_default127"></a></td><td class="c014">output @1 /*  Hello  */ rather than @1 when traifying </td></tr>
<tr><td class="c015"><span class="c005">--untraify-d</span><a id="--untraify-d"></a><a id="hevea_default128"></a> <span class="c003">X</span></td><td class="c014">convert .D file X to use hardcoded strings... </td></tr>
<tr><td class="c015"><span class="c005">--untraify-tra</span><a id="--untraify-tra"></a><a id="hevea_default129"></a> <span class="c003">X</span></td><td class="c014">...from TRA file X. Please note that the outcoming file
could not work properly (if baf code embedded in a d file contains @ references, or if a string contains
the<code>~</code> character). </td></tr>
<tr><td class="c015"><span class="c005">--trans</span><a id="--trans"></a><a id="hevea_default130"></a></td><td class="c014">Emit coupled <a href="#D"><span class="c003">D</span></a> and <a href="#TRA"><span class="c003">TRA</span></a> files when
decompiling a <a href="#DLG"><span class="c003">DLG</span></a>. </td></tr>
<tr><td class="c015"><span class="c005">--transref</span><a id="--transref"></a><a id="hevea_default131"></a></td><td class="c014">	Emit string reference numbers in <a href="#TRA"><span class="c003">TRA</span></a> files
when using <a href="#--trans"><span class="c003">--trans</span></a>. </td></tr>
<tr><td class="c015"><span class="c005">--traify-tlk</span><a id="--traify-tlk"></a><a id="hevea_default132"></a></td><td class="c014">Emit a <a href="#TRA"><span class="c003">TRA</span></a> file for the loaded <a href="#TLK"><span class="c003">TLK</span></a> file (see <a href="#--tlkin"><span class="c003">--tlkin</span></a>, <a href="#--out"><span class="c003">--out</span></a>, <a href="#--min"><span class="c003">--min</span></a> and <span class="c003">--traify#</span>). </td></tr>
<tr><td class="c015"><span class="c005">--make-tlk</span><a id="--make-tlk"></a><a id="hevea_default133"></a> <span class="c003">X</span></td><td class="c014">Create a <a href="#TLK"><span class="c003">TLK</span></a> file from <a href="#TRA"><span class="c003">TRA</span></a> file X (cumulative, see <a href="#--tlkout"><span class="c003">--tlkout</span></a>). </td></tr>
<tr><td class="c015"><span class="c005">--testtrans</span><a id="--testtrans"></a><a id="hevea_default134"></a></td><td class="c014">	Test all specified <a href="#TRA"><span class="c003">TRA</span></a> translation files to
see if any of them use text that is already in the loaded
<span class="c003">DIALOG.</span><a href="#TLK"><span class="c003">TLK</span></a>. If they do you can save translation effort by using
string references instead. </td></tr>
<tr><td class="c015"><span class="c005">--forceify</span><a id="--forceify"></a><a id="hevea_default135"></a> <span class="c003">X</span></td><td class="c014">Convert the given <a href="#D"><span class="c003">D</span></a> file to use forced
strrefs (see <a href="#--out"><span class="c003">--out</span></a>, <a href="#SAY"><span class="c003">SAY</span></a>, <a href="#Forced%20String%20Reference"><span class="c003">Forced String Reference</span></a>). </td></tr>
<tr><td class="c015">&nbsp;</td></tr>
<tr><td class="c008" colspan=2> <span class="c002"> Game Text Repository (</span><a href="#TLK"><span class="c004">TLK</span></a><span class="c002">) Options</span> </td></tr>
<tr><td class="c015"><span class="c005">--string</span><a id="--string"></a><a id="hevea_default136"></a> <span class="c003">X</span></td><td class="c014">	Display string reference <span class="c003">#X</span> (cumulative). If you also specify <a href="#--min"><span class="c003">--min</span></a> or <a href="#--max"><span class="c003">--max</span></a>, all string references between <a href="#--min"><span class="c003">--min</span></a> (or 0) and <a href="#--max"><span class="c003">--max</span></a> (or infinity) will be displayed. </td></tr>
<tr><td class="c015"><span class="c005">--strfind</span><a id="--strfind"></a><a id="hevea_default137"></a> <span class="c003">X</span></td><td class="c014">	Display strings that contain <span class="c003">X</span> (cumulative, <a href="#regexp"><span class="c003">regexp</span></a> allowed). </td></tr>
<tr><td class="c015"><span class="c005">--strapp</span><a id="--strapp"></a><a id="hevea_default138"></a> <span class="c003">X</span></td><td class="c014">	Append string <span class="c003">X</span> to <span class="c003">DIALOG.</span><a href="#TLK"><span class="c003">TLK</span></a> (cumulative). </td></tr>
<tr><td class="c015">&nbsp;</td></tr>
<tr><td class="c008" colspan=2> <span class="c002"> Game Archive (</span><a href="#BIFF"><span class="c004">BIFF</span></a><span class="c002">) Options</span> </td></tr>
<tr><td class="c015"><span class="c005">--list-biffs</span><a id="--list-biffs"></a><a id="hevea_default139"></a></td><td class="c014">	Enumerate all <a href="#BIFF"><span class="c003">BIFF</span></a> files in <span class="c003">CHITIN.</span><a href="#KEY"><span class="c003">KEY</span></a>. </td></tr>
<tr><td class="c015"><span class="c005">--list-files</span><a id="--list-files"></a><a id="hevea_default140"></a></td><td class="c014">	Enumerate all resource files in <span class="c003">CHITIN.</span><a href="#KEY"><span class="c003">KEY</span></a> </td></tr>
<tr><td class="c015"><span class="c005">--biff</span><a id="--biff"></a><a id="hevea_default141"></a> <span class="c003">X</span></td><td class="c014">Enumerate contents of <a href="#BIFF"><span class="c003">BIFF</span></a> file <span class="c003">X</span> (cumulative). </td></tr>
<tr><td class="c015"><span class="c005">--biff-get</span><a id="--biff-get"></a><a id="hevea_default142"></a> <span class="c003">X</span></td><td class="c014">	Extract resource <span class="c003">X</span> from game <a href="#BIFF"><span class="c003">BIFF</span></a>s (cumulative, <a href="#regexp"><span class="c003">regexp</span></a> allowed). </td></tr>
<tr><td class="c015"><span class="c005">--biff-get-rest</span><a id="--biff-get-rest"></a><a id="hevea_default143"></a> <span class="c003">X</span> <span class="c003">Y</span> ...</td><td class="c014">Every argument given on the
command line after <a href="#--biff-get-rest"><span class="c003">--biff-get-rest</span></a> is treated as if it were
preceded by <a href="#--biff-get"><span class="c003">--biff-get</span></a>. Use this command to extract multiple
different files (or <a href="#regexp"><span class="c003">regexp</span></a>s) at once. </td></tr>
<tr><td class="c015"><span class="c005">--biff-get-list</span><a id="--biff-get-list"></a><a id="hevea_default144"></a> <span class="c003">X</span> <span class="c003">Y</span> ...</td><td class="c014">Every argument given on the
command line after <a href="#--biff-get-rest"><span class="c003">--biff-get-rest</span></a> is treated as if it were
preceded by <a href="#--biff-get"><span class="c003">--biff-get</span></a>, with the -list exception. Use this command to extract multiple
different files (or <a href="#regexp"><span class="c003">regexp</span></a>s) at once. </td></tr>
<tr><td class="c015"><span class="c005">--biff-str</span><a id="--biff-str"></a><a id="hevea_default145"></a> <span class="c003">X</span></td><td class="c014">	Search all game <a href="#BIFF"><span class="c003">BIFF</span></a>s for files
containing <span class="c003">X</span> (<a href="#regexp"><span class="c003">regexp</span></a> allowed). </td></tr>
<tr><td class="c015"><span class="c005">--biff-value</span><a id="--biff-value"></a><a id="hevea_default146"></a> <span class="c003">X</span></td><td class="c014">Search all game <a href="#BIFF"><span class="c003">BIFF</span></a>s for files
containing value <span class="c003">X</span> at offset <span class="c003">ADDR</span>. Must be used with
<a href="#--biff-value-at"><span class="c003">--biff-value-at</span></a>. </td></tr>
<tr><td class="c015"><span class="c005">--biff-value-at</span><a id="--biff-value-at"></a><a id="hevea_default147"></a> <span class="c003">ADDR</span></td><td class="c014">Gives the offset address for a
<a href="#--biff-value"><span class="c003">--biff-value</span></a> search. </td></tr>
<tr><td class="c015"><span class="c005">--biff-type</span><a id="--biff-type"></a><a id="hevea_default148"></a> <span class="c003">X</span></td><td class="c014">	Limit <a href="#--biff-str"><span class="c003">--biff-str</span></a> or
<a href="#--biff-value"><span class="c003">--biff-value</span></a> searches to
resources of type <span class="c003">X</span> (cumulative). </td></tr>
<tr><td class="c015"><span class="c005">--biff-name</span><a id="--biff-name"></a><a id="hevea_default149"></a> <span class="c003">X</span></td><td class="c014">	When a <a href="#--biff-str"><span class="c003">--biff-str</span></a> or
<a href="#--biff-value"><span class="c003">--biff-value</span></a> search finds a
matching file, assume it has a strref name at offset <span class="c003">X</span> and print that
name out as well. </td></tr>
<tr><td class="c015"><span class="c005">--make-biff</span><a id="--make-biff"></a><a id="hevea_default150"></a> <span class="c003">X</span></td><td class="c014">Create <span class="c003">data/X.bif</span> from all files in
folder <span class="c003">X</span> and destructively update <span class="c003">CHITIN.KEY</span>. <em>Do not use this
feature. Use MAKE_BIFF instead.</em> </td></tr>
<tr><td class="c015"><span class="c005">--remove-biff</span><a id="--remove-biff"></a><a id="hevea_default151"></a> <span class="c003">X</span></td><td class="c014">Remove references to <a href="#BIFF"><span class="c003">BIFF</span></a> <span class="c003">X</span> and
all of its resources from <span class="c003">CHITIN.KEY</span>. <em>Do not use this feature.</em> </td></tr>
<tr><td class="c015">&nbsp;</td></tr>
<tr><td class="c008" colspan=2> <span class="c002"> Comparison Options</span> (see <a href="#--out"><span class="c003">--out</span></a>) </td></tr>
<tr><td class="c015"><span class="c005">--cmp-from</span><a id="--cmp-from"></a><a id="hevea_default152"></a> <span class="c003">X</span></td><td class="c014">	Emit <a href="#WRITE_BYTE"><span class="c003">WRITE_BYTE</span></a>s to turn this file ... </td></tr>
<tr><td class="c015"><span class="c005">--cmp-to</span><a id="--cmp-to"></a><a id="hevea_default153"></a> <span class="c003">X</span></td><td class="c014">	... into this one. </td></tr>
<tr><td class="c015"><span class="c005">--dcmp-from</span><a id="--dcmp-from"></a><a id="hevea_default154"></a><span class="c003">X</span></td><td class="c014">	Emit <a href="#REPLACE"><span class="c003">REPLACE</span></a>s to turn this <a href="#DLG"><span class="c003">DLG</span></a> file ... </td></tr>
<tr><td class="c015"><span class="c005">--dcmp-to</span><a id="--dcmp-to"></a><a id="hevea_default155"></a> <span class="c003">X</span></td><td class="c014">	... into this one. </td></tr>
<tr><td class="c015"><span class="c005">--tcmp-from</span><a id="--tcmp-from"></a><a id="hevea_default156"></a><span class="c003">X</span></td><td class="c014">	Compare this <a href="#TRA"><span class="c003">TRA</span></a> file (or directory of <a href="#TRA"><span class="c003">TRA</span></a> files)... </td></tr>
<tr><td class="c015"><span class="c005">--tcmp-to</span><a id="--tcmp-to"></a><a id="hevea_default157"></a> <span class="c003">X</span></td><td class="c014">	... with this one (or this directory). </td></tr>
<tr><td class="c015"><span class="c005">--tlkcmp-from</span><a id="--tlkcmp-from"></a><a id="hevea_default158"></a><span class="c003">X</span></td><td class="c014">	Emit <a href="#STRING_SET"><span class="c003">STRING_SET</span></a>s to convert this <a href="#TLK"><span class="c003">TLK</span></a> file ... </td></tr>
<tr><td class="c015"><span class="c005">--tlkcmp-to</span><a id="--tlkcmp-to"></a><a id="hevea_default159"></a><span class="c003">X</span></td><td class="c014">	... into this one. </td></tr>
<tr><td class="c015"><span class="c005">--tlkcmp-use-strings</span><a id="--tlkcmp-use-strings"></a><a id="hevea_default160"></a></td><td class="c014">When using <a href="#--tlkcmp-from"><span class="c003">--tlkcmp-from</span></a>, emit
commands of the form <span class="c003">STRING_SET "Hello" @1</span> instead of <span class="c003">STRING_SET #1
@1</span>. </td></tr>
<tr><td class="c015"><span class="c005">--bcmp-from</span><a id="--bcmp-from"></a><a id="hevea_default161"></a> <span class="c003">X</span></td><td class="c014">Emit <a href="#APPLY_BCS_PATCH"><span class="c003">APPLY_BCS_PATCH</span></a> to turn this
<a href="#BCS"><span class="c003">BCS</span></a> file ... </td></tr>
<tr><td class="c015"><span class="c005">--bcmp-to</span><a id="--bcmp-to"></a><a id="hevea_default162"></a> <span class="c003">X</span></td><td class="c014">... into this one. </td></tr>
<tr><td class="c015"><span class="c005">--bcmp-orig</span><a id="--bcmp-orig"></a><a id="hevea_default163"></a> <span class="c003">X</span></td><td class="c014">Original file <span class="c003">X</span> to apply ... </td></tr>
<tr><td class="c015"><span class="c005">--bcmp-patch</span><a id="--bcmp-patch"></a><a id="hevea_default164"></a> <span class="c003">X</span></td><td class="c014">... this patch to. </td></tr>
<tr><td class="c015">&nbsp;</td></tr>
<tr><td class="c008" colspan=2> <span class="c002"> Range Options</span> </td></tr>
<tr><td class="c015"><span class="c005">--min</span><a id="--min"></a><a id="hevea_default165"></a> <span class="c003">X</span></td><td class="c014">Lower range for some commands. See
<a href="#--traify-tlk"><span class="c003">--traify-tlk</span></a>, <a href="#--tlkcmp-from"><span class="c003">--tlkcmp-from</span></a> and <a href="#--string"><span class="c003">--string</span></a>. </td></tr>
<tr><td class="c015"><span class="c005">--max</span><a id="--max"></a><a id="hevea_default166"></a> <span class="c003">X</span></td><td class="c014">Upper range for some commands. </td></tr>
<tr><td class="c015">&nbsp;</td></tr>
<tr><td class="c008" colspan=2> <span class="c002"> Automatic Module Packaging Options</span> </td></tr>
<tr><td class="c015"><span class="c005">--automate</span><a id="--automate"></a><a id="hevea_default167"></a> <span class="c003">X</span></td><td class="c014">Automatically create a <a href="#TP2"><span class="c003">TP2</span></a> file for resources in folder <span class="c003">X</span>. See <a href="#--out"><span class="c003">--out</span></a>. </td></tr>
<tr><td class="c015"><span class="c005">--automate-min</span><a id="--automate-min"></a><a id="hevea_default168"></a> <span class="c003">X</span></td><td class="c014">Only <a href="#--automate"><span class="c003">--automate</span></a> string references above <span class="c003">X</span>. If not specified, it is assumed as 62169 (that is, the number of strings in unmodded SoA). </td></tr>
<tr><td class="c015"><span class="c005">--extract-kits</span><a id="--extract-kits"></a><a id="hevea_default169"></a> <span class="c003">X</span></td><td class="c014">Extract all kits starting with kit #<span class="c003">X</span>
and create <a href="#TP2"><span class="c003">TP2</span></a> actions to install those kits as part of a module. </td></tr>
<tr><td class="c015">&nbsp;</td></tr>
<tr><td class="c008" colspan=2> <span class="c002"> Logging Options </span> </td></tr>
<tr><td class="c015"><span class="c005">--log</span><a id="--log"></a><a id="hevea_default170"></a> <span class="c003">X</span></td><td class="c014">	Log output and details to <span class="c003">X</span>. </td></tr>
<tr><td class="c015"><span class="c005">--autolog</span><a id="--autolog"></a><a id="hevea_default171"></a></td><td class="c014">	Log output and details to <span class="c003">WSETUP.DEBUG</span>. </td></tr>
<tr><td class="c015"><span class="c005">--logapp</span><a id="--logapp"></a><a id="hevea_default172"></a></td><td class="c014">	Append to log file instead of overwriting it. </td></tr>
</table><p>Finally, note that WeiDU will <em>not</em> add duplicate strings to
<span class="c003">DIALOG.</span><a href="#TLK"><span class="c003">TLK</span></a>. If you instruct WeiDU to make use of the string
“Imoen” (via <a href="#SAY"><span class="c003">SAY</span></a> or <span class="c003">--strapp</span> or whatever) it will re-use any
existing definition of “Imoen” instead. Two strings are equivalent in
this sense only if they have the same text and the same associated sounds
(normally strings have no associated sounds).</p>
<!--TOC section id="sec8" Example Uses-->
<h2 class="section" id="sec8">7  Example Uses</h2><!--SEC END --><ul class="itemize"><li class="li-itemize">Decompiling a <a href="#DLG"><span class="c003">DLG</span></a> to a <a href="#D"><span class="c003">D</span></a><p><span class="c003">C:</span>\<span class="c003">Program Files</span>\<span class="c003">Black Isle</span>\<span class="c003">BGII - SoA</span>\<span class="c003">&gt;  <span class="c002">weidu bodhi.dlg</span> </span>
</p><pre class="verbatim">  [C:\Program Files\Black Isle\BGII - SoA\chitin.key] 182 BIFFs, 41793 resources
  [C:\Program Files\Black Isle\BGII - SoA\DIALOG.TLK] 84458 string entries
  [C:\Program Files\Black Isle\BGII - SoA\data\Dialog.bif] 2729 file entries
  [BODHI.DLG] loaded
  [.\BODHI.D] created from [BODHI.DLG]
</pre><p>This loads <span class="c003">BODHI.</span><a href="#DLG"><span class="c003">DLG</span></a> from the standard search path (i.e., the
current directory, your override directory, then the game <a href="#BIFF"><span class="c003">BIFF</span></a>s) and
creates <span class="c003">BODHI.</span><a href="#D"><span class="c003">D</span></a> from it.</p></li><li class="li-itemize">Decompiling a <a href="#DLG"><span class="c003">DLG</span></a> file with translations<p><span class="c003">C:</span>\<span class="c003">Program Files</span>\<span class="c003">Black Isle</span>\<span class="c003">BGII - SoA</span>\<span class="c003">&gt;  <span class="c002">weidu bodhi.dlg --trans</span> </span>
</p><pre class="verbatim">        ...
  [.\BODHI.TRA] created as translation file
  [.\BODHI.D] created from [BODHI.DLG]
</pre><p>This creates <span class="c003">BODHI.</span><a href="#D"><span class="c003">D</span></a> as above and also the translation file
<span class="c003">BODHI.</span><a href="#TRA"><span class="c003">TRA</span></a> (listing all of the strings in <span class="c003">BODHI.</span><a href="#D"><span class="c003">D</span></a>
in an easy-to-translate or spell-check format). <span class="c003">BODHI.</span><a href="#D"><span class="c003">D</span></a> will
be created with special references to those strings.</p><p>This is particularly useful if you are converting existing modifications
you may have created with another tool, such as IDU, into WeiDU format.
It allows you to both create the WeiDU <a href="#D"><span class="c003">D</span></a> code and the
translation-friendly string labels at the same time.</p></li><li class="li-itemize">Decompiling a <a href="#DLG"><span class="c003">DLG</span></a> files with options<p><span class="c003">C:</span>\<span class="c003">Program Files</span>\<span class="c003">Black Isle</span>\<span class="c003">BGII - SoA</span>\<span class="c003">&gt;  <span class="c002"> weidu --nofrom bodhi.dlg --out foozle.d --text</span> </span>
</p><pre class="verbatim">        ...
  [.\foozle.d] created from [BODHI.DLG]
</pre><p>This creates <span class="c003">foozle.d</span> (instead of <span class="c003">BODHI.D</span>) and does not put any
<span class="c003">"// from:"</span> comments in <span class="c003">foozle.d</span>. It will include <a href="#state"><span class="c003">state</span></a>s
with <a href="#SAY"><span class="c003">SAY</span></a>s of the form

<pre width="80"> <font color="#3159D1">SAY</font> <font color="#868626">~Hello~</font> <font color="#219121">/* #1 */</font> </pre>

instead of

<pre width="80"> <font color="#3159D1">SAY</font> <font color="#0000FF">#1</font> <font color="#219121">/* ~Hello~ */</font> </pre>
</p></li><li class="li-itemize">Decompiling multiple <a href="#DLG"><span class="c003">DLG</span></a> files<p><span class="c003">C:</span>\<span class="c003">Program Files</span>\<span class="c003">Black Isle</span>\<span class="c003">BGII - SoA</span>\<span class="c003">&gt;  <span class="c002"> weidu bodhi.dlg jaheira.dlg --out test</span> </span>
</p><pre class="verbatim">        ...
  [test\JAHEIRA.D] created from [JAHEIRA.DLG]
  [test\BODHI.D] created from [BODHI.DLG]
</pre><p>This loads <span class="c003">BODHI.DLG</span> and <span class="c003">JAHEIRA.DLG</span> and creates <span class="c003">BODHI.D</span> and
<span class="c003">JAHEIRA.D</span>. The optional
<span class="c003">--out test</span> argument instructs WeiDU to put the resulting <a href="#D"><span class="c003">D</span></a>
files in the <span class="c003">test</span> directory.</p></li><li class="li-itemize">Compiling a <a href="#D"><span class="c003">D</span></a> file<p><span class="c003">C:</span>\<span class="c003">Program Files</span>\<span class="c003">Black Isle</span>\<span class="c003">BGII - SoA</span>\<span class="c003">&gt;  <span class="c002"> weidu bodhi.d</span> </span>
</p><pre class="verbatim">        ...
  [bodhi.d] parsed
  [BODHI.DLG] saved       135 states, 259 trans, 16 strig, 66 ttrig, 54 actions
</pre><p>This loads and parses bodhi.d and then executed all instructions in it.
This <span class="c003">bodhi.d</span> file just defines <span class="c003">BODHI.DLG</span>, which is created. If
<span class="c003">bodhi.d</span> contains strings that do not occur in <span class="c003">DIALOG.</span><a href="#TLK"><span class="c003">TLK</span></a>,
these strings will be added as new string references.</p></li><li class="li-itemize">Compiling multiple <a href="#D"><span class="c003">D</span></a> files<p><span class="c003">C:</span>\<span class="c003">Program Files</span>\<span class="c003">Black Isle</span>\<span class="c003">BGII - SoA</span>\<span class="c003">&gt;  <span class="c002"> weidu ppworker.d bodhi.d --out test</span> </span>
</p><pre class="verbatim">        ...
  [bodhi.d] parsed
  [ppworker.d] parsed
  [BODHI.DLG] saved       135 states, 259 trans, 16 strig, 66 ttrig, 54 actions
  [PPWORKER.DLG] saved    33 states, 81 trans, 4 strig, 12 ttrig, 10 actions
</pre><p>This creates <span class="c003">test/BODHI.DLG</span> and <span class="c003">test/PPWORKER.DLG</span> based on the
instructions in <span class="c003">bodhi.d</span> and <span class="c003">ppworker.d</span>.</p></li><li class="li-itemize">Compiling a <a href="#D"><span class="c003">D</span></a> file that defines many <a href="#DLG"><span class="c003">DLG</span></a> files<p><span class="c003">C:</span>\<span class="c003">Program Files</span>\<span class="c003">Black Isle</span>\<span class="c003">BGII - SoA</span>\<span class="c003">&gt;  <span class="c002"> weidu examples/sola/solae1.d</span> </span>
<br>
OR <br>
 <span class="c003">C:</span>\<span class="c003">Program Files</span>\<span class="c003">Black Isle</span>\<span class="c003">BGII - SoA</span>\<span class="c003">&gt;  <span class="c002"> weidu examples</span></span><span class="c002">\</span><span class="c004">sola</span><span class="c002">\</span><span class="c004">solae1.d</span><span class="c003"> </span>
</p><pre class="verbatim">        ...
  [examples/sola/solae1.d] parsed
  [SOLA.DLG] loaded
  [SOLA.DLG] saved        336 states, 401 trans, 64 strig, 18 ttrig, 125 actions
  [SOLAE1.DLG] saved      36 states, 49 trans, 1 strig, 11 ttrig, 1 actions
  [SOLAE2.DLG] saved      3 states, 3 trans, 0 strig, 0 ttrig, 0 actions
  [SOLAE3.DLG] saved      2 states, 2 trans, 0 strig, 0 ttrig, 0 actions
  [SOLAE4.DLG] saved      3 states, 3 trans, 1 strig, 0 ttrig, 0 actions
  [SOLAE5.DLG] saved      2 states, 2 trans, 0 strig, 0 ttrig, 0 actions
  [SOLAE6.DLG] saved      4 states, 5 trans, 0 strig, 2 ttrig, 0 actions
</pre><p>It just so happens that <span class="c003">solae1.d</span> <a href="#APPEND"><span class="c003">APPEND</span></a>s text to
<span class="c003">SOLA.DLG</span> and
creates <span class="c003">SOLAE1.DLG</span>, <span class="c003">SOLAE1.DLG</span>,
<span class="c003">SOLAE3.DLG</span>, ..., <span class="c003">SOLAE6.DLG</span>. You could
have put them all in the override directory with <span class="c003">--out override</span>. You
may use the forward slash (/) or the backslash (\) for
directories.</p></li><li class="li-itemize">Compiling a <a href="#D"><span class="c003">D</span></a> file that uses a <a href="#TRA"><span class="c003">TRA</span></a> file<p><span class="c003">C:</span>\<span class="c003">Program Files</span>\<span class="c003">Black Isle</span>\<span class="c003">BGII - SoA</span>\<span class="c003">&gt;  <span class="c002"> weidu examples/sola/solafoe.d --transin examples/sola/solafoe.tra</span> </span>
<br>
OR <br>
 <span class="c003">C:</span>\<span class="c003">Program Files</span>\<span class="c003">Black Isle</span>\<span class="c003">BGII - SoA</span>\<span class="c003">&gt;  <span class="c002"> weidu examples/sola/solafoe.d examples/sola/solafoe.tra</span> </span>
</p><pre class="verbatim">        ...
  [examples/sola/solafoe.tra] parsed (15 translation strings)
  [examples/sola/solafoe.d] parsed
  [SOLA.DLG] loaded
  [SOLA.DLG] saved        336 states, 401 trans, 65 strig, 18 ttrig, 124 actions
  [SOLAFOE.DLG] saved     11 states, 14 trans, 1 strig, 2 ttrig, 1 actions
</pre><p>It happens that <span class="c003">solafoe.d</span> uses 15 strings from a translation file,
<a href="#APPEND"><span class="c003">APPEND</span></a>s to <span class="c003">SOLA.DLG</span> and creates
<span class="c003">SOLAFOE.DLG</span>. You may use <span class="c003">--transin</span> to
specify a translation file or (if it ends in <a href="#TRA"><span class="c003">TRA</span></a>) just throw it
on the command line. If you include multiple <a href="#TRA"><span class="c003">TRA</span></a> files, the last
one to define a particular string index wins for that string. They need
not all cover the same set.</p></li><li class="li-itemize">Displaying String References<p><span class="c003">C:</span>\<span class="c003">Program Files</span>\<span class="c003">Black Isle</span>\<span class="c003">BGII - SoA</span>\<span class="c003">&gt;  <span class="c002"> weidu --string 123 --strfind understudy --strfind acid.*rows</span> </span>
</p><pre class="verbatim">        ...
  [C:\Program Files\Black Isle\BGII - SoA\chitin.key] 182 BIFFs, 41793 resources
  [C:\Program Files\Black Isle\BGII - SoA\DIALOG.TLK] 84458 string entries
  String #123 is ~Haer' Dalis, all of you, stop them!~
  String #6763 is ~Acid Arrows~
  String #11662 is ~Biff The Understudy~
        ...
</pre><p>This displays string #123 and all strings that contain the string
"understudy" and all strings that match the regular expression
(<a href="#regexp"><span class="c003">regexp</span></a>) "acid.*rows". Note that case does not matter.</p></li><li class="li-itemize">Updating <span class="c003">DIALOG.</span><a href="#TLK"><span class="c003">TLK</span></a> Manually<p><span class="c003">C:</span>\<span class="c003">Program Files</span>\<span class="c003">Black Isle</span>\<span class="c003">BGII - SoA</span>\<span class="c003">&gt;  <span class="c002"> weidu --strapp ANewString --tlkout happy.tlk</span> </span>
</p><pre class="verbatim">  [C:\Program Files\Black Isle\BGII - SoA\DIALOG.TLK] 84458 string entries
  [.\happy.tlk] created, 84459 string entries
</pre><p>Not much to say here. String reference #84459 in <span class="c003">happy.tlk</span> is now
“<span class="c003">ANewString</span>”.</p></li><li class="li-itemize">Listing <a href="#BIFF"><span class="c003">BIFF</span></a> Contents<p><span class="c003">C:</span>\<span class="c003">Program Files</span>\<span class="c003">Black Isle</span>\<span class="c003">BGII - SoA</span>\<span class="c003">&gt;  <span class="c002"> weidu --biff data</span></span><span class="c002">\</span><span class="c004">dialog.bif</span><span class="c003"> </span>
</p><pre class="verbatim">        ...
  [data\Dialog.bif] contains    ABELA.DLG at index 0
  [data\Dialog.bif] contains    ACHEN.DLG at index 1
        ...
</pre><p>This shows all of the resources (e.g., <span class="c003">ACHEN.DLG</span> is a resource) that
are contained in <span class="c003">data</span>\<span class="c003">Dialog.bif</span>.</p></li><li class="li-itemize">Extracting <a href="#BIFF"><span class="c003">BIFF</span></a> Contents<p><span class="c003">C:</span>\<span class="c003">Program Files</span>\<span class="c003">Black Isle</span>\<span class="c003">BGII - SoA</span>\<span class="c003">&gt;  <span class="c002"> weidu --biff-get dragred.cre </span> </span>
</p><pre class="verbatim">  [C:\Program Files\Black Isle\BGII - SoA\chitin.key] 182 BIFFs, 41793 resources
  [C:\Program Files\Black Isle\BGII - SoA\DIALOG.TLK] 84458 string entries
  [C:\Program Files\Black Isle\BGII - SoA\data\Creature.bif] 3194 file entries
  [.\dragred.cre] 1776 bytes, created from [C:\Program Files\Black Isle\BGII - SoA\data\Creature.bif]
</pre><p>This grabs Firkraag’s dragon-form <a href="#CRE"><span class="c003">CRE</span></a> creature file from the game
<a href="#BIFF"><span class="c003">BIFF</span></a>s and saves it in the current directory.</p></li><li class="li-itemize">Extracting <a href="#BIFF"><span class="c003">BIFF</span></a> Contents with Regular Expressions<p><span class="c003">C:</span>\<span class="c003">Program Files</span>\<span class="c003">Black Isle</span>\<span class="c003">BGII - SoA</span>\<span class="c003">&gt;  <span class="c002">weidu --biff-get sper.*itm</span> </span>
</p><pre class="verbatim">  [.\chitin.key] loaded, 590551 bytes
  [.\chitin.key] 182 BIFFs, 41793 resources
  [.\DIALOG.TLK] loaded, 10154904 bytes
  [.\DIALOG.TLK] 77666 string entries
  [.\data\Items.bif] loaded, 659688 bytes
  [.\data\Items.bif] 1990 file entries
  [.\SPER01.ITM] 266 bytes, created from [.\data\Items.bif]
  [.\SPER02.ITM] 314 bytes, created from [.\data\Items.bif]
  [.\SPER03.ITM] 362 bytes, created from [.\data\Items.bif]
  [.\SPER04.ITM] 322 bytes, created from [.\data\Items.bif]
  [.\SPER05.ITM] 266 bytes, created from [.\data\Items.bif]
  [.\SPER06.ITM] 266 bytes, created from [.\data\Items.bif]
  [.\SPER07.ITM] 554 bytes, created from [.\data\Items.bif]
  [.\SPER08.ITM] 314 bytes, created from [.\data\Items.bif]
  [.\SPER09.ITM] 314 bytes, created from [.\data\Items.bif]
  [.\SPER10.ITM] 362 bytes, created from [.\data\Items.bif]
  [.\data\25Items.bif] loaded, 222370 bytes
  [.\data\25Items.bif] 479 file entries
  [.\SPER11.ITM] 314 bytes, created from [.\data\25Items.bif]
  [.\SPER12.ITM] 1610 bytes, created from [.\data\25Items.bif]
  [.\SPERMEL.ITM] 890 bytes, created from [.\data\25Items.bif]
</pre><p>This one assumes that the game is in the current directory and asks for
every spear item in the game. Note that <span class="c003">--biff-get</span> uses regular
expressions (<a href="#regexp"><span class="c003">regexp</span></a>), not DOS-style wildcards. Note also that
<span class="c003">--biff-get</span> does not look in the override directory. Finally, if
you are using a Mac (or otherwise running unix) you’ll want to put the
regular expression in double quotes, like so:
<span class="c003">C:</span>\<span class="c003">Program Files</span>\<span class="c003">Black Isle</span>\<span class="c003">BGII - SoA</span>\<span class="c003">&gt;  <span class="c002">weidu --biff-get "sper.*itm"</span> </span></p></li><li class="li-itemize">Searching <a href="#BIFF"><span class="c003">BIFF</span></a> Contents<p><span class="c003">C:</span>\<span class="c003">Program Files</span>\<span class="c003">Black Isle</span>\<span class="c003">BGII - SoA</span>\<span class="c003">&gt;  <span class="c002"> weidu --biff-type CRE --biff-str SPWI911</span> </span>
</p><pre class="verbatim">        ...
  LICH01.CRE in [data\Creature.bif] matches
  HLKANG.CRE in [data\Creature.bif] matches
        ...
</pre><p>This finds all <a href="#CRE"><span class="c003">CRE</span></a> files that contain the string "SPWI911", which is
equivalent to finding all enemy mages that know the spell Meteor Swarm
(which has resource name "SPWI911"). You could also try something like:</p><p><span class="c003">C:</span>\<span class="c003">Program Files</span>\<span class="c003">Black Isle</span>\<span class="c003">BGII - SoA</span>\<span class="c003">&gt;  <span class="c002"> weidu --biff-type BCS --biff-str Terminsel</span> </span>
</p><pre class="verbatim">        ...
  AR0300.BCS in [data\Scripts.bif] matches
  AR0308.BCS in [data\Scripts.bif] matches
  JAHEIRA.BCS in [data\Scripts.bif] matches
        ...
</pre><p>to find all of the game scripts that include a variable that includes the
substring "Terminsel". As you would expect, Jaheira shows up. Note that
these searches are moderately time-consuming (e.g., searching all scripts
takes about 20 seconds).</p></li><li class="li-itemize">Converting one <a href="#TLK"><span class="c003">TLK</span></a> file to another<p><span class="c003">C:</span>\<span class="c003">Program Files</span>\<span class="c003">Black Isle</span>\<span class="c003">BGII - SoA</span>\<span class="c003">&gt;  <span class="c002"> weidu --tlkcmp-from DIALOG.TLK --tlkcmp-to dialog-asc.tlk </span> </span>
</p><pre class="verbatim">    ...
  [DIALOG.TLK] loaded, 8692747 bytes
  [DIALOG.TLK] 74107 string entries
  [dialog-asc.tlk] loaded, 10211578 bytes
  [dialog-asc.tlk] 82805 string entries
  WARNING: DIALOG.TLK has 74107 entries, dialog-asc.tlk has 82805 entries
          STRING_SET 70866 ~Babau~ []
          STRING_SET 70867 ~Babau~ []
</pre><p>This compares all strings in common between two <span class="c003">DIALOG.</span><a href="#TLK"><span class="c003">TLK</span></a> files and
generates a list of <a href="#STRING_SET"><span class="c003">STRING_SET</span></a> <a href="#TP2"><span class="c003">TP2</span></a> entries to convert the
<a href="#TLK"><span class="c003">TLK</span></a> file named in <span class="c003">--tlkcomp-from</span> into the <a href="#TLK"><span class="c003">TLK</span></a> file named in
<span class="c003">--tlkcomp-to</span>. In this case, WeiDU indicates there are two differences in
the strings shared between a standard ToB <a href="#TLK"><span class="c003">TLK</span></a> file and an Ascension
Classic <a href="#TLK"><span class="c003">TLK</span></a> file: strings 70866 and 70867 were changed to "Babau".
Also note that the Ascension Classic <a href="#TLK"><span class="c003">TLK</span></a> file has more entries (82805
compared to 74107).</p><p>If you have made a large number of manual changes to a <a href="#TLK"><span class="c003">TLK</span></a> file
(such as grammar/spelling corrections, or other dialogue tweaks), this is a
handy way to generate install-ready scripting to apply those changes to an
end user’s version of BG2.</p><p>Note that the use of <span class="c003">--out</span> will be helpful for a long list.</p><p><span class="c003">C:</span>\<span class="c003">Program Files</span>\<span class="c003">Black Isle</span>\<span class="c003">BGII - SoA</span>\<span class="c003">&gt;  <span class="c002"> weidu --tlkcmp-from DIALOG.TLK --tlkcmp-to dialog-asc.tlk --out mylist.txt </span> </span></p><p>This will make a new <span class="c003">file mylist.txt</span> file that contains the
<a href="#STRING_SET"><span class="c003">STRING_SET</span></a> parts of the output, which can then be put into a
<a href="#TP2"><span class="c003">TP2</span></a> file.</p></li><li class="li-itemize">Automating File Descriptions<p><span class="c003">C:</span>\<span class="c003">Program Files</span>\<span class="c003">Black Isle</span>\<span class="c003">BGII - SoA</span>\<span class="c003">&gt;  <span class="c002">weidu --automate MyMod/SomeFolder --append MyMod.tp2</span> </span></p><p>WeiDU’s <span class="c003">--automate</span> feature can save you oodles of time, so you probably
will want to learn how to use it. It’s rather simple when you get the hang
of it (but everything is right?).</p><p>Suppose you have just created some items, some spells and some creatures
and some areas for you mod and you want to distribute them to others using
WeiDU. You could manually write out string patching code by hand for each
resource. Or you can get WeiDU to do it automatically.</p><p>WeiDU will scan every item, spell and creature inside the given folder (in
this example, the folder is <span class="c003">MyMod/SomeFolder</span>) and emit <a href="#TP2"><span class="c003">TP2</span></a>
commands to <a href="#COPY"><span class="c003">COPY</span></a> those resources from that folder into the
<span class="c003">override</span> folder. In addition, each resource’s current strings (like
item descriptions and monster names) will be loaded from your <a href="#TLK"><span class="c003">TLK</span></a>
file and used to patch that resource as it is copied.</p><p>For example, the output of <span class="c003">--automate</span> on a folder that contains a
potion of extra healing looks like this:</p><pre class="verbatim">COPY ~MyMod/SomeFolder/potn52.itm~  ~override/potn52.itm~
  SAY NAME ~Potion~
  SAY NAME2 ~Potion of Extra Healing~
  SAY UNIDENTIFIED_DESC ~Potions are typically found in ceramic, crystal, glass,
    or metal flasks or vials.  Flasks or other containers generally contain
    enough fluid to provide one person with one complete dose to achieve the
    effects of the potion.~
  SAY DESC ~When wholly consumed, this potion restores 27 hit points to the
    person. The effect is instantaneous and the potion is destroyed in the
    process.~
  SAY 0xde ~Gulp!~ [GULP]
</pre><p>And there you have it, apparently there is a substitute for hard work.</p></li><li class="li-itemize">Converting Between <a href="#TLK"><span class="c003">TLK</span></a> and <a href="#TRA"><span class="c003">TRA</span></a> Files<p>Some translators who are using WeiDU to translate non-WeiDU mods find it
handy to be able to convert between <a href="#TLK"><span class="c003">TLK</span></a> and <a href="#TRA"><span class="c003">TRA</span></a> files.</p><p>First, let’s create a <a href="#TRA"><span class="c003">TRA</span></a> file:</p><p><span class="c003">C:</span>\<span class="c003">Program Files</span>\<span class="c003">Black Isle</span>\<span class="c003">BGII - SoA</span>\<span class="c003">&gt;  <span class="c002"> weidu --traify-tlk --min 2000 --max 2002 </span> </span>
</p><pre class="verbatim">        ...
  @2000  = ~Indeed! It's been quite tasty so far. Listen, we're not here to
  devour everything. In fact, we'd like to help a little girl named
  Jaella.~
  @2001  = ~No, we haven't. We will devour you if you don't tell us what we
  need to know.~
  @2002  = ~Let us stop this charade. I'm only here to ask you a few
  questions.~
        ...
</pre><p>You may also extract only those strings matching a <a href="#regexp"><span class="c003">regexp</span></a>:</p><p><span class="c003">C:</span>\<span class="c003">Program Files</span>\<span class="c003">Black Isle</span>\<span class="c003">BGII - SoA</span>\<span class="c003">&gt;  <span class="c002"> weidu --traify-tlk --strfind lawyer </span> </span>
</p><pre class="verbatim">        ...
  @36568 = ~Honor-bound and honor-branded, then, is it?  Very well, lawyer,
  you have set me free and for that I thank you.~
        ...
</pre><p>Finally, you may redirect the output to a file using <span class="c003">--out</span> and
read from a different <a href="#TLK"><span class="c003">TLK</span></a> file by adding it on the command line.</p><p>Once you have a <a href="#TRA"><span class="c003">TRA</span></a> file with a few entries you can create a
<a href="#TLK"><span class="c003">TLK</span></a> file from it:</p><p><span class="c003">C:</span>\<span class="c003">Program Files</span>\<span class="c003">Black Isle</span>\<span class="c003">BGII - SoA</span>\<span class="c003">&gt;  <span class="c002"> weidu --make-tlk my.tra --tlkout new.tlk </span> </span>
</p><pre class="verbatim">  [c:\src\weidu\weidu.exe] WeiDU version 109
  [C:\Program Files\Black Isle\BGII - SoA/chitin.key] 182 BIFFs, 41793
  resources
  [C:\Program Files\Black Isle\BGII - SoA/dialog.tlk] 82405 string entries
  [my.tra] parsed
  [my.tra] has 100 translation strings
  New TLK will have 200 entries
  [new.tlk] created, 200 string entries
</pre><p>String <span class="c003">@1</span> in your <a href="#TRA"><span class="c003">TRA</span></a> file will become string reference <span class="c003">#1</span> in the <a href="#TLK"><span class="c003">TLK</span></a> file. If your <a href="#TRA"><span class="c003">TRA</span></a> file has “holes” the new
<a href="#TLK"><span class="c003">TLK</span></a> file will have blank entries. You may specify <span class="c003">--make-tlk</span>
multiple times: the last <a href="#TRA"><span class="c003">TRA</span></a> file to define a translation string
determine that string reference.</p></li><li class="li-itemize">Viewing Banter Offline with <span class="c005">--transitive</span><a id="hevea_default173"></a><p><span class="c003">C:</span>\<span class="c003">Program Files</span>\<span class="c003">Black Isle</span>\<span class="c003">BGII - SoA</span>\<span class="c003">&gt;  <span class="c002"> weidu --nocom --text --transitive banomen.dlg </span> </span></p><p>The <span class="c003">--transitive</span> flag tells WeiDU to follow <a href="#EXTERN"><span class="c003">EXTERN</span></a>
references when emitting <a href="#D"><span class="c003">D</span></a> files. So the resulting <span class="c003">BANOMEN.D</span>
file has lines like this:</p><pre class="verbatim">IF WEIGHT #31 ~InParty("Edwin")
See("Edwin")
Gender("Edwin",FEMALE)
!StateCheck("Edwin",STATE_SLEEPING)
Global("BAnomen1","LOCALS",0)~ THEN BEGIN 10
  SAY ~Hey, Edwina!  I shall be your champion at the next tournament that
  we come to if only you give me a piece of your robe, uh, that is, dress
  to adorn my shield.~ [ANOMEN49]
  IF ~~ THEN DO ~SetGlobal("BAnomen1","LOCALS",1)~ EXTERN ~BEDWIN~ 104
END

IF ~~ THEN BEGIN BEDWIN 104
  SAY ~(My condition draws fools like flies to honey).  Silence, you idiot!
  You've a death wish that is larger than your swollen head.~ [EDWINW39]
  IF ~~ THEN GOTO 11
END

IF ~~ THEN BEGIN 11
  SAY ~Fair Edwina, I am truly bereft by your non-acceptance.  It is tragic
  when a knight has no fair maiden to moon over.  Heh he he...~
  IF ~~ THEN EXIT
END
</pre><p>Note that both lines from both Edwin and Anomen are presented. The
resulting “D” file is not valid in that it cannot be fed back to WeiDU
directly, but it should make it easier for you to read all of the jokes
offline.</p></li></ul>
<!--TOC section id="sec9" WeiDU Tutorials-->
<h2 class="section" id="sec9">8  WeiDU Tutorials</h2><!--SEC END --><p>This section includes tutorials on specific parts of WeiDU. Many of them
were contributed by users like you.</p>
<!--TOC subsection id="sec10" <span class="c003">Multisay</span>-->
<h3 class="subsection" id="sec10">8.1  <span class="c003">Multisay</span></h3><!--SEC END --><p>
<a id="Multisay"></a>
This tutorial was thoughtfully provided by Jason Compton.</p><p>Although a single <a href="#SAY"><span class="c003">SAY</span></a> line can be of any length, for style purposes
(particularly in BG2) it is considered good form to break up very large
lines into smaller chunks.</p><p>One can easily create a series of simple <a href="#SAY"><span class="c003">SAY</span></a> blocks, one doing
<a href="#GOTO"><span class="c003">GOTO</span></a> to the next, but if there are no special conditions being
checked or actions being taken, you can very easily string several lines
together.</p><p>Let’s say you have a scenery NPC teaching a lesson about the Bill of Rights
to the US Constitution.

<pre width="80"><font color="#3159D1">BEGIN</font> TEACHER

<font color="#3159D1">IF <font color="#868626">~NumTimesTalkedTo(0)~</font> THEN BEGIN</font> constitution_1
  <font color="#3159D1">SAY <font color="#868626">~On September 25, 1789, the First Congress of the United States
    therefore proposed to the state legislatures 12 amendments to the
    Constitution that met arguments most frequently advanced against it. The
    first two proposed amendments, which concerned the number of constituents
    for each Representative and the compensation of Congressmen, were not
    ratified. Articles 3 to 12, however, ratified by three- fourths of the
    state legislatures, constitute the first 10 amendments of the
    Constitution, known as the Bill of Rights.~</font>
  IF <font color="#868626">~~</font> THEN EXIT
END</font> </pre>

This is a perfectly valid block of dialogue, but it is extremely long, and
would likely scroll out of the text window for players with lower
resolution.</p><p>Rather than break each sentence up into a new explicit <a href="#state"><span class="c003">state</span></a>, we
can use <a href="#Multisay"><span class="c003">Multisay</span></a> and save a lot of typing. <a href="#Multisay"><span class="c003">Multisay</span></a> is
invoked with the <span class="c003">=</span> (equals) sign, which tells WeiDU that, "the current
speaker should say another line here."</p><p>Here’s how that <a href="#D"><span class="c003">D</span></a> <a href="#state"><span class="c003">state</span></a> would look with <a href="#Multisay"><span class="c003">Multisay</span></a>:

<pre width="80"><font color="#3159D1">IF <font color="#868626">~NumTimesTalkedTo(0)~</font> THEN BEGIN</font> constitution_1
  <font color="#3159D1">SAY</font> <font color="#868626">~On September 25, 1789, the First Congress of the United States
  therefore proposed to the state legislatures 12 amendments to the
  Constitution that met arguments most frequently advanced against it.~</font>
      =
  <font color="#868626">~The first two proposed amendments, which concerned the number of
  constituents for each Representative and the compensation of Congressmen,
  were not ratified.~</font>
      =
  <font color="#868626">~Articles 3 to 12, however, ratified by three-fourths of the state
  legislatures, constitute the first 10 amendments of the Constitution,
  known as the Bill of Rights.~
  <font color="#3159D1">IF</font> ~~</font> <font color="#3159D1">THEN</font> <font color="#3159D1">EXIT</font>
<font color="#3159D1">END</font>
</pre>

This will create three dialogue <a href="#state"><span class="c003">state</span></a>s, separated by simple "click
to continue" transitions.</p><p>And that’s <a href="#Multisay"><span class="c003">Multisay</span></a> in a nutshell. Note that (as always with WeiDU)
the line break and spacing before and after the <span class="c003">=</span> are totally optional,
and used here only for illustration.

<pre width="80"><font color="#3159D1">SAY</font> <font color="#868626">~One~</font> = <font color="#868626">~Two~</font> = <font color="#868626">~Three~</font> </pre>

is perfectly valid as well.</p><p>You may <a href="#Multisay"><span class="c003">Multisay</span></a> inside almost any <a href="#state"><span class="c003">state</span></a>, so you may use it
within an <a href="#APPEND"><span class="c003">APPEND</span></a> <a href="#D%20Action"><span class="c003">D Action</span></a>. This is valid:

<pre><font color="#3159D1">APPEND</font> J#KLSYJ
  <font color="#3159D1">IF <font color="#868626">~~</font> THEN BEGIN</font> Renal1_1
    <font color="#3159D1">SAY</font> <font color="#868626">~All right, CHARNAME. I can accept that... you are right, there
    are bigger issues to consider.~</font>
      =
    <font color="#868626">~But I hope you do understand why I said something, why it would be
    upsetting to have someone so close to me, in a role like that.~
    <font color="#3159D1">IF</font> ~~</font> <font color="#3159D1">THEN</font> <font color="#3159D1">EXIT</font>
  <font color="#3159D1">END</font>                            <font color="#219121">// end of state Renal1_1
<font color="#3159D1">END</font>                             // end of APPEND J#KLSYJ
</font></pre>

However, you <em>cannot</em> use Multisay inside <a href="#REPLACE"><span class="c003">REPLACE</span></a>, because the
nature of <a href="#REPLACE"><span class="c003">REPLACE</span></a> is to change (that is, replace) a <em>single</em>
<a href="#state"><span class="c003">state</span></a>, while <a href="#Multisay"><span class="c003">Multisay</span></a>’s nature is to create
multiple <a href="#state"><span class="c003">state</span></a>s.</p>
<!--TOC subsection id="sec11" <span class="c003">CHAIN</span>-->
<h3 class="subsection" id="sec11">8.2  <a href="#CHAIN"><span class="c003">CHAIN</span></a></h3><!--SEC END --><p>
This tutorial was thoughtfully provided by Jason Compton.</p><p><a href="#CHAIN"><span class="c003">CHAIN</span></a> is an extension of the Multisay concept, simply with multiple
participants. If you have two NPCs bantering back and forth for a prolonged
period of time, and you do not need to do any special condition checks or
actions as they babble, it can get very tedious to set up a separate
<span class="c003">IF</span>/<span class="c003">THEN</span>/<span class="c003">BEGIN</span>/<a href="#SAY"><span class="c003">SAY</span></a> block for each line.</p><p>Imagine a conversation like this:</p><ul class="itemize"><li class="li-itemize">
Kelsey: Imoen, what do you like on your pizza?
</li><li class="li-itemize">Imoen: Oregano.
</li><li class="li-itemize">Imoen: Oh, and maybe with a little basil mixed in.
</li><li class="li-itemize">Kelsey: Well, yeah, but anything else?
</li><li class="li-itemize">Imoen: Sauce is good.
</li><li class="li-itemize">Kelsey: (laughs) You’re not being very helpful, Imoen.
</li><li class="li-itemize">Imoen: Crust. I like crust on my pizza. Cooked crust is better.
</li><li class="li-itemize">Kelsey: Do you want me to make you this pizza or not?
</li><li class="li-itemize">Kelsey: It WAS your idea.
</li><li class="li-itemize">Imoen: I can’t decide. Never mind, I’m just gonna have yogurt.
</li><li class="li-itemize">Kelsey: (sigh)
</li></ul><p>If you wanted to add this witty little banter to your game, you could do it
with 11 <a href="#APPEND"><span class="c003">APPEND</span></a> blocks for each line, or save a little time doubling
up the back-to-back Imoen and Kelsey lines with <a href="#Multisay"><span class="c003">Multisay</span></a> inside
their <a href="#APPEND"><span class="c003">APPEND</span></a>s, so you’d only need 9. In fact, you could get away
with 2 <a href="#APPEND"><span class="c003">APPEND</span></a> blocks (remember that the states don’t have to appear
in the order they are spoken, so you could mention all of Kelsey’s lines
first and then all of Immy’s as long as the labels thread up the
conversation correctly), one with 5 <a href="#state"><span class="c003">state</span></a> declarations and one 4. But
there’s an <em>even better</em> way, and that’s to use <a href="#CHAIN"><span class="c003">CHAIN</span></a>. It works
very much like <a href="#Multisay"><span class="c003">Multisay</span></a>. You use <span class="c003">=</span> to indicate that the current
speaker should speak again, and <span class="c003">==</span> (that’s two consecutive equal signs)
to indicate that a new speaker should take over.</p><p>Note that as of WeiDU 82, <a href="#CHAIN"><span class="c003">CHAIN</span></a> can now define <a href="#state"><span class="c003">state</span></a> triggers,
perform <a href="#DO"><span class="c003">DO</span></a> actions, and end with an <a href="#EXIT"><span class="c003">EXIT</span></a> or
<a href="#COPY_TRANS"><span class="c003">COPY_TRANS</span></a>. This means that for most simple NPC/NPC banters, where
the PC does not have an opportunity to speak, you no longer need to use
anything else.</p><p>Watch and see how this dialogue works using a <a href="#CHAIN"><span class="c003">CHAIN</span></a>.

<pre width="80"><font color="#3159D1">CHAIN
  IF <font color="#868626">~Global("KelseyImoenPizza","LOCALS",0)
      InParty("Imoen2")
      See("Imoen2")
      !StateCheck("Imoen2",STATE_SLEEPING)~</font> THEN</font> BJKLSY pizzachain
  <font color="#868626">~Imoen, what do you like on your pizza?~
<font color="#3159D1">DO</font> ~SetGlobal("KelseyImoenPizza","LOCALS",1)~</font>
  == IMOEN2J
  <font color="#868626">~Oregano.~</font>
  =
  <font color="#868626">~Oh, and maybe with a little basil mixed in.~</font>
  == BJKLSY
  <font color="#868626">~Well, yeah, but anything else?~</font>
  == IMOEN2J
  <font color="#868626">~Sauce is good.~</font>
  == BJKLSY
  <font color="#868626">~(laughs) You're not being very helpful, Imoen.~</font>
  == IMOEN2J
  <font color="#868626">~Crust. I like crust on my pizza. Cooked crust is better.~</font>
  == BJKLSY
  <font color="#868626">~Do you want me to make you this pizza or not?~</font>
  =
  <font color="#868626">~It WAS your idea.~</font>
  == IMOEN2J
  <font color="#868626">~I can't decide. Never mind, I'm just gonna have yogurt.~</font>
  == BJKLSY
  <font color="#868626">~(sigh)~</font>
<font color="#3159D1">EXIT</font> </pre>

Note how this dialogue works.</p><p>We use the <a href="#CHAIN"><span class="c003">CHAIN</span></a> statement to define the state trigger (the
starting conditions that must be true) and assign it to BJKLSY.DLG. The
"pizzachain" label is mostly just for internal reference. Kelsey delivers
the first line, then we use <span class="c003">==</span> <span class="c003">IMOEN2J</span> to allow her to answer,
"Oregano." Then, we can use the single = to indicate that the current
speaker (Imoen) has two consecutive lines.</p><p>Then it’s Kelsey’s turn to speak, so we use <span class="c003">== BJKLSY</span> to tell WeiDU to
tell WeiDU to switch to the <em>other</em> speaker (which is Kelsey, since we
specified <span class="c003">BJKLSY</span>). They banter back and forth for a while, and then
when it is Kelsey’s turn to have back-to-back lines <span class="c003">Do you want me to
make you this pizza or not?</span> and <span class="c003">It WAS your idea.</span>, we separate with a
single <span class="c003">=</span> to indicate that the current speaker (Kelsey) has two
consecutive lines.</p><p>After Kelsey’s final, exasperated sigh, we use the <a href="#EXIT"><span class="c003">EXIT</span></a> command to
terminate the <a href="#CHAIN"><span class="c003">CHAIN</span></a>, and exit the dialogue.</p><p>And that’s all you need to know to use <a href="#CHAIN"><span class="c003">CHAIN</span></a>. It saves a <em>tremendous</em> amount of time over setting up individual <a href="#APPEND"><span class="c003">APPEND</span></a>
blocks, even <a href="#Multisay"><span class="c003">Multisay</span></a> blocks, for each NPC.</p><p>Advanced <a href="#CHAIN"><span class="c003">CHAIN</span></a>ing:</p><p>You may include <a href="#DO"><span class="c003">DO</span></a> actions and conditionals inside
<a href="#chainText"><span class="c003">chainText</span></a>, as in:

<pre width="80"><font color="#3159D1">CHAIN
  IF <font color="#868626">~Global("KelseyImoenPizza","LOCALS",0)
      InParty("Imoen2")
      See("Imoen2")
      !StateCheck("Imoen2",STATE_SLEEPING)~</font> THEN</font> BJKLSY pizzachain
  <font color="#868626">~Imoen, what do you like on your pizza?~
<font color="#3159D1">DO</font> ~SetGlobal("KelseyImoenPizza","LOCALS",1)~</font>
  == IMOEN2J
    <font color="#868626">~Oregano.~</font>
    =
    <font color="#868626">~Oh, and maybe with a little basil mixed in.~</font>

  == BJKLSY
    <font color="#868626">~Well, yeah, but anything else?~</font>

  == IMOEN2J
    <font color="#868626">~Sauce is good.~</font>

    == BJKLSY   <font color="#3159D1">IF <font color="#868626">~PartyHasItem("pepperoni")~</font> THEN</font>
      <font color="#868626">~Look, we HAVE pepperoni. Why don't I just use that? I'll eat it,
      anyway. If you don't like it, have yogurt instead.~</font>

    == IMOEN2J  <font color="#3159D1">IF <font color="#868626">~!PartyHasItem("pepperoni")~</font> THEN</font>
      <font color="#868626">~Crust. I like crust on my pizza. Cooked crust is better.~</font>
    == BJKLSY <font color="#3159D1">IF <font color="#868626">~!PartyHasItem("pepperoni")~</font> THEN</font>
      <font color="#868626">~Do you want me to make you this pizza or not?~</font>
      =
      <font color="#868626">~It WAS your idea.~</font>

    == IMOEN2J  <font color="#3159D1">IF <font color="#868626">~!PartyHasItem("pepperoni")~</font> THEN</font>
      <font color="#868626">~I can't decide. Never mind, I'm just gonna have yogurt.~</font>
    == BJKLSY <font color="#3159D1">IF <font color="#868626">~!PartyHasItem("pepperoni")~</font> THEN
      <font color="#868626">~(sigh)~</font>
EXIT</font></pre>

In this case, the dialogue changes if the party has the pepperoni item. If
it does, Kelsey says the <span class="c003">we HAVE pepperoni</span> and then <span class="c003">(sigh)</span> and then
the dialogue ends. If not, the dialogue works as before. The
<a href="#chainText"><span class="c003">chainText</span></a> lines with <span class="c003">IF</span>s in them are only spoken if their
conditionals are true.</p>
<!--TOC subsection id="sec12" <span class="c003">COPY_TRANS</span>-->
<h3 class="subsection" id="sec12">8.3  <a href="#COPY_TRANS"><span class="c003">COPY_TRANS</span></a></h3><!--SEC END --><p>This tutorial was thoughtfully provided by Jason Compton.</p><p>There are some complex branching dialogues in Infinity Engine games that
you, as a mod creator, may wish to add to. Consider Baldur’s Gate 2 and the
"Arrival In Hell" dialogue. There is a brief internal dialogue as the
protagonist comes to terms with the fact that he/she is now in Hell, and
then all of the companions coded by Bioware have a chance to speak.
(<span class="c003">PLAYER1.DLG</span> state 25. It will help the rest of this explanation if you
go use WeiDU to decompile <span class="c003">PLAYER1.DLG</span> into <span class="c003">PLAYER1.d</span>, and/or open
up <span class="c003">PLAYER1.DLG</span> in Near Infinity and look at state 25.)</p><p>After the PC’s internal voice says <span class="c003">You doubt they will be pleased with
their present circumstance, when you don’t even know why you are here
yourself.</span>, every Bioware NPC has the opportunity to speak. If you are
creating a new NPC and want it to have that full, rich Bioware flavor, you
may wish to let your character speak here as well. For that, a simple
<a href="#EXTEND_BOTTOM"><span class="c003">EXTEND_BOTTOM</span></a> will do the job.</p><p>Here’s the example of how Weimer does this with Solaufein:

<pre width="80"><font color="#3159D1">EXTEND_BOTTOM</font> PLAYER1 <font color="#0000FF">25</font>
  <font color="#3159D1">IF <font color="#868626">~IsValidForPartyDialogue("Sola")
      Global("SolaWelcomeHell","GLOBAL",0)~</font> THEN
    DO <font color="#868626">~SetGlobal("SolaWelcomeHell","GLOBAL",1)~</font> EXTERN</font> SOLA inHell1
<font color="#3159D1">END</font></pre>

This puts a new transition at the bottom of <span class="c003">PLAYER1 25</span> that tells the
game to branch to Solaufein’s observation about your arrival in Hell, if he
is present (<span class="c003">IsValid</span>) and if we have not already seen his comment once
before (the check for <span class="c003">SolaWelcomeHell</span>=0, then setting it to 1. This
ensures that this path can only happen once, which is important for a
reason I will explain later.) <span class="c003">SOLA inHell1</span>, which we will define later,
contains Solaufein’s comment.</p><p>Once Solaufein makes his comment, it would be very thoughtful of us to
allow the other Bioware NPCs to have their say as well, as Bioware intended
and as the experienced players out there expect. You <em>could</em> simply use the
decompiled <span class="c003">PLAYER1.D</span> and copy and paste the transition list out. But
there are some good reasons not to do that. On a trivial level, it’s a big
waste of space in your <a href="#D"><span class="c003">D</span></a> file.</p><p>The most important reason is this: If <em>another</em> mod NPC has come along
and done their <em>own</em> <a href="#EXTEND_BOTTOM"><span class="c003">EXTEND_BOTTOM</span></a>, you would have no way of
knowing that. By putting the Bioware stock transition list in, you would
ensure that <em>only</em> your mod NPC got to have their say. The rest would be
silent. So if you were the developer of Solaufein, and Solaufein were
installed after Kelsey and Tashia in a game, Kelsey and Tashia would be
skipped, because <em>you</em> only copied the Bioware transition list. That’s a
heavy responsibility.</p><p>That’s why <a href="#COPY_TRANS"><span class="c003">COPY_TRANS</span></a> exists. <a href="#COPY_TRANS"><span class="c003">COPY_TRANS</span></a> pulls the entire
transition list from a specified state and makes it the transition list for
<em>your</em> new state.</p><p>To illustrate, look at <span class="c003">SOLA inHell1</span> :

<pre><font color="#3159D1">APPEND</font> SOLA
  <font color="#3159D1">IF <font color="#868626">~~</font> THEN BEGIN</font> inHell1
    <font color="#3159D1">SAY</font> @<font color="#0000FF">2</font> = @<font color="#0000FF">3</font>         <font color="#219121">// use strings @2 and @3 from translation file
</font>    <font color="#3159D1">COPY_TRANS</font> PLAYER1 <font color="#0000FF">25</font>
  <font color="#3159D1">END
END</font> </pre>

Instead of copying and pasting that huge list of <span class="c003">IF "" THEN EXTERN</span>
transitions from the <span class="c003">PLAYER1.D</span>, we let WeiDU do it for us.
<a href="#COPY_TRANS"><span class="c003">COPY_TRANS</span></a> <span class="c003">PLAYER1 25</span> tells WeiDU to grab the current list of
<a href="#transition"><span class="c003">transition</span></a>s from <span class="c003">PLAYER1</span> <a href="#state"><span class="c003">state</span></a> 25, and use it as the
<a href="#transition"><span class="c003">transition</span></a> list for <span class="c003">SOLA inHell1</span>. This ensures that Solaufein
will be able to properly branch out to Imoen, Aerie, Minsc, and the rest of
the gang, <em>as well as</em> grabbing the transitions that may have been
added by other NPCs such as Kelsey, Valen, or Tashia.</p><p><a href="#COPY_TRANS"><span class="c003">COPY_TRANS</span></a> can form all of your new <a href="#state"><span class="c003">state</span></a>’s
<a href="#transition"><span class="c003">transition</span></a> list, or only part of it. This would be valid, for
example:

<pre width="80"><font color="#3159D1">IF <font color="#868626">~~</font> THEN BEGIN</font> commentary
  <font color="#3159D1">SAY <font color="#868626">~Hey, I think I might like to run the transition list from TOLGER
    75... or I might want to do something else, if I'm in chapter six!~</font>
  COPY_TRANS</font> TOLGER <font color="#0000FF">75</font>
  <font color="#3159D1">IF <font color="#868626">~Global("Chapter","GLOBAL",6)~</font> THEN GOTO</font> chapter6commentary
<font color="#3159D1">END</font></pre>

This would make the <a href="#GOTO"><span class="c003">GOTO</span></a> <span class="c003">commentary2</span> transition show up at the
bottom of the transition stack (below the list copied from <span class="c003">TOLGER 75</span>).
Remember that transition triggers are read <em>bottom to top</em>, so it would
be the first transition evaluated. If you want it to be evaluated <em>after</em> the list of transitions in the <a href="#COPY_TRANS"><span class="c003">COPY_TRANS</span></a>, put it above.
Note, however, that Bioware usually structures its transition lists so that
the topmost trigger will always be true (in fact, sometimes it <em>is</em>
<span class="c003">"True()"</span>) so it is somewhat unlikely you would ever want to put a new
transition trigger <em>above</em> the <a href="#COPY_TRANS"><span class="c003">COPY_TRANS</span></a>.</p><p>Now, that explanation for why the <span class="c003">SolaWelcomeHell</span> variable check is
important: if a user accidentally installs the same mod more than once, and
it employs <a href="#COPY_TRANS"><span class="c003">COPY_TRANS</span></a>, the list the second time around will <em>include</em> our new trigger:

<pre><font color="#3159D1">IF <font color="#868626">~IsValidForPartyDialogue("Sola")
      Global("SolaWelcomeHell","GLOBAL",0)~</font> THEN
    DO <font color="#868626">~SetGlobal("SolaWelcomeHell","GLOBAL",1)~</font> EXTERN</font> SOLA inHell1
</pre>

If there was no flag being set to ensure that the <a href="#transition"><span class="c003">transition</span></a> could
only run once, the user would get stuck in a loop. This can and has
happened with mods in the wild. The end result would be Solaufein or Kelsey
or whomever constantly offering their commentary, over and over again.</p><p>Important note: The WeiDU <a href="#D"><span class="c003">D</span></a> compiler runs <a href="#COPY_TRANS"><span class="c003">COPY_TRANS</span></a> <em>before</em> other actions that you might take to affect a transition list
within the same <a href="#D"><span class="c003">D</span></a> file (like <a href="#EXTEND_TOP"><span class="c003">EXTEND_TOP</span></a> and
<a href="#EXTEND_BOTTOM"><span class="c003">EXTEND_BOTTOM</span></a>). This is a good thing.</p>
<!--TOC subsection id="sec13" <span class="c003">INTERJECT</span>-->
<h3 class="subsection" id="sec13">8.4  <a href="#INTERJECT"><span class="c003">INTERJECT</span></a></h3><!--SEC END --><p>
This tutorial was thoughtfully provided by Jason Compton.</p><p>Interjections, the little comments party members make, are a great way to
spice up a new NPC or a new quest you create. It shows that the characters
are paying attention to their game world, and that they have an opinion
about what goes on around them.</p><p>Through interjections, an NPC can advise a course of action, complain about
a decision, force your hand... fun things.</p><p>The traditional way to do an interjection is to find a state of a dialogue
where another NPC might comment, and use <a href="#EXTEND_BOTTOM"><span class="c003">EXTEND_BOTTOM</span></a> and
<a href="#APPEND"><span class="c003">APPEND</span></a> in conjunction.</p><p>Here’s an old-school example:

<pre width="80"><font color="#3159D1">EXTEND_BOTTOM</font> SAHPR4 <font color="#0000FF">7</font>
     <font color="#3159D1">IF <font color="#868626">~IsValidForPartyDialog("J#Kelsey")~</font> THEN EXTERN</font> J#KLSYJ KelseySAHPR4
<font color="#3159D1">END

APPEND</font> J#KLSYJ
  <font color="#3159D1">IF <font color="#868626">~~</font> THEN BEGIN</font> KelseySAHPR4
    <font color="#3159D1">SAY <font color="#868626">~Urk. Who was the lucky donor?~</font>
    IF <font color="#868626">~~</font> THEN EXTERN</font> SAHPR2 <font color="#0000FF">10</font>
  <font color="#3159D1">END
END</font></pre>

This works, but it’s also more work than it needs to be since the
introduction of <a href="#INTERJECT"><span class="c003">INTERJECT</span></a>. (Incidentally, for you WeiDU historians out
there, there are two main reasons advanced functions have been added to
WeiDU since the first versions of Solaufein and the original <a href="#CHAIN"><span class="c003">CHAIN</span></a>
command: Either Weimer needed them for his own modding goals, or a mod
project, usually Kelsey, requested it. <a href="#INTERJECT"><span class="c003">INTERJECT</span></a> came about when
Westley finally decided that Solaufein and Valen should comment about
quests. On the other hand, <a href="#COPY_TRANS"><span class="c003">COPY_TRANS</span></a> and
<a href="#INTERJECT_COPY_TRANS"><span class="c003">INTERJECT_COPY_TRANS</span></a> were my idea.)</p><p><a href="#INTERJECT"><span class="c003">INTERJECT</span></a> simplifies this process considerably. To run an
<a href="#INTERJECT"><span class="c003">INTERJECT</span></a>, you
need to know the source state (the line after which you want one or more
NPCs to interject), and the destination state (where you want the dialogue
tree to go after the interjection.) Typically, but not necessarily, the
destination state will be wherever the dialogue was <em>originally</em>
planning to go, but if the NPC takes the conversation in a new direction,
that may change. We’ll stick with the simpler cases for illustration.</p><p><a href="#INTERJECT"><span class="c003">INTERJECT</span></a> is a specialized form of <a href="#CHAIN"><span class="c003">CHAIN</span></a>.
So if you’re familiar with <a href="#CHAIN"><span class="c003">CHAIN</span></a>, this will look familiar.</p><p>Consider the dryads in the Irenicus start dungeon. Perhaps Minsc should say
something to them. <span class="c003">IDRYAD1.DLG</span> state 1 offers a good opportunity.

<pre><font color="#3159D1">IF <font color="#868626">~~</font> THEN BEGIN <font color="#0000FF">1</font> <font color="#219121">// from:
</font>  SAY <font color="#0000FF">#11080</font> <font color="#219121">/* ~We are his possessions.~ */</font>
  IF <font color="#868626">~~</font> THEN EXTERN <font color="#868626">~IDRYAD2~</font> <font color="#0000FF">1</font>
END</font></pre>

Minsc is outraged. Here’s how he can express it. The idea is that we want
Minsc to comment, but for the dialogue to continue just as it would have if
he was not there.

<pre><font color="#3159D1">INTERJECT</font> IDRYAD1 <font color="#0000FF">1</font> MinscDryad
  == MINSCJ <font color="#3159D1">IF <font color="#868626">~IsValidForPartyDialog("Minsc")~</font> THEN
    <font color="#868626">~Boo is outraged that the strange wizard would own these lovely ladies!
    Can Minsc and Boo help you nice girls?~</font>
END</font> IDRYAD2 <font color="#0000FF">1</font></pre>

Here’s what’s going on here.</p><p>Invoking <a href="#INTERJECT"><span class="c003">INTERJECT</span></a> requires three arguments: the dialogue name and
state we’re interjecting into, plus a unique global variable name. This
variable will be set from 0 to 1 after the <a href="#INTERJECT"><span class="c003">INTERJECT</span></a> runs, to
ensure that it can only happen once. (This is important in case players
accidentally install your mod twice, as it could create a looping problem
similar to the one described in <a href="#COPY_TRANS"><span class="c003">COPY_TRANS</span></a>.)</p><p>So <a href="#INTERJECT"><span class="c003">INTERJECT</span></a> <span class="c003">IDRYAD1 1 MinscDryad</span> tells WeiDU "Put this
dialogue after <span class="c003">IDRYAD1</span> <a href="#state"><span class="c003">state</span></a> <span class="c003">1</span>. This dialogue will run if
<span class="c003">MinscDryad</span> is 0. After it runs, we will set <span class="c003">MinscDryad</span> to 1."</p><p>Then we need to define who is speaking. == (that’s two consecutive equal
signs) is <a href="#CHAIN"><span class="c003">CHAIN</span></a>-style notation for a new speaker, and <span class="c003">MINSCJ</span> is
the proper dialogue to use for Minsc’s "joined-party" commentary. If Minsc
is in the party and valid for dialogue, he will say his line. After that,
we transition to <span class="c003">IDRYAD2</span> state <span class="c003">1</span> (<span class="c003">END IDRYAD2 1</span>), which is
where the dialogue was heading in the first place. We can make this more
complicated and let the dryad reply to his interruption before proceeding.

<pre><font color="#3159D1">INTERJECT</font> IDRYAD1 <font color="#0000FF">1</font> MinscDryad
  == MINSCJ     <font color="#3159D1">IF <font color="#868626">~IsValidForPartyDialog("Minsc")~</font> THEN</font>
    <font color="#868626">~Boo is outraged that the strange wizard would own these lovely ladies!
    Can Minsc and Boo help you nice girls?~</font>
  == IDRYAD1    <font color="#3159D1">IF <font color="#868626">~IsValidForPartyDialog("Minsc")~</font> THEN
    <font color="#868626">~Large mortal, we are having a dramatic scene. Please do not
    interrupt.~</font>
END</font> IDRYAD2 <font color="#0000FF">1</font></pre>

Note that we repeat the

<pre><font color="#3159D1">IF <font color="#868626">~IsValidForPartyDialog("Minsc")~</font> THEN</font></pre>

check for <span class="c003">IDRYAD1</span>. That is to ensure that she only says that line if
Minsc is there, and by extension has already made his little comment. So
now, Minsc interrupts, Dryad #1 scolds him, and then we proceed to the
second dryad’s line.</p><p>One general piece of advice: while it’s not <em>necessary</em> to pick a state
that has only a single transition to another state, unless you’re willing
to experiment (or you’re intentionally trying to remove player choices from
the equation, by making the NPC say something that forces immediate action,
for instance), don’t <a href="#INTERJECT"><span class="c003">INTERJECT</span></a> into a state that has player options
(<a href="#REPLY"><span class="c003">REPLY</span></a>s).</p><p><a id="sec-interject-copy-trans"></a></p>
<!--TOC subsection id="sec14" <span class="c003">INTERJECT_COPY_TRANS</span>-->
<h3 class="subsection" id="sec14">8.5  <span class="c003">INTERJECT_COPY_TRANS</span></h3><!--SEC END --><p>
This tutorial was thoughtfully provided by Jason Compton.</p><p><a href="#INTERJECT"><span class="c003">INTERJECT</span></a> is good for creating interjections where none already
exist. However, many of the really good opportunities for interjections in
game dialogue already <em>have</em> interjections in them. If you use standard
<a href="#INTERJECT"><span class="c003">INTERJECT</span></a>, chances are you’ll skip right over them.</p><p>Consider <span class="c003">TOLGER.DLG</span> <a href="#state"><span class="c003">state</span></a> <span class="c003">75</span>. After Tolgerias lays down the
law by saying <span class="c003">This is a sensitive matter, and I cannot tell all to every
curious soul. I must have your commitment that you agree to the task,</span>
four NPCs (Edwin, Jaheira, Yoshimo, Korgan) will tell you what they think
of <em>that</em> rotten arrangement. What’s more, Bioware structured the dialogue
transitions so that they <em>all</em> can get their comment in, if all four of
them are in the party.</p><p>However, using a standard <a href="#INTERJECT"><span class="c003">INTERJECT</span></a> for a new NPC line would skip
over those four comments, which is rather impolite.
<a href="#INTERJECT_COPY_TRANS"><span class="c003">INTERJECT_COPY_TRANS</span></a> works much like regular <a href="#INTERJECT"><span class="c003">INTERJECT</span></a>, but
instead of defining a state to transition to after <span class="c003">END</span>, WeiDU will
<a href="#COPY_TRANS"><span class="c003">COPY_TRANS</span></a> the transition list from the state you are
<a href="#INTERJECT"><span class="c003">INTERJECT</span></a>ing into.</p><p>This is not as confusing as it sounds. Watch as hypothetical new NPC
Aqualung responds to Tolgerias’s terms:

<pre width="80"><font color="#3159D1">INTERJECT_COPY_TRANS</font> TOLGER <font color="#0000FF">75</font> AquaTolger
  == AQUALUNJ   <font color="#3159D1">IF <font color="#868626">~IsValidForPartyDialogue("Aqualung")~</font> THEN</font>
    <font color="#868626">~Hey, that's a really crummy offer! Where did those little girls go? I
    could be sitting on a park bench, I don't need this aggravation! Who
    are you, anyway?~</font>
  == TOLGER     <font color="#3159D1">IF <font color="#868626">~IsValidForPartyDialogue("Aqualung")~</font> THEN
    <font color="#868626">~You poor old sod, you see it's only me. Now, did anyone else have a
    smart remark they wanted to make?~</font>
END</font></pre>

So, if Aqualung is around, we’ll hear from him and then Tolgerias will
respond to him. <em>After that</em>, the game will look for the presence of
Edwin, Jaheira, Yoshimo, and Korgan and we’ll get <em>their</em> responses to
Tolgerias as well.</p><p>Hint: <a href="#INTERJECT_COPY_TRANS"><span class="c003">INTERJECT_COPY_TRANS</span></a> is fine to use even if there were no other
interjections in the source state, i.e. if there’s just a single <span class="c003">IF "" THEN
GOTO blah</span>. That is, as long as you plan to proceed to the original
destination. It saves you the trouble of having to look up and input the
destination.</p><p><a id="sec-interject-copy-trans2"></a></p>
<!--TOC subsection id="sec15" <span class="c003">INTERJECT_COPY_TRANS2</span>-->
<h3 class="subsection" id="sec15">8.6  <span class="c003">INTERJECT_COPY_TRANS2</span></h3><!--SEC END --><p>
This tutorial was thoughtfully provided by Rastor.</p><p>There seems to be a great deal of confusion among the members of the modding
community regarding the purpose and overall function of
<a href="#INTERJECT_COPY_TRANS2"><span class="c003">INTERJECT_COPY_TRANS2</span></a>. Allow me to take a moment to dispel the rumors
that you may have heard.</p><p><a href="#INTERJECT_COPY_TRANS2"><span class="c003">INTERJECT_COPY_TRANS2</span></a> is not intended as a replacement for
<a href="#INTERJECT_COPY_TRANS"><span class="c003">INTERJECT_COPY_TRANS</span></a>. <a href="#INTERJECT_COPY_TRANS"><span class="c003">INTERJECT_COPY_TRANS</span></a> is a great function
but it has a flaw in certain special cases. That’s what
<a href="#INTERJECT_COPY_TRANS2"><span class="c003">INTERJECT_COPY_TRANS2</span></a> is intended to remedy. This difference between
the two is best illustrated with an example.</p><p>Let us suppose that you want to add an NPC response to <span class="c003">PPSAEM2</span> 8. Here is
some of what that state looks like before any mods have been applied:</p><pre class="verbatim">IF ~~ THEN BEGIN 8 // from: 7.0
  SAY #44931 /* ~Blah blah blah~ */
  IF ~!IsValidForPartyDialog("Jaheira")
!IsValidForPartyDialog("Anomen")
!IsValidForPartyDialog("Edwin")
IsValidForPartyDialog("Viconia")~ THEN DO ~SetGlobal("WackoArmy","GLOBAL",1)
OpenDoor("DOOR12")
EscapeArea()~ UNSOLVED_JOURNAL #7045 EXTERN ~VICONIJ~ 129
END
</pre><p>Note that the <a href="#DO"><span class="c003">DO</span></a> actions include <span class="c003">EscapeArea()</span>. If you use
<a href="#INTERJECT_COPY_TRANS"><span class="c003">INTERJECT_COPY_TRANS</span></a> to add an interjection here, the <a href="#DO"><span class="c003">DO</span></a>
actions will be performed by your interjector (usually a party member). The
result is that after encountering this dialogue in the game the party member
will leave the area (and Saemon will stay where he is!) promptly after
performing the interjection. Instead, we want to keep the <a href="#DO"><span class="c003">DO</span></a> action
associated with Saemon.</p><p><a href="#INTERJECT_COPY_TRANS2"><span class="c003">INTERJECT_COPY_TRANS2</span></a> allows modders to remedy this problem.
<a href="#INTERJECT_COPY_TRANS2"><span class="c003">INTERJECT_COPY_TRANS2</span></a> does exactly the same thing as
<a href="#INTERJECT_COPY_TRANS"><span class="c003">INTERJECT_COPY_TRANS</span></a> except that DO actions will be kept with their
original actor and not transferred to the interjector.</p><p>To code your interjection using <a href="#INTERJECT_COPY_TRANS2"><span class="c003">INTERJECT_COPY_TRANS2</span></a>, you would do
this:</p><pre class="verbatim">INTERJECT_COPY_TRANS2 PPSAEM2 8
  ~Blah blah blah~
END
</pre><p>The dialogue state that WeiDU will create from this
<a href="#INTERJECT_COPY_TRANS2"><span class="c003">INTERJECT_COPY_TRANS2</span></a> statement looks something like:</p><pre class="verbatim">IF ~~ THEN BEGIN 133 // from:
  SAY #78199 /* ~Blah blah blah~ */
  IF ~!IsValidForPartyDialog("Jaheira")
!IsValidForPartyDialog("Anomen")
!IsValidForPartyDialog("Edwin")
IsValidForPartyDialog("Viconia")~ THEN UNSOLVED_JOURNAL #7045 EXTERN ~VICONIJ~ 129
END
</pre><p>Note that <a href="#INTERJECT_COPY_TRANS2"><span class="c003">INTERJECT_COPY_TRANS2</span></a> is not intended as a universal
replacement for <a href="#INTERJECT_COPY_TRANS"><span class="c003">INTERJECT_COPY_TRANS</span></a>. This is most obvious when using
the command to interject into a state that starts a cutscene. Here is an
example of an interjection into <span class="c003">PPIRENI2</span> 27.</p><p>The original, unmodded state:</p><pre class="verbatim">IF ~~ THEN BEGIN 27 // from: 28.0 26.0
  SAY #44869 /* ~I bid you farewell, child of Bhaal. We shall not meet again.~
[IRENIC52] */
  IF ~~ THEN DO ~EraseJournalEntry(7252)
EraseJournalEntry(7253)
EraseJournalEntry(22952)
EraseJournalEntry(23306)
SetGlobal("AsylumPlot","GLOBAL",40)
StartCutSceneMode()
StartCutScene("Cut41j")~ SOLVED_JOURNAL #7255 EXIT
END
</pre><p>Using <a href="#INTERJECT_COPY_TRANS2"><span class="c003">INTERJECT_COPY_TRANS2</span></a> to code your interjection into this state
will cause the game to crash when your interjection plays (because the special
<span class="c003">StartCutSceneMode()</span> action cannot occur in the middle of a dialogue,
loosely). <a href="#INTERJECT_COPY_TRANS"><span class="c003">INTERJECT_COPY_TRANS</span></a> will work properly, however.</p>
<!--TOC subsection id="sec16" <span class="c003">state WEIGHTs</span>-->
<h3 class="subsection" id="sec16">8.7  <a href="#state"><span class="c003">state</span></a> <a href="#WEIGHT"><span class="c003">WEIGHT</span></a>s</h3><!--SEC END --><p><a href="#stateTriggerString"><span class="c003">stateTriggerString</span></a>s, the conditions that determine what
<a href="#state"><span class="c003">state</span></a> should be used for the beginning of a dialogue, may have
<a href="#WEIGHT"><span class="c003">WEIGHT</span></a>s. These <a href="#WEIGHT"><span class="c003">WEIGHT</span></a>s are used by the Infinity Engine to
choose which state to pick if multiple state triggers evaluate to "true". [
In reality, the <a href="#WEIGHT"><span class="c003">WEIGHT</span></a>s are just the offsets within the state
trigger table in the <span class="c003">DLG</span> file, but this detail is not important unless
you are writing your own tool. ] <a href="#WEIGHT"><span class="c003">WEIGHT</span></a>s only make sense for
<a href="#stateTriggerString"><span class="c003">stateTriggerString</span></a>s that are not empty.</p><p>If multiple <a href="#stateTriggerString"><span class="c003">stateTriggerString</span></a>s evaluate to true, the Infinity
Engine will pick the <a href="#state"><span class="c003">state</span></a> with the <em>lowest</em> <a href="#WEIGHT"><span class="c003">WEIGHT</span></a>.
Usually the weighting follows the order of state declaration in the
<a href="#D"><span class="c003">D</span></a> file. That is, the first <a href="#state"><span class="c003">state</span></a> mentioned has the lowest
weight (i.e., will be picked first in case of a tie) and the last state
mentioned has the highest weight (i.e., will be picked last in case of a
tie). However, you may include an explicit <a href="#WEIGHT"><span class="c003">WEIGHT</span></a> directive to
change things around. For example, consider this <a href="#D"><span class="c003">D</span></a> file:

<pre width="80"><font color="#3159D1">BEGIN</font> foozle
  <font color="#3159D1">IF <font color="#868626">~True()~</font> THEN BEGIN</font> a <font color="#3159D1">SAY <font color="#868626">~Jason~</font> END
  IF <font color="#868626">~True()~</font> THEN BEGIN</font> b <font color="#3159D1">SAY <font color="#868626">~yada~</font> END
  IF <font color="#868626">~True()~</font> THEN BEGIN</font> c <font color="#3159D1">SAY <font color="#868626">~Compton~</font> END
  IF <font color="#868626">~True()~</font> THEN BEGIN</font> d <font color="#3159D1">SAY <font color="#868626">~kelsey~</font> END</font></pre>

If you talk to <span class="c003">foozle</span>, it will always say <span class="c003">Jason</span>. However, you may
explicitly alter the weights so that the third state is picked first, as
in:

<pre><font color="#3159D1">BEGIN</font> foozle
  <font color="#3159D1">IF WEIGHT <font color="#0000FF">#10</font> <font color="#868626">~True()~</font> THEN BEGIN</font> a <font color="#3159D1">SAY <font color="#868626">~Jason~</font> END
  IF            <font color="#868626">~True()~</font> THEN BEGIN</font> b <font color="#3159D1">SAY <font color="#868626">~yada~</font> END
  IF WEIGHT <font color="#0000FF">#2</font>  <font color="#868626">~True()~</font> THEN BEGIN</font> c <font color="#3159D1">SAY <font color="#868626">~Compton~</font> END
  IF            <font color="#868626">~True()~</font> THEN BEGIN</font> d <font color="#3159D1">SAY <font color="#868626">~kelsey~</font> END</font></pre>

With this <a href="#D"><span class="c003">D</span></a> file, foozle will always say <span class="c003">Compton</span>. All
<a href="#state"><span class="c003">state</span></a>s with <a href="#WEIGHT"><span class="c003">WEIGHT</span></a> directives come before all states
without them. States without <a href="#WEIGHT"><span class="c003">WEIGHT</span></a> directives are ranked in order
of appearance. So the state order for <span class="c003">foozle.</span><a href="#DLG"><span class="c003">DLG</span></a> is <span class="c003">c-a-b-d</span>. Yes, this is
complicated.</p><p><em>Strong Style Suggestion</em>: do <em>not</em> use the <a href="#WEIGHT"><span class="c003">WEIGHT</span></a>
directive in your hand-made <a href="#D"><span class="c003">D</span></a> files. Just use the implicit ordering.</p><p>The <a href="#WEIGHT"><span class="c003">WEIGHT</span></a> directive was introduced to facilitate handling of
Bioware-created <a href="#DLG"><span class="c003">DLG</span></a> files (e.g., <span class="c003">BJAHEIR.DLG</span>) that include
tricky weighting. Only states with non-empty triggers are given implicit
weights. If you create a <a href="#D"><span class="c003">D</span></a> file from a <a href="#DLG"><span class="c003">DLG</span></a> that features
non-trivial weighting, WeiDU will emit comments like this:

<pre><font color="#3159D1">IF WEIGHT <font color="#0000FF">#8</font> <font color="#219121">/* Triggers after states #: 11 12 24 25 26 36 58 even though
                they appear after this state */</font>
  <font color="#868626">~True()~</font> THEN BEGIN <font color="#0000FF">10</font> <font color="#219121">// from:
</font>    SAY <font color="#0000FF">#52190</font> <font color="#219121">/* ~Please do not interrupt our thoughts. We must prepare
      carefully if we are to see a weakness in the illithid web. ~ */</font>
    IF <font color="#868626">~~</font> THEN EXIT
END</font></pre>

to remind you that the order is not what you think.</p><p>All non-empty state triggers in <a href="#DLG"><span class="c003">DLG</span></a> files are given weights
counting up from 0 to the maximum number of state triggers in the
<a href="#DLG"><span class="c003">DLG</span></a> file. You may use any number you like (even a negative one):
WeiDU will simply sort them. <a href="#ADD_STATE_TRIGGER"><span class="c003">ADD_STATE_TRIGGER</span></a>does not change the
weight associated with that trigger. <a href="#APPEND"><span class="c003">APPEND</span></a> can be used to give a
non-trivial weight to a state, as in:

<pre><font color="#3159D1">APPEND</font> BJAHEIR
  <font color="#3159D1">IF WEIGHT <font color="#0000FF">#-999</font> <font color="#868626">~MyCondition()~</font> THEN BEGIN</font> mystate <font color="#3159D1">SAY <font color="#868626">~My Stuff~</font> END
END</font></pre>

Since <span class="c003">BJAHEIR</span> will have implicit <a href="#WEIGHT"><span class="c003">WEIGHT</span></a>s in the range from #0 to
about #50, this causes <span class="c003">mystate</span> to have priority over all states that
already exist in <span class="c003">BJAHEIR</span>. Without such drastic action,
<a href="#APPEND"><span class="c003">APPEND</span></a>ed states will
have use the implicit ordering, and will thus have the lowest priority
(because they appear at the end of the file). <a href="#Multisay"><span class="c003">Multisay</span></a> and
<a href="#CHAIN"><span class="c003">CHAIN</span></a> also
append states, but since they always append states with empty
<a href="#stateTriggerString"><span class="c003">stateTriggerString</span></a>s, <a href="#WEIGHT"><span class="c003">WEIGHT</span></a>s are not relevant.</p><p>Consider the following example:

<pre><font color="#3159D1">BEGIN</font> foozle
  <font color="#3159D1">IF WEIGHT <font color="#0000FF">#10</font> <font color="#868626">~True()~</font> THEN BEGIN</font> a <font color="#3159D1">SAY <font color="#868626">~Jason~</font> END
  IF            <font color="#868626">~~</font> THEN BEGIN</font> b <font color="#3159D1">SAY <font color="#868626">~yada~</font> END
  IF WEIGHT <font color="#0000FF">#2</font>  <font color="#868626">~True()~</font> THEN BEGIN</font> c <font color="#3159D1">SAY <font color="#868626">~Compton~</font> END
  IF            <font color="#868626">~True()~</font> THEN BEGIN</font> d <font color="#3159D1">SAY <font color="#868626">~kelsey~</font> END
  ADD_STATE_TRIGGER</font> foozle <font color="#0000FF">1</font> <font color="#219121">/* state b */</font> <font color="#868626">~MyCondition()~</font></pre>

The resulting <span class="c003">foozle</span> dialogue will still have the <span class="c003">c-a-b-d</span> weighting
order.</p><p>Here’s another example:

<pre><font color="#3159D1">BEGIN</font> foozle
  <font color="#3159D1">IF            <font color="#868626">~True()~</font> THEN BEGIN</font> a <font color="#3159D1">SAY <font color="#868626">~Jason~</font> END
  IF            <font color="#868626">~~</font> THEN BEGIN</font> b <font color="#3159D1">SAY <font color="#868626">~yada~</font> END
  IF            <font color="#868626">~True()~</font> THEN BEGIN</font> c <font color="#3159D1">SAY <font color="#868626">~Compton~</font> END
  IF            <font color="#868626">~True()~</font> THEN BEGIN</font> d <font color="#3159D1">SAY <font color="#868626">~kelsey~</font> END
  ADD_STATE_TRIGGER</font> foozle <font color="#0000FF">1</font> <font color="#219121">/* state b */</font> <font color="#868626">~MyCondition()~</font></pre>

The resulting <span class="c003">foozle</span> dialogue will have the (expected) <span class="c003">a-b-c-d</span>
ordering.</p><p><em>However</em>, consider this evil example:

<pre>  <font color="#219121">//////
  // foozle.DLG contents, assume it has already been created and is
  // sitting on your hard drive somewhere
  // IF            ~True()~ THEN BEGIN a SAY ~Jason~ END
  // IF            ~~ THEN BEGIN b SAY ~yada~ END
  // IF            ~True()~ THEN BEGIN c SAY ~Compton~ END
  // IF            ~True()~ THEN BEGIN d SAY ~kelsey~ END
  //////

  // new D file
</font>  <font color="#3159D1">ADD_STATE_TRIGGER</font> foozle <font color="#0000FF">1</font> <font color="#219121">/* state b */</font> <font color="#868626">~MyCondition()~</font></pre>

This will update <span class="c003">foozle</span> and the resulting order will be <span class="c003">a-c-d-b</span>
(because when <span class="c003">foozle.</span><a href="#DLG"><span class="c003">DLG</span></a> was loaded from the disk, <span class="c003">a</span> <span class="c003">c</span>
and <span class="c003">d</span> were given weights but <span class="c003">b</span> was not (because it had an empty
trigger)). Thus, you should avoid using <a href="#ADD_STATE_TRIGGER"><span class="c003">ADD_STATE_TRIGGER</span></a> on
states with empty triggers unless you know what you are doing.</p><p><a id="TRA"></a></p>
<!--TOC subsection id="sec17" <span class="c003">TRA</span> Translation Files-->
<h3 class="subsection" id="sec17">8.8  <span class="c003">TRA</span> Translation Files</h3><!--SEC END --><p>If you are writing a mod and you would like to make it easier to translate
it into another language you can use "translation files" (much like BGII
itself uses <span class="c003">DIALOG.</span><a href="#TLK"><span class="c003">TLK</span></a>) to separate your dialogue structure and content. A
translation file basically lists the string texts in order. For example,</p><p><span class="c003">C:</span>\<span class="c003">Program Files</span>\<span class="c003">Black Isle</span>\<span class="c003">BGII - SoA</span>\<span class="c003">&gt;  <span class="c002">WeiDU --trans SCSARLES.DLG</span> </span></p><p>This creates <span class="c003">scsarles</span>.<a href="#D"><span class="c003">D</span></a> and <span class="c003">scsarles.tra</span>.
<span class="c003">scsarles.</span><a href="#D"><span class="c003">D</span></a> now contains:

<pre width="80"><font color="#3159D1">IF <font color="#868626">~NumTimesTalkedTo(0)~</font> THEN BEGIN <font color="#0000FF">0</font> <font color="#219121">// from:
</font>  SAY</font> @<font color="#0000FF">1</font> <font color="#219121">/* ~Who is it? Might I ask why you have disturbed my meditations?
    My creative muse must be gently awakened, and your stomping about is
    simply not conducive to this.~ [SARLES02] #28655 */</font>
  <font color="#3159D1">IF <font color="#868626">~~</font> THEN REPLY</font> @<font color="#0000FF">2
    <font color="#219121">/* ~My apologies. I will leave you to your thinking.~ #28656 */</font> <font color="#3159D1">GOTO</font> 1</font>
  <font color="#3159D1">IF</font> <font color="#868626">~~</font> <font color="#3159D1">THEN</font> <font color="#3159D1">REPLY</font> @<font color="#0000FF">3 <font color="#219121">/* ~I apologize, but I have come to request your
  talent on a commissioned artwork.~ #28657 */</font>
    <font color="#3159D1">DO <font color="#868626">~SetGlobal("TalkedToSarles","GLOBAL",1)~</font> GOTO</font> 2</font>
<font color="#3159D1">END</font> </pre>

Note that all of the strings have been replaced by <span class="c003">@number</span> and the texts
have been put in comments.</p><p>The translation file <span class="c003">scsarles.tra</span> contains all of those strings:

<pre><font color="#219121">// SCSARLES translation file
</font>@<font color="#0000FF">1</font>   = <font color="#868626">~Who is it? Might I ask why you have disturbed my meditations?
My creative muse must be gently awakened, and your stomping
about is simply not conducive to this.~</font> [SARLES02]
@<font color="#0000FF">2</font>   = <font color="#868626">~My apologies. I will leave you to your thinking.~</font>
@<font color="#0000FF">3</font>   = <font color="#868626">~I apologize, but I have come to request your talent on a commissioned artwork.~</font> </pre>

You may then ask someone who speaks another language to write a new
translation file by translating every string in <span class="c003">scsarles.tra</span>. This
prevents the string text and the structure from getting out of sync
and simplifies translation; non-technical players can translate raw text
files easily.</p><p>When compiling a <a href="#D"><span class="c003">D</span></a> file that contains <span class="c003">@number</span> translation
references you must supply (at least) one translation file. For example,
you might say:</p><p><span class="c003">C:</span>\<span class="c003">Program Files</span>\<span class="c003">Black Isle</span>\<span class="c003">BGII - SoA</span>\<span class="c003">&gt;  <span class="c002">WeiDU SCSARLES.D italian.tra</span> </span></p><p>You may specify multiple translation files. The last one to define a string
wins. This is useful if one language is more up to date than the others. In
this example:</p><p><span class="c003">C:</span>\<span class="c003">Program Files</span>\<span class="c003">Black Isle</span>\<span class="c003">BGII - SoA</span>\<span class="c003">&gt;  <span class="c002">WeiDU SCSARLES.D english.tra italian.tra</span> </span></p><p>Strings will be taken from the italian translation whenever possible, but
if they are not available it will fall back on the english versions.</p><p>You may use WeiDU to check and make sure that translations are up to date.
WeiDU will automatically generate a text file listing all of the strings
that are present in one translation (usually your native one) that are
missing in another. You can then send this file to your translators so that
they know what to do. This example command compares all of the <a href="#TRA"><span class="c003">TRA</span></a>
files in the <span class="c003">american</span> and <span class="c003">french</span> directories and creates a file
called <span class="c003">MISSING</span>.</p><p><span class="c003">C:</span>\<span class="c003">Program Files</span>\<span class="c003">Black Isle</span>\<span class="c003">BGII - SoA</span>\<span class="c003">&gt;  <span class="c002">weidu --tcmp-from american --tcmp-to french --out MISSING</span> </span></p>
<!--TOC subsection id="sec18" Converting a “hard-coded” <span class="c003">D to a D/TRA pair (Last Update: v200)</span>-->
<h3 class="subsection" id="sec18">8.9  Converting a “hard-coded” <a href="#D"><span class="c003">D</span></a> to a <a href="#D"><span class="c003">D</span></a>/<a href="#TRA"><span class="c003">TRA</span></a> pair (Last Update: v200)</h3><!--SEC END --><p>This tutorial was thoughtfully provided by Jason Compton.</p><p><a href="#D"><span class="c003">D</span></a> and <a href="#TP2"><span class="c003">TP2</span></a> files allow programmers to describe text either
literally:

<pre width="80"><font color="#219121">// Greeting.d
</font><font color="#3159D1">SAY</font> <font color="#868626">~Hello.~</font>
</pre>

or with a companion <a href="#TRA"><span class="c003">TRA</span></a> (translation) file that supports multiple
languages:

<pre width="80"><font color="#219121">// Greeting.d
</font><font color="#3159D1">SAY</font> @<font color="#0000FF">1</font>

<font color="#219121">// Greeting.tra
</font>@<font color="#0000FF">1</font> = <font color="#868626">~Hello.~</font>
</pre>

The idea being that one can make a French version of <span class="c003">Greeting.tra</span> which
contains

<pre width=80><font color="#219121">// French-Greeting.tra
</font>@<font color="#0000FF">1</font> = <font color="#868626">~Bonjour.~</font>
</pre>

However, some WeiDU users, for reasons of convenience or simply never
anticipating the opportunity to translate, may have originally chosen the
"hard-coded" approach but now regret that decision. <span class="c003">--traify</span> will break
out all the text in <a href="#SAY"><span class="c003">SAY</span></a>, <a href="#REPLY"><span class="c003">REPLY</span></a>, and <a href="#JOURNAL"><span class="c003">JOURNAL</span></a> entries
into translation-ready format. <span class="c003">--traify</span> may also be used on <a href="#TP2"><span class="c003">TP2</span></a>
files.</p><p>To turn the hard-coded <a href="#D"><span class="c003">D</span></a> file <span class="c003">FWKI.d</span> into a new
<a href="#D"><span class="c003">D</span></a>/<a href="#TRA"><span class="c003">TRA</span></a> combo, use
<span class="c003">--traify</span> and <span class="c003">--out</span> to specify the input and output filenames,
respectively:</p><p><span class="c003">C:</span>\<span class="c003">Program Files</span>\<span class="c003">Black Isle</span>\<span class="c003">BGII - SoA</span>\<span class="c003">&gt;  <span class="c002"> weidu --traify fwki.d --out fwki-new.d</span> </span></p><p>After a brief pause, <span class="c003">fwki-new.d</span> and <span class="c003">fwki-new.tra</span> will be created.</p><p>The <span class="c003">--traify</span> process turns <span class="c003">fwki.d</span>’s

<pre width="80"><font color="#3159D1">APPEND</font> J#KLSYJ
  <font color="#3159D1">IF <font color="#868626">~~</font> THEN BEGIN</font> KelseySAHPR4
    <font color="#3159D1">SAY <font color="#868626">~Urk. Who was the lucky donor?~</font>
    IF <font color="#868626">~~</font> THEN EXTERN</font> SAHPR2 <font color="#0000FF">10</font>
  <font color="#3159D1">END
END</font> </pre>

into <span class="c003">fwki-new.d</span>’s

<pre width="80"><font color="#3159D1">APPEND</font> J#KLSYJ
  <font color="#3159D1">IF <font color="#868626">~~</font> THEN BEGIN</font> KelseySAHPR4
    <font color="#3159D1">SAY</font> @<font color="#0000FF">0</font>
    <font color="#3159D1">IF <font color="#868626">~~</font> THEN EXTERN</font> SAHPR2 <font color="#0000FF">10</font>
  <font color="#3159D1">END
END</font> </pre>

and in the newly created <span class="c003">fwki-new.tra</span>, you will find

<pre>@<font color="#0000FF">0</font>    = <font color="#868626">~Urk. Who was the lucky donor?~</font></pre>

and this dialogue file is now ready for translation.</p><p><span class="c003">--traify</span> works from the top of the <a href="#D"><span class="c003">D</span></a> down, starting at <span class="c003">@0</span>. It
will NOT skip over any existing <span class="c003">@x</span> translation references it finds, so if
your <a href="#D"><span class="c003">D</span></a> contains any translation support at all, it is best to use <span class="c003">--traify-old-tra</span> as well.</p><p>Because standard <span class="c003">--traify</span> starts at <span class="c003">@0</span> and is unaware of any any existing
<span class="c003">@x</span> entries in the <a href="#D"><span class="c003">D</span></a>, if you have begun to convert a <a href="#D"><span class="c003">D</span></a> to a
<a href="#D"><span class="c003">D</span></a>/<a href="#TRA"><span class="c003">TRA</span></a> pair by hand, you may have <span class="c003">@x</span> entries that clash with
<span class="c003">--traify</span>’s results.</p><p>In other words, if you already have a state that says

<pre width="80"><font color="#3159D1">IF <font color="#868626">~~</font> THEN BEGIN</font> blah
  <font color="#3159D1">SAY</font> @<font color="#0000FF">0</font>
  <font color="#3159D1">IF <font color="#868626">~~</font> THEN EXIT
END</font></pre>

<span class="c003">--traify</span> will not skip <span class="c003">@0</span> automatically, you will have two locations where
<span class="c003">@0</span> is used but you intended to use two different strings, and this will be
bad.</p><p>To avoid this problem, add the <span class="c003">--traify-old-tra</span> argument to specify the file
containing the already traified strings:</p><p><span class="c003">C:</span>\<span class="c003">Program Files</span>\<span class="c003">Black Isle</span>\<span class="c003">BGII - SoA</span>\<span class="c003">&gt;  <span class="c002"> weidu --traify fwki.d --traify-old-tra fwki.tra --out fwki-new</span> </span></p><p>will put the existing and new ones <span class="c003">@x</span> references in <span class="c003">fwki-new.tra</span>.</p><p>Finally, note that <span class="c003">--traify</span> works for <a href="#BAF"><span class="c003">BAF</span></a> files as well.</p><p>Note: We were previously suggesting to use <span class="c003">--traify#</span> here. Unless you want
for some reason to have new references starting at a given number, you should
use <a href="#--traify-old-tra"><span class="c003">--traify-old-tra</span></a> instead.</p><p>In all cases, you might also find it beneficial to put the
<a href="#--traify-comment"><span class="c003">--traify-comment</span></a> argument in your command line, so that you’ll also have
the content of the @references in your file (which will make it easier to edit it later):</p><p><span class="c003">C:</span>\<span class="c003">Program Files</span>\<span class="c003">Black Isle</span>\<span class="c003">BGII - SoA</span>\<span class="c003">&gt;  <span class="c002"> weidu --traify fwki.d --traify-old-tra fwki.tra --out fwki-new --traify-comment</span> </span></p><p>In particular, using <a href="#--traify-comment"><span class="c003">--traify-comment</span></a> and <a href="#--traify-old-tra"><span class="c003">--traify-old-tra</span></a> together
will add the missing comments without doubling the existing ones.</p>
<!--TOC subsection id="sec19" <span class="c003">REPLACE_ACTION_TEXT</span>-->
<h3 class="subsection" id="sec19">8.10  <a href="#REPLACE_ACTION_TEXT"><span class="c003">REPLACE_ACTION_TEXT</span></a></h3><!--SEC END --><p>
This tutorial was thoughtfully provided by Japheth.</p><p><a href="#REPLACE_ACTION_TEXT"><span class="c003">REPLACE_ACTION_TEXT</span></a> can be used with regular expressions
(<a href="#regexp"><span class="c003">regexp</span></a>). So, some actions such as
<span class="c003">CreateCreature("blah",[0.0],1)</span> won’t be matched by WeiDU because when
you say <span class="c003">[0.0]</span> it is looking for a character set.</p><p>Here’s one dialogue that I’m fixing and how to do it correctly.</p><p><span class="c003">Arghai.dlg</span> has this action trigger before
<a href="#REPLACE_ACTION_TEXT"><span class="c003">REPLACE_ACTION_TEXT</span></a>ing it.</p><pre class="verbatim">CreateCreature("OGREHA",[1351.1078])
</pre><p>There’s no point given, which makes WeiDU and NI angry. To fix it using
<a href="#REPLACE_ACTION_TEXT"><span class="c003">REPLACE_ACTION_TEXT</span></a> this is what you have to do:</p><pre class="verbatim">REPLACE_ACTION_TEXT arghai
~CreateCreature("OGREHA",\[1351.1078\])~
~CreateCreature("OGREHA",[1351.1078],0)~
</pre><p>So, all you have to remember to do is escape the square brackets with a
backslash so WeiDU doesn’t confuse them with a regular expression.</p><p><a id="sec-alter-trans"></a></p>
<!--TOC subsection id="sec20" <span class="c003">ALTER_TRANS</span> (Last Update: 204.)-->
<h3 class="subsection" id="sec20">8.11  <span class="c003">ALTER_TRANS</span> (Last Update: 204.)</h3><!--SEC END --><p>
This tutorial was thoughtfully provided by CamDawg.</p><p>ALTER_TRANS is a more compatibility-friendly way of changing transitions in an existing dialogue state. This is best illustrated with an example; let’s use state 9 from doghma.dlg in BG2:</p><pre class="verbatim">IF ~~ THEN BEGIN 9 SAY #45751
  IF ~~ THEN REPLY #45752 GOTO 2
  IF ~GlobalLT("chapter","GLOBAL",4)~ THEN REPLY #45753 GOTO 5
  IF ~~ THEN REPLY #45754 GOTO 4
  IF ~Global("RevealUmar","GLOBAL",1)
      PartyHasItem("miscbl")
      PartyHasItem("miscbm")
      PartyHasItem("miscbn")
      PartyHasItem("miscbo")~ THEN REPLY #57922 GOTO 10
  IF ~~ THEN REPLY #45755 GOTO 1
END
</pre><p>The problem lies in transition 3, which should have an OR(4) before those four PartyHasItem checks. Before ALTER_TRANS, the least destructive way to fix it would be</p><pre class="verbatim">ADD_TRANS_TRIGGER DOGHMA 9 ~False()~ DO 3
EXTEND_BOTTOM DOGHMA 9
IF ~Global("RevealUmar","GLOBAL",1)
OR(4)
PartyHasItem("miscbl")
PartyHasItem("miscbm")
PartyHasItem("miscbn")
PartyHasItem("miscbo")~ THEN REPLY #57922 GOTO 10
END
</pre><p>This presents some compatibility issues though. If another mod has altered this transition (for example, a new action via ADD_TRANS_ACTION) then those changes are lost via this method. It also reorders the replies as they’re displayed on-screen--not a big issue for transitions involving replies, but it is a big issue for non-reply transitions where they’re evaluated from the bottom-up. It’s also an issue for other mods that target this transition, as the False() essentially eliminates it. Enter ALTER_TRANS:</p><pre class="verbatim">ALTER_TRANS DOGHMA // file name
BEGIN 9 END // state number (can be more than one)
BEGIN 3 END // transition number (can be more than one)
BEGIN // list of changes, see below for flags
  "TRIGGER" ~Global("RevealUmar","GLOBAL",1)
           OR(4)
             PartyHasItem("miscbl")
             PartyHasItem("miscbm")
             PartyHasItem("miscbn")
             PartyHasItem("miscbo")~
END
</pre><p>There are eight flags you can use in the list of changes. If you do not use a particular flag, the previous value of the transition will be retained (i.e. not specifying an ACTION flag will preserve the current action of the transition).</p><ul class="itemize"><li class="li-itemize">
TRIGGER: The trigger condition for the transition.
i.e <code>"TRIGGER" ~Global("foo","GLOBAL",0)~</code></li><li class="li-itemize">ACTION: The action performed if the transition is selected.
i.e. <code>"ACTION" ~SetGlobal("foo","GLOBAL",1)~</code></li><li class="li-itemize">REPLY: The player’s reply, if any.
i.e. <code>"REPLY" ~#57922~</code></li><li class="li-itemize">JOURNAL: Can add or change the journal entry.
i.e. <code>"JOURNAL" ~@100~</code></li><li class="li-itemize">SOLVED_JOURNAL: Same as JOURNAL, except for entries into the solved section of the journal.</li><li class="li-itemize">UNSOLVED_JOURNAL: Same as JOURNAL, except for entries into the unsolved section of the journal.</li><li class="li-itemize">EPILOGUE: Specifies where the transition leads to (GOTO, EXTERN, or EXIT)
i.e. <code>EPILOGUE" ~EXTERN BVICONI 0~</code></li><li class="li-itemize">FLAGS: Used to set transition flags manually, though I can’t imagine why one would do this.
</li></ul><p>Let’s try one last example. This is bviconi.dlg, state 103:</p><pre class="verbatim">IF WEIGHT #22 ~Global("LoveTalk","LOCALS",46)~ THEN BEGIN 103 SAY #10537
  IF ~~ THEN REPLY #10538 GOTO 367
  IF ~~ THEN REPLY #10539 EXTERN ~~ 0
END
</pre><p>As you can see the transition destination for the second transition is broken. In the olden days this would be fixed with</p><pre class="verbatim">ADD_TRANS_TRIGGER BVICONI 103 ~False()~ DO 1
EXTEND_BOTTOM BVICONI 103
IF ~~ THEN REPLY #10539 GOTO 368
END
</pre><p>With ALTER_TRANS, it becomes much easier:</p><pre class="verbatim">ALTER_TRANS BVICONI BEGIN 103 END BEGIN 1 END BEGIN "EPILOGUE" ~GOTO 368~ END
</pre><p>Addendum: please note that it’s important to wrap the target (for example, REPLY or EPILOGUE)
in quotes, tildas, or percentage signs.</p><p>Further addendum: REPLY, JOURNAL and friends will remove the feature (rather than add an empty
journal line or whatever) if the associated string is empty.</p>
<!--TOC section id="TP2" Module Packaging: <span class="c003"><span class="c007">TP2</span></span> Files-->
<h2 class="section" id="TP2">9  Module Packaging: <span class="c005">TP2</span><a id="hevea_default174"></a> Files</h2><!--SEC END --><p>
<a id="TP"></a></p><p>At some point you will be done with your mod (a collection of <span class="c003">CRE</span>,
<span class="c003">ITM</span>, <a href="#D"><span class="c003">D</span></a>, etc., files) and you will want to package it up so that
other users can install it (and then perhaps uninstall it later) easily.
WeiDU can handle this task for you (and you may freely distribute <span class="c003">WeiDU.exe</span>
with your module).</p><p>A <a href="#TP2"><span class="c003">TP2</span></a> describes how to install components of your module. WeiDU
will read the file, ask the user questions, and then perform the
installation. Uninstallation and upgrading are also handled.</p><p>See the file <span class="c003">examples/mymod.tp2</span> for a commented example of how this all
works.</p><p>Here is the context-free grammar syntax for the <a href="#TP2"><span class="c003">TP2</span></a> file format:</p><table class="c000 cellpadding1" border=1><tr><td class="c012">
<span class="c005">TP2 File</span><a id="TP2 File"></a><a id="hevea_default175"></a><a id="TP2"></a></td><td class="c014">&nbsp;</td><td class="c014"> A <a href="#TP2%20File"><span class="c003">TP2 File</span></a> is a text file that contains a number of
mod <a href="#Component"><span class="c003">Component</span></a>s. <a href="#TP2%20File"><span class="c003">TP2 File</span></a>s tell WeiDU how to install
various parts of your mod on an end-user’s computer. </td></tr>
<tr><td class="c012">
is</td><td class="c014"><span class="c005">BACKUP</span><a id="BACKUP"></a><a id="hevea_default176"></a> directoryName<p><span class="c005">AUTHOR</span><a id="AUTHOR"></a><a id="hevea_default177"></a> emailAddress</p><p><a href="#TP2%20Flag"><span class="c003">TP2 Flag</span></a> <span class="c002"> list </span></p><p><a href="#Language"><span class="c003">Language</span></a> <span class="c002"> list </span></p><p><a href="#Component"><span class="c003">Component</span></a> <span class="c002"> list </span></p></td><td class="c014">
A <a href="#TP2%20File"><span class="c003">TP2 File</span></a> is basically a prologue and then a list of
<a href="#Component"><span class="c003">Component</span></a>s. The <a href="#BACKUP"><span class="c003">BACKUP</span></a> declaration tells WeiDU
where to put backed-up versions of files that would be
overwritten so that they can be uninstalled later. This
directory will be created automatically if it is missing. The
<a href="#AUTHOR"><span class="c003">AUTHOR</span></a> directive gives an email address for users to
send bugs to if there are problems during the installation. You
may use <span class="c005">SUPPORT</span><a id="SUPPORT"></a><a id="hevea_default178"></a> as an alias for <a href="#AUTHOR"><span class="c003">AUTHOR</span></a>. The
<span class="c005">TP2_AUTHOR</span><a id="TP2_AUTHOR"></a><a id="hevea_default179"></a> <a href="#variable"><span class="c003">variable</span></a> is set to the
“emailAddress” value. The <span class="c005">TP2_FILE_NAME</span><a id="TP2_FILE_NAME"></a><a id="hevea_default180"></a>
<a href="#variable"><span class="c003">variable</span></a> is set to the name of the tp2 file. The
<span class="c005">TP2_BASE_NAME</span><a id="TP2_BASE_NAME"></a><a id="hevea_default181"></a> <a href="#variable"><span class="c003">variable</span></a> is set to the name of
the tp2, excluding any initial “setup-” and file
extension. For “setup-mymod.tp2”, <span class="c003">TP2_FILE_NAME</span> is set to
“setup-mymod.tp2”, while <span class="c003">TP2_BASE_NAME</span> is set to
“mymod”. The <span class="c005">MOD_FOLDER</span><a id="MOD_FOLDER"></a><a id="hevea_default182"></a> <a href="#variable"><span class="c003">variable</span></a> is set to
the directory containing the TP2 file, if there is one,
otherwise it is set to the root directory of directoryName.
<a href="#TP2%20Flag"><span class="c003">TP2 Flag</span></a>s set global options. <a href="#Language"><span class="c003">Language</span></a>s are
the various languages in which your mod is available. The
Finally, the <a href="#Component"><span class="c003">Component</span></a>s make up the actual meat of your
mod. Different <a href="#Component"><span class="c003">Component</span></a>s can be installed or
uninstalled separately, but all of the parts within a
<a href="#Component"><span class="c003">Component</span></a> are treated as a unit. </td></tr>
<tr><td class="c012">&nbsp;</td></tr>
<tr><td class="c012">
<span class="c005">TP2 Flag</span><a id="TP2 Flag"></a><a id="hevea_default183"></a></td><td class="c014">&nbsp;</td><td class="c014">A <a href="#TP2%20Flag"><span class="c003">TP2 Flag</span></a> declaration tells WeiDU to apply some
global option to your <a href="#TP2"><span class="c003">TP2</span></a> file. </td></tr>
<tr><td class="c012"> is</td><td class="c014"><span class="c005">AUTO_TRA</span><a id="AUTO_TRA"></a><a id="hevea_default184"></a> path</td><td class="c014"> The <a href="#AUTO_TRA"><span class="c003">AUTO_TRA</span></a> flag is used
with the <a href="#COMPILE"><span class="c003">COMPILE</span></a> <a href="#TP2%20Action"><span class="c003">TP2 Action</span></a>. It automatically loads
<a href="#TRA"><span class="c003">TRA</span></a> files that match your <a href="#D"><span class="c003">D</span></a> files. The <a href="#TRA"><span class="c003">TRA</span></a> file
loaded by <a href="#AUTO_TRA"><span class="c003">AUTO_TRA</span></a> takes precedence over all other <a href="#TRA"><span class="c003">TRA</span></a>
files. Variables are evaluated when the action is processed. </td></tr>
<tr><td class="c012"> or</td><td class="c014"><span class="c005">ALLOW_MISSING</span><a id="ALLOW_MISSING"></a><a id="hevea_default185"></a> file <span class="c002"> list </span></td><td class="c014"> <a href="#ALLOW_MISSING"><span class="c003">ALLOW_MISSING</span></a> directive allows you to specify files that can
be missing (when you try to copy them or reference them from
<a href="#D"><span class="c003">D</span></a> files). Empty versions of those files will be created on
demand. Try to use <a href="#ACTION_IF"><span class="c003">ACTION_IF</span></a> instead of this. </td></tr>
<tr><td class="c012"> or</td><td class="c014"><span class="c005">ASK_EVERY_COMPONENT</span><a id="ASK_EVERY_COMPONENT"></a><a id="hevea_default186"></a></td><td class="c014"> This flag instructs WeiDU to ask about installing every component in
this <a href="#TP2"><span class="c003">TP2</span></a> file individually, rather than asking questions
like "Would you like to install them all?" </td></tr>
<tr><td class="c012"> or</td><td class="c014"><span class="c005">ALWAYS</span><a id="ALWAYS"></a><a id="hevea_default187"></a> <a href="#TP2%20Action"><span class="c003">TP2 Action</span></a> <span class="c002"> list </span><span class="c003">END</span></td><td class="c014"> This flag specified a <a href="#TP2%20Action"><span class="c003">TP2 Action</span></a> that is executed at the beginning
of each <a href="#Component"><span class="c003">Component</span></a>, before the component-specific <a href="#TP2%20Action"><span class="c003">TP2 Action</span></a>. </td></tr>
<tr><td class="c012"> or</td><td class="c014"><span class="c005">README</span><a id="README"></a><a id="hevea_default188"></a> file <span class="c002"> list </span></td><td class="c014"> The given file is displayed to the user after choosing the language, but
before installing any component. If more than one file name is provided,
they are checked for existence in the order they’re provided, and the first available
one will be opened. If you wish to open multiple readme files, use multiple <span class="c003">README</span>
statements.
</td></tr>
<tr><td class="c012"> or</td><td class="c014"><span class="c005">UNINSTALL_ORDER</span><a id="hevea_default189"></a> String <span class="c002"> list </span></td><td class="c014">		<em>Do not use this without a real reason.</em><p>		Specifies the order in which uninstallation operations are handled.
		The operations are STRSET (uninstall <a href="#STRING_SET"><span class="c003">STRING_SET</span></a> and
<a href="#ALTER_TLK"><span class="c003">ALTER_TLK</span></a>), MOVE
		(uninstall <a href="#MOVE"><span class="c003">MOVE</span></a>), AT (perform <a href="#AT_UNINSTALL"><span class="c003">AT_UNINSTALL</span></a> and
<a href="#AT_INTERACTIVE_UNINSTALL"><span class="c003">AT_INTERACTIVE_UNINSTALL</span></a>) and
		COPY (uninstall all various file operations).</p><p>		If not specified, the order is MOVE - STRSET - COPY - AT.</p><p>		If this is specified, then ALL operations must be specified
		(if any isn’t, a warning is printed). Please note that this means that
		your mod might start printing warnings three years down the line if
		a new uninstall action is coded.
</p></td></tr>
<tr><td class="c012"> or</td><td class="c014"><span class="c005">MODDER</span><a id="MODDER"></a><a id="hevea_default190"></a> String <span class="c002"> list </span></td><td class="c014"> Enable additional debug info. By default, these messages are verbose but do
not halt the installation. Some options are configurable, see the <a href="#sec-modder">in-depth description</a>.
</td></tr>
<tr><td class="c012"> or</td><td class="c014"><span class="c005">VERSION</span><a id="VERSION"></a><a id="hevea_default191"></a> String</td><td class="c014">
"String" (variables evaluated) will be appended to every component’s
name in the weidu.log file. The <a href="#variable"><span class="c003">variable</span></a>
<span class="c005">MOD_VERSION</span><a id="MOD_VERSION"></a><a id="hevea_default192"></a> evaluates to the string set by <a href="#VERSION"><span class="c003">VERSION</span></a>
or to the empty string if the <a href="#VERSION"><span class="c003">VERSION</span></a> flag is not present. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">SCRIPT_STYLE</span><a id="SCRIPT_STYLE"></a><a id="hevea_default193"></a> style</td><td class="c014"> This flag determines how WeiDU will read in <a href="#BAF"><span class="c003">BAF</span></a> and
<a href="#BCS"><span class="c003">BCS</span></a> files and
write out <a href="#BAF"><span class="c003">BAF</span></a> and <a href="#BCS"><span class="c003">BCS</span></a> files. Possible options for
“style” include <span class="c003">BG</span> (the default), <span class="c003">IWD1</span>, <span class="c003">IWD2</span>, and <span class="c003">PST</span>.
See <a href="#sec-scripting-styles">the Scripting Styles tutorial</a>. </td></tr>
<tr><td class="c012"> or</td><td class="c014"><span class="c005">NO_IF_EVAL_BUG</span><a id="NO_IF_EVAL_BUG"></a><a id="hevea_default194"></a></td><td class="c014">this action solves a long-standing bug with
the <span class="c003">IF_EVAL</span> action. Since solving it is not directly possible without
damaging backwards compatibility, you have to use this action (preferably
in an <a href="#ALWAYS"><span class="c003">ALWAYS</span></a> statement) to solve the bug for yourself. <span class="c003">IF_EVAL</span> will not
work with this action in the TP2 - use <a href="#PATCH_IF"><span class="c003">PATCH_IF</span></a> and
<a href="#BUT_ONLY_IF_IT_CHANGES"><span class="c003">BUT_ONLY_IF_IT_CHANGES</span></a> instead. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">QUICK_MENU</span><a id="QUICK_MENU"></a><a id="hevea_default195"></a> lots of parameters</td><td class="c014"> Used to specify one or more groups of components that can be installed in
a single step. See the <a href="#sec-quick-menu"><span class="c003">QUICK_MENU</span> tutorial</a> for syntax, usage
instructions, and caveats. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">AUTO_EVAL_STRINGS</span><a id="AUTO_EVAL_STRINGS"></a><a id="hevea_default196"></a></td><td class="c014">
<span class="c003">EVALUATE_BUFFER</span> is used whenever variables are evaluated. In
particular, you can now "forget" about using it in FUNCTIONs and
arrays. Note, TP2 defines multiple instances of
<span class="c003">EVALUATE_BUFFER</span>, like <a href="#EVALUATE_BUFFER"><span class="c003">EVALUATE_BUFFER</span></a>, but these are
not affected by <a href="#AUTO_EVAL_STRINGS"><span class="c003">AUTO_EVAL_STRINGS</span></a>. <em>N.B.</em> This adds
an additional level of <span class="c003">EVAL</span> to <a href="#OUTER_TEXT_SPRINT"><span class="c003">OUTER_TEXT_SPRINT</span></a> and
<a href="#TEXT_SPRINT"><span class="c003">TEXT_SPRINT</span></a>, but not to <a href="#OUTER_SPRINT"><span class="c003">OUTER_SPRINT</span></a> or
<a href="#SPRINT"><span class="c003">SPRINT</span></a>. </td></tr>
<tr><td class="c012">&nbsp;</td></tr>
<tr><td class="c012">
<span class="c005">Language</span><a id="Language"></a><a id="hevea_default197"></a></td><td class="c014">&nbsp;</td><td class="c014"> A <a href="#Language"><span class="c003">Language</span></a> declaration tells WeiDU where to find <a href="#TRA"><span class="c003">TRA</span></a>
files. </td></tr>
<tr><td class="c012">
is</td><td class="c014"><span class="c005">LANGUAGE</span><a id="LANGUAGE"></a><a id="hevea_default198"></a> languageName
languageDirectory
defaultLanguageTRA <span class="c002"> list </span></td><td class="c014"> The languageName is the name of the language as it is presented to
the user. "American English" and "Italiano" are
examples. The languageDirectory is the name of the subdirectory in
which you have stored the <a href="#TRA"><span class="c003">TRA</span></a> files for that language.
Examples include "american" and "spanish". The <a href="#variable"><span class="c003">variable</span></a>
named <span class="c003">LANGUAGE</span> is set to languageDirectory if the user selects
this language.. Finally, all of the <a href="#TRA"><span class="c003">TRA</span></a> files in the
defaultLanguageTRA list are loaded as soon as the user selects a
language. </td></tr>
<tr><td class="c012">&nbsp;</td></tr>
<tr><td class="c012">
<span class="c005">Component</span><a id="Component"></a><a id="hevea_default199"></a><a id="component"></a></td><td class="c014">&nbsp;</td><td class="c014"> A <a href="#Component"><span class="c003">Component</span></a> is a contiguous group of files and actions that a
user can install, uninstall or upgrade. </td></tr>
<tr><td class="c012">
is</td><td class="c014"><span class="c005">BEGIN</span><a id="hevea_default200"></a> componentName
<a href="#Component%20Flag"><span class="c003">Component Flag</span></a> <span class="c002"> list </span><a href="#TP2%20Action"><span class="c003">TP2 Action</span></a> <span class="c002"> list </span></td><td class="c014"> Basically, if componentName is "Foo", the user will be asked: "Do you
want to install Foo?". If so, all of the associated <a href="#TP2%20Action"><span class="c003">TP2 Action</span></a>s
are performed. If not, they are skipped. </td></tr>
<tr><td class="c012">&nbsp;</td></tr>
<tr><td class="c012">
<span class="c005">Component Flag</span><a id="Component Flag"></a><a id="hevea_default201"></a></td><td class="c014">&nbsp;</td><td class="c014"> A <a href="#Component%20Flag"><span class="c003">Component Flag</span></a> determines how WeiDU treats a component. </td></tr>
<tr><td class="c012">
is</td><td class="c014"><span class="c005">DEPRECATED</span><a id="DEPRECATED"></a><a id="hevea_default202"></a> <a href="#String"><span class="c003">String</span></a></td><td class="c014"> Mark the given component as deprecated. If it is currently installed,
it will be uninstalled and the given <a href="#String"><span class="c003">String</span></a> will be
displayed. The user will never be asked to install the given
component -- it will be silently skipped in all listings. However, it
will still take up a “component number”. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">REQUIRE_COMPONENT</span><a id="REQUIRE_COMPONENT"></a><a id="hevea_default203"></a> modToUninstall modComponent
<a href="#String"><span class="c003">String</span></a></td><td class="c014"> Make this component so that it can only be installed if another
component is installed. If that other component is not installed, the
<a href="#String"><span class="c003">String</span></a> will be displayed and the user will not get a chance
to install this component. This is in some sense the opposite of the
<a href="#UNINSTALL"><span class="c003">UNINSTALL</span></a> <a href="#TP2%20Action"><span class="c003">TP2 Action</span></a>. For example,
<span class="c003">REQUIRE_COMPONENT "setup-ease.tp2" "0" "You must have infinite
stacking installed!"</span> prevents a component from being installed
unless the infinite stacking part of the Ease-of-Use mod is
installed. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">FORBID_COMPONENT</span><a id="FORBID_COMPONENT"></a><a id="hevea_default204"></a> modToUninstall modComponent
<a href="#String"><span class="c003">String</span></a></td><td class="c014"> Make this component so that it can only be installed if another
component is <em>not</em> installed. This does the opposite of
<a href="#REQUIRE_COMPONENT"><span class="c003">REQUIRE_COMPONENT</span></a>. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">REQUIRE_PREDICATE</span><a id="REQUIRE_PREDICATE"></a><a id="hevea_default205"></a> <a href="#value"><span class="c003">value</span></a> <a href="#String"><span class="c003">String</span></a></td><td class="c014"> This component can only be installed if the <a href="#value"><span class="c003">value</span></a>
evaluates to true (non-zero). </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">SUBCOMPONENT</span><a id="SUBCOMPONENT"></a><a id="hevea_default206"></a> <a href="#String"><span class="c003">String</span></a> <span class="c002"> [ </span><a href="#value"><span class="c003">value</span></a> <span class="c002"> ] </span></td><td class="c014"> At most one component of the given subcomponent group can be
installed at any time. All subcomponents of the same group are
listed together for the user. See the <a href="#sec-subcomponent"><span class="c003">SUBCOMPONENT</span> tutorial</a>. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">FORCED_SUBCOMPONENT</span><a id="FORCED_SUBCOMPONENT"></a><a id="hevea_default207"></a> <a href="#String"><span class="c003">String</span></a> <span class="c002"> [ </span><a href="#value"><span class="c003">value</span></a> <span class="c002"> ] </span></td><td class="c014"> See the <a href="#sec-subcomponent"><span class="c003">SUBCOMPONENT</span> tutorial</a>. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">GROUP</span><a id="GROUP"></a><a id="hevea_default208"></a> <a href="#String"><span class="c003">String</span></a><span class="c002"> [ </span><a href="#value"><span class="c003">value</span></a> <span class="c002"> ] </span></td><td class="c014">Used for grouping components; the user
will be asked to display these or not. See the <a href="#sec-group"><span class="c003">GROUP</span></a> tutorial. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">INSTALL_BY_DEFAULT</span><a id="INSTALL_BY_DEFAULT"></a><a id="hevea_default209"></a></td><td class="c014"> If WeiDU would ask the user whether to install this component or not,
and this component is not already installed, WeiDU will instead
install it by default (without asking the user). If there is an error
or the component is already installed, WeiDU will ask the user. The
<a href="#--uninstall"><span class="c003">--uninstall</span></a> command-line argument overrides this. See also
<a href="#REQUIRE_COMPONENT"><span class="c003">REQUIRE_COMPONENT</span></a> and <a href="#ALWAYS"><span class="c003">ALWAYS</span></a>. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">DESIGNATED</span><a id="DESIGNATED"></a><a id="hevea_default210"></a> forcedNumber</td><td class="c014"> Normally module components are numbered based on their order in the
<a href="#TP2"><span class="c003">TP2</span></a> file (starting from 0). This flag sets the current
component number to forcedNumber. The next component (if it lacks a
<a href="#DESIGNATED"><span class="c003">DESIGNATED</span></a> flag) will be forcedNumber+1. You can easily shoot
yourself in the foot by setting forcedNumber too low (e.g., so that
multiple components have the same number). </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">NO_LOG_RECORD</span><a id="NO_LOG_RECORD"></a><a id="hevea_default211"></a></td><td class="c014"> Normally all module components are recorded in <span class="c003">WeiDU.log</span> and can
be uninstalled later. This component flag prevents this component
from writing a log record when it is successfully installed. As a
result it is “invisible” to WeiDU, can be installed multiple times,
and cannot be uninstalled with WeiDU. <em>Do not use this flag without
	 a real reason.</em> </td></tr>
<tr><td class="c012"> or</td><td class="c014"><span class="c005">LABEL</span><a id="LABEL"></a><a id="hevea_default212"></a> <a href="#String"><span class="c003">String</span></a></td><td class="c014"> Defines the <span class="c003">LABEL</span>, or unique textual identifier, of this
module. Any component can have zero or more <span class="c003">LABEL</span>s. Will
print a warning if two components in the same tp2 share a
<span class="c003">LABEL</span>. <em>Do not alter a component’s <span class="c003">LABEL</span> once you
publish that mod</em>. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">METADATA</span><a id="METADATA"></a><a id="hevea_default213"></a> <a href="#String"><span class="c003">String</span></a></td><td class="c014"> Associates a string of metadata with this component. WeiDU does
not use the metadata for anything, but external programs might.
<span class="c003">METADATA</span> may be used multiple times per component.</td></tr>
<tr><td class="c012">&nbsp;</td></tr>
<tr><td class="c012">
<span class="c005">TP2 Action</span><a id="TP2 Action"></a><a id="hevea_default214"></a></td><td class="c014">&nbsp;</td><td class="c014"> A <a href="#TP2%20Action"><span class="c003">TP2 Action</span></a> tells WeiDU how to install a component. This usually
involves copying files and writing in new string references. </td></tr>
<tr><td class="c012">
is</td><td class="c014"><span class="c005">COPY</span><a id="COPY"></a><a id="hevea_default215"></a> <a href="#optNoBackup"><span class="c003">optNoBackup</span></a>
<a href="#optGlob"><span class="c003">optGlob</span></a> fromFile toFile ...
<a href="#patch"><span class="c003">patch</span></a> <span class="c002"> list </span><a href="#when"><span class="c003">when</span></a> <span class="c002"> list </span></td><td class="c014">
You may specify as many fromFile-toFile pairs as you like. Each
fromFile is copied to its associated toFile. If there are any
WeiDU variables inside explicit <span class="c003">%</span>s in toFile or fromFile,
they are replaced by their values. All of the <a href="#patch"><span class="c003">patch</span></a>es
are applied. If there are any <a href="#when"><span class="c003">when</span></a> conditions and any
of them are false, the copy does not happen. If fromFile is a
directory, toFile is also taken to be a directory and all files
(but not subdirectories) in fromFile are copied to toFile. A
typical example is <span class="c003">COPY "mymod/sword.itm"
"override/m#sword.itm"</span>.<p><a href="#COPY"><span class="c003">COPY</span></a> commands set the user-defined <span class="c005">SOURCE_DIRECTORY</span><a id="SOURCE_DIRECTORY"></a><a id="hevea_default216"></a>,
<span class="c005">SOURCE_FILESPEC</span><a id="SOURCE_FILESPEC"></a><a id="hevea_default217"></a>, <span class="c005">SOURCE_FILE</span><a id="SOURCE_FILE"></a><a id="hevea_default218"></a>,
<span class="c005">SOURCE_RES</span><a id="SOURCE_RES"></a><a id="hevea_default219"></a>, <span class="c005">SOURCE_EXT</span><a id="SOURCE_EXT"></a><a id="hevea_default220"></a>,
<span class="c005">DEST_DIRECTORY</span><a id="DEST_DIRECTORY"></a><a id="hevea_default221"></a>, <span class="c005">DEST_FILESPEC</span><a id="DEST_FILESPEC"></a><a id="hevea_default222"></a>,
<span class="c005">DEST_FILE</span><a id="DEST_FILE"></a><a id="hevea_default223"></a>,<span class="c005">DEST_RES</span><a id="DEST_RES"></a><a id="hevea_default224"></a> and <span class="c005">DEST_EXT</span><a id="DEST_EXT"></a><a id="hevea_default225"></a>
<a href="#variable"><span class="c003">variable</span></a>s based on fromFile and toFile as follows. If
fromFile is <span class="c003">mymod/cre/bigboss.cre</span>, then
<a href="#SOURCE_DIRECTORY"><span class="c003">SOURCE_DIRECTORY</span></a> is <span class="c003">mymod/cre</span>,
<a href="#SOURCE_FILESPEC"><span class="c003">SOURCE_FILESPEC</span></a> is <span class="c003">mymod/cre/bigboss.cre</span>,
<a href="#SOURCE_FILE"><span class="c003">SOURCE_FILE</span></a> is <span class="c003">bigboss.cre</span>,
<a href="#SOURCE_RES"><span class="c003">SOURCE_RES</span></a> is <span class="c003">bigboss</span> and <a href="#SOURCE_EXT"><span class="c003">SOURCE_EXT</span></a> is <span class="c003">cre</span>.
The <span class="c003">DEST_</span> variables
are similarly based on toFile. In addition, <span class="c005">SOURCE_SIZE</span><a id="SOURCE_SIZE"></a><a id="hevea_default226"></a> is
set to the size (in bytes) of the source file.</p><p>This is generally only useful if you have enabled globbing. Any
user-defined <a href="#variable"><span class="c003">variable</span></a>s in toFile are replaced with their
values. You may also reference these <a href="#variable"><span class="c003">variable</span></a>s in
<a href="#patch"><span class="c003">patch</span></a>es.</p><p>See the <a href="#sec-module-distribution">Module Distribution</a> section for information about
finding a good unique prefix for your mod-created resources.
</p></td></tr>
<tr><td class="c012"> or</td><td class="c014"><span class="c005">COPY_EXISTING</span><a id="COPY_EXISTING"></a><a id="hevea_default227"></a> <a href="#optNoBackup"><span class="c003">optNoBackup</span></a> fromFile toFile ...</td><td class="c014"> Behaves like <a href="#COPY"><span class="c003">COPY</span></a> except that the fromFiles are drawn from
the game <a href="#BIFF"><span class="c003">BIFF</span></a>s or <span class="c003">override</span> directory. This is useful for
making changes to files that other mods may have changed as well.
</td></tr>
<tr><td class="c012"> or</td><td class="c014"><span class="c005">COPY_EXISTING_REGEXP</span><a id="COPY_EXISTING_REGEXP"></a><a id="hevea_default228"></a> <a href="#optNoBackup"><span class="c003">optNoBackup</span></a> <a href="#optGlob"><span class="c003">optGlob</span></a>
fromFileRegexp toDirOrFile ... <a href="#patch"><span class="c003">patch</span></a> <span class="c002"> list </span><a href="#when"><span class="c003">when</span></a> <span class="c002"> list </span></td><td class="c014"> Behaves like <a href="#COPY_EXISTING"><span class="c003">COPY_EXISTING</span></a> except that fromFileRegexp may
contain regular expressions (<a href="#regexp"><span class="c003">regexp</span></a>s). Additionally, toDirOrFile
may reference matched groups in fromFileRegexp with \1,
\2, etc. If toDirOrFile is an existing directory or lacks a
file extension, it will be treated as a directory and all matching files
in the game <a href="#BIFF"><span class="c003">BIFF</span></a>s will be copied there. Otherwise, toDirOrFile
will be treated as a file.<p>If <a href="#GLOB"><span class="c003">GLOB</span></a> is specified, matching files in <span class="c003">override</span> will
also be patched and copied. If a file appears in both the
<a href="#BIFF"><span class="c003">BIFF</span></a>s and the <span class="c003">override</span> folder, it will only be copied
once. For example, if <span class="c003">HARM.ITM</span> is in the <a href="#BIFF"><span class="c003">BIFF</span></a>s and
<span class="c003">HARM2.ITM</span> is in <span class="c003">override</span>, this code will copy and patch them
both:</p><pre class="verbatim">COPY_EXISTING_REGEXP GLOB ~HARM.*.ITM~ ~override~
  SAY // ... whatever
</pre></td></tr>
<tr><td class="c012"> or</td><td class="c014"><span class="c005">COPY_LARGE</span><a id="COPY_LARGE"></a><a id="hevea_default229"></a> <a href="#optNoBackup"><span class="c003">optNoBackup</span></a> <a href="#optGlob"><span class="c003">optGlob</span></a> fromFile toFile ...</td><td class="c014"> Behaves like <a href="#COPY"><span class="c003">COPY</span></a> except that the fromFiles can be of arbitrary
size (the limit should be over a Gigabyte), but on the other side of
the coin you can’t apply patches to the copying.<p>Like <a href="#COPY"><span class="c003">COPY</span></a>, <a href="#COPY_LARGE"><span class="c003">COPY_LARGE</span></a> sets the variables
<a href="#SOURCE_DIRECTORY"><span class="c003">SOURCE_DIRECTORY</span></a>, <a href="#SOURCE_FILESPEC"><span class="c003">SOURCE_FILESPEC</span></a>, <a href="#SOURCE_FILE"><span class="c003">SOURCE_FILE</span></a>,
<a href="#SOURCE_RES"><span class="c003">SOURCE_RES</span></a>, <a href="#SOURCE_EXT"><span class="c003">SOURCE_EXT</span></a>, <a href="#SOURCE_SIZE"><span class="c003">SOURCE_SIZE</span></a>,
<a href="#DEST_DIRECTORY"><span class="c003">DEST_DIRECTORY</span></a>, <a href="#DEST_FILESPEC"><span class="c003">DEST_FILESPEC</span></a>, <a href="#DEST_FILE"><span class="c003">DEST_FILE</span></a>,
<a href="#DEST_RES"><span class="c003">DEST_RES</span></a> and <a href="#DEST_EXT"><span class="c003">DEST_EXT</span></a>.
</p></td></tr>
<tr><td class="c012"> or</td><td class="c014"><span class="c005">COPY_RANDOM</span><a id="COPY_RANDOM"></a><a id="hevea_default230"></a> <span class="c003">(</span> file1 <span class="c002"> list </span><span class="c003">)</span>
<span class="c002"> [ </span><span class="c003">(</span> fileN <span class="c002"> list </span><span class="c003">)</span> <span class="c002"> list  ] </span><a href="#patch"><span class="c003">patch</span></a> <span class="c002"> list </span><a href="#when"><span class="c003">when</span></a> <span class="c002"> list </span></td><td class="c014"> This command works like <a href="#COPY_EXISTING"><span class="c003">COPY_EXISTING</span></a> but the destination
for any given source file in the file1-list is some other different
file in the file1-list. Similarly, the destination for any file in
the fileN-list is some other file in the fileN-list. This allows you
to randomly shuffle categories of game resources. </td></tr>
<tr><td class="c012"> or</td><td class="c014"><span class="c005">COPY_ALL_GAM_FILES</span><a id="COPY_ALL_GAM_FILES"></a><a id="hevea_default231"></a>
<a href="#patch"><span class="c003">patch</span></a> <span class="c002"> list </span><a href="#when"><span class="c003">when</span></a> <span class="c002"> list </span></td><td class="c014"> Copies Default.gam from the biff and the ones in the save/ and mpsave/ saved
games, applying the list of patches. If there are any <a href="#when"><span class="c003">when</span></a> conditions
and any of them are false, the copy does not happen. <em>NO BACKUP is applied
to files in the save/ and mpsave/ directories. The savegame from the biffs is
backed up as usual.</em> </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">MOVE</span><a id="MOVE"></a><a id="hevea_default232"></a> <a href="#optNoBackup"><span class="c003">optNoBackup</span></a> fromFile toFile ... <code>(</code> <a href="#directory-file-regexp"><span class="c003">directory-file-regexp</span></a> <code>)</code> toFile ...</td><td class="c014"> If optNoBackup is specified, in addition to the usual effects, fromFile may be moved to toFile even if
one or both contain spaces in their names. <em>Do not use this feature without a real reason.</em><p>You may specify as many fromFile--toFile pairs as you like. Each
fromFile is moved to its associated toFile.</p><p>	 If fromFile is a file, toFile can be a file or a directory; if fromFile is a
	 directory, toFile must be a directory; if fromFile doesn’t exist, an error is
	 raised. If toFile already exists, <span class="c003">MOVE</span> is equivalent to <a href="#COPY_LARGE"><span class="c003">COPY_LARGE</span></a>.</p><p>	 <span class="c003">MOVE</span> also supports the <a href="#directory-file-regexp"><span class="c003">directory-file-regexp</span></a> construct
	 in place of fromFile; in this form, it must be wrapped in parenthesis,
	 toFile must be a directory, and no error is raised if no file is matched. Examples:</p><pre class="verbatim">MOVE ~sourceFile~ ~destinationFile~
MOVE ~sourceFile~ ~destinationDirectory~
MOVE ~sourceDirectory~ ~destinationDirectory~
MOVE (~sourceDirectory~ ~^[A-M].*\.itm$~) ~destinationDirectory
</pre><p>Safety notes: when uninstalling, MOVE is restored first,
then all generic actions are restored, then <span class="c003">AT_*_UNINSTALL</span> is handled.
As such, do your <a href="#AT_NOW"><span class="c003">AT_NOW</span></a>, then do your <a href="#COPY"><span class="c003">COPY</span></a>, then do your <span class="c003">MOVE</span>s
(exception: if you <span class="c003">MOVE</span> for biffing purposes, it is safe to call
<a href="#MAKE_BIFF"><span class="c003">MAKE_BIFF</span></a> after <span class="c003">MOVE</span>. <em>Do not use the --make-biff command-line argument</em>).
</p></td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">DELETE</span><a id="DELETE"></a><a id="hevea_default233"></a> <a href="#optNoBackup"><span class="c003">optNoBackup</span></a> file ...</td><td class="c014"> Removes one or more files from the file system. If file is a
directory, it will be recursively deleted together with anything
it contains.<p><em>Do not use without a real reason.</em>
</p></td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">DISABLE_FROM_KEY</span><a id="DISABLE_FROM_KEY"></a><a id="hevea_default234"></a> file ...</td><td class="c014">		Removes one or more files from the chitin.key, while leaving the
		containing bif file itself untouched.<p>		<em>Do not use without a real reason.</em>
</p></td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">CREATE</span><a id="CREATE"></a><a id="hevea_default235"></a> type <span class="c002"> [ </span><span class="c003">VERSION</span> version <span class="c002"> ] </span>resref <span class="c002"> [ </span><a href="#patch"><span class="c003">patch</span></a> <span class="c002"> list  ] </span></td><td class="c014">
Creates a new file of the specified type with the resource
reference resref and a correct file extension for the file
type. If there are any patches, they are applied to contents of
the new file. Any existing file with the same name will be
backed up, as normal. The file will be created structurally
correct but will contain no non-zero data aside from the
structural details. The file version will be native to the
current game, or default to <span class="c003">"V1.0"</span>, but can be overridden
with the <span class="c003">VERSION</span> option, which takes a string specifying the
desired version. <a href="#CREATE"><span class="c003">CREATE</span></a> supports the file types <span class="c003">ARE</span>,
<span class="c003">CRE</span>, <span class="c003">EFF</span>, <span class="c003">ITM</span>, <span class="c003">SPL</span> and <span class="c003">STO</span> and all their
known file versions (aside from EFF V1.0, which is never found
as a file). </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">COMPILE</span><a id="COMPILE"></a><a id="hevea_default236"></a> <span class="c002"> [ </span><span class="c003">EVALUATE_BUFFER</span> <span class="c002"> ] </span>sourceFile <span class="c002"> list  [ </span><a href="#patch"><span class="c003">patch</span></a> <span class="c002"> list  ]  [ </span><span class="c005">USING</span><a id="USING"></a><a id="hevea_default237"></a> traFile <span class="c002"> list  ] </span></td><td class="c014"> This command compiles <a href="#D"><span class="c003">D</span></a> and <a href="#BAF"><span class="c003">BAF</span></a> source files. If
sourceFile is a directory, all <a href="#D"><span class="c003">D</span></a> and <a href="#BAF"><span class="c003">BAF</span></a> files within
that directory are processed individually. If there is <a href="#EVALUATE_BUFFER"><span class="c003">EVALUATE_BUFFER</span></a>,
all <code>%variables%</code> in the files are substituted with their values.<p>After the special <a href="#EVALUATE_BUFFER"><span class="c003">EVALUATE_BUFFER</span></a> is executed, all other patches are executed.</p><p>First, this loads all of the traFiles presented. If any of their
paths contain <span class="c003">%s</span>, the <span class="c003">%s</span> is replaced with the
languageDirectory of from the <a href="#Language"><span class="c003">Language</span></a> the user selected.
If you specified <a href="#AUTO_TRA"><span class="c003">AUTO_TRA</span></a> <span class="c003">mymod/%s</span> above, WeiDU will
also attempt to load <span class="c003">mymod/languageDirectory/sourceFile.tra</span> for
every sourceFile in the list. Once all of the <a href="#TRA"><span class="c003">TRA</span></a> files are
loaded, the <a href="#D"><span class="c003">D</span></a> and <a href="#BAF"><span class="c003">BAF</span></a> files are compiled. Any
<a href="#DLG"><span class="c003">DLG</span></a>s or <a href="#BCS"><span class="c003">BCS</span></a>s they create or modify are placed in the
<span class="c003">override</span> directory. </p></td></tr>
<tr><td class="c012"> or</td><td class="c014"><span class="c005">CLEAR_MEMORY</span><a id="CLEAR_MEMORY"></a><a id="hevea_default238"></a></td><td class="c014">removes all variables from the memory, then
reloads the automatic ones (<a href="#TP2_AUTHOR"><span class="c003">TP2_AUTHOR</span></a>, <a href="#TP2_FILE_NAME"><span class="c003">TP2_FILE_NAME</span></a>, <a href="#TP2_BASE_NAME"><span class="c003">TP2_BASE_NAME</span></a>,
<a href="#MOD_FOLDER"><span class="c003">MOD_FOLDER</span></a>, <a href="#LANGUAGE"><span class="c003">LANGUAGE</span></a>, <a href="#WEIDU_ARCH"><span class="c003">WEIDU_ARCH</span></a>,
<a href="#WEIDU_OS"><span class="c003">WEIDU_OS</span></a>, <a href="#COMPONENT_NUMBER"><span class="c003">COMPONENT_NUMBER</span></a>, all numeric constants such as <span class="c003">NAME1</span>, the soundsets, or
<span class="c003">SCRIPT_OVERRIDE</span>). <a href="#INTERACTIVE"><span class="c003">INTERACTIVE</span></a> is automatically set when you call the
next component. <em>Do not use this feature without a real reason.</em> </td></tr>
<tr><td class="c012"> or</td><td class="c014"><span class="c005">CLEAR_ARRAYS</span><a id="CLEAR_ARRAYS"></a><a id="hevea_default239"></a></td><td class="c014">removes the names and contents of all arrays
from the memory (while still keeping their values). </td></tr>
<tr><td class="c012"> or</td><td class="c014"><span class="c005">CLEAR_CODES</span><a id="CLEAR_CODES"></a><a id="hevea_default240"></a></td><td class="c014">Removes all loaded functions and macros from the
memory. </td></tr>
<tr><td class="c012"> or</td><td class="c014"><span class="c005">CLEAR_INLINED</span><a id="CLEAR_INLINED"></a><a id="hevea_default241"></a></td><td class="c014">Removes all inlined files from the memory. </td></tr>
<tr><td class="c012"> or</td><td class="c014"><span class="c005">CLEAR_EVERYTHING</span><a id="CLEAR_EVERYTHING"></a><a id="hevea_default242"></a></td><td class="c014">Runs <a href="#CLEAR_MEMORY"><span class="c003">CLEAR_MEMORY</span></a>, <a href="#CLEAR_ARRAY"><span class="c003">CLEAR_ARRAY</span></a>, <a href="#CLEAR_CODES"><span class="c003">CLEAR_CODES</span></a> and
<a href="#CLEAR_INLINED"><span class="c003">CLEAR_INLINED</span></a>. </td></tr>
<tr><td class="c012"> or</td><td class="c014"><span class="c005">CLEAR_IDS_MAP</span><a id="CLEAR_IDS_MAP"></a><a id="hevea_default243"></a></td><td class="c014">force WeiDU to remove all loaded IDSes in memory
(otherwise, if you compile a script, append to an IDS and compile another script, WeiDU
will not handle the new IDS entry). </td></tr>
<tr><td class="c012"> or</td><td class="c014"><span class="c005">ACTION_CLEAR_ARRAY</span><a id="ACTION_CLEAR_ARRAY"></a><a id="hevea_default244"></a> <a href="#String"><span class="c003">String</span></a></td><td class="c014"> ‘Forgets’ that the array <span class="c003">string</span> exists until its values are recalled.
The actual variables’ values are kept, the only effect is that <span class="c003">*PHP_EACH</span>
will not consider old values.
</td></tr>
<tr><td class="c012"> or</td><td class="c014"><span class="c005">SILENT</span><a id="SILENT"></a><a id="hevea_default245"></a></td><td class="c014">makes WeiDU skip all messages; it’s reenabled once a component
is installed (or fails to), or a <a href="#PRINT"><span class="c003">PRINT</span></a>, <a href="#PATCH_PRINT"><span class="c003">PATCH_PRINT</span></a>, <a href="#VERBOSE"><span class="c003">VERBOSE</span></a> or <a href="#PATCH_VERBOSE"><span class="c003">PATCH_VERBOSE</span></a> is found. </td></tr>
<tr><td class="c012"> or</td><td class="c014"><span class="c005">VERBOSE</span><a id="VERBOSE"></a><a id="hevea_default246"></a></td><td class="c014">undoes the latest <a href="#SILENT"><span class="c003">SILENT</span></a> command. </td></tr>
<tr><td class="c012"> or</td><td class="c014"><span class="c005">MKDIR</span><a id="MKDIR"></a><a id="hevea_default247"></a> dirName <span class="c002"> list </span></td><td class="c014"> Instructs WeiDU to create all of the directories in the list. </td></tr>
<tr><td class="c012"> or</td><td class="c014"><span class="c005">RANDOM_SEED</span><a id="RANDOM_SEED"></a><a id="hevea_default248"></a> someInteger</td><td class="c014"> Sets the random number generator seed to someInteger. This allows you
to get reproducible results when using random functions. If you
specify a string that is not a valid integer the system initializes
itself (e.g., by using the current time). </td></tr>
<tr><td class="c012"> or</td><td class="c014"><span class="c005">ACTION_READLN</span><a id="ACTION_READLN"></a><a id="hevea_default249"></a> <a href="#variable"><span class="c003">variable</span></a></td><td class="c014"> Waits for the user to provided an enter-terminated string and store it in
variable. Said string will be stored and re-used during non-interactive reinstalls. See the
<a href="#sec-readln"><span class="c003">READLN</span> tutorial</a>. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">APPEND</span><a id="hevea_default250"></a> <a href="#optNoBackup"><span class="c003">optNoBackup</span></a> filename newText <a href="#when"><span class="c003">when</span></a> <span class="c002"> list  [ </span><span class="c003">KEEP_CRLF</span> <span class="c002"> ] </span></td><td class="c014"> If there are no <a href="#when"><span class="c003">when</span></a> conditions or they are all true, the
ASCII text newText is appended to the existing file filename (which
is read from the game <a href="#BIFF"><span class="c003">BIFF</span></a>s or the <span class="c003">override</span> folder).
Any variables in newText are replaced by their values.<p>If <span class="c003">KEEP_CRLF</span> is not present, double newlines in the file
(but not in newText) will be removed; otherwise, they’re kept.</p><p>In any event, if the file ends with CRLF only newText and an ending
CRLF will be written; otherwise, if the file does not end with CRLF,
it will be written before newText.
</p></td></tr>
<tr><td class="c012"> or</td><td class="c014"><span class="c005">APPEND_OUTER</span><a id="APPEND_OUTER"></a><a id="hevea_default251"></a> <a href="#optNoBackup"><span class="c003">optNoBackup</span></a> filename newText <a href="#when"><span class="c003">when</span></a> <span class="c002"> list  [ </span><span class="c003">KEEP_CRLF</span> <span class="c002"> ] </span></td><td class="c014"> If there are no <a href="#when"><span class="c003">when</span></a> conditions or they are all true, the
ASCII text newText is appended to the existing file filename (which
is treated as a path to a file).
Any variables in newText are replaced by their values.<p>If <span class="c003">KEEP_CRLF</span> is not present, double newlines in the file
(but not in newText) will be removed; otherwise, they’re kept.</p><p>In any event, if the file ends with CRLF only newText and an ending
CRLF will be written; otherwise, if the file does not end with CRLF,
it will be written before newText.
</p></td></tr>
<tr><td class="c012"> or</td><td class="c014"><span class="c005">APPEND_COL</span><a id="APPEND_COL"></a><a id="hevea_default252"></a> <a href="#optNoBackup"><span class="c003">optNoBackup</span></a> filename newText <span class="c002"> [ </span>prepend <span class="c002"> ] </span><a href="#when"><span class="c003">when</span></a> <span class="c002"> list </span></td><td class="c014"> If there are no <a href="#when"><span class="c003">when</span></a> conditions or they are all true, the
string newText is appended column-wise to the existing file filename (which
is read from the game <a href="#BIFF"><span class="c003">BIFF</span></a>s or the <span class="c003">override</span> folder).
If filename was:
<pre class="verbatim">A B C
D E F
X Y Z
P Q R
</pre>
and newText was <span class="c003">"0 1 2 3"</span>, the result would be:
<pre class="verbatim">A B C 0
D E F 1
X Y Z 2
P Q R 3
</pre>
You must have the same number of whitespace-separated words in
newText as there are columns in filename. Prepend empty cells are
	 assumed to be at the beginning of newText. A cell containing exactly
	 <code>$</code> is printed as empty. </td></tr>
<tr><td class="c012"> or</td><td class="c014"><span class="c005">APPEND_COL_OUTER</span><a id="APPEND_COL_OUTER"></a><a id="hevea_default253"></a> <a href="#optNoBackup"><span class="c003">optNoBackup</span></a> filename newText <span class="c002"> [ </span>prepend <span class="c002"> ] </span><a href="#when"><span class="c003">when</span></a> <span class="c002"> list </span></td><td class="c014"> If there are no <a href="#when"><span class="c003">when</span></a> conditions or they are all true, the
string newText is appended column-wise to the existing file filename (which
is treated as a path to a file).
If filename was:
<pre class="verbatim">A B C
D E F
X Y Z
P Q R
</pre>
and newText was <span class="c003">"0 1 2 3"</span>, the result would be:
<pre class="verbatim">A B C 0
D E F 1
X Y Z 2
P Q R 3
</pre>
You must have the same number of whitespace-separated words in
newText as there are columns in filename. Prepend empty cells are
	 assumed to be at the beginning of newText. A cell containing exactly
	 <code>$</code> is printed as empty. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">EXTEND_TOP</span><a id="hevea_default254"></a> existingBCS newFile <a href="#patch"><span class="c003">patch</span></a> <span class="c002"> list  [ </span><span class="c003">USING</span> traName <span class="c002"> list  ] </span></td><td class="c014"> Loads existingFile (which may be <a href="#BAF"><span class="c003">BAF</span></a> or <a href="#BCS"><span class="c003">BCS</span></a>), prepends
all of newBCS to the top of it, applies all of the <a href="#patch"><span class="c003">patch</span></a>es, and
then copies it to the <span class="c003">override</span> folder. User variables in
the filenames existingFile and newFile are replaced by their values.
Use <a href="#EVALUATE_BUFFER"><span class="c003">EVALUATE_BUFFER</span></a> if you want to evaluate variables inside
the body of newFile before parsing it. </td></tr>
<tr><td class="c012"> or</td><td class="c014"><span class="c005">EXTEND_BOTTOM</span><a id="hevea_default255"></a> existingBCS newFile <a href="#patch"><span class="c003">patch</span></a> <span class="c002"> list  [ </span><span class="c003">USING</span> traName <span class="c002"> list  ] </span></td><td class="c014"> As <a href="#EXTEND_TOP"><span class="c003">EXTEND_TOP</span></a>, but the newFile file is put at the bottom of the
existingBCS file. User variables in the filenames existingFile and
newFile are replaced by their values. </td></tr>
<tr><td class="c012"> or</td><td class="c014"><span class="c005">EXTEND_TOP_REGEXP</span><a id="EXTEND_TOP_REGEXP"></a><a id="hevea_default256"></a> existingBCSregexp newFile <a href="#patch"><span class="c003">patch</span></a> <span class="c002"> list  [ </span><span class="c003">USING</span> traName <span class="c002"> list  ] </span></td><td class="c014"> As <a href="#EXTEND_TOP"><span class="c003">EXTEND_TOP</span></a>, but the newFile file is put at the top of the
every <a href="#BCS"><span class="c003">BCS</span></a> file that matches the <a href="#regexp"><span class="c003">regexp</span></a>
existingBCSregexp. </td></tr>
<tr><td class="c012"> or</td><td class="c014"><span class="c005">EXTEND_BOTTOM_REGEXP</span><a id="EXTEND_BOTTOM_REGEXP"></a><a id="hevea_default257"></a> existingBCSregexp newFile <a href="#patch"><span class="c003">patch</span></a> <span class="c002"> list  [ </span><span class="c003">USING</span> traName <span class="c002"> list  ] </span></td><td class="c014"> See <a href="#EXTEND_TOP_REGEXP"><span class="c003">EXTEND_TOP_REGEXP</span></a>. </td></tr>
<tr><td class="c012"> or</td><td class="c014"><span class="c005">ACTION_IF</span><a id="ACTION_IF"></a><a id="hevea_default258"></a> <a href="#value"><span class="c003">value</span></a> <span class="c003">THEN BEGIN</span>
<a href="#TP2%20Action"><span class="c003">TP2 Action</span></a> <span class="c002"> list </span><span class="c003">END</span>
<span class="c002"> [ </span><span class="c003">ELSE BEGIN</span> <a href="#TP2%20Action"><span class="c003">TP2 Action</span></a> <span class="c002"> list </span><span class="c003">END</span> <span class="c002"> ] </span></td><td class="c014"> If <a href="#value"><span class="c003">value</span></a> evaluates to true (non-zero), the <a href="#TP2%20Action"><span class="c003">TP2 Action</span></a>s
in the <span class="c003">THEN</span>-branch are executed. Otherwise, if an <span class="c003">ELSE</span>-branch
is present, its commands are executed. Otherwise nothing happens. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">ACTION_MATCH</span><a id="ACTION_MATCH"></a><a id="hevea_default259"></a> match-value <span class="c003">WITH</span> <span class="c002"> [ </span>guard-value ...
<span class="c002"> [ </span><span class="c003">WHEN</span> condition-<a href="#value"><span class="c003">value</span></a> <span class="c002"> ] </span><span class="c003">BEGIN</span> <a href="#TP2%20Action"><span class="c003">TP2 Action</span></a> <span class="c002"> list </span><span class="c003">END</span> <span class="c002"> ]  [ </span><span class="c003">ANY</span> condition-<a href="#value"><span class="c003">value</span></a> <span class="c003">BEGIN</span> <a href="#TP2%20Action"><span class="c003">TP2 Action</span></a>
<span class="c002"> list </span><span class="c003">END</span> <span class="c002"> ] </span>...
<span class="c003">DEFAULT</span> <a href="#TP2%20Action"><span class="c003">TP2 Action</span></a> <span class="c002"> list </span><span class="c003">END</span></td><td class="c014">
The match-value is either a <a href="#value"><span class="c003">value</span></a> or a literal expression
(strings or integers); <a href="#value"><span class="c003">value</span></a>s are evaluated, including for
variables and the array construct, and the result obtained is used
in the matching.<p>Matching is done in order against guard-values for which any
corresponding condition-value evaluates to true (not 0) and against
guard-values that lack a condition-value.</p><p>Guard-values are either <a href="#value"><span class="c003">value</span></a>s or literal
expressions. Values are evaluated, including for variables and the
array construct, and the result is case-insensitively matched as a
<a href="#regexp"><span class="c003">regexp</span></a> against the match-value.</p><p>Condition-values must be <a href="#value"><span class="c003">value</span></a>s and must evaluate to integers.</p><p><span class="c003">ANY</span> matches any match-value for which the corresponding
condition-value is true.</p><p>If a match is found, the corresponding action list is executed and
no further matching is done. If no match is found, the <span class="c003">DEFAULT</span>
action list is executed.</p><p>See the <a href="#sec-match-and-try"><span class="c003">MATCH</span> and <span class="c003">TRY</span> tutorial</a>
for additional information. </p></td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">ACTION_TRY</span><a id="ACTION_TRY"></a><a id="hevea_default260"></a> <a href="#TP2%20Action"><span class="c003">TP2 Action</span></a> <span class="c002"> list </span><span class="c003">WITH</span>
<span class="c002"> [ </span>guard-<a href="#value"><span class="c003">value</span></a> ... <span class="c002"> [ </span><span class="c003">WHEN</span> condition-<a href="#value"><span class="c003">value</span></a>
<span class="c002"> ] </span><span class="c003">BEGIN</span> <a href="#TP2%20Action"><span class="c003">TP2 Action</span></a> <span class="c002"> list </span><span class="c003">END</span> <span class="c002"> ]  [ </span><span class="c003">ANY</span>
condition-<a href="#value"><span class="c003">value</span></a> <span class="c003">BEGIN</span> <a href="#TP2%20Action"><span class="c003">TP2 Action</span></a> <span class="c002"> list </span><span class="c003">END</span>
<span class="c002"> ] </span>... <span class="c003">DEFAULT</span> <a href="#TP2%20Action"><span class="c003">TP2 Action</span></a> <span class="c002"> list </span><span class="c003">END</span></td><td class="c014"> If evaluating the action list results in an error, the error is matched, as per <a href="#ACTION_MATCH"><span class="c003">ACTION_MATCH</span></a>.<p><span class="c007">N.B.</span> <span class="c003">TRY</span> is generally <em>not safe</em> to use because
many errors are intended to be fatal and if the mod installation
were to proceed anyway, it might do so in an inconsistent state,
with resource leaks or with other errors. <a href="#ACTION_RERAISE"><span class="c003">ACTION_RERAISE</span></a>
mitigates or eliminates these risks, since the unsafe part is
allowing the installation to continue and re-raising the error
allows it to fail, like intended.</p><p>See the <a href="#sec-match-and-try"><span class="c003">MATCH</span> and <span class="c003">TRY</span> tutorial</a> for additional information.
</p></td></tr>
<tr><td class="c012"> or</td><td class="c014"><span class="c005">ACTION_RERAISE</span><a id="ACTION_RERAISE"></a><a id="hevea_default261"></a></td><td class="c014"> When used inside an <a href="#ACTION_TRY"><span class="c003">ACTION_TRY</span></a>, the matched error is re-raised.<p>See the <a href="#sec-match-and-try"><span class="c003">MATCH</span> and <span class="c003">TRY</span> tutorial</a> for additional information.
</p></td></tr>
<tr><td class="c012"> or</td><td class="c014"><span class="c005">AT_EXIT</span><a id="AT_EXIT"></a><a id="hevea_default262"></a> commandToRun <span class="c002"> [ </span><span class="c003">EXACT</span> <span class="c002"> ] </span></td><td class="c014"> Whenever this <a href="#component"><span class="c003">component</span></a> attempts to be installed, commandToRun
is executed. Variables (e.g., <span class="c003">%LANGUAGE%</span>) in the string
commandToRun are replaced by their values. Note that the command is
executed even if the component does not install correctly, so
<a href="#AT_EXIT"><span class="c003">AT_EXIT</span></a> should probably be the last command in a component.
<ul class="itemize"><li class="li-itemize">
If commandToRun consists of a single <a href="#TP2"><span class="c003">TP2</span></a> filename, WeiDU will
enqueue that <a href="#TP2"><span class="c003">TP2</span></a> file and run it when the current one is done
(asking the user all the standard questions about languages and which
components to install).
</li><li class="li-itemize">If commandToRun consists of the word <span class="c003">VIEW</span> followed by a file, a
system-specific viewer will be used to present the file to the user.
For example, on Windows systems <span class="c003">notepad</span> will be used to view
<span class="c003">txt</span> files and a web browser will be used to view <span class="c003">html</span> files.
Note: also NOTEPAD and EXPLORER work like this, but use of those are
reserved to differently able modders.
</li><li class="li-itemize">Otherwise, commandToRun is executed by the underlying operating system
(and is thus system dependant). If you want to do something that
WeiDU doesn’t handle, like extracting WAVs from an MP3, make a batch
file and run it from here.
</li></ul>
Slashes and backslashes will be converted appropriately for the
underlying operating system. If <span class="c003">EXACT</span> is specified, <code>/</code>
and <code>\</code> will instead be preserved as they are. The most common usage is:
<pre class="verbatim">AT_INTERACTIVE_EXIT ~VIEW mymod\README.txt~
</pre>
This causes your README file to be displayed using a system appropriate
viewer. Here’s a more complicated example that pulls up a
language-specific README if one is available:
<pre class="verbatim">ACTION_IF FILE_EXISTS ~mymod\README.%LANGUAGE%.txt~ THEN BEGIN
  AT_INTERACTIVE_EXIT ~VIEW mymod\README.%LANGUAGE%.txt~
END ELSE BEGIN
  AT_INTERACTIVE_EXIT ~VIEW mymod\README.txt~
END
</pre>
</td></tr>
<tr><td class="c012"> or</td><td class="c014"><span class="c005">AT_INTERACTIVE_EXIT</span><a id="AT_INTERACTIVE_EXIT"></a><a id="hevea_default263"></a> commandToRun <span class="c002"> [ </span><span class="c003">EXACT</span> <span class="c002"> ] </span></td><td class="c014"> As <a href="#AT_EXIT"><span class="c003">AT_EXIT</span></a>, but the command is only executed if the user
specifically asked for the <a href="#component"><span class="c003">component</span></a> to be installed or
upgraded. </td></tr>
<tr><td class="c012"> or</td><td class="c014"><span class="c005">AT_UNINSTALL</span><a id="AT_UNINSTALL"></a><a id="hevea_default264"></a> commandToRun <span class="c002"> [ </span><span class="c003">EXACT</span> <span class="c002"> ] </span></td><td class="c014"> As <a href="#AT_EXIT"><span class="c003">AT_EXIT</span></a>, but when this <a href="#component"><span class="c003">component</span></a> is removed,
commandToRun is executed.</td></tr>
<tr><td class="c012"> or</td><td class="c014"><span class="c005">AT_INTERACTIVE_UNINSTALL</span><a id="AT_INTERACTIVE_UNINSTALL"></a><a id="hevea_default265"></a> commandToRun <span class="c002"> [ </span><span class="c003">EXACT</span> <span class="c002"> ] </span></td><td class="c014"> As <a href="#AT_EXIT"><span class="c003">AT_EXIT</span></a>, but whenever the user specifically asks for this
<a href="#component"><span class="c003">component</span></a> to be removed, commandToRun is executed.
Only the <span class="c003">%LANGUAGE%</span> variable is guaranteed to be
replaced, so do not count on any others. </td></tr>
<tr><td class="c012"> or</td><td class="c014"><span class="c005">AT_UNINSTALL_EXIT</span><a id="AT_UNINSTALL_EXIT"></a><a id="hevea_default266"></a> commandToRun <span class="c002"> [ </span><span class="c003">EXACT</span> <span class="c002"> ] </span></td><td class="c014"> As <a href="#AT_UNINSTALL"><span class="c003">AT_UNINSTALL</span></a>, but executed at the end of the WeiDU run (after
	printing ’SUCCESFULLY INSTALLED xyz’).</td></tr>
<tr><td class="c012"> or</td><td class="c014"><span class="c005">AT_INTERACTIVE_UNINSTALL_EXIT</span><a id="AT_INTERACTIVE_UNINSTALL_EXIT"></a><a id="hevea_default267"></a> commandToRun <span class="c002"> [ </span><span class="c003">EXACT</span> <span class="c002"> ] </span></td><td class="c014"> As <a href="#AT_UNINSTALL_EXIT"><span class="c003">AT_UNINSTALL_EXIT</span></a>, but only whenever the user specifically asks for this
<a href="#component"><span class="c003">component</span></a> to be removed. </td></tr>
<tr><td class="c012"> or</td><td class="c014"><span class="c005">AT_NOW</span><a id="AT_NOW"></a><a id="hevea_default268"></a> <span class="c002"> [ </span><a href="#variable"><span class="c003">variable</span></a> <span class="c002"> ] </span>commandToRun <span class="c002"> [ </span><span class="c003">EXACT</span> <span class="c002"> ] </span></td><td class="c014"> As <a href="#AT_EXIT"><span class="c003">AT_EXIT</span></a>, but commandToRun is executed when found,
rather than at the end of the installation. Use with oggdec,
tisunpack, wav2acm... but not with readmes (you’ll create dozens
of windows), nor with --make-biff (you’ll crash the
installation). If the optional <a href="#variable"><span class="c003">variable</span></a> is provided, a TP2
variable is of that name is assigned the return value of
commandToRun. </td></tr>
<tr><td class="c012"> or</td><td class="c014"><span class="c005">AT_INTERACTIVE_NOW</span><a id="AT_INTERACTIVE_NOW"></a><a id="hevea_default269"></a> <span class="c002"> [ </span><a href="#variable"><span class="c003">variable</span></a> <span class="c002"> ] </span>commandToRun <span class="c002"> [ </span><span class="c003">EXACT</span> <span class="c002"> ] </span></td><td class="c014"> As <a href="#AT_NOW"><span class="c003">AT_NOW</span></a>, but commandToRun is executed only if the installation is
run interactively.</td></tr>
<tr><td class="c012"> or</td><td class="c014"><span class="c005">MAKE_BIFF</span><a id="MAKE_BIFF"></a><a id="hevea_default270"></a> name-of-biff <span class="c003">BEGIN</span> <a href="#directory-file-regexp"><span class="c003">directory-file-regexp</span></a> <span class="c002"> list </span><span class="c003">END</span></td><td class="c014"> Create a biff <span class="c003">Data/name-of-biff.bif</span> from the files that can be matched by
directory-file-regexp. The chitin.key file is restored as a normal file, and
reloaded whenever the component is installed or uninstalled (which means that its
contents will be available exactly when the biff exists), while the .bif file
itself is deleted or on uninstall as usual. </td></tr>
<tr><td class="c012"> or</td><td class="c014"><span class="c005">LOAD_TRA</span><a id="LOAD_TRA"></a><a id="hevea_default271"></a> traName <span class="c002"> list </span></td><td class="c014"> Loads all traName files (variable substitution is done; the file can be inlined)
to be used in the following tp2 actions, as if you had declared them in <a href="#LANGUAGE"><span class="c003">LANGUAGE</span></a>. </td></tr>
<tr><td class="c012"> or</td><td class="c014"><span class="c005">WITH_TRA</span><a id="WITH_TRA"></a><a id="hevea_default272"></a> traName <span class="c002"> list </span><span class="c003">BEGIN</span> <a href="#TP2%20Action"><span class="c003">TP2 Action</span></a> <span class="c002"> list </span><span class="c003">END</span></td><td class="c014"> Creates a new <span class="c003">TRA</span> scope copied from the surrounding scope,
loads all traName files (variable substitution is done; the file
can be inlined) and evaluates the <span class="c003">TP2 Action</span>s. When
<a href="#WITH_TRA"><span class="c003">WITH_TRA</span></a> exits, the new <span class="c003">TRA</span> scope is discarded, that
is, all <span class="c003">TRA</span> changes made by <a href="#WITH_TRA"><span class="c003">WITH_TRA</span></a> or any of its
enclosed actions are forgotten. </td></tr>
<tr><td class="c012"> or</td><td class="c014"><span class="c005">WITH_SCOPE</span><a id="WITH_SCOPE"></a><a id="hevea_default273"></a> <span class="c003">BEGIN</span> <a href="#TP2%20Action"><span class="c003">TP2 Action</span></a> <span class="c002"> list </span><span class="c003">END</span></td><td class="c014"> Creates a new variable scope copied from the surrounding scope
and evaluates the <span class="c003">TP2 Action</span>s inside the new scope. When
<a href="#WITH_SCOPE"><span class="c003">WITH_SCOPE</span></a> exits, the new scope is discarded, all
new variables defined inside the scope and all changes to existing variables
are forgotten. </td></tr>
<tr><td class="c012"> or</td><td class="c014"><span class="c005">UNINSTALL</span><a id="UNINSTALL"></a><a id="hevea_default274"></a> modToUninstall modComponent</td><td class="c014"> If the given component of the given mod is currently installed,
uninstall it before proceeding. <em>Do not use this action without
	a real reason.</em> This
should only be used if you release a new version of a component under a
new name. For example, many Tactics Mod components replace old
Solaufein mod components. In order to prevent such a component from
being installed twice, the Tactics version uninstalls the Solaufein
version. </td></tr>
<tr><td class="c012"> or</td><td class="c014"><span class="c005">COPY_KIT</span><a id="COPY_KIT"></a><a id="hevea_default275"></a> oldKit newKit <code>(</code> diffName diffValue <span class="c002"> list </span><code>)</code></td><td class="c014"> Copies a copy of the oldKit kit called newKit. This copy is non-player
selectable, while all other fields can be edited by setting diffName to
the field to be changed and diffValue to the new value. Valid values for
diffName are:
<pre class="verbatim">clasweap
weapprof
abclasrq
abclsmod
abdcdsrq
abdcscrq
dualclas
alignmnt
clab
lower
mixed
help
luabbr
25stweap
unusabilities
</pre>
Currently, lower, mixed and help can only be numbers referring to a TLK
string. Unusabilities requires to be both kit and class unusables, there
isn’t a way to <a href="#BAND"><span class="c003">BAND</span></a> or <a href="#BOR"><span class="c003">BOR</span></a> them.
</td></tr>
<tr><td class="c012"> or</td><td class="c014"><span class="c005">ADD_KIT</span><a id="ADD_KIT"></a><a id="hevea_default276"></a> internalKitName <a href="#String"><span class="c003">String</span></a><span class="c003">1</span>
<a href="#String"><span class="c003">String</span></a><span class="c003">2</span> <a href="#String"><span class="c003">String</span></a><span class="c003">3</span> <a href="#String"><span class="c003">String</span></a><span class="c003">4</span>
<a href="#String"><span class="c003">String</span></a><span class="c003">6</span> <a href="#String"><span class="c003">String</span></a><span class="c003">7</span> <a href="#String"><span class="c003">String</span></a><span class="c003">8</span>
<a href="#String"><span class="c003">String</span></a><span class="c003">9</span> <a href="#String"><span class="c003">String</span></a><span class="c003">10</span> <a href="#String"><span class="c003">String</span></a><span class="c003">11</span>
<a href="#String"><span class="c003">String</span></a><span class="c003">12</span> <a href="#String"><span class="c003">String</span></a><span class="c003">13</span> <span class="c003">SAY</span> <a href="#text"><span class="c003">text</span></a><span class="c003">1</span>
<span class="c003">SAY</span> <a href="#text"><span class="c003">text</span></a><span class="c003">2</span> <span class="c003">SAY</span> <a href="#text"><span class="c003">text</span></a><span class="c003">3</span></td><td class="c014"> This command allows you to add new kits to the BGII.
See the example file <span class="c003">mymod.tp2</span> or the tutorial at
<a href="http://gibberlings3.net/forums/index.php?showtopic=584"><span class="c003">http://gibberlings3.net/forums/index.php?showtopic=584</span></a>
for information on how to do this.<p><a href="#ADD_KIT"><span class="c003">ADD_KIT</span></a> sets the variable <span class="c003">%internalKitName%</span> to the
number your kit occupies in <span class="c003">kitlist.2da</span>. This value is exactly
0x4000 less than the number your kit is assigned in
<span class="c003">kit.ids</span>. Also observe that the kit DWORD in the <span class="c003">CRE</span> file
format uses a reversed WORD order, unlike all other fields in the
<span class="c003">CRE</span> file format.</p><p>Most arguments to <a href="#ADD_KIT"><span class="c003">ADD_KIT</span></a> are strings to be appended verbatim to
<span class="c003">2DA</span> files, detailed as follows:
</p><table class="c001 cellpading0"><tr><td class="c010"> <span class="c007">Argument</span></td><td class="c010"><span class="c007"><span class="c003">2DA</span> file</span></td><td class="c010"><span class="c007">Verbatim</span> </td></tr>
<tr><td class="c010"> <span class="c003">String1</span></td><td class="c010"><span class="c003">clasweap</span></td><td class="c010">Yes </td></tr>
<tr><td class="c010"> <span class="c003">String2</span></td><td class="c010"><span class="c003">weapprof</span></td><td class="c010">Yes </td></tr>
<tr><td class="c010"> <span class="c003">String3</span></td><td class="c010"><span class="c003">abclasrq</span></td><td class="c010">Yes </td></tr>
<tr><td class="c010"> <span class="c003">String4</span></td><td class="c010"><span class="c003">abclsmod</span></td><td class="c010">Yes </td></tr>
<tr><td class="c010"> <span class="c003">String5</span></td><td class="c010"><span class="c003">abdcdsrq</span></td><td class="c010">Yes </td></tr>
<tr><td class="c010"> <span class="c003">String6</span></td><td class="c010"><span class="c003">abdcscrq</span></td><td class="c010">Yes </td></tr>
<tr><td class="c010"> <span class="c003">String7</span></td><td class="c010"><span class="c003">alignmnt</span></td><td class="c010">Yes </td></tr>
<tr><td class="c010"> <span class="c003">String8</span></td><td class="c010"><span class="c003">dualclas</span></td><td class="c010">Yes </td></tr>
<tr><td class="c010"> <span class="c003">String12</span></td><td class="c010"><span class="c003">luabbr</span></td><td class="c010">No </td></tr>
<tr><td class="c010"> <span class="c003">String13</span></td><td class="c010"><span class="c003">25stweap</span></td><td class="c010">No </td></tr>
</table><p>
Strings that are appended verbatim need to include the kit name at
the very start of the string. Strings that are not appended verbatim
should not include the kit name, as it is added automatically.</p><p><span class="c003">String9</span> is the path to the CLAB-style <span class="c003">2DA</span> file of your kit.</p><p><span class="c003">String10</span> is a list of which class and race combinations the kit
should be available for, as per <span class="c003">kittable.2da</span>.</p><p><span class="c003">String11</span> is the unusability information and parent class used in
<span class="c003">kitlist.2da</span>.</p><p>Note that if <span class="c003">String12</span> denotes a custom HLA table, you need to copy
the new <span class="c003">2DA</span> file into the game manually. <a href="#ADD_KIT"><span class="c003">ADD_KIT</span></a> merely
appends to <span class="c003">luabbr.2da</span>.</p><p><span class="c003">text1</span>, <span class="c003">text2</span> and <span class="c003">text3</span> are, respectively, the lower name,
mixed name and description of your kit.</p><p>The BG2: ToB engine cannot handle more than 255 kits installed (if you
try to check <code>Kit(Somebody,kit256)</code> or <code>AddKit(kit256)</code>, the
game crashes to desktop). As such, WeiDU will currently refuse to
install a 256th kit. This limitation is lifted on GemRB, or if suitable
versions of ToB Hacks or ToBEx are installed,
</p></td></tr>
<tr><td class="c012"> or</td><td class="c014"><span class="c005">ADD_MUSIC</span><a id="ADD_MUSIC"></a><a id="hevea_default277"></a> internalMusicName newMUSFile</td><td class="c014">
<span class="c003">newMUSFile</span> is copied to the <span class="c003">music</span> directory and added to
<span class="c003">songlist.2da</span> under the name <span class="c003">internalMusicName</span>. The
variable <span class="c003">%internalMusicName%</span> is set to the number of this
new entry in <span class="c003">songlist.2da</span>. If <span class="c003">newMUSFile</span> already exists,
the variable <span class="c003">%internalMusicName%</span> is set to the existing
entry in <span class="c003">songlist.2da</span> and all other operations are
skipped. Variables are evaluated.<p>Some versions of the Infinity Engine cannot handle more than 100
entries in <span class="c003">songlist.2da</span>. <span class="c003">ADD_MUSIC</span> will fail under
those circumstances unless the appropriate versions of ToB Hacks
or ToBEx are installed or the game is GemRB or BGEE.
</p></td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">ADD_SCHOOL</span><a id="ADD_SCHOOL"></a><a id="hevea_default278"></a> schoolName removalString</td><td class="c014">	Creates a new (guaranteed-unique) spell school (as per mschool.2da),
	associate removalString (can be a tra reference) to its removal,
	and sets the schoolName variable to the school identifier.<p>	If mschool.2da already contains schoolName, the variable is set to
	the school’s current identifier and no other operation is performed.
	</p></td></tr>
<tr><td class="c012"> or</td><td class="c014"><span class="c005">ADD_SECTYPE</span><a id="ADD_SECTYPE"></a><a id="hevea_default279"></a> sectypeName removalString</td><td class="c014">	Creates a new (guaranteed-unique) spell secondary type
	(as per msectype.2da), associate removalString (can be a tra reference)
	to its removal, and sets the sectypeName variable to the sectype
	identifier.<p>	If msectype.2da already contains sectypeName, the variable is set to
	the sectype’s current identifier and no other operation is performed.
	</p></td></tr>
<tr><td class="c012"> or</td><td class="c014"><span class="c005">ADD_AREA_TYPE</span><a id="ADD_AREA_TYPE"></a><a id="hevea_default280"></a> areaTypeName</td><td class="c014">	Adds a new (guaranteed-unique) area type to areatype.ids, and sets
the areaTypeName variable to the index of the bit the type is associated
with: the type can be set with
<code>WRITE_SHORT 0x48 THIS | (1 &lt;&lt; areaTypeName)</code>.<p>	If areatype.ids already contains areaTypeName, the variable is set to
	the type’s current identifier and no other operation is performed.</p><p>Also note that only 8 area types can be added to an unmodded installation
of BG2; as such, don’t add a new area type type unless you really need it
(most likely, another modder is already using a type with a similar name,
and you can share the type between your mods without issue).
	</p></td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">ADD_PROJECTILE</span><a id="ADD_PROJECTILE"></a><a id="hevea_default281"></a> modpath/PROName.PRO</td><td class="c014"> Appends an entry for PROName to <span class="c003">PROJECTL.IDS</span> and assigns it the next
available ProRef number. Then copies the file <span class="c003">modpath/PROName.PRO</span>
to the <span class="c003">override</span> folder. The new ProRef number can be accessed
through the variable <span class="c003">%PROName%</span> and used to updated the
<span class="c003">Projectile type</span> field of an ITM or SPL file’s <span class="c003">Item Ability</span> or
<span class="c003">Spell Ability</span> sub-structures. (The hexadecimal offsets for these
fields can be found using NearInfinity.) In the following example, a
new PRO file and an ITM file that will use it are added to the game:
<pre class="verbatim">ADD_PROJECTILE      ~MyMod/MYDXP.PRO~
COPY ~MyMod/MYDART.ITM~ ~override/MYDART.ITM~
  WRITE_SHORT   0x09c ~%MYDXP%~
</pre>
</td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">ADD_SPELL</span><a id="ADD_SPELL"></a><a id="hevea_default282"></a> modpath/newSPLfile.SPL type level idsName
<a href="#patch"><span class="c003">patch</span></a> <span class="c002"> list  [ </span><span class="c003">IF_EXISTING</span> <a href="#patch"><span class="c003">patch</span></a> <span class="c002"> list </span><span class="c003">END</span> <span class="c002"> ]  [ </span><span class="c003">ON_DISABLE</span> <a href="#patch"><span class="c003">patch</span></a> <span class="c002"> list </span><span class="c003">END</span> <span class="c002"> ] </span></td><td class="c014">
adds newSPLfile as a spell of type and level into the game (IE, SPPR102
or whatnot), in the first empty slot possible, appends the idsName
to spell.ids, and sets <code>%idsName%</code> to the 4-digit code
associated with idsName in Spell.ids. While you copy newSPLfile to
the override, you also apply the patches listed.<p>	If Spell.ids already contains a spell named idsName, of the same type and
	level than the one you’re adding, then that spell is overwritten (rather
	than adding a duplicate version). If you have the <code>IF_EXISTING</code>
	section, its patches are applied to the current version instead.</p><p>	If Spell.ids already contains a spell named idsName, but of of different
	type and/or level than the one you’re adding, then the current reference
	is removed from spell.ids, and then the action proceeds as usual. In this
	case, if there is the <code>ON_DISABLE</code> section, the patches declared
	there will be applied to the older spell.
	</p></td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">ADD_JOURNAL</span><a id="ADD_JOURNAL"></a><a id="hevea_default283"></a> <span class="c002"> [ </span><span class="c003">EXISTING</span> <span class="c002"> ]  [ </span><span class="c003">MANAGED</span> <span class="c002"> ]  [ </span><span class="c003">TITLE</span> <span class="c003">(</span> <a href="#text"><span class="c003">text</span></a> <span class="c003">)</span> <span class="c002"> ] </span><a href="#reference"><span class="c003">reference</span></a> <span class="c002"> list  [ </span><span class="c003">USING</span> traFile <span class="c002"> list  ] </span></td><td class="c014">
If the game is not of an EE-type, this action does nothing. If
the game is of an EE-type, this action patches BGEE.SQL or
BGEE.LUA (depending on game version) with the provided quests and
journal entries, so they will work with the EE-type journal
system.<p>For each of the provided <a href="#reference"><span class="c003">reference</span></a>s, which are taken to be
journal entries, the first line of text, up to a newline character, is
taken to be the title of the journal entry. Titles isolated in this way
have any trailing whitespace and full stops trimmed. The title is added
as a separate string to the TLK, together with the complete journal entry.
The game files patched with the strrefs of the title and journal entry.
Each unique title is given a unique quest id and journal entries that
share titles end up sharing quest ids.</p><p>If <span class="c003">EXISTING</span> is specified, the strref of the title is matched
against the existing title strrefs. If a match is found, the
journal entry is added under the quest id of the existing
quest. Otherwise it is added as a new quest. Note that <span class="c003">TITLE</span>
should be given a string reference in this case. <span class="c003">ADD_JOURNAL</span>
cannot guarantee correct results if <span class="c003">EXISTING</span> is used without
<span class="c003">TITLE</span> or if <span class="c003">TITLE</span> is given a string or tra reference
instead of a string reference.</p><p>If <span class="c003">MANAGED</span> is specified, all provided journal entries are given a
unique, non-zero quest-group number. They share the same quest-group
number regardless of whether they share the same title. If <span class="c003">EXISTING</span>
is also specified, the quest-group numbers for all existing journal
entries that match the provided titles are assigned a quest-group
number, provided they do not already have one. This option does nothing
unless the game version supports quest groups.</p><p>If <span class="c003">TITLE</span> is specified, the provided <a href="#text"><span class="c003">text</span></a> is used as the title
for all provided journal entries. The titles of each individual journal
entry remains unchanged, they are just all listed under the same title.</p><p>For more information on <span class="c003">ADD_JOURNAL</span> and some usage examples, refer to
the journal section of <a href="http://gibberlings3.net/forums/index.php?showtopic=26671">this tutorial</a>.
</p></td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">STRING_SET</span><a id="STRING_SET"></a><a id="hevea_default284"></a> indexOrString newValue <span class="c002"> list  [ </span><span class="c003">USING</span> traFile <span class="c002"> ] </span></td><td class="c014"> This command replaces each given string in the user’s <a href="#TLK"><span class="c003">TLK</span></a> file
with the associated newValue. If a
traFile is given, that file is is read once before all of the
replacements take place and its contents are forgotten after. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">STRING_SET_EVALUATE</span><a id="STRING_SET_EVALUATE"></a><a id="hevea_default285"></a> <a href="#value"><span class="c003">value</span></a> newValue <span class="c002"> list  [ </span><span class="c003">USING</span> traFile <span class="c002"> ] </span></td><td class="c014"> This command replaces the string at index value in the user’s
<a href="#TLK"><span class="c003">TLK</span></a> file with the associated newValue. If a traFile is
given, that file is is read once before all of the replacements
take place and its contents are forgotten after. If the index
value equals the current number of strings in the <a href="#TLK"><span class="c003">TLK</span></a> file
(for example, through <a href="#NEXT_STRREF"><span class="c003">NEXT_STRREF</span></a>), newValue will be added
to the <a href="#TLK"><span class="c003">TLK</span></a> file as a new string. This addition is made with
no deduplication. Use with caution, as this will continue to grow
the <a href="#TLK"><span class="c003">TLK</span></a> file each time the mod is reinstalled.
</td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">STRING_SET_RANGE</span><a id="STRING_SET_RANGE"></a><a id="hevea_default286"></a> <span class="c003">#</span>min <span class="c003">#</span>max <span class="c003">USING</span> traFile</td><td class="c014"> For every integer i between min and max (inclusive) we do
<span class="c003">STRING_SET i @i USING traFile</span> (except that this command should be
executed more rapidly). The command will fail if <span class="c003">@</span>i is not defined
(either by traFile or by some other tra file in scope) for some i
between min and max. </td></tr>
<tr><td class="c012">
	or</td><td class="c014"><span class="c005">ALTER_TLK_RANGE</span><a id="ALTER_TLK_RANGE"></a><a id="hevea_default287"></a> <a href="#value"><span class="c003">value</span></a> <a href="#value"><span class="c003">value</span></a> <span class="c003">BEGIN</span> <a href="#patch"><span class="c003">patch</span></a> <span class="c002"> list </span><span class="c003">END</span></td><td class="c014">		Executes the given patch list on all the strings *currently* in dialog.tlk between the
		two given values (both inclusive).
		This means that strings added in the current mod installation will not
		be patched, and strings already altered via <a href="#ALTER_TLK"><span class="c003">ALTER_TLK</span></a>* and/or <a href="#STRING_SET"><span class="c003">STRING_SET</span></a>*
		will be patched from the pre-patch condition.</td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">ALTER_TLK_LIST</span><a id="ALTER_TLK_LIST"></a><a id="hevea_default288"></a> <span class="c003">BEGIN</span> <a href="#value"><span class="c003">value</span></a> <span class="c002"> list </span><span class="c003">END</span> <span class="c003">BEGIN</span> <a href="#patch"><span class="c003">patch</span></a> <span class="c002"> list </span><span class="c003">END</span></td><td class="c014">		Executes the given patch list on all the strings *currently* in dialog.tlk from the given list.
		This means that strings added in the current mod installation will not
		be patched, and strings already altered via <a href="#ALTER_TLK"><span class="c003">ALTER_TLK</span></a>* and/or <a href="#STRING_SET"><span class="c003">STRING_SET</span></a>*
		will be patched from the pre-patch condition. </td></tr>
<tr><td class="c012">
	or</td><td class="c014"><span class="c005">ALTER_TLK</span><a id="ALTER_TLK"></a><a id="hevea_default289"></a> <span class="c003">BEGIN</span> <a href="#patch"><span class="c003">patch</span></a> <span class="c002"> list </span><span class="c003">END</span></td><td class="c014">		Executes the given patch list on all the strings *currently* in dialog.tlk.
		This means that strings added in the current mod installation will not
		be patched, and strings already altered via <a href="#ALTER_TLK"><span class="c003">ALTER_TLK</span></a>* and/or <a href="#STRING_SET"><span class="c003">STRING_SET</span></a>*
		will be patched from the pre-patch condition. Consider using
		<a href="#ALTER_TLK_RANGE"><span class="c003">ALTER_TLK_RANGE</span></a> with the base game’s boundaries instead. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">REQUIRE_FILE</span><a id="REQUIRE_FILE"></a><a id="hevea_default290"></a> filename warningString</td><td class="c014"> If filename does not exist (or the bif file is not referenced inside
the chitin.key), warningString is displayed and this
<a href="#component"><span class="c003">component</span></a> cannot be installed. This is checked before any
actions are executed. </td></tr>
<tr><td class="c012"> or</td><td class="c014"><span class="c005">FORBID_FILE</span><a id="FORBID_FILE"></a><a id="hevea_default291"></a> filename warningString</td><td class="c014"> If filename does exist (or the bif file is referenced inside
the chitin.key), warningString is displayed and this
<a href="#component"><span class="c003">component</span></a> cannot be installed. This is checked before any
actions are executed. </td></tr>
<tr><td class="c012"> or</td><td class="c014"><span class="c005">FAIL</span><a id="FAIL"></a><a id="hevea_default292"></a> warningString</td><td class="c014"> If this <a href="#TP2%20Action"><span class="c003">TP2 Action</span></a> is executed, warningString is displayed and
the <a href="#component"><span class="c003">component</span></a> fails to install. </td></tr>
<tr><td class="c012"> or</td><td class="c014"><span class="c005">ABORT</span><a id="ABORT"></a><a id="hevea_default293"></a> string</td><td class="c014"> The string is displayed and installation of the component is undone.
No error is implied. </td></tr>
<tr><td class="c012"> or</td><td class="c014"><span class="c005">WARN</span><a id="WARN"></a><a id="hevea_default294"></a> displayString</td><td class="c014"> The string DisplayString is echoed to the user. Useful for debugging or
status reports. If displayString contains <span class="c003">%</span><a href="#variable"><span class="c003">variable</span></a><span class="c003">%</span>
references, their values will be displayed. Additionally, INSTALLED WITH
WARNINGS is printed at the end of the install.
</td></tr>
<tr><td class="c012"> or</td><td class="c014"><span class="c005">PRINT</span><a id="PRINT"></a><a id="hevea_default295"></a> displayString</td><td class="c014"> The string DisplayString is echoed to the user. Useful for debugging or
status reports. If displayString contains <span class="c003">%</span><a href="#variable"><span class="c003">variable</span></a><span class="c003">%</span>
references, their values will be displayed. </td></tr>
<tr><td class="c012"> or</td><td class="c014"><span class="c005">LOG</span><a id="LOG"></a><a id="hevea_default296"></a> displayString</td><td class="c014"> The string DisplayString is echoed to setup-mymod.debug.
If displayString contains <span class="c003">%</span><a href="#variable"><span class="c003">variable</span></a><span class="c003">%</span>
references, their values will be displayed. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">OUTER_TEXT_SPRINT</span><a id="OUTER_TEXT_SPRINT"></a><a id="hevea_default297"></a> <a href="#variable"><span class="c003">variable</span></a> stringWithVars</td><td class="c014"> Any WeiDU variables (enclosed in <span class="c003">%</span>s) inside stringWithVars are
replaced by their values and the resulting string (constructed at
mod-installation time!) is assigned to the variable <span class="c003">variable</span>. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">OUTER_SPRINT</span><a id="OUTER_SPRINT"></a><a id="hevea_default298"></a> <a href="#variable"><span class="c003">variable</span></a> stringWithVars</td><td class="c014"> Like <a href="#OUTER_TEXT_SPRINT"><span class="c003">OUTER_TEXT_SPRINT</span></a>, but stringWithVars can be an @reference, and will
break --traify. Use <a href="#OUTER_TEXT_SPRINT"><span class="c003">OUTER_TEXT_SPRINT</span></a> instead. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">OUTER_SNPRINT</span><a id="OUTER_SNPRINT"></a><a id="hevea_default299"></a> <a href="#value"><span class="c003">value</span></a> <a href="#variable"><span class="c003">variable</span></a> stringWithVars</td><td class="c014"> If <a href="#value"><span class="c003">value</span></a> evaluates to zero or a positive number, N, the first
N characters of the evaluated contents of stringWithVars are
assigned to <a href="#variable"><span class="c003">variable</span></a>. If <a href="#value"><span class="c003">value</span></a> evaluates to a
negative number, N, it’s instead the last N characters. Thus:
<pre class="verbatim">SPRINT author Jason
SNPRINT 3 myvar "1:%author%"
</pre>
... assigns <span class="c003">1:J</span> to <span class="c003">myvar</span>. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">OUTER_SET</span><a id="OUTER_SET"></a><a id="hevea_default300"></a> <a href="#variable"><span class="c003">variable</span></a> <span class="c003">=</span> <a href="#value"><span class="c003">value</span></a></td><td class="c014"> Update <a href="#variable"><span class="c003">variable</span></a> so that it is equal to <a href="#value"><span class="c003">value</span></a>. </td></tr>
<tr><td class="c012">or</td><td class="c014"><a href="#OUTER_SET"><span class="c003">OUTER_SET</span></a> <a href="#variable"><span class="c003">variable</span></a> <span class="c003">+=</span> <a href="#value"><span class="c003">value</span></a></td><td class="c014"> Equivalent to <span class="c003">OUTER_SET variable = variable + value</span>. </td></tr>
<tr><td class="c012">or</td><td class="c014"><a href="#OUTER_SET"><span class="c003">OUTER_SET</span></a> <a href="#variable"><span class="c003">variable</span></a> <span class="c003">-=</span> <a href="#value"><span class="c003">value</span></a></td><td class="c014"> Equivalent to <span class="c003">OUTER_SET variable = variable - value</span>. </td></tr>
<tr><td class="c012">or</td><td class="c014"><a href="#OUTER_SET"><span class="c003">OUTER_SET</span></a> <a href="#variable"><span class="c003">variable</span></a> <span class="c003">*=</span> <a href="#value"><span class="c003">value</span></a></td><td class="c014"> Equivalent to <span class="c003">OUTER_SET variable = variable * value</span>. </td></tr>
<tr><td class="c012">or</td><td class="c014"><a href="#OUTER_SET"><span class="c003">OUTER_SET</span></a> <a href="#variable"><span class="c003">variable</span></a> <span class="c003">/=</span> <a href="#value"><span class="c003">value</span></a></td><td class="c014"> Equivalent to <span class="c003">OUTER_SET variable = variable / value</span>. </td></tr>
<tr><td class="c012">or</td><td class="c014"><a href="#OUTER_SET"><span class="c003">OUTER_SET</span></a> <a href="#variable"><span class="c003">variable</span></a> <span class="c003">&amp;=</span> <a href="#value"><span class="c003">value</span></a></td><td class="c014"> Equivalent to <span class="c003">OUTER_SET variable = variable BAND value</span>. </td></tr>
<tr><td class="c012">or</td><td class="c014"><a href="#OUTER_SET"><span class="c003">OUTER_SET</span></a> <a href="#variable"><span class="c003">variable</span></a> <span class="c003">|=</span> <a href="#value"><span class="c003">value</span></a></td><td class="c014"> Equivalent to <span class="c003">OUTER_SET variable = variable BOR value</span>. </td></tr>
<tr><td class="c012">or</td><td class="c014"><a href="#OUTER_SET"><span class="c003">OUTER_SET</span></a> <a href="#variable"><span class="c003">variable</span></a> <span class="c003">&lt;&lt;=</span> <a href="#value"><span class="c003">value</span></a></td><td class="c014"> Equivalent to <span class="c003">OUTER_SET variable = variable BLSL value</span>. </td></tr>
<tr><td class="c012">or</td><td class="c014"><a href="#OUTER_SET"><span class="c003">OUTER_SET</span></a> <a href="#variable"><span class="c003">variable</span></a> <span class="c003">&gt;&gt;=</span> <a href="#value"><span class="c003">value</span></a></td><td class="c014"> Equivalent to <span class="c003">OUTER_SET variable = variable BLSR value</span>. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">OUTER_INNER_PATCH</span><a id="OUTER_INNER_PATCH"></a><a id="hevea_default301"></a> buffString <span class="c003">BEGIN</span> <a href="#patch"><span class="c003">patch</span></a> <span class="c002"> list </span><span class="c003">END</span></td><td class="c014"> Any WeiDU variables inside <span class="c003">%</span>s within buffString are replaced by
their values. All of the <a href="#patch"><span class="c003">patch</span></a>es given are evaluated as if the
contents of the current file were buffString. Any modifications to
buffString are thrown away. This is considered an action, not a patch. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">OUTER_PATCH</span><a id="OUTER_PATCH"></a><a id="hevea_default302"></a> buffString <span class="c003">BEGIN</span> <a href="#patch"><span class="c003">patch</span></a> <span class="c002"> list </span><span class="c003">END</span></td><td class="c014"> Equal to <a href="#OUTER_INNER_PATCH"><span class="c003">OUTER_INNER_PATCH</span></a>, if you feel that OUTER_INNER sounds wrong. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">OUTER_INNER_PATCH_SAVE</span><a id="OUTER_INNER_PATCH_SAVE"></a><a id="hevea_default303"></a> savevar buffString <span class="c003">BEGIN</span> <a href="#patch"><span class="c003">patch</span></a> <span class="c002"> list </span><span class="c003">END</span></td><td class="c014"> As with <a href="#OUTER_INNER_PATCH"><span class="c003">OUTER_INNER_PATCH</span></a>, except that any modifications to buffString are stored inside
savevar. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">OUTER_PATCH_SAVE</span><a id="OUTER_PATCH_SAVE"></a><a id="hevea_default304"></a> savevar buffString <span class="c003">BEGIN</span> <a href="#patch"><span class="c003">patch</span></a> <span class="c002"> list </span><span class="c003">END</span></td><td class="c014"> Equal to <a href="#OUTER_INNER_PATCH_SAVE"><span class="c003">OUTER_INNER_PATCH_SAVE</span></a>, if you feel that OUTER_INNER sounds wrong. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">OUTER_WHILE</span><a id="OUTER_WHILE"></a><a id="hevea_default305"></a> <a href="#value"><span class="c003">value</span></a> <span class="c003">BEGIN</span>
<a href="#TP2%20Action"><span class="c003">TP2 Action</span></a> <span class="c002"> list </span><span class="c003">END</span></td><td class="c014"> If <a href="#value"><span class="c003">value</span></a> is non-zero, execute the given <a href="#TP2%20Action"><span class="c003">TP2 Action</span></a> <span class="c002"> list </span>and
then repeat, re-evaluating the <a href="#value"><span class="c003">value</span></a>.
<em>Be very careful when using this command. </em> You can easily describe
an infinite loop. See the <a href="#sec-while"><span class="c003">WHILE</span></a> loop tutorial for more
information.
</td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">OUTER_FOR</span><a id="OUTER_FOR"></a><a id="hevea_default306"></a> <span class="c003">(</span> <a href="#patch"><span class="c003">patch</span></a> <span class="c002"> list </span><span class="c003">;</span>
<a href="#value"><span class="c003">value</span></a> <span class="c003">;</span>
<a href="#patch"><span class="c003">patch</span></a> <span class="c002"> list </span><span class="c003">)</span>
<span class="c003">BEGIN</span> <a href="#TP2%20Action"><span class="c003">TP2 Action</span></a> <span class="c002"> list </span><span class="c003">END</span></td><td class="c014"> The <a href="#TP2%20Action"><span class="c003">TP2 Action</span></a> <span class="c003">OUTER_FOR (init;pred;inc) BEGIN body END</span> is equivalent to
<span class="c003">init WHILE pred BEGIN INNER_ACTION BEGIN body END inc END</span>, except that
it’s considered an action. Note that the predicate <a href="#value"><span class="c003">value</span></a> cannot be empty. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">ACTION_BASH_FOR</span><a id="ACTION_BASH_FOR"></a><a id="hevea_default307"></a> <a href="#directory-file-regexp"><span class="c003">directory-file-regexp</span></a> <span class="c003">BEGIN</span> <a href="#TP2%20Action"><span class="c003">TP2 Action</span></a> <span class="c002"> list </span><span class="c003">END</span></td><td class="c014"> for all files that match <a href="#directory-file-regexp"><span class="c003">directory-file-regexp</span></a>, sets a bunch of variables
and executes the actions for each file found. Assuming the file being copied
is somedir/yourfile.cre, the following variables will be set:
<pre class="verbatim">"%BASH_FOR_DIRECTORY%" = "somedir"
"%BASH_FOR_FILESPEC%" = "somedir/yourfile.cre"
"%BASH_FOR_FILE%" = "yourfile.cre"
"%BASH_FOR_RES%" = "yourfile"
"%BASH_FOR_EXT%" = "cre"
"%BASH_FOR_SIZE%" = &lt;size of somedir/yourfile.cre&gt;
</pre> </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">ACTION_DEFINE_ARRAY</span><a id="ACTION_DEFINE_ARRAY"></a><a id="hevea_default308"></a> <a href="#String"><span class="c003">String</span></a><span class="c003">1 BEGIN </span><a href="#String"><span class="c003">String</span></a><span class="c003">2</span> <span class="c002"> list </span><span class="c003">END</span></td><td class="c014">	Sets the array <code>$string1(0)</code>,<code>$string1(1)</code> etc. to the various elements in string2.
</td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">ACTION_SORT_ARRAY_INDICES</span><a id="ACTION_SORT_ARRAY_INDICES"></a><a id="hevea_default309"></a> <a href="#String"><span class="c003">String</span></a>
<span class="c002"> [ </span><a href="#ArrayIndicesSortType"><span class="c003">ArrayIndicesSortType</span></a> <span class="c002"> ] </span></td><td class="c014">
Sorts the indices of the array given by String according to the
order <a href="#ArrayIndicesSortType"><span class="c003">ArrayIndicesSortType</span></a>. String is evaluated for
variables and you can use the array construct.</td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">GET_FILE_ARRAY</span><a id="GET_FILE_ARRAY"></a><a id="hevea_default310"></a> <a href="#String"><span class="c003">String</span></a> path <a href="#regexp"><span class="c003">regexp</span></a></td><td class="c014"> The array <code>$string(0)</code>, <code>$string{1}</code> etc is set to the file names, including path, that match regexp in path. The path is relative to the installation directory (e.g. save/000000000-Auto-Save).</td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">GET_DIRECTORY_ARRAY</span><a id="GET_DIRECTORY_ARRAY"></a><a id="hevea_default311"></a> <a href="#String"><span class="c003">String</span></a> path <a href="#regexp"><span class="c003">regexp</span></a></td><td class="c014"> Like <a href="#GET_FILE_ARRAY"><span class="c003">GET_FILE_ARRAY</span></a> except regexp is matched against directories instead of files.</td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">ACTION_DEFINE_ASSOCIATIVE_ARRAY</span><a id="ACTION_DEFINE_ASSOCIATIVE_ARRAY"></a><a id="hevea_default312"></a> <a href="#String"><span class="c003">String</span></a><span class="c003"> BEGIN key1 <span class="c002"> [ </span>, key2 ... <span class="c002"> ] </span>=&gt; result1</span> <span class="c002"> list </span><span class="c003">END</span></td><td class="c014"> Sets the array <code>$string</code>, indexed by the keys, to the corresponding results. The results can either be <a href="#String"><span class="c003">String</span></a>s or <a href="#value"><span class="c003">value</span></a>s.
Example:
<pre class="verbatim">ACTION_DEFINE_ASSOCIATIVE_ARRAY mix_with_blue BEGIN
  red =&gt; purple
  yellow =&gt; green
END
</pre></td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">ACTION_FOR_EACH</span><a id="ACTION_FOR_EACH"></a><a id="hevea_default313"></a> <a href="#String"><span class="c003">String</span></a><span class="c003">1 IN </span><a href="#String"><span class="c003">String</span></a> <span class="c002"> list </span><span class="c003">BEGIN</span> <a href="#TP2%20Action"><span class="c003">TP2 Action</span></a> <span class="c002"> list </span><span class="c003">END</span></td><td class="c014"> will set the string1 variable to each value in string list and process each action. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">ACTION_PHP_EACH</span><a id="ACTION_PHP_EACH"></a><a id="hevea_default314"></a> <a href="#String"><span class="c003">String</span></a><span class="c003">1 AS </span><a href="#String"><span class="c003">String</span></a><span class="c003">2 =&gt; </span><a href="#String"><span class="c003">String</span></a><span class="c003">3</span> <span class="c002"> list </span><span class="c003">BEGIN</span> <a href="#TP2%20Action"><span class="c003">TP2 Action</span></a> <span class="c002"> list </span><span class="c003">END</span></td><td class="c014"> For every value of the string1 array that has been created or read, sets
<code>string2_0</code> to the first array parameter, <code>string2_1</code> to the second array
parameter, etc. and string3 to the result of the array. <code>string2</code> will also contain
		the first array parameter (as a synonym of <code>string2_0</code>). then executes the
actions listed. More exhaustive documentation will be provided by SConrad.
</td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">INCLUDE</span><a id="INCLUDE"></a><a id="hevea_default315"></a> <a href="#String"><span class="c003">String</span></a> <span class="c002"> list </span></td><td class="c014"> loads the file string as if it were a list of tp2 actions and executes it (as if
		it had been typed inside your tp2).
These files have by convenience tph as an extension, due to no reason other than
randomness (you can use .tp1 or .xyzsucks if you’re so oriented).
		Please note that, to speed up inclusions, tph files are stored in memory,
	 rather than re-read each time from the hard-disk. If you need automorphing code
		(IE, you want to edit your tph file), you can use <a href="#REINCLUDE"><span class="c003">REINCLUDE</span></a> instead. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">ACTION_INCLUDE</span><a id="ACTION_INCLUDE"></a><a id="hevea_default316"></a> <a href="#String"><span class="c003">String</span></a> <span class="c002"> list </span></td><td class="c014"> A synonym of <a href="#INCLUDE"><span class="c003">INCLUDE</span></a>.
</td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">REINCLUDE</span><a id="REINCLUDE"></a><a id="hevea_default317"></a> <a href="#String"><span class="c003">String</span></a> <span class="c002"> list </span></td><td class="c014"> Works like <a href="#INCLUDE"><span class="c003">INCLUDE</span></a>, but loads each time the tph file from the hard disk.
This is slower, but required if you want to edit your tph file between an
inclusion and another.
</td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">ACTION_REINCLUDE</span><a id="ACTION_REINCLUDE"></a><a id="hevea_default318"></a> <a href="#String"><span class="c003">String</span></a> <span class="c002"> list </span></td><td class="c014"> A synonym of <a href="#REINCLUDE"><span class="c003">REINCLUDE</span></a>.
</td></tr>
<tr><td class="c012"> or</td><td class="c014"><span class="c003">&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span> fileName fileBody <span class="c003">&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span></td><td class="c014"> (That’s eight (8) angle brackets on each side.)
For the purposes of copying and compiling files, WeiDU will pretend
that fileName is a real file with contents fileBody. This allows you to
define <span class="c005">inlined</span><a id="inlined"></a><a id="hevea_default319"></a><a id="inlined"></a> files inside your TP2 file. Such definitions
must be executed before the <a href="#inlined"><span class="c003">inlined</span></a> file is used. Other operations
on fileName (such as <a href="#FILE_EXISTS"><span class="c003">FILE_EXISTS</span></a>, <a href="#FILE_MD5"><span class="c003">FILE_MD5</span></a> or
<a href="#FILE_SIZE"><span class="c003">FILE_SIZE</span></a>) are undefined. Inlined files will be skipped by
<a href="#COPY_EXISTING_REGEXP"><span class="c003">COPY_EXISTING_REGEXP</span></a> and other “wildcard” approaches: you
must name them directly. Unlike most other WeiDU things,
spacing matters here. After the initial <span class="c003">&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span> there can be
any number of spaces. The first non-space character after the
<span class="c003">&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span> is the first character of fileName. All other
characters up to and excluding the newline on that line are part of
fileName (and thus fileName cannot start with a space or contain a
newline). All user variables (e.g., <span class="c003">%foo%</span>) in fileName will be
replaced by their values.
The fileBody contains all characters after that newline up to
and excluding the <span class="c003">&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>. Note that a single inlined filename
namespace is shared by WeiDU for all <a href="#TP2"><span class="c003">TP2</span></a> files it reads (it
might read other <a href="#TP2"><span class="c003">TP2</span></a> files in the process of installing yours
in order to uninstall or reinstall another mod’s components), so it is
<em>critically</em> important that you use some sort of unique prefix.
I also suggest that you avoid using your mod’s actual directory
structure (if any) in order to avoid confusion with real files.
Consider using <span class="c003">.../yourmod-inlined/fileName</span>. Here is a concrete
working example:
<pre class="verbatim">BEGIN ~MyMod Component 1~

&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt; .../mymod-inlined/myfile.baf
IF
  True()
THEN
  RESPONSE #100
    Kill("Anomen")
END
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;

COMPILE ~.../mymod-inlined/myfile.baf~
</pre>
This inclusion method is eight-bit clean, so if you are very careful you
can <a href="#inlined">inline</a> a binary file (e.g., a <a href="#CRE"><span class="c003">CRE</span></a> or <a href="#BAM"><span class="c003">BAM</span></a>) with
this method. Be careful to shave off the newline before the <span class="c003">&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
in such cases. Finally, note that <a href="#inlined"><span class="c003">inlined</span></a> files have the same
maximum size as other (non-BIFF) WeiDU files and strings (usually about
16 megs).
</td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">ACTION_TO_UPPER</span><a id="ACTION_TO_UPPER"></a><a id="hevea_default320"></a> <a href="#variable"><span class="c003">variable</span></a></td><td class="c014"> Turns to upper-case the contents of <code>%variable%</code> and store the
results in variable. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">ACTION_TO_LOWER</span><a id="ACTION_TO_LOWER"></a><a id="hevea_default321"></a> <a href="#variable"><span class="c003">variable</span></a></td><td class="c014"> Turns to lower-case the contents of <code>%variable%</code> and store the
results in variable. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">ACTION_GET_STRREF</span><a id="ACTION_GET_STRREF"></a><a id="hevea_default322"></a> <a href="#value"><span class="c003">value</span></a> <a href="#variable"><span class="c003">variable</span></a></td><td class="c014">
The string reference value is looked up in <span class="c003">DIALOG.TLK</span> and the
(male) string (without any quotes) is stored in the variable. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">ACTION_GET_STRREF_F</span><a id="ACTION_GET_STRREF_F"></a><a id="hevea_default323"></a> <a href="#value"><span class="c003">value</span></a> <a href="#variable"><span class="c003">variable</span></a></td><td class="c014">
The string reference value is looked up in <span class="c003">DIALOGF.TLK</span> and the
female string (without any quotes) is stored in the variable. If
there is no <span class="c003">DIALOGF.TLK</span>, the string from <span class="c003">DIALOG.TLK</span> is used
instead. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">ACTION_GET_STRREF_S</span><a id="ACTION_GET_STRREF_S"></a><a id="hevea_default324"></a> <a href="#value"><span class="c003">value</span></a> <a href="#variable"><span class="c003">variable</span></a></td><td class="c014">
The string reference value is looked up in <span class="c003">DIALOG.TLK</span> and the
sound reference associated with the (male) string is stored in the
variable. If the string has no sound, the empty string
is used instead. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">ACTION_GET_STRREF_FS</span><a id="ACTION_GET_STRREF_FS"></a><a id="hevea_default325"></a> <a href="#value"><span class="c003">value</span></a> <a href="#variable"><span class="c003">variable</span></a></td><td class="c014">
The string reference value is looked up in <span class="c003">DIALOGF.TLK</span> and the
sound reference associated with the female string is stored in the
variable. If there is no <span class="c003">DIALOGF.TLK</span>, the sound reference
associated with the string from <span class="c003">DIALOG.TLK</span> is used instead. If the
string has no sound, the empty string is used instead. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">DECOMPRESS_BIFF</span><a id="DECOMPRESS_BIFF"></a><a id="hevea_default326"></a> file ...</td><td class="c014"> Decompresses one or more biff files from either <span class="c003">"BIF V1.0"</span> or <span class="c003">"BIFCV1.0"</span>
into <span class="c003">"BIFFV1 "</span>.
The biff file is looked for in /data and the CD paths specified in baldur.ini. You should
consequently <em>not</em> specify the biff path, merely the name. All matching biff files
are decompressed, even ones that are duplicated between CD paths. The biff file is backed up
to another file in the same directory before it is decompressed. Since multiple games
can share the same biffs, this action is not uninstalled together with the mod.<p>WeiDU will raise a Failure exception if the biff is not found in any of the paths.</p><p>Decompressing a biff file can be helpful in preventing crashes related to area files,
commonly <span class="c003">WAV</span> ambient sounds or <span class="c003">TIS</span> files. <em>Do not use this action without a real reason.</em> </p></td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">DEFINE_ACTION_MACRO</span><a id="DEFINE_ACTION_MACRO"></a><a id="hevea_default327"></a> <a href="#String"><span class="c003">String</span></a> <span class="c003">BEGIN</span>
<a href="#TP2%20Action"><span class="c003">TP2 Action</span></a> <span class="c002"> list </span><span class="c003">END</span></td><td class="c014"> Define an action macro. Refer to the <a href="#macros"><span class="c003">macros</span></a> section for
additional information. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">DEFINE_PATCH_MACRO</span><a id="DEFINE_PATCH_MACRO"></a><a id="hevea_default328"></a> <a href="#String"><span class="c003">String</span></a> <span class="c003">BEGIN</span>
<a href="#patch"><span class="c003">patch</span></a> <span class="c002"> list </span><span class="c003">END</span></td><td class="c014"> Define a patch macro. Refer to the <a href="#macros"><span class="c003">macros</span></a> section for
additional information. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">DEFINE_ACTION_FUNCTION</span><a id="DEFINE_ACTION_FUNCTION"></a><a id="hevea_default329"></a> <a href="#String"><span class="c003">String</span></a>
<span class="c002"> [ </span><span class="c003">INT_VAR</span> <a href="#variable"><span class="c003">variable</span></a> <span class="c003">=</span> <a href="#value"><span class="c003">value</span></a> ... <span class="c002"> ]  [ </span><span class="c003">STR_VAR</span> <a href="#variable"><span class="c003">variable</span></a> <span class="c003">=</span> <a href="#String"><span class="c003">String</span></a> ... <span class="c002"> ]  [ </span><span class="c003">RET</span> <a href="#variable"><span class="c003">variable</span></a> ... <span class="c002"> ]  [ </span><span class="c003">RET_ARRAY</span> <a href="#variable"><span class="c003">variable</span></a> ... <span class="c002"> ] </span><span class="c003">BEGIN</span> <a href="#TP2%20Action"><span class="c003">TP2 Action</span></a> <span class="c002"> list </span><span class="c003">END</span></td><td class="c014"> Define an action function. Refer to the <a href="#sec-functions"><span class="c003">Functions</span></a> section for
additional information. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">DEFINE_DIMORPHIC_FUNCTION</span><a id="DEFINE_DIMORPHIC_FUNCTION"></a><a id="hevea_default330"></a> <a href="#String"><span class="c003">String</span></a>
<span class="c002"> [ </span><span class="c003">INT_VAR</span> <a href="#variable"><span class="c003">variable</span></a> <span class="c003">=</span> <a href="#value"><span class="c003">value</span></a> ... <span class="c002"> ]  [ </span><span class="c003">STR_VAR</span> <a href="#variable"><span class="c003">variable</span></a> <span class="c003">=</span> <a href="#String"><span class="c003">String</span></a> ... <span class="c002"> ]  [ </span><span class="c003">RET</span> <a href="#variable"><span class="c003">variable</span></a> ... <span class="c002"> ]  [ </span><span class="c003">RET_ARRAY</span> <a href="#variable"><span class="c003">variable</span></a> ... <span class="c002"> ] </span><span class="c003">BEGIN</span> <a href="#TP2%20Action"><span class="c003">TP2 Action</span></a> <span class="c002"> list </span><span class="c003">END</span></td><td class="c014">
As <a href="#DEFINE_ACTION_FUNCTION"><span class="c003">DEFINE_ACTION_FUNCTION</span></a>, except the function is additionally
defined as a PATCH function. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">DEFINE_PATCH_FUNCTION</span><a id="DEFINE_PATCH_FUNCTION"></a><a id="hevea_default331"></a> <a href="#String"><span class="c003">String</span></a>
<span class="c002"> [ </span><span class="c003">INT_VAR</span> <a href="#variable"><span class="c003">variable</span></a> <span class="c003">=</span> <a href="#value"><span class="c003">value</span></a> ... <span class="c002"> ]  [ </span><span class="c003">STR_VAR</span> <a href="#variable"><span class="c003">variable</span></a> <span class="c003">=</span> <a href="#String"><span class="c003">String</span></a> ... <span class="c002"> ]  [ </span><span class="c003">RET</span> <a href="#variable"><span class="c003">variable</span></a> ... <span class="c002"> ]  [ </span><span class="c003">RET_ARRAY</span> <a href="#variable"><span class="c003">variable</span></a> ... <span class="c002"> ] </span><span class="c003">BEGIN</span> <a href="#patch"><span class="c003">patch</span></a> <span class="c002"> list </span><span class="c003">END</span></td><td class="c014"> Define a patch function. Refer to the <a href="#sec-functions"><span class="c003">Functions</span></a> section for
additional information. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">LAUNCH_ACTION_MACRO</span><a id="LAUNCH_ACTION_MACRO"></a><a id="hevea_default332"></a> <a href="#String"><span class="c003">String</span></a></td><td class="c014"> Launch an action macro. Refer to the <a href="#macros"><span class="c003">macros</span></a> section for
additional information. You may use <span class="c005">LAM</span><a id="LAM"></a><a id="hevea_default333"></a> as a synonym for
<a href="#LAUNCH_ACTION_MACRO"><span class="c003">LAUNCH_ACTION_MACRO</span></a>.</td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">LAUNCH_ACTION_FUNCTION</span><a id="LAUNCH_ACTION_FUNCTION"></a><a id="hevea_default334"></a> <a href="#String"><span class="c003">String</span></a>
<span class="c002"> [ </span><span class="c003">INT_VAR</span> <a href="#variable"><span class="c003">variable</span></a> <span class="c002"> [ </span><span class="c003">=</span> <a href="#value"><span class="c003">value</span></a> <span class="c002"> ] </span>... <span class="c002"> ]  [ </span><span class="c003">STR_VAR</span> <a href="#variable"><span class="c003">variable</span></a> <span class="c002"> [ </span><span class="c003">=</span> <span class="c002"> [ </span><a href="#EVALUATE_BUFFER"><span class="c003">EVALUATE_BUFFER</span></a>
<span class="c002"> ] </span><a href="#String"><span class="c003">String</span></a> <span class="c002"> ] </span>... <span class="c002"> ]  [ </span><span class="c003">RET</span> <a href="#variable"><span class="c003">variable</span></a> <span class="c002"> [ </span><span class="c003">=</span> <a href="#String"><span class="c003">String</span></a> <span class="c002"> ] </span>... <span class="c002"> ]  [ </span><span class="c003">RET_ARRAY</span> <a href="#variable"><span class="c003">variable</span></a> <span class="c002"> [ </span><span class="c003">=</span> <a href="#String"><span class="c003">String</span></a> <span class="c002"> ] </span>... <span class="c002"> ] </span><span class="c003">END</span></td><td class="c014"> Launch an action function. Refer to the <a href="#sec-functions"><span class="c003">Functions</span></a> section for
additional information. You may use <span class="c005">LAF</span><a id="LAF"></a><a id="hevea_default335"></a> as a synonym for
<a href="#LAUNCH_ACTION_FUNCTION"><span class="c003">LAUNCH_ACTION_FUNCTION</span></a>.</td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">ACTION_TIME</span><a id="ACTION_TIME"></a><a id="hevea_default336"></a> <a href="#String"><span class="c003">String</span></a> <span class="c003">BEGIN</span> <a href="#TP2%20Action"><span class="c003">TP2 Action</span></a>
<span class="c002"> list </span><span class="c003">END</span></td><td class="c014"> Measure the time taken to execute the <a href="#TP2%20Action"><span class="c003">TP2 Action</span></a>s and report
it under the label <a href="#String"><span class="c003">String</span></a> together with the other time
measurements at the end of the mod’s debug file.</td></tr>
<tr><td class="c012">&nbsp;</td></tr>
<tr><td class="c012">
<span class="c005">optNoBackup</span><a id="optNoBackup"></a><a id="hevea_default337"></a></td><td class="c014">&nbsp;</td><td class="c014"> A <a href="#COPY"><span class="c003">COPY</span></a>, <a href="#MOVE"><span class="c003">MOVE</span></a> or <a href="#DELETE"><span class="c003">DELETE</span></a> command normally makes a backup copy of its target (if one
exists) so that the mod can be uninstalled later by restoring the backup.
</td></tr>
<tr><td class="c012">
is</td><td class="c014">&nbsp;</td><td class="c014">If you don’t say anything here, WeiDU <em>will</em> make a backup
copy of the file and the <a href="#COPY"><span class="c003">COPY</span></a>, <a href="#MOVE"><span class="c003">MOVE</span></a> or <a href="#DELETE"><span class="c003">DELETE</span></a> will be undone if the mod
is uninstalled. </td></tr>
<tr><td class="c012"> or</td><td class="c014"><span class="c003">+</span></td><td class="c014">If you put a <span class="c003">+</span> here, WeiDU will <em>not</em> make a backup
copy of the file and the <a href="#COPY"><span class="c003">COPY</span></a>, <a href="#MOVE"><span class="c003">MOVE</span></a> or <a href="#DELETE"><span class="c003">DELETE</span></a> will <em>not</em> be
undone if the mod is uninstalled. <em>Do not use this feature without
			a real reason.</em> </td></tr>
<tr><td class="c012"> or</td><td class="c014"><span class="c003">-</span></td><td class="c014">If you put a <span class="c003">-</span> here, WeiDU will <em>not</em> copy the file,
but only store it as an inlined file (so you can patch a file and
then use it for <a href="#EXTEND_BOTTOM"><span class="c003">EXTEND_BOTTOM</span></a> or whatever).
This option is not available for <a href="#COPY_LARGE"><span class="c003">COPY_LARGE</span></a>, <a href="#MOVE"><span class="c003">MOVE</span></a> or <a href="#DELETE"><span class="c003">DELETE</span></a>. </td></tr>
<tr><td class="c012">&nbsp;</td></tr>
<tr><td class="c012">
<span class="c005">directory-file-regexp</span><a id="directory-file-regexp"></a><a id="hevea_default338"></a></td><td class="c014">&nbsp;</td><td class="c014">This is a directory path and a <a href="#regexp"><span class="c003">regexp</span></a> string.
It’s used by <a href="#MAKE_BIFF"><span class="c003">MAKE_BIFF</span></a>, <a href="#ACTION_BASH_FOR"><span class="c003">ACTION_BASH_FOR</span></a> and <a href="#PATCH_BASH_FOR"><span class="c003">PATCH_BASH_FOR</span></a>
for listing patterns to be matched. Please note that
the directory / filename distinction must be enforced. </td></tr>
<tr><td class="c012">is</td><td class="c014">directory <a href="#regexp"><span class="c003">regexp</span></a></td><td class="c014">get a list of all files in directory that match <a href="#regexp"><span class="c003">regexp</span></a>.
Case doesn’t matter. </td></tr>
<tr><td class="c012">or</td><td class="c014">directory <span class="c003">EVALUATE_REGEXP</span> <a href="#regexp"><span class="c003">regexp</span></a></td><td class="c014">get a list of all files in directory that match <a href="#regexp"><span class="c003">regexp</span></a>.
Case doesn’t matter. This is the same as the above item. </td></tr>
<tr><td class="c012">or</td><td class="c014">directory <span class="c003">EXACT_MATCH</span> name</td><td class="c014">get the file directory/name. Please note that
the directory / filename distinction must be enforced. </td></tr>
<tr><td class="c012">&nbsp;</td></tr>
<tr><td class="c012"><span class="c005">optGlob</span><a id="optGlob"></a><a id="hevea_default339"></a></td><td class="c014">&nbsp;</td><td class="c014"> A <a href="#COPY"><span class="c003">COPY</span></a> command may use <em>globbing</em> to expand filename
wildcards with respect to files <em>on the host filesystem</em>. Unlike
<a href="#COPY_EXISTING_REGEXP"><span class="c003">COPY_EXISTING_REGEXP</span></a>, glob wildcards do not range over game
resources. Instead, they range over physical files actually on the disk.
</td></tr>
<tr><td class="c012"> is</td><td class="c014"><span class="c005">GLOB</span><a id="GLOB"></a><a id="hevea_default340"></a></td><td class="c014">Use local filesystem globbing. Globbing is
generally architecture specific!<p>Here is a concrete example. Imagine that <span class="c003">CHITIN.KEY</span> contains
two files: C1.ITM and C2.ITM. The <span class="c003">override</span> contains C2.ITM and
C_MOD.ITM.
</p><pre class="verbatim">  COPY_EXISTING_REGEXP "C.*.ITM" "override"
    // catches C1.ITM, C2.ITM

  COPY_EXISTING_REGEXP GLOB "C.*.ITM" "override"
    // catches C1.ITM, C2.ITM, C_MOD.ITM

  COPY "override" "override"
    // catches C2.ITM, C_MOD.ITM
</pre><p>
To put it another way: if you do not specify <a href="#GLOB"><span class="c003">GLOB</span></a> with
<a href="#COPY_EXISTING"><span class="c003">COPY_EXISTING</span></a>, WeiDU pretends that the <span class="c003">override</span> directory
contains 0 files that are not in <span class="c003">CHITIN.KEY</span>. Finally, GLOB has no
effect on wildcards in the "destination" part of the <a href="#COPY"><span class="c003">COPY</span></a>:
</p><pre class="verbatim">  COPY GLOB "mymod/foo" "music/*"
    // this is illegal: DO NOT DO THIS
</pre></td></tr>
<tr><td class="c012"> or</td><td class="c014"><span class="c005">NOGLOB</span><a id="NOGLOB"></a><a id="hevea_default341"></a></td><td class="c014">Never use local file system globbing. </td></tr>
<tr><td class="c012"> or</td><td class="c014">&nbsp;</td><td class="c014">Use sane defaults: enable globbing with <a href="#COPY_EXISTING_REGEXP"><span class="c003">COPY_EXISTING_REGEXP</span></a>, disable
it with <a href="#COPY"><span class="c003">COPY</span></a>. </td></tr>
<tr><td class="c012">&nbsp;</td></tr>
<tr><td class="c012">
<span class="c005">optcase</span><a id="optcase"></a><a id="hevea_default342"></a></td><td class="c014">&nbsp;</td><td class="c014">Allows you to decide whether regexp matching is case-sensitive
or not. </td></tr>
<tr><td class="c012">is</td><td class="c014">&nbsp;</td><td class="c014">Uses the WeiDU default (which is undocumented and varies with the action).
Please specify case-sensitiveness manually. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">CASE_SENSITIVE</span><a id="CASE_SENSITIVE"></a><a id="hevea_default343"></a></td><td class="c014">matching is case-sensitive. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">CASE_INSENSITIVE</span><a id="CASE_INSENSITIVE"></a><a id="hevea_default344"></a></td><td class="c014">matching is case-insensitive. </td></tr>
<tr><td class="c012">&nbsp;</td></tr>
<tr><td class="c012">&nbsp;</td></tr>
<tr><td class="c012">
<span class="c005">optexact</span><a id="optexact"></a><a id="hevea_default345"></a></td><td class="c014">&nbsp;</td><td class="c014">Allows you to decide whether regexp matching is exact. </td></tr>
<tr><td class="c012">is</td><td class="c014">&nbsp;</td><td class="c014">Uses the WeiDU default (which is undocumented and varies with the action).
Please specify matching policy manually. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">EXACT_MATCH</span><a id="EXACT_MATCH"></a><a id="hevea_default346"></a></td><td class="c014">only the given string is searched for. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">EVALUATE_REGEXP</span><a id="EVALUATE_REGEXP"></a><a id="hevea_default347"></a></td><td class="c014">matching is evaluated following the usual regexp
conventions. </td></tr>
<tr><td class="c012">&nbsp;</td></tr>
<tr><td class="c012">&nbsp;</td></tr>
<tr><td class="c012">
<span class="c005">ArrayIndicesSortType</span><a id="ArrayIndicesSortType"></a><a id="hevea_default348"></a></td><td class="c014">&nbsp;</td><td class="c014">Allows you to select how the indices
in an array to be sorted are to be interpreted. </td></tr>
<tr><td class="c012">
is</td><td class="c014">&nbsp;</td><td class="c014">The default sort is lexicographic, see <a href="#LEXICOGRAPHICALLY"><span class="c003">LEXICOGRAPHICALLY</span></a>.</td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">LEXICOGRAPHICALLY</span><a id="LEXICOGRAPHICALLY"></a><a id="hevea_default349"></a></td><td class="c014">The sorting is in ascending
lexicographical order. This means each row of indices are interpreted
as a string and that, for example, 10 is sorted before 2.</td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">NUMERICALLY</span><a id="NUMERICALLY"></a><a id="hevea_default350"></a></td><td class="c014">The sorting is in ascending numerical
order. This requires that the first column of indices can be
interpreted as numbers; any strings will raise a warning and the sort
order will be undefined. </td></tr>
<tr><td class="c012">&nbsp;</td></tr>
<tr><td class="c012">
<span class="c005">patch</span><a id="patch"></a><a id="hevea_default351"></a><a id="TP2 Patch"></a></td><td class="c014">&nbsp;</td><td class="c014">A <a href="#patch"><span class="c003">patch</span></a> tells WeiDU how to modify a file. </td></tr>
<tr><td class="c012">is</td><td class="c014"><span class="c005">SAY</span><a id="hevea_default352"></a> <a href="#offset"><span class="c003">offset</span></a> <a href="#text"><span class="c003">text</span></a></td><td class="c014"> The string-ref associated with <a href="#text"><span class="c003">text</span></a> is written at
<a href="#offset"><span class="c003">offset</span></a>. This is commonly used to change the name or
description of a spell or item. </td></tr>
<tr><td class="c012"> or</td><td class="c014"><span class="c005">PATCH_FAIL</span><a id="PATCH_FAIL"></a><a id="hevea_default353"></a> warningString</td><td class="c014"> If this <a href="#TP2%20Action"><span class="c003">TP2 Action</span></a> is execution, warningString is displayed and
the <a href="#component"><span class="c003">component</span></a> fails to install. </td></tr>
<tr><td class="c012"> or</td><td class="c014"><span class="c005">PATCH_ABORT</span><a id="PATCH_ABORT"></a><a id="hevea_default354"></a> string</td><td class="c014"> The string is displayed and installation of the component is undone.
No error is implied. </td></tr>
<tr><td class="c012"> or</td><td class="c014"><span class="c005">PATCH_WARN</span><a id="PATCH_WARN"></a><a id="hevea_default355"></a> displayString</td><td class="c014"> The string DisplayString is echoed to the user. Useful for debugging or
status reports. If displayString contains <span class="c003">%</span><a href="#variable"><span class="c003">variable</span></a><span class="c003">%</span>
references, their values will be displayed. Additionally, INSTALLED WITH
WARNINGS is printed at the end of the install.
</td></tr>
<tr><td class="c012"> or</td><td class="c014"><span class="c005">PATCH_PRINT</span><a id="PATCH_PRINT"></a><a id="hevea_default356"></a> displayString</td><td class="c014"> The string DisplayString is echoed to the user. Useful for debugging or
status reports. If displayString contains <span class="c003">%</span><a href="#variable"><span class="c003">variable</span></a><span class="c003">%</span>
references, their values will be displayed. See also <a href="#PRINT"><span class="c003">PRINT</span></a>.
Example:
<pre class="verbatim">COPY_EXISTING_REGEXP ~.*\.CRE~ ~override~
  READ_BYTE 0x272 race
  READ_BYTE 0x273 class
  PATCH_IF class = 3 THEN BEGIN
    PATCH_PRINT
      ~%SOURCE_FILE% is a cleric with race = %race%.~
  END
</pre> </td></tr>
<tr><td class="c012"> or</td><td class="c014"><span class="c005">PATCH_LOG</span><a id="PATCH_LOG"></a><a id="hevea_default357"></a> displayString</td><td class="c014"> The string DisplayString is echoed to setup-mymod.debug.
If displayString contains <span class="c003">%</span><a href="#variable"><span class="c003">variable</span></a><span class="c003">%</span>
references, their values will be displayed. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">SAY_EVALUATED</span><a id="SAY_EVALUATED"></a><a id="hevea_default358"></a> <a href="#offset"><span class="c003">offset</span></a> stringWithVars</td><td class="c014"> Any WeiDU variables (enclosed in <span class="c003">%</span>s) inside stringWithVars are
replaced by their values and the resulting string (constructed at
mod-installation time!) is added to <span class="c003">DIALOG.TLK</span> and its string
reference it written to the <a href="#offset"><span class="c003">offset</span></a>. Example:
<pre class="verbatim">COPY_EXISTING_REGEXP ~RING.*.ITM~ ~override~
  READ_LONG 0x38 cost
  SAY_EVALUATED IDENTIFIED_DESC
    ~I Am %SOURCE_RES%, I Cost %cost%~
</pre> </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">TO_UPPER</span><a id="TO_UPPER"></a><a id="hevea_default359"></a> <a href="#variable"><span class="c003">variable</span></a></td><td class="c014"> Turns to upper-case the contents of <code>%variable%</code> and store the
results in variable. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">TO_LOWER</span><a id="TO_LOWER"></a><a id="hevea_default360"></a> <a href="#variable"><span class="c003">variable</span></a></td><td class="c014"> Turns to lower-case the contents of <code>%variable%</code> and store the
results in variable. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">TEXT_SPRINT</span><a id="TEXT_SPRINT"></a><a id="hevea_default361"></a> <a href="#variable"><span class="c003">variable</span></a> stringWithVars</td><td class="c014"> Any WeiDU variables (enclosed in <span class="c003">%</span>s) inside stringWithVars are
replaced by their values and the resulting string (constructed at
mod-installation time!) is assigned to the variable <span class="c003">variable</span>. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">SPRINT</span><a id="SPRINT"></a><a id="hevea_default362"></a> <a href="#variable"><span class="c003">variable</span></a> stringWithVars</td><td class="c014"> Like <a href="#TEXT_SPRINT"><span class="c003">TEXT_SPRINT</span></a>, but stringWithVars can be an @reference, and will
break --traify. Use <a href="#TEXT_SPRINT"><span class="c003">TEXT_SPRINT</span></a> instead. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">SNPRINT</span><a id="SNPRINT"></a><a id="hevea_default363"></a> <a href="#value"><span class="c003">value</span></a> <a href="#variable"><span class="c003">variable</span></a> stringWithVars</td><td class="c014"> If <a href="#value"><span class="c003">value</span></a> evaluates to zero or a positive number, N, the first
N characters of the evaluated contents of stringWithVars are
assigned to <a href="#variable"><span class="c003">variable</span></a>. If <a href="#value"><span class="c003">value</span></a> evaluates to a
negative number, N, it’s instead the last N characters. Thus:
<pre class="verbatim">SPRINT author Jason
SNPRINT 3 myvar "1:%author%"
</pre>
... assigns <span class="c003">1:J</span> to <span class="c003">myvar</span>. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">SPRINTF</span><a id="SPRINTF"></a><a id="hevea_default364"></a> <a href="#variable"><span class="c003">variable</span></a> stringWithVars
<span class="c003">(</span> <a href="#variable"><span class="c003">variable</span></a> or <a href="#value"><span class="c003">value</span></a> <span class="c002"> list </span><span class="c003">)</span></td><td class="c014">In stringWithVars, any instance of <span class="c003">%s</span>, <span class="c003">%d</span> and <span class="c003">%x</span> will consume
one variable of the list of variables and format the contents of the variable
as a string, decimal number or hexadecimal number, respectively. Any normal text
in stringWithVars is reproduced verbatim. Variables enclosed in <span class="c003">%</span> are not
evaluated. The result is stored in the variable given as the first argument.
<pre class="verbatim">SET ten = 10
SPRINTF foo "%s %d %x quux" ("bar" 10 ten)
</pre>
will set the variable <span class="c003">foo</span> to the string <code>~bar 10 0xa quux~</code> </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">SOURCE_BIFF</span><a id="SOURCE_BIFF"></a><a id="hevea_default365"></a> <a href="#variable"><span class="c003">variable</span></a> filename</td><td class="c014"> If filename is in a biff (whether it is also in the override or not), sets
variable to the name of the containing biff (the name is printed as E.G.
<code>data/items.bif</code>).
</td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">SPACES</span><a id="SPACES"></a><a id="hevea_default366"></a> <a href="#variable"><span class="c003">variable</span></a> stringWithVars</td><td class="c014"> <code>%variable%</code> will be inited to a string the same length as stringWithVars,
but made entirely of spaces. <code>SPACES var ~123~</code> will create <code>%var% = "   "</code>.
</td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">QUOTE</span><a id="QUOTE"></a><a id="hevea_default367"></a> <a href="#variable"><span class="c003">variable</span></a> stringWithVars</td><td class="c014"> <code>%variable%</code> will be inited to a string that will match exactly stringWithVars.
<code>QUOTE var ~some\thing^~</code> will create <code>%var% = "some\\thing\^"</code>.
</td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">REPLACE</span><a id="hevea_default368"></a> <a href="#optcase"><span class="c003">optcase</span></a> <a href="#optexact"><span class="c003">optexact</span></a> <a href="#regexp"><span class="c003">regexp</span></a> <a href="#text"><span class="c003">text</span></a></td><td class="c014"> All occurrences of <a href="#regexp"><span class="c003">regexp</span></a> in the file are replaced with the ASCII
printing of the string reference for <a href="#text"><span class="c003">text</span></a>. So if <a href="#regexp"><span class="c003">regexp</span></a>
is "FRED" and the <a href="#text"><span class="c003">text</span></a> ends up being strref #1234, "FRED" will
be replaced with "1234". This is usually used to replace string
references in <a href="#BCS"><span class="c003">BCS</span></a> files (where they are stored textually). Put a
command like <span class="c003">DisplayString(Myself,99999)</span> in your <a href="#BCS"><span class="c003">BCS</span></a> file
and use something like <span class="c003">REPLACE 99999 "Hello, World"</span>. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">REPLACE_TEXTUALLY</span><a id="REPLACE_TEXTUALLY"></a><a id="hevea_default369"></a> <a href="#optcase"><span class="c003">optcase</span></a> <a href="#optexact"><span class="c003">optexact</span></a>
<a href="#regexp"><span class="c003">regexp</span></a> string <span class="c002"> [ </span><span class="c003">(</span> <span class="c003">sizeValue</span> <span class="c003">)</span> <span class="c002"> ] </span></td><td class="c014"> All occurrences of the given <a href="#regexp"><span class="c003">regexp</span></a> in the file are replaced with
the given string.
<a href="#variable"><span class="c003">variable</span></a>
substitution (e.g., kit and music names) is performed on both the
string and the regexp.
If you use the sizeValue field, optexact is automatically set to true (IE
without regexp patterns). The regexp and the string are padded by zeros to
be long exactly sizeValue bytes. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">EVALUATE_BUFFER_SPECIAL</span><a id="EVALUATE_BUFFER_SPECIAL"></a><a id="hevea_default370"></a> string</td><td class="c014"> String must be one character long. Any WeiDU variables (like <span class="c003">XmyvarX</span>)
	inside the current file are replaced by their values, where X is to be intended
	as string. Example:
<pre class="verbatim">&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt; .../mymod-inlined/script.baf
IF
  See($myvar$)
THEN
  RESPONSE #100
    Kill(%myvar%)
END
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
EXTEND_TOP ~sola.bcs~ ~.../mymod-inlined/script.baf~
  SPRINT myvar = ~"Anomen"~
  EVALUATE_BUFFER_SPECIAL ~$~
</pre>
	<span class="c006">myvar</span> will be substituted with Anomen, but <span class="c003">%myvar%</span> will be not.<p>	<em>Do not use this without a real reason.</em>
</p></td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">EVALUATE_BUFFER</span><a id="EVALUATE_BUFFER"></a><a id="hevea_default371"></a></td><td class="c014"> Any WeiDU variables (like <span class="c003">%myvar%</span>) inside the current file (which
should probably be a plain text file in order for this to make much sense)
are replaced by their values. Example:
<pre class="verbatim">&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt; .../mymod-inlined/script.baf
IF
  See(%myvar%)
THEN
  RESPONSE #100
    Kill(%myvar%)
END
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
EXTEND_TOP ~sola.bcs~ ~.../mymod-inlined/script.baf~
  SPRINT myvar = ~"Anomen"~
  EVALUATE_BUFFER
</pre>
Those two actions extend the top of <span class="c003">sola.bcs</span> with the script
block <span class="c003">IF See("Anomen") THEN RESPONSE #100 Kill("Anomen") END</span>.
You can also use <a href="#EVALUATE_BUFFER"><span class="c003">EVALUATE_BUFFER</span></a> in <a href="#COMPILE"><span class="c003">COMPILE</span></a> actions
or before strings in <a href="#value"><span class="c003">value</span></a>s. You may use <span class="c005">EVAL</span><a id="EVAL"></a><a id="hevea_default372"></a> as
a synonym for <span class="c003">EVALUATE_BUFFER</span>.
</td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">APPLY_BCS_PATCH</span><a id="APPLY_BCS_PATCH"></a><a id="hevea_default373"></a> patchFile</td><td class="c014"> Applies patchFile to the current file. See <a href="#--bcmp-from"><span class="c003">--bcmp-from</span></a> and similar
command-line arguments for constructing these patches. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">APPLY_BCS_PATCH_OR_COPY</span><a id="APPLY_BCS_PATCH_OR_COPY"></a><a id="hevea_default374"></a> patchFile copyFile</td><td class="c014"> Applies patchFile to the current file, as <a href="#APPLY_BCS_PATCH"><span class="c003">APPLY_BCS_PATCH</span></a>.
However, if the patching fails the current file is replaced with copyFile
instead. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">WRITE_BYTE</span><a id="WRITE_BYTE"></a><a id="hevea_default375"></a> <a href="#offset"><span class="c003">offset</span></a> <a href="#value"><span class="c003">value</span></a></td><td class="c014"> The first argument is the offset at which the second argument (an 8-bit
byte value) is written. Performs <code>READ_BYTE offset THIS</code> and
<code>READ_SBYTE offset STHIS</code> automatically (you can now write
<code>WRITE_BYTE 100 THIS </code> 2). </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">WRITE_SHORT</span><a id="WRITE_SHORT"></a><a id="hevea_default376"></a> <a href="#offset"><span class="c003">offset</span></a> <a href="#value"><span class="c003">value</span></a></td><td class="c014"> The first argument is the offset at which the second argument (a 16-bit
short value) is written. Performs <code>READ_SHORT offset THIS</code> and
<code>READ_SSHORT offset STHIS</code> automatically. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">WRITE_LONG</span><a id="WRITE_LONG"></a><a id="hevea_default377"></a> <a href="#offset"><span class="c003">offset</span></a> <a href="#value"><span class="c003">value</span></a></td><td class="c014"> The first argument is the offset at which the second argument (a 32-bit
long word value) is written. Performs <code>READ_LONG offset THIS</code> and
<code>READ_SLONG offset STHIS</code> automatically. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">WRITE_ASCII</span><a id="WRITE_ASCII"></a><a id="hevea_default378"></a> <a href="#offset"><span class="c003">offset</span></a> ascString
<span class="c002"> [ </span><span class="c003">#requiredSize</span> <span class="c002"> ] </span></td><td class="c014"> The ASCII ascString is written to the file starting at offset.
If you specify a <span class="c003">requiredSize</span> then exactly that many bytes are
written (if ascString is smaller, it is padded with <span class="c003">NUL</span>s; if
ascString is larger, it is truncated). If you do not specify a requiredSize,
the terminating <span class="c003">NUL</span> is not written. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">WRITE_ASCII_LIST</span><a id="WRITE_ASCII_LIST"></a><a id="hevea_default379"></a> <a href="#offset"><span class="c003">offset</span></a> ascString <span class="c002"> list </span></td><td class="c014"> The given ASCII strings are written at offset, offset + 8, offset + 16...
Automatically evaluates variables. You may use <span class="c005">WRITE_ASCIIL</span><a id="WRITE_ASCIIL"></a><a id="hevea_default380"></a>
as a synonym for <a href="#WRITE_ASCII_LIST"><span class="c003">WRITE_ASCII_LIST</span></a>.</td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">WRITE_ASCII_TERMINATE</span><a id="WRITE_ASCII_TERMINATE"></a><a id="hevea_default381"></a> <a href="#offset"><span class="c003">offset</span></a> ascString</td><td class="c014"> The ASCII ascString is written to the file starting at offset.
The terminating <span class="c003">NUL</span> <em>is</em> written. You may use
<span class="c005">WRITE_ASCIIT</span><a id="WRITE_ASCIIT"></a><a id="hevea_default382"></a> as a synonym for <a href="#WRITE_ASCII_TERMINATE"><span class="c003">WRITE_ASCII_TERMINATE</span></a>. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">WRITE_EVALUATED_ASCII</span><a id="WRITE_EVALUATED_ASCII"></a><a id="hevea_default383"></a> <a href="#offset"><span class="c003">offset</span></a> ascString
<span class="c002"> [ </span><span class="c003">#requiredSize</span> <span class="c002"> ] </span></td><td class="c014"> The ASCII ascString is evaluated (so <span class="c003">%variable%</span> is replaced by its
value) and written to the file starting at offset (as in
<a href="#WRITE_ASCII"><span class="c003">WRITE_ASCII</span></a>). You may use <span class="c005">WRITE_ASCIIE</span><a id="WRITE_ASCIIE"></a><a id="hevea_default384"></a> as a synonym
for <a href="#WRITE_EVALUATED_ASCII"><span class="c003">WRITE_EVALUATED_ASCII</span></a>. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">WRITE_FILE</span><a id="WRITE_FILE"></a><a id="hevea_default385"></a> <a href="#offset"><span class="c003">offset</span></a> filename</td><td class="c014"> The entire contents of “filename” (which may contain variables) are
loaded and copied over the current file starting at offset
<a href="#offset"><span class="c003">offset</span></a>. “filename” must be a literal filename like
<span class="c003">mymod/data/file.bam</span>. If there is not enough room between
<a href="#offset"><span class="c003">offset</span></a> and the end of the file for the contents of “filename”
the <a href="#patch"><span class="c003">patch</span></a> will fail with an error message. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">INSERT_FILE</span><a id="INSERT_FILE"></a><a id="hevea_default386"></a> <a href="#offset"><span class="c003">offset</span></a> filename</td><td class="c014"> Just like <a href="#WRITE_FILE"><span class="c003">WRITE_FILE</span></a> except that the entire contents of
“filename” are inserted at <a href="#offset"><span class="c003">offset</span></a>, just as if you had done an
<a href="#INSERT_BYTES"><span class="c003">INSERT_BYTES</span></a> with the size of “filename” to that <a href="#offset"><span class="c003">offset</span></a>
followed by a <a href="#WRITE_FILE"><span class="c003">WRITE_FILE</span></a> to that <a href="#offset"><span class="c003">offset</span></a>. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">APPEND_FILE</span><a id="APPEND_FILE"></a><a id="hevea_default387"></a> <span class="c002"> [ </span><span class="c003">TEXT</span> <span class="c002"> ] </span>filename</td><td class="c014">
Appends the contents of filename onto the current file. If <span class="c003">TEXT</span>
is specified, the contents of filename and the current file is
separated by a newline character (LF) unless the first character of
filename or the last character of the current file is a newline
character. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">APPEND_FILE_EVALUATE</span><a id="APPEND_FILE_EVALUATE"></a><a id="hevea_default388"></a> <span class="c002"> [ </span><span class="c003">TEXT</span> <span class="c002"> ] </span>filename</td><td class="c014">
Just like <a href="#APPEND_FILE"><span class="c003">APPEND_FILE</span></a> except that <code>%variables%</code> in the
contents of filename are evaluated before the appending. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">REPLACE_BCS_BLOCK</span><a id="REPLACE_BCS_BLOCK"></a><a id="hevea_default389"></a> <span class="c002"> [ </span><span class="c003">EVALUATE_BUFFER</span> <span class="c002"> ] </span><a href="#optcase"><span class="c003">optcase</span></a>
oldFile newFile <span class="c002"> [ </span><span class="c003">ON_MISMATCH</span> <a href="#patch"><span class="c003">patch</span></a> <span class="c002"> list </span><span class="c003">END</span> <span class="c002"> ] </span></td><td class="c014"> If the current file is a <a href="#BCS"><span class="c003">BCS</span></a> file, the segment of it
corresponding to oldFile is replaced with the contents of newFile.
Multiple blocks can be replaced if they are contiguous and in order.
oldFile and newFile may be <a href="#BCS"><span class="c003">BCS</span></a> or <a href="#BAF"><span class="c003">BAF</span></a> files. If they
are <a href="#BAF"><span class="c003">BAF</span></a> files they will not get the benefit of <a href="#AUTO_TRA"><span class="c003">AUTO_TRA</span></a>.<p>If <a href="#EVALUATE_BUFFER"><span class="c003">EVALUATE_BUFFER</span></a> is given, variables inside oldFile and newFile are
evaluated, but only they are <a href="#BAF"><span class="c003">BAF</span></a> files.</p><p>If the segment corresponding to oldFile is not found and the
<span class="c003">ON_MISMATCH</span> section is present, those patches are run; if
oldFile is not found and <span class="c003">ON_MISMATCH</span> is not present, a warning
message is printed.</p><p>You may use <span class="c005">R_B_B</span><a id="R_B_B"></a><a id="hevea_default390"></a> as a synonym for <a href="#REPLACE_BCS_BLOCK"><span class="c003">REPLACE_BCS_BLOCK</span></a>.
</p></td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">INSERT_BYTES</span><a id="INSERT_BYTES"></a><a id="hevea_default391"></a> <a href="#offset"><span class="c003">offset</span></a> <a href="#value"><span class="c003">value</span></a></td><td class="c014"> The first argument is the offset, the second argument is the count.
The file will be expanded at the given offset with count bytes worth of
zeroes. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">DELETE_BYTES</span><a id="DELETE_BYTES"></a><a id="hevea_default392"></a> <a href="#offset"><span class="c003">offset</span></a> <a href="#value"><span class="c003">value</span></a></td><td class="c014"> The first argument is the offset, the second argument is the count.
The file will shrink as count bytes are deleted starting at the given
offset. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">READ_BYTE</span><a id="READ_BYTE"></a><a id="hevea_default393"></a> <a href="#offset"><span class="c003">offset</span></a> <a href="#variable"><span class="c003">variable</span></a> <span class="c002"> [ </span><span class="c003">ELSE</span>
<a href="#value"><span class="c003">value</span></a> <span class="c002"> ] </span></td><td class="c014"> An 8-bit value is read from the file at the given <a href="#offset"><span class="c003">offset</span></a> and is stored
in the given <a href="#variable"><span class="c003">variable</span></a>. If <a href="#offset"><span class="c003">offset</span></a> is out-of-bounds and the
<span class="c003">ELSE</span> is present, the <span class="c003">ELSE</span>-<a href="#value"><span class="c003">value</span></a> is assigned to
<a href="#variable"><span class="c003">variable</span></a>. If <a href="#offset"><span class="c003">offset</span></a> is out-of-bounds and the <span class="c003">ELSE</span> is
not present, the <a href="#patch"><span class="c003">patch</span></a> fails with a visible error. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">READ_SBYTE</span><a id="READ_SBYTE"></a><a id="hevea_default394"></a> <a href="#offset"><span class="c003">offset</span></a> <a href="#variable"><span class="c003">variable</span></a> <span class="c002"> [ </span><span class="c003">ELSE</span>
<a href="#value"><span class="c003">value</span></a> <span class="c002"> ] </span></td><td class="c014"> As <a href="#READ_BYTE"><span class="c003">READ_BYTE</span></a>, but the value is interpreted as signed. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">READ_SHORT</span><a id="READ_SHORT"></a><a id="hevea_default395"></a> <a href="#offset"><span class="c003">offset</span></a> <a href="#variable"><span class="c003">variable</span></a> <span class="c002"> [ </span><span class="c003">ELSE</span>
<a href="#value"><span class="c003">value</span></a> <span class="c002"> ] </span></td><td class="c014"> A 16-bit value is read from the file at the given <a href="#offset"><span class="c003">offset</span></a> and is
stored in the given <a href="#variable"><span class="c003">variable</span></a>. See <a href="#READ_BYTE"><span class="c003">READ_BYTE</span></a>. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">READ_SSHORT</span><a id="READ_SSHORT"></a><a id="hevea_default396"></a> <a href="#offset"><span class="c003">offset</span></a> <a href="#variable"><span class="c003">variable</span></a> <span class="c002"> [ </span><span class="c003">ELSE</span>
<a href="#value"><span class="c003">value</span></a> <span class="c002"> ] </span></td><td class="c014"> As <a href="#READ_SHORT"><span class="c003">READ_SHORT</span></a>, but the value is interpreted as signed. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">READ_LONG</span><a id="READ_LONG"></a><a id="hevea_default397"></a> <a href="#offset"><span class="c003">offset</span></a> <a href="#variable"><span class="c003">variable</span></a> <span class="c002"> [ </span><span class="c003">ELSE</span>
<a href="#value"><span class="c003">value</span></a> <span class="c002"> ] </span></td><td class="c014"> A 32-bit value is read from the file at the given <a href="#offset"><span class="c003">offset</span></a>
and is stored in the given <a href="#variable"><span class="c003">variable</span></a>. See <a href="#READ_BYTE"><span class="c003">READ_BYTE</span></a>. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">READ_SLONG</span><a id="READ_SLONG"></a><a id="hevea_default398"></a> <a href="#offset"><span class="c003">offset</span></a> <a href="#variable"><span class="c003">variable</span></a> <span class="c002"> [ </span><span class="c003">ELSE</span>
<a href="#value"><span class="c003">value</span></a> <span class="c002"> ] </span></td><td class="c014"> As <a href="#READ_LONG"><span class="c003">READ_LONG</span></a>, but the value is interpreted as signed. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">READ_ASCII</span><a id="READ_ASCII"></a><a id="hevea_default399"></a> <a href="#offset"><span class="c003">offset</span></a> <a href="#variable"><span class="c003">variable</span></a> <span class="c002"> [ </span><span class="c003">ELSE</span>
<span class="c003">string</span> <span class="c002"> ]  [ </span><span class="c003">(</span> <a href="#value"><span class="c003">value</span></a> <span class="c003">)</span> <span class="c002"> [ </span><span class="c003">NULL</span> <span class="c002"> ]  ] </span></td><td class="c014"> A nul-terminated string is read from the file at
the given <a href="#offset"><span class="c003">offset</span></a> and is stored in the given <a href="#variable"><span class="c003">variable</span></a>.
The terminating nul is not stored. The default read size is 8 bytes.
If an explicit size <a href="#value"><span class="c003">value</span></a> is specified then that many bytes are read
into the <a href="#variable"><span class="c003">variable</span></a>, even if some of them are nuls, except if <span class="c003">NULL</span>
is present, in which case a nul-terminated string is read, without storing
the terminating null. See
<a href="#READ_BYTE"><span class="c003">READ_BYTE</span></a>. If the <a href="#offset"><span class="c003">offset</span></a> is out-of-bounds and the
<span class="c003">ELSE</span> clause is present, the <span class="c003">string</span> is evaluated as in
<span class="c003">WRITE_EVALUATED_ASCII</span> and then assigned into <a href="#variable"><span class="c003">variable</span></a>.
</td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">READ_STRREF</span><a id="READ_STRREF"></a><a id="hevea_default400"></a> <a href="#offset"><span class="c003">offset</span></a> <a href="#variable"><span class="c003">variable</span></a> <span class="c002"> [ </span><span class="c003">ELSE</span>
<span class="c003">string</span> <span class="c002"> ] </span></td><td class="c014">
A 32-bit Infinity Engine string reference is read from the
file at the given offset. The string reference is looked up in
<span class="c003">DIALOG.TLK</span> and the (male) string (without any quotes) is
stored in the variable. In some sense this is the opposite of
<a href="#SAY_EVALUATED"><span class="c003">SAY_EVALUATED</span></a>. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">READ_STRREF_F</span><a id="READ_STRREF_F"></a><a id="hevea_default401"></a> <a href="#offset"><span class="c003">offset</span></a> <a href="#variable"><span class="c003">variable</span></a> <span class="c002"> [ </span><span class="c003">ELSE</span> <span class="c003">string</span> <span class="c002"> ] </span></td><td class="c014">
A 32-bit Infinity Engine string reference is read from the file at
the given offset. The string reference is looked up in
<span class="c003">DIALOGF.TLK</span> and the female string (without any quotes) is stored
in the variable. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">READ_STRREF_S</span><a id="READ_STRREF_S"></a><a id="hevea_default402"></a> <a href="#offset"><span class="c003">offset</span></a> <a href="#variable"><span class="c003">variable</span></a> <span class="c002"> [ </span><span class="c003">ELSE</span> <span class="c003">string</span> <span class="c002"> ] </span></td><td class="c014">
A 32-bit Infinity Engine string reference is read from the file at
the given offset. The string reference is looked up in
<span class="c003">DIALOG.TLK</span> and the sound reference associated with the (male)
string is stored in the variable. If the string has no sound, the
empty string is used instead. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">READ_STRREF_FS</span><a id="READ_STRREF_FS"></a><a id="hevea_default403"></a> <a href="#offset"><span class="c003">offset</span></a> <a href="#variable"><span class="c003">variable</span></a> <span class="c002"> [ </span><span class="c003">ELSE</span> <span class="c003">string</span> <span class="c002"> ] </span></td><td class="c014">
A 32-bit Infinity Engine string reference is read from the file at
the given offset. The string reference is looked up in
<span class="c003">DIALOGF.TLK</span> and the sound reference associated with the female
string is stored in the variable. If there is no <span class="c003">DIALOGF.TLK</span>,
the sound reference associated with the string from <span class="c003">DIALOG.TLK</span>
is used instead. If the string has no sound, the empty string is
used instead. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">GET_OFFSET_ARRAY</span><a id="GET_OFFSET_ARRAY"></a><a id="hevea_default404"></a> <a href="#String"><span class="c003">String</span></a> <span class="c003">seven </span><a href="#value"><span class="c003">value</span></a><span class="c003">s</span></td><td class="c014"> The seven values are:
<pre class="verbatim">1. Offset
2. Read length of "Offset"
3. Iterations
4. Read length of "Iterations"
5. Index
6. Read length of "Index"
7. Length between iterations.
</pre><p>WeiDU comes with a number of pre-defined sets of values for <span class="c003">GET_OFFSET_ARRAY</span>. These sets are:
</p><pre class="verbatim">ARE_V10_ACTORS (0x54 4 0x58 2 0 0 0x110)
ARE_V10_REGIONS (0x5c 4 0x5a 2 0 0 0xc4)
ARE_V10_SPAWN_POINTS (0x60 4 0x64 4 0 0 0xc8)
ARE_V10_ENTRANCES (0x68 4 0x6c 4 0 0 0x68)
ARE_V10_CONTAINERS (0x70 4 0x74 2 0 0 0xc0)
ARE_V10_AMBIENTS (0x84 4 0x82 2 0 0 0xd4)
ARE_V10_DOORS (0xa8 4 0xa4 4 0 0 0xc8)
ARE_V10_ANIMATIONS (0xb0 4 0xac 4 0 0 0x4c)

ARE_V91_ACTORS (0x64 4 0x68 2 0 0 0x110)

CRE_V10_KNOWN_SPELLS (0x2a0 4 0x2a4 4 0 0 0xc)
CRE_V10_SPELL_MEM_INFO (0x2a8 4 0x2ac 4 0 0 0x10)
CRE_V10_EFFECTS (0x2c4 4 0x2c8 4 0 0 0x108)
CRE_V10_ITEMS (0x2bc 4 0x2c0 4 0 0 0x14)

ITM_V10_HEADERS (0x64 4 0x68 2 0 0 0x38)
ITM_V10_GEN_EFFECTS (0x6a 4 0x70 2 0x6e 2 0x30)

SPL_V10_HEADERS (0x64 4 0x68 2 0 0 0x28)
SPL_V10_GEN_EFFECTS (0x6a 4 0x70 2 0x6e 2 0x30)

STO_V10_ITEMS_PURCHASED (0x2c 4 0x30 4 0 0 0x4)
STO_V10_ITEMS_SOLD (0x34 4 0x38 4 0 0 0x1c)
STO_V10_DRINKS (0x4c 4 0x50 4 0 0 0x14)
STO_V10_CURES (0x70 4 0x74 4 0 0 0xc)

WMP_AREAS (0x34 4 0x30 4 0 0 0xf0)
WMP_LINKS (0x38 4 0x3c 4 0 0 0xd8)
</pre><p><span class="c003">GET_OFFSET_ARRAY</span> performs "Iterations" number of reads and sets the array <code>$string(0)</code>, <code>$string(1)</code> etc to the result of these reads. A more detailed explanation can be had in the <a href="#sec-get-offset-array12"><span class="c003">GET_OFFSET_ARRAY</span> and <span class="c003">GET_OFFSET_ARRAY2</span> tutorial</a>.</p></td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">GET_OFFSET_ARRAY2</span><a id="GET_OFFSET_ARRAY2"></a><a id="hevea_default405"></a> <a href="#String"><span class="c003">String</span></a> <span class="c003">eight </span><a href="#value"><span class="c003">value</span></a><span class="c003">s</span></td><td class="c014"> The eight values are:
<pre class="verbatim">1. Offset2
2. Offset
3. Read length of "Offset"
4. Iterations
5. Read length of "Iterations"
6. Index
7. Read length of "Index"
8. Length between iterations
</pre><p>WeiDU comes with a number of pre-defined sets of values for <span class="c003">GET_OFFSET_ARRAY2</span>. These sets are:
</p><pre class="verbatim">ARE_V10_ITEMS (0x78 4 0x44 4 0x40 4 0x14)
ARE_V10_REGION_VERTICES (0x7c 4 0x2a 2 0x2c 4 0x4)
ARE_V10_CONTAINER_VERTICES (0x7c 4 0x54 2 0x50 4 0x4)
ARE_V10_DOOR_OPEN_OUTLINE_VERTICES (0x7c 4 0x30 2 0x2c 4 0x4)
ARE_V10_DOOR_CLOSED_OUTLINE_VERTICES (0x7c 4 0x32 2 0x34 4 0x4)
ARE_V10_DOOR_OPEN_CELL_VERTICES (0x7c 4 0x4c 2 0x48 4 0x4)
ARE_V10_DOOR_CLOSED_CELL_VERTICES (0x7c 4 0x4e 2 0x50 4 0x4)

CRE_V10_SPELL_MEM (0x2b0 4 0xc 4 0x8 4 0xc)

ITM_V10_HEAD_EFFECTS (0x6a 4 0x1e 2 0x20 2 0x30)

SPL_V10_HEAD_EFFECTS (0x6a 4 0x1e 2 0x20 2 0x30)

WMP_NORTH_LINKS (0x38 4 0x54 4 0x50 4 0xd8)
WMP_WEST_LINKS (0x38 4 0x5c 4 0x58 4 0xd8)
WMP_SOUTH_LINKS (0x38 4 0x64 4 0x60 4 0xd8)
WMP_EAST_LINKS (0x38 4 0x6c 4 0x68 4 0xd8)
</pre><p>
As you can see, the value for Offset2 isn’t included in the sets, since it varies.</p><p>"Offset2" corresponds to the result from <a href="#GET_OFFSET_ARRAY"><span class="c003">GET_OFFSET_ARRAY</span></a>. "Offset" is read from the start of the file. "Iterations" and "Index" are read from Offset2 + value. Apart from that <span class="c003">GET_OFFSET_ARRAY2</span> functions like <a href="#GET_OFFSET_ARRAY"><span class="c003">GET_OFFSET_ARRAY</span></a>. A more detailed explanation can be had in the <a href="#sec-get-offset-array12"><span class="c003">GET_OFFSET_ARRAY</span> and <span class="c003">GET_OFFSET_ARRAY2</span> tutorial</a>.</p></td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">DEFINE_ASSOCIATIVE_ARRAY</span><a id="DEFINE_ASSOCIATIVE_ARRAY"></a><a id="hevea_default406"></a> <a href="#String"><span class="c003">String</span></a><span class="c003"> BEGIN key1 <span class="c002"> [ </span>, key2 ... <span class="c002"> ] </span>=&gt; result1</span> <span class="c002"> list </span><span class="c003">END</span></td><td class="c014"> Sets the array <code>$string</code>, indexed by the keys, to the corresponding results. The results can either be <a href="#String"><span class="c003">String</span></a>s or <a href="#value"><span class="c003">value</span></a>s.
Example:
<pre class="verbatim">DEFINE_ASSOCIATIVE_ARRAY mix_with_blue BEGIN
  red =&gt; purple
  yellow =&gt; green
END
</pre>
You may use <span class="c005">PATCH_DEFINE_ASSOCIATIVE_ARRAY</span><a id="PATCH_DEFINE_ASSOCIATIVE_ARRAY"></a><a id="hevea_default407"></a> as a synonym for <a href="#DEFINE_ASSOCIATIVE_ARRAY"><span class="c003">DEFINE_ASSOCIATIVE_ARRAY</span></a>.
</td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">GET_STRREF</span><a id="GET_STRREF"></a><a id="hevea_default408"></a> <a href="#value"><span class="c003">value</span></a> <a href="#variable"><span class="c003">variable</span></a></td><td class="c014">
The string reference value is looked up in <span class="c003">DIALOG.TLK</span> and the
(male) string (without any quotes) is stored in the variable. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">GET_STRREF_F</span><a id="GET_STRREF_F"></a><a id="hevea_default409"></a> <a href="#value"><span class="c003">value</span></a> <a href="#variable"><span class="c003">variable</span></a></td><td class="c014">
The string reference value is looked up in <span class="c003">DIALOGF.TLK</span> and the
female string (without any quotes) is stored in the variable. If
there is no <span class="c003">DIALOGF.TLK</span>, the string from <span class="c003">DIALOG.TLK</span> is used
instead. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">GET_STRREF_S</span><a id="GET_STRREF_S"></a><a id="hevea_default410"></a> <a href="#value"><span class="c003">value</span></a> <a href="#variable"><span class="c003">variable</span></a></td><td class="c014">
The string reference value is looked up in <span class="c003">DIALOG.TLK</span> and the
sound reference associated with the (male) string is stored in the
variable. If the string has no sound, the empty string
is used instead. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">GET_STRREF_FS</span><a id="GET_STRREF_FS"></a><a id="hevea_default411"></a> <a href="#value"><span class="c003">value</span></a> <a href="#variable"><span class="c003">variable</span></a></td><td class="c014">
The string reference value is looked up in <span class="c003">DIALOGF.TLK</span> and the
sound reference associated with the female string is stored in the
variable. If there is not <span class="c003">DIALOGF.TLK</span>, the sound reference
associated with the string from <span class="c003">DIALOG.TLK</span> is used instead. If the
string has no sound, the empty string is used instead. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">SET</span><a id="SET"></a><a id="hevea_default412"></a> <a href="#variable"><span class="c003">variable</span></a> <span class="c003">=</span> <a href="#value"><span class="c003">value</span></a></td><td class="c014"> Update <a href="#variable"><span class="c003">variable</span></a> so that it is equal to <a href="#value"><span class="c003">value</span></a>. </td></tr>
<tr><td class="c012">or</td><td class="c014"><a href="#variable"><span class="c003">variable</span></a> <span class="c003">=</span> <a href="#value"><span class="c003">value</span></a></td><td class="c014"> Update <a href="#variable"><span class="c003">variable</span></a> so that it is equal to <a href="#value"><span class="c003">value</span></a>. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c002"> [ </span><a href="#SET"><span class="c003">SET</span></a> <span class="c002"> ] </span><a href="#variable"><span class="c003">variable</span></a> <span class="c003">+=</span> <a href="#value"><span class="c003">value</span></a></td><td class="c014"> Equivalent to <span class="c003">SET variable = variable + value</span>. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c002"> [ </span><a href="#SET"><span class="c003">SET</span></a> <span class="c002"> ] </span><a href="#variable"><span class="c003">variable</span></a> <span class="c003">-=</span> <a href="#value"><span class="c003">value</span></a></td><td class="c014"> Equivalent to <span class="c003">SET variable = variable - value</span>. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c002"> [ </span><a href="#SET"><span class="c003">SET</span></a> <span class="c002"> ] </span><a href="#variable"><span class="c003">variable</span></a> <span class="c003">*=</span> <a href="#value"><span class="c003">value</span></a></td><td class="c014"> Equivalent to <span class="c003">SET variable = variable * value</span>. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c002"> [ </span><a href="#SET"><span class="c003">SET</span></a> <span class="c002"> ] </span><a href="#variable"><span class="c003">variable</span></a> <span class="c003">/=</span> <a href="#value"><span class="c003">value</span></a></td><td class="c014"> Equivalent to <span class="c003">SET variable = variable / value</span>. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c002"> [ </span><a href="#SET"><span class="c003">SET</span></a> <span class="c002"> ] </span><a href="#variable"><span class="c003">variable</span></a> <span class="c003">&amp;=</span> <a href="#value"><span class="c003">value</span></a></td><td class="c014"> Equivalent to <span class="c003">SET variable = variable BAND value</span>. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c002"> [ </span><a href="#SET"><span class="c003">SET</span></a> <span class="c002"> ] </span><a href="#variable"><span class="c003">variable</span></a> <span class="c003">|=</span> <a href="#value"><span class="c003">value</span></a></td><td class="c014"> Equivalent to <span class="c003">SET variable = variable BOR value</span>. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c002"> [ </span><a href="#SET"><span class="c003">SET</span></a> <span class="c002"> ] </span><a href="#variable"><span class="c003">variable</span></a> <span class="c003">&lt;&lt;=</span> <a href="#value"><span class="c003">value</span></a></td><td class="c014"> Equivalent to <span class="c003">SET variable = variable BLSL value</span>. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c002"> [ </span><a href="#SET"><span class="c003">SET</span></a> <span class="c002"> ] </span><a href="#variable"><span class="c003">variable</span></a> <span class="c003">&gt;&gt;=</span> <a href="#value"><span class="c003">value</span></a></td><td class="c014"> Equivalent to <span class="c003">SET variable = variable BLSR value</span>. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">WHILE</span><a id="WHILE"></a><a id="hevea_default413"></a> <a href="#value"><span class="c003">value</span></a> <span class="c003">BEGIN</span>
<a href="#patch"><span class="c003">patch</span></a> <span class="c002"> list </span><span class="c003">END</span></td><td class="c014"> If <a href="#value"><span class="c003">value</span></a> is non-zero, execute the given <a href="#patch"><span class="c003">patch</span></a> <span class="c002"> list </span>and
then repeat, re-evaluating the <a href="#value"><span class="c003">value</span></a>.
<em>Be very careful when using this command. </em> You can easily describe
an infinite loop. See the <a href="#sec-while"><span class="c003">WHILE</span></a> loop tutorial for more
information.
</td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">FOR</span><a id="FOR"></a><a id="hevea_default414"></a> <span class="c003">(</span> <a href="#patch"><span class="c003">patch</span></a> <span class="c002"> list </span><span class="c003">;</span>
<a href="#value"><span class="c003">value</span></a> <span class="c003">;</span>
<a href="#patch"><span class="c003">patch</span></a> <span class="c002"> list </span><span class="c003">)</span>
<span class="c003">BEGIN</span> <a href="#patch"><span class="c003">patch</span></a> <span class="c002"> list </span><span class="c003">END</span></td><td class="c014"> The <a href="#patch"><span class="c003">patch</span></a> <span class="c003">FOR (init;pred;inc) BEGIN body END</span> is equivalent to
<span class="c003">init WHILE pred BEGIN body inc END</span>. Note that the predicate
<a href="#value"><span class="c003">value</span></a> cannot be empty. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">PATCH_BASH_FOR</span><a id="PATCH_BASH_FOR"></a><a id="hevea_default415"></a> <a href="#directory-file-regexp"><span class="c003">directory-file-regexp</span></a> <span class="c003">BEGIN</span> <a href="#patch"><span class="c003">patch</span></a> <span class="c002"> list </span><span class="c003">END</span></td><td class="c014"> for all files that match <a href="#directory-file-regexp"><span class="c003">directory-file-regexp</span></a>, sets a bunch of variables
and executes the patches for each file found. Assuming the file being copied
is somedir/yourfile.cre, the following variables will be set:
<pre class="verbatim">"%BASH_FOR_DIRECTORY%" = "somedir"
"%BASH_FOR_FILESPEC%" = "somedir/yourfile.cre"
"%BASH_FOR_FILE%" = "yourfile.cre"
"%BASH_FOR_RES%" = "yourfile"
"%BASH_FOR_EXT%" = "cre"
"%BASH_FOR_SIZE%" = &lt;size of somedir/yourfile.cre&gt;
</pre> </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">DEFINE_ARRAY</span><a id="DEFINE_ARRAY"></a><a id="hevea_default416"></a> <a href="#String"><span class="c003">String</span></a><span class="c003">1 BEGIN </span><a href="#String"><span class="c003">String</span></a><span class="c003">2</span> <span class="c002"> list </span><span class="c003">END</span></td><td class="c014">	Sets the array <code>$string1(0)</code>,<code>$string1(1)</code> etc. to the various elements in string2.
</td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">PATCH_DEFINE_ARRAY</span><a id="PATCH_DEFINE_ARRAY"></a><a id="hevea_default417"></a> <a href="#String"><span class="c003">String</span></a><span class="c003">1 BEGIN </span><a href="#String"><span class="c003">String</span></a><span class="c003">2 <span class="c002"> list </span>END</span></td><td class="c014">	Same as <a href="#DEFINE_ARRAY"><span class="c003">DEFINE_ARRAY</span></a>.
</td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">SORT_ARRAY_INDICES</span><a id="SORT_ARRAY_INDICES"></a><a id="hevea_default418"></a> <a href="#String"><span class="c003">String</span></a>
<span class="c002"> [ </span><a href="#ArrayIndicesSortType"><span class="c003">ArrayIndicesSortType</span></a> <span class="c002"> ] </span></td><td class="c014">
Semantically identical to <a href="#ACTION_SORT_ARRAY_INDICES"><span class="c003">ACTION_SORT_ARRAY_INDICES</span></a></td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">PATCH_FOR_EACH</span><a id="PATCH_FOR_EACH"></a><a id="hevea_default419"></a> <a href="#String"><span class="c003">String</span></a><span class="c003">1 IN </span><a href="#String"><span class="c003">String</span></a> <span class="c002"> list </span><span class="c003">BEGIN</span> <a href="#patch"><span class="c003">patch</span></a> <span class="c002"> list </span><span class="c003">END</span></td><td class="c014"> will set the string1 variable to each value in string list and process each patch. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">PHP_EACH</span><a id="PHP_EACH"></a><a id="hevea_default420"></a> <a href="#String"><span class="c003">String</span></a><span class="c003">1 AS </span><a href="#String"><span class="c003">String</span></a><span class="c003">2 =&gt; </span><a href="#String"><span class="c003">String</span></a><span class="c003">3</span> <span class="c002"> list </span><span class="c003">BEGIN</span> <a href="#patch"><span class="c003">patch</span></a> <span class="c002"> list </span><span class="c003">END</span></td><td class="c014"> For every value of the string1 array that has been created or read, sets
string2_0 to the first array parameter, string2_1 to the second array
parameter, etc. and string3 to the result of the array. <code>string2</code> will also contain
		the first array parameter (as a synonym of <code>string2_0</code>). then executes the
patches listed. More exhaustive documentation will be provided by SConrad.
</td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">PATCH_PHP_EACH</span><a id="PATCH_PHP_EACH"></a><a id="hevea_default421"></a> <a href="#String"><span class="c003">String</span></a><span class="c003">1 AS </span><a href="#String"><span class="c003">String</span></a><span class="c003">2 =&gt; </span><a href="#String"><span class="c003">String</span></a><span class="c003">3</span> <span class="c002"> list </span><span class="c003">BEGIN</span> <a href="#patch"><span class="c003">patch</span></a> <span class="c002"> list </span><span class="c003">END</span></td><td class="c014"> A synonym of <a href="#PHP_EACH"><span class="c003">PHP_EACH</span></a>.
</td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">CLEAR_ARRAY</span><a id="CLEAR_ARRAY"></a><a id="hevea_default422"></a> <a href="#String"><span class="c003">String</span></a></td><td class="c014"> ‘Forgets’ that the array <span class="c003">string</span> exists until its values are recalled.
The actual variables’ values are kept, the only effect is that <span class="c003">*PHP_EACH</span>
will not consider old values.
</td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">PATCH_CLEAR_ARRAY</span><a id="PATCH_CLEAR_ARRAY"></a><a id="hevea_default423"></a> <a href="#String"><span class="c003">String</span></a></td><td class="c014"> A synonym of <a href="#CLEAR_ARRAY"><span class="c003">CLEAR_ARRAY</span></a>.
</td></tr>
<tr><td class="c012"> or</td><td class="c014"><span class="c005">PATCH_IF</span><a id="PATCH_IF"></a><a id="hevea_default424"></a> <a href="#value"><span class="c003">value</span></a> <span class="c002"> [ </span><span class="c003">THEN</span> <span class="c002"> ] </span><span class="c003">BEGIN</span>
<a href="#patch"><span class="c003">patch</span></a> <span class="c002"> list </span><span class="c003">END</span>
<span class="c002"> [ </span><span class="c003">ELSE</span> <span class="c003">BEGIN</span> <a href="#patch"><span class="c003">patch</span></a> <span class="c002"> list </span><span class="c003">END</span> <span class="c002"> ] </span></td><td class="c014"> If <a href="#value"><span class="c003">value</span></a> is non-zero, execute the first <a href="#patch"><span class="c003">patch</span></a> <span class="c002"> list </span>once. Otherwise, execute the second <a href="#patch"><span class="c003">patch</span></a> <span class="c002"> list </span>(if any). As a
convenient shorthand, you may omit the <span class="c003">BEGIN</span>-<span class="c003">END</span> in the <span class="c003">ELSE</span>
branch if the <span class="c003">ELSE</span> branch contains exactly one <span class="c003">patch</span>.
</td></tr>
<tr><td class="c012"> or</td><td class="c014"><span class="c005">PATCH_MATCH</span><a id="PATCH_MATCH"></a><a id="hevea_default425"></a> match-value <span class="c003">WITH</span> <span class="c002"> [ </span>guard-value ...
<span class="c002"> [ </span><span class="c003">WHEN</span> condition-<a href="#value"><span class="c003">value</span></a> <span class="c002"> ] </span><span class="c003">BEGIN</span> <a href="#patch"><span class="c003">patch</span></a>
<span class="c002"> list </span><span class="c003">END</span> <span class="c002"> ]  [ </span><span class="c003">ANY</span> condition-<a href="#value"><span class="c003">value</span></a> <span class="c003">BEGIN</span>
<a href="#patch"><span class="c003">patch</span></a> <span class="c002"> list </span><span class="c003">END</span> <span class="c002"> ] </span>... <span class="c003">DEFAULT</span> <a href="#patch"><span class="c003">patch</span></a>
<span class="c002"> list </span><span class="c003">END</span></td><td class="c014">
The match-value is either a <a href="#value"><span class="c003">value</span></a> or a literal expression
(strings or integers); <a href="#value"><span class="c003">value</span></a>s are evaluated, including for
variables and the array construct, and the result obtained is used
in the matching.<p>Matching is done in order against guard-values for which any
corresponding condition-value evaluates to true (not 0) and against
guard-values that lack a condition-value.</p><p>Guard-values are either <a href="#value"><span class="c003">value</span></a>s or literal
expressions. Values are evaluated, including for variables and the
array construct, and the result is case-insensitively matched as a
<a href="#regexp"><span class="c003">regexp</span></a> against the match-value.</p><p>Condition-values must be <a href="#value"><span class="c003">value</span></a>s and must evaluate to integers.</p><p><span class="c003">ANY</span> matches any match-value for which the corresponding
condition-value is true.</p><p>If a match is found, the corresponding patch list is executed and
no further matching is done. If no match is found, the <span class="c003">DEFAULT</span>
patch list is executed.</p><p>See the <a href="#sec-match-and-try"><span class="c003">MATCH</span> and <span class="c003">TRY</span> tutorial</a>
for additional information. </p></td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">PATCH_TRY</span><a id="PATCH_TRY"></a><a id="hevea_default426"></a> <a href="#patch"><span class="c003">patch</span></a> <span class="c002"> list </span><span class="c003">WITH</span> <span class="c002"> [ </span>guard-value ...
<span class="c002"> [ </span><span class="c003">WHEN</span> condition-<a href="#value"><span class="c003">value</span></a> <span class="c002"> ] </span><span class="c003">BEGIN</span> <a href="#patch"><span class="c003">patch</span></a>
<span class="c002"> list </span><span class="c003">END</span> <span class="c002"> ]  [ </span><span class="c003">ANY</span> condition-<a href="#value"><span class="c003">value</span></a> <span class="c003">BEGIN</span>
<a href="#patch"><span class="c003">patch</span></a> <span class="c002"> list </span><span class="c003">END</span> ... <span class="c003">DEFAULT</span> <a href="#patch"><span class="c003">patch</span></a> <span class="c002"> list </span><span class="c003">END</span></td><td class="c014"> If evaluating the patch list results in an error, the error is matched, as per <a href="#PATCH_MATCH"><span class="c003">PATCH_MATCH</span></a>.<p><span class="c007">N.B.</span> <span class="c003">TRY</span> is generally <em>not safe</em> to use because
many errors are intended to be fatal and if the mod installation
were to proceed anyway, it might do so in an inconsistent state,
with resource leaks or with other errors. <a href="#PATCH_RERAISE"><span class="c003">PATCH_RERAISE</span></a>
mitigates or eliminates these risks, since the unsafe part is
allowing the installation to continue and re-raising the error
allows it to fail, like intended.</p><p>See the <a href="#sec-match-and-try"><span class="c003">MATCH</span> and <span class="c003">TRY</span> tutorial</a> for additional information.
</p></td></tr>
<tr><td class="c012"> or</td><td class="c014"><span class="c005">PATCH_RERAISE</span><a id="PATCH_RERAISE"></a><a id="hevea_default427"></a></td><td class="c014"> When used inside a <a href="#PATCH_TRY"><span class="c003">PATCH_TRY</span></a>, the matched error is re-raised.<p>See the <a href="#sec-match-and-try"><span class="c003">MATCH</span> and <span class="c003">TRY</span> tutorial</a> for additional information.
</p></td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">PATCH_INCLUDE</span><a id="PATCH_INCLUDE"></a><a id="hevea_default428"></a> <a href="#String"><span class="c003">String</span></a> <span class="c002"> list </span></td><td class="c014"> loads the file string as if it were a list of tp2 patches and executes it (as if
		it had been typed inside your tp2).
These files have by convention tpp as an extension, due to no reason other than
randomness (you can use .tp1 or .xyzsucks if you’re so oriented).
		Please note that, to speed up inclusions, tpp files are stored in memory,
	 rather than re-read each time from the hard-disk. If you need automorphing code
		(IE, you want to edit your tpp file), you can use <a href="#PATCH_REINCLUDE"><span class="c003">PATCH_REINCLUDE</span></a> instead. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">PATCH_REINCLUDE</span><a id="PATCH_REINCLUDE"></a><a id="hevea_default429"></a> <a href="#String"><span class="c003">String</span></a> <span class="c002"> list </span></td><td class="c014"> Works like <a href="#PATCH_INCLUDE"><span class="c003">PATCH_INCLUDE</span></a>, but loads each time the tph file from the hard disk.
This is slower, but required if you want to edit your tpp file between an
inclusion and another.
</td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">PATCH_WITH_TRA</span><a id="PATCH_WITH_TRA"></a><a id="hevea_default430"></a> traName <span class="c002"> list </span><span class="c003">BEGIN</span> <a href="#patch"><span class="c003">patch</span></a> <span class="c002"> list </span><span class="c003">END</span></td><td class="c014"> Creates a new <span class="c003">TRA</span> scope copied from the surrounding scope,
loads all traName files (variable substitution is done; the file
can be inlined) and evaluates the <span class="c003">patch</span>es. When
<a href="#PATCH_WITH_TRA"><span class="c003">PATCH_WITH_TRA</span></a> exits, the new <span class="c003">TRA</span> scope is discarded,
that is, all <span class="c003">TRA</span> changes made by <a href="#PATCH_WITH_TRA"><span class="c003">PATCH_WITH_TRA</span></a> or any
of its enclosed patches are forgotten. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">PATCH_WITH_SCOPE</span><a id="PATCH_WITH_SCOPE"></a><a id="hevea_default431"></a> <span class="c003">BEGIN</span> <a href="#patch"><span class="c003">patch</span></a> <span class="c002"> list </span><span class="c003">END</span></td><td class="c014"> Creates a new variable scope copied from the surrounding scope
and evaluates the <span class="c003">patch</span>es inside the new scope. When
<a href="#PATCH_WITH_SCOPE"><span class="c003">PATCH_WITH_SCOPE</span></a> exits, the new scope is discarded, all
new variables defined inside the scope and all changes to existing variables
are forgotten. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">SET_2DA_ENTRY</span><a id="SET_2DA_ENTRY"></a><a id="hevea_default432"></a> <a href="#value"><span class="c003">value</span></a> <a href="#value"><span class="c003">value</span></a> <a href="#value"><span class="c003">value</span></a>
<a href="#value"><span class="c003">value</span></a></td><td class="c014"> The first <a href="#value"><span class="c003">value</span></a> is the row, the second is the column and the
third is the <em>required column count</em>. The entry on the given column
of the given row is set to the fourth <a href="#value"><span class="c003">value</span></a>, but only rows with
at least as many columns as the required column count are considered.
The fourth <a href="#value"><span class="c003">value</span></a>, the new entry, is evaluated specially: if it
can be evaluated like a value (e.g., <span class="c003">‘‘3+4’’</span>) it will be evaluated
and its integer result will be written as an ASCII string. Otherwise if
it is a single string (that is not a variable in scope) that string will
be written at the new value.
See
the <a href="#sec-set-2da-entry"><span class="c003">SET_2DA_ENTRY</span> tutorial</a> for more information. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">SET_2DA_ENTRY_LATER</span><a id="SET_2DA_ENTRY_LATER"></a><a id="hevea_default433"></a> string <a href="#value"><span class="c003">value</span></a> <a href="#value"><span class="c003">value</span></a>
<a href="#value"><span class="c003">value</span></a></td><td class="c014">
Defines an change to a 2DA file to be made at some point in the
future. The change is stored in variables derived from the
first parameter, string. The first two values are the row and column
of the 2DA table to be changed and the third value the new value of
the 2DA entry. Use <a href="#SET_2DA_ENTRIES_NOW"><span class="c003">SET_2DA_ENTRIES_NOW</span></a> to flush the queued
changes and update the 2DA table. If you use
<a href="#SET_2DA_ENTRY_LATER"><span class="c003">SET_2DA_ENTRY_LATER</span></a> together with
<a href="#READ_2DA_ENTRY_FORMER"><span class="c003">READ_2DA_ENTRY_FORMER</span></a> you must use different string
variables for the two. See the <a href="#sec-set-2da-entry-later-now"><span class="c003">SET_2DA_ENTRY_LATER tutorial</span></a>. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">SET_2DA_ENTRIES_NOW</span><a id="SET_2DA_ENTRIES_NOW"></a><a id="hevea_default434"></a> string <a href="#value"><span class="c003">value</span></a></td><td class="c014">
Flush the changes to the 2DA table that have been queued by
<a href="#SET_2DA_ENTRY_LATER"><span class="c003">SET_2DA_ENTRY_LATER</span></a>. The first parameter, string, should be
the same string you used for <a href="#SET_2DA_ENTRY_LATER"><span class="c003">SET_2DA_ENTRY_LATER</span></a>. The second
value is the required column count. Rows with fewer columns are
disregarded. See the <a href="#sec-set-2da-entry-later-now"><span class="c003">SET_2DA_ENTRIES_NOW tutorial</span></a>. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">PRETTY_PRINT_2DA</span><a id="PRETTY_PRINT_2DA"></a><a id="hevea_default435"></a></td><td class="c014">Indents the 3rd line in the current file (which
should be a 2da file). </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">PRETTY_PRINT_2DA</span><a id="hevea_default436"></a> <a href="#value"><span class="c003">value</span></a></td><td class="c014">Indents the value’th line
(counting from 0) in the current file (which should be a 2da file). </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">INSERT_2DA_ROW</span><a id="INSERT_2DA_ROW"></a><a id="hevea_default437"></a> <a href="#value"><span class="c003">value</span></a><span class="c003">1 </span><a href="#value"><span class="c003">value</span></a><span class="c003">2 </span><a href="#String"><span class="c003">String</span></a></td><td class="c014"> String (after variable substitution) will be inserted as a new line in the table.
Value1 is the row count, value2 is the <em>required column count</em>. If row count is
the same as the number of long enough lines in the file, then the line will be inserted
at the end; if row count is lesser than the number of lines, it will be inserted just before
the nth line in the original file (starting count from 0); finally, if row count is greater
than the number of lines, the component will fail to install.
<pre class="verbatim">&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt; ~.../mymod-inlined/2dafile~
asd foo
a b c
d e f
g h i
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
COPY ~.../mymod-inlined/2dafile~ ~.../mymod-inlined/2dafile~
INSERT_2DA_ROW 3 3 ~4 4 4~
INSERT_2DA_ROW 2 3 ~3 3 3~
INSERT_2DA_ROW 1 3 ~2 2 2~
INSERT_2DA_ROW 0 3 ~1 1 1~
</pre>
will result in
<pre class="verbatim">asd foo
1 1 1
a b c
2 2 2
d e f
3 3 3
g h i
4 4 4
</pre> </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">REMOVE_2DA_ROW</span><a id="REMOVE_2DA_ROW"></a><a id="hevea_default438"></a> <a href="#value"><span class="c003">value</span></a><span class="c003">1 </span><a href="#value"><span class="c003">value</span></a><span class="c003">2</span></td><td class="c014"> the Value1-th row from the 2da file containing at least value2 items will be removed.
</td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">PATCH_READLN</span><a id="PATCH_READLN"></a><a id="hevea_default439"></a> <a href="#variable"><span class="c003">variable</span></a></td><td class="c014"> Waits for the user to provided an enter-terminated string and store it in
variable. Said string will be stored and re-used during non-interactive reinstalls. See the
<a href="#sec-readln"><span class="c003">READLN</span> tutorial</a>. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">PATCH_RANDOM_SEED</span><a id="PATCH_RANDOM_SEED"></a><a id="hevea_default440"></a> <a href="#value"><span class="c003">value</span></a></td><td class="c014"> See <a href="#RANDOM_SEED"><span class="c003">RANDOM_SEED</span></a>. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">ADD_STORE_ITEM</span><a id="ADD_STORE_ITEM"></a><a id="hevea_default441"></a> <span class="c002"> [ </span><span class="c003">+</span> <span class="c002"> ] </span>itemName <span class="c002"> [ </span>position <span class="c002"> ] </span>charge1 charge2 charge3 flags stack <span class="c002"> [ </span>unlimited <span class="c002"> ] </span></td><td class="c014">
Add the item itemName to the current STO file. An optional <span class="c003">+</span>
signifies that the new instance of the item should overwrite any
existing instance of the same item. The item’s number of charges are
given by the respective charge argument, which must take the form of
<span class="c003">#</span>integer or <span class="c003">(</span> <a href="#value"><span class="c003">value</span></a> <span class="c003">)</span>. The optional position
argument must be one of <span class="c003">AFTER</span> <a href="#String"><span class="c003">String</span></a>, <span class="c003">BEFORE</span>
<a href="#String"><span class="c003">String</span></a>, <span class="c003">LAST</span>, <span class="c003">FIRST</span> or <span class="c003">AT</span>
<a href="#value"><span class="c003">value</span></a>. <span class="c003">AFTER</span> will place the new item behind the item
given by <a href="#String"><span class="c003">String</span></a>. <span class="c003">BEFORE</span> will place the item before the
item provided by <a href="#String"><span class="c003">String</span></a>. <span class="c003">LAST</span> will place the new item
after all existing items. <span class="c003">FIRST</span> will place the new item as the
first item in the store. <span class="c003">AT</span> will place the new item at the
position given by <a href="#value"><span class="c003">value</span></a>, with the first item having position
0. If no position argument is given, <a href="#ADD_STORE_ITEM"><span class="c003">ADD_STORE_ITEM</span></a> defaults
to <span class="c003">FIRST</span>. The argument flags must be a string consisting of one
of <span class="c003">none</span>, <span class="c003">identified</span>, <span class="c003">unstealable</span>, <span class="c003">stolen</span>,
<span class="c003">identified&amp;stolen</span> or <span class="c003">identified&amp;unstealable</span>. The argument
stack sets the number of item the store carries in the stack and
must take the form of <span class="c003">#</span>integer or <span class="c003">(</span> <a href="#value"><span class="c003">value</span></a>
<span class="c003">)</span>. The optional argument unlimited should be one of the strings
<span class="c003">limited</span> or <span class="c003">unlimited</span> and controls whether the store should
carry an inexhaustible stack of the new item, or not. <span class="c003">limited</span> is
the default behaviour. See the <a href="#sec-add-store-item"><span class="c003">ADD_STORE_ITEM</span> tutorial</a> for
more information. <span class="c007">Note:</span> The patch function <a href="#ADD_STORE_ITEM_EX"><span class="c003">ADD_STORE_ITEM_EX</span></a>
offers similar functionality. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">REMOVE_STORE_ITEM</span><a id="REMOVE_STORE_ITEM"></a><a id="hevea_default442"></a> itmName <span class="c002"> list </span></td><td class="c014"> Remove the listed items from the current store. Does nothing if an item is not for sale.
	Multiple instances are removed. <span class="c007">Note:</span> The patch function
<a href="#REMOVE_STORE_ITEM_EX"><span class="c003">REMOVE_STORE_ITEM_EX</span></a> offers similar functionality. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">READ_2DA_ENTRY</span><a id="READ_2DA_ENTRY"></a><a id="hevea_default443"></a> <a href="#value"><span class="c003">value</span></a> <a href="#value"><span class="c003">value</span></a> <a href="#value"><span class="c003">value</span></a>
<a href="#variable"><span class="c003">variable</span></a></td><td class="c014"> The first <a href="#value"><span class="c003">value</span></a> is the row, the second is the column and the
third is the <em>required column count</em>. The variable specified is set
to the entry on the given column of the given row, but only column
with at least as many columns as the required column count are
considered. This is the reverse of <a href="#SET_2DA_ENTRY"><span class="c003">SET_2DA_ENTRY</span></a>. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">READ_2DA_ENTRIES_NOW</span><a id="READ_2DA_ENTRIES_NOW"></a><a id="hevea_default444"></a> string <a href="#value"><span class="c003">value</span></a></td><td class="c014">
The contents of the 2DA table is read in one go into an array
derived from the first parameter, string. The second parameter,
value, is the required column count. Rows with fewer columns are
disregarded. The parameter string is also used to set a variable
named after string that is set to the number of rows in the 2DA
table with the required number of columns. Retrieve values from the
constructed array with <a href="#READ_2DA_ENTRY_FORMER"><span class="c003">READ_2DA_ENTRY_FORMER</span></a>. If you use
<a href="#READ_2DA_ENTRIES_NOW"><span class="c003">READ_2DA_ENTRIES_NOW</span></a> together with
<a href="#SET_2DA_ENTRY_LATER"><span class="c003">SET_2DA_ENTRY_LATER</span></a> you must use different string variables
for the two. See the <span class="c003">READ_2DA_ENTRIES_NOW</span> tutorial. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">READ_2DA_ENTRY_FORMER</span><a id="READ_2DA_ENTRY_FORMER"></a><a id="hevea_default445"></a> string <a href="#value"><span class="c003">value</span></a> <a href="#value"><span class="c003">value</span></a>
<a href="#variable"><span class="c003">variable</span></a></td><td class="c014">
Retrieves values from an array constructed by
<a href="#READ_2DA_ENTRIES_NOW"><span class="c003">READ_2DA_ENTRIES_NOW</span></a>. The first parameter, string, is the
name of the array. The following two values are the 2DA row and
column from which to read the entry. The value of the 2DA entry is
stored in the last parameter, variable. See the
<span class="c003">READ_2DA_ENTRY_FORMER</span> tutorial. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">COUNT_2DA_ROWS</span><a id="COUNT_2DA_ROWS"></a><a id="hevea_default446"></a> <a href="#value"><span class="c003">value</span></a> <a href="#variable"><span class="c003">variable</span></a></td><td class="c014"> The first <a href="#value"><span class="c003">value</span></a> is the required column count. This command
counts the number of rows in the current file (which should be a
<a href="#2DA"><span class="c003">2DA</span></a> file) that have at least as many columns as the required
column count and stores the result in the variable. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">COUNT_2DA_COLS</span><a id="COUNT_2DA_COLS"></a><a id="hevea_default447"></a> <a href="#variable"><span class="c003">variable</span></a></td><td class="c014"> This command counts the number of columns in the current file (which should be a
<a href="#2DA"><span class="c003">2DA</span></a> file) and stores the result in the variable. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">COUNT_REGEXP_INSTANCES</span><a id="COUNT_REGEXP_INSTANCES"></a><a id="hevea_default448"></a> <a href="#optcase"><span class="c003">optcase</span></a> <a href="#optexact"><span class="c003">optexact</span></a> <a href="#regexp"><span class="c003">regexp</span></a>
<a href="#variable"><span class="c003">variable</span></a></td><td class="c014"> This command counts the number of times regexp appears in the current file
and stores the result in the variable. Variable substitution is performed
on regexp prior to regexp handling (EG, if <code>%var% = ~abc~</code>,
<code>~[%var%]~</code> is evaluated as <code>~[abc]~</code>). </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">LOOKUP_IDS_SYMBOL_OF_INT</span><a id="LOOKUP_IDS_SYMBOL_OF_INT"></a><a id="hevea_default449"></a> variable idsFile <a href="#value"><span class="c003">value</span></a></td><td class="c014"> The symbolic constant associated with <a href="#value"><span class="c003">value</span></a> in idsFile (which may
contain user variables) is stored
in variable. If that doesn’t work, <a href="#value"><span class="c003">value</span></a> is stored in variable.
Example:
<pre class="verbatim">LOOKUP_IDS_SYMBOL_OF_INT foo ~spell~ 1101
SPRINT myfile "SPELL"
LOOKUP_IDS_SYMBOL_OF_INT bar ~%myfile%~ (0x44c + 1)
LOOKUP_IDS_SYMBOL_OF_INT baz ~spell~ 77777
</pre>
Both <span class="c003">foo</span> and <span class="c003">bar</span> are <span class="c003">CLERIC_BLESS</span> while <span class="c003">baz</span> is
<span class="c003">777777</span>. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">COMPILE_BAF_TO_BCS</span><a id="COMPILE_BAF_TO_BCS"></a><a id="hevea_default450"></a></td><td class="c014">Consider using <a href="#DECOMPILE_AND_PATCH"><span class="c003">DECOMPILE_AND_PATCH</span></a> instead.<p>The current file, which must be a valid <a href="#BAF"><span class="c003">BAF</span></a> script, is compiled
to a <a href="#BCS"><span class="c003">BCS</span></a>. In general you should use the <a href="#COMPILE"><span class="c003">COMPILE</span></a>
<a href="#TP2%20Action"><span class="c003">TP2 Action</span></a> instead, unless you are using other <span class="c003">patch</span> commands
to modify the file under consideration. </p></td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">DECOMPILE_BCS_TO_BAF</span><a id="DECOMPILE_BCS_TO_BAF"></a><a id="hevea_default451"></a></td><td class="c014">Consider using <a href="#DECOMPILE_AND_PATCH"><span class="c003">DECOMPILE_AND_PATCH</span></a> instead.<p>The current file, which must be a valid <a href="#BCS"><span class="c003">BCS</span></a> script, is decompiled
to a <a href="#BAF"><span class="c003">BAF</span></a>. </p></td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">DECOMPILE_DLG_TO_D</span><a id="DECOMPILE_DLG_TO_D"></a><a id="hevea_default452"></a></td><td class="c014">Consider using <a href="#DECOMPILE_AND_PATCH"><span class="c003">DECOMPILE_AND_PATCH</span></a> instead.<p>The current file, which must be a valid <a href="#DLG"><span class="c003">DLG</span></a> file, is decompile
to a textual <a href="#D"><span class="c003">D</span></a> file (with string refs and no comments). Once you
have a <a href="#D"><span class="c003">D</span></a> file you can use other <span class="c003">patch</span> commands to change the
actions and triggers around. You should use <a href="#D"><span class="c003">D</span></a> actions (like
<a href="#REPLACE_ACTION_TEXT"><span class="c003">REPLACE_ACTION_TEXT</span></a>) instead whenever possible. </p></td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">COMPILE_D_TO_DLG</span><a id="COMPILE_D_TO_DLG"></a><a id="hevea_default453"></a></td><td class="c014">Consider using <a href="#DECOMPILE_AND_PATCH"><span class="c003">DECOMPILE_AND_PATCH</span></a> instead.<p>The current file, which must be a valid <a href="#D"><span class="c003">D</span></a> file that defines
a single <a href="#DLG"><span class="c003">DLG</span></a> file (via an obvious <a href="#BEGIN"><span class="c003">BEGIN</span></a> action) is
compiled to a <a href="#DLG"><span class="c003">DLG</span></a>. Typically this is only used after a
<a href="#DECOMPILE_DLG_TO_D"><span class="c003">DECOMPILE_DLG_TO_D</span></a>. </p></td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">DECOMPILE_AND_PATCH</span><a id="DECOMPILE_AND_PATCH"></a><a id="hevea_default454"></a> <span class="c003">BEGIN</span> <a href="#patch"><span class="c003">patch</span></a> <span class="c002"> list </span><span class="c003">END</span></td><td class="c014"> Acts like
<pre class="verbatim">DECOMPILE_BCS_TO_BAF // or DLG_TO_D
  patch list
COMPILE_BAF_TO_BCS // or D_TO_DLG
</pre>
except it enforces that the DECOMPILE is followed by the compile,
can indiscriminately patch BCS and DLG files, and is guaranteed not to leave
a decompiled file in the override (if decompiling, patching or recompiling
fails, a warning is printed and the original version of the file is left in
the override).
</td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">REFACTOR_TRIGGER</span><a id="REFACTOR_TRIGGER"></a><a id="hevea_default455"></a> <a href="#optcase"><span class="c003">optcase</span></a> <a href="#optexact"><span class="c003">optexact</span></a> String String</td><td class="c014"> Works like <a href="#REPLACE_TEXTUALLY"><span class="c003">REPLACE_TEXTUALLY</span></a>, except that it only works on triggers
(for both D and BAF files)
and applies Boolean Algebra to ensure that the structure of the trigger is not
broken (like <a href="#REPLACE_TEXTUALLY"><span class="c003">REPLACE_TEXTUALLY</span></a> would do if you are substituting one trigger with
several and the matching trigger is inside an OR() block and/or negated).<p>Caveats:
</p><ul class="itemize"><li class="li-itemize">
this command is very slow, so you should use <a href="#REPLACE_TEXTUALLY"><span class="c003">REPLACE_TEXTUALLY</span></a> if
you are substituting a trigger with another, as well as using <a href="#IF"><span class="c003">IF</span></a> to
	avoid calling this patch on script files that do not contain the trigger
	you are looking for.
</li><li class="li-itemize">the resulting file will have messed up whitespace, so remember that if
you plan on using <a href="#REPLACE_TEXTUALLY"><span class="c003">REPLACE_TEXTUALLY</span></a> later (the file will work correctly
	in-game). Applying another (empty) <a href="#DECOMPILE_AND_PATCH"><span class="c003">DECOMPILE_AND_PATCH</span></a>
will fix this issue.
</li><li class="li-itemize">the searching regexp must match exactly against a single trigger
(so <code>REFACTOR_TRIGGER ~A() B()~ ~C()~</code> or
	<code>REFACTOR_TRIGGER ~A(~ ~C() A(~</code> will not work). The substituting
	string can contain multiple triggers.
</li></ul></td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">REFACTOR_BAF_TRIGGER</span><a id="REFACTOR_BAF_TRIGGER"></a><a id="hevea_default456"></a> <a href="#optcase"><span class="c003">optcase</span></a> <a href="#optexact"><span class="c003">optexact</span></a> String String</td><td class="c014"> Synonym for <a href="#REFACTOR_TRIGGER"><span class="c003">REFACTOR_TRIGGER</span></a>.
</td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">REFACTOR_D_TRIGGER</span><a id="REFACTOR_D_TRIGGER"></a><a id="hevea_default457"></a> <a href="#optcase"><span class="c003">optcase</span></a> <a href="#optexact"><span class="c003">optexact</span></a> String String</td><td class="c014"> Synonym for <a href="#REFACTOR_TRIGGER"><span class="c003">REFACTOR_TRIGGER</span></a>.
</td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">REPLACE_EVALUATE</span><a id="REPLACE_EVALUATE"></a><a id="hevea_default458"></a> <a href="#optcase"><span class="c003">optcase</span></a> findRegexp <span class="c003">BEGIN</span>
<a href="#patch"><span class="c003">patch</span></a> <span class="c002"> list </span><span class="c003">END</span> replaceRegexp</td><td class="c014">
For every instance of the <a href="#regexp"><span class="c003">regexp</span></a> findRegexp found, the
<a href="#patch"><span class="c003">patch</span></a> list is evaluated (with the variable <span class="c003">MATCH</span><span class="c006">i</span> set
to the <span class="c006">i</span>th matched group in findRegexp), variable substitution is
performed on replaceRegexp, and then findRegexp is replaced by
replaceRegexp. Note that <a href="#REPLACE_EVALUATE"><span class="c003">REPLACE_EVALUATE</span></a> defines up to 200
<span class="c003">MATCH</span><span class="c006">i</span> variables, but that <span class="c003">MATCH1</span> is normally the variable
matching the first group in findRegexp. Due to details of the
implementation, <span class="c003">MATCH0</span> normally evaluates to the string matched
by the whole of findRegexp. Any writes done by the <a href="#patch"><span class="c003">patch</span></a>
list (e.g., <a href="#SAY"><span class="c003">SAY</span></a> or <a href="#WRITE_ASCII"><span class="c003">WRITE_ASCII</span></a>) are ignored:
<a href="#SET"><span class="c003">SET</span></a> should be the main component of the <a href="#patch"><span class="c003">patch</span></a>
list. For example:
<pre class="verbatim">COPY ~nice.baf~ ~mean.baf~
  REPLACE_EVALUATE
    ~Give(\([0-9]+\),\([0-9]+\))~
    BEGIN
      SET result = (MATCH1 + MATCH2) / 2
    END
    ~Take(%result%)~
</pre>
This <a href="#COPY"><span class="c003">COPY</span></a> <a href="#TP2%20Action"><span class="c003">TP2 Action</span></a> would replace <span class="c003">Give(10,20)</span>
with <span class="c003">Take(15)</span>. optcase allows you to decide if the matching is
case-sensitive or not. Matching is case-sensitive by default. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">ADD_GAM_NPC</span><a id="ADD_GAM_NPC"></a><a id="hevea_default459"></a> npcCRE npcARE xCoord yCoord</td><td class="c014"> See the <a href="#sec-add-gam-npc"><span class="c003">ADD_GAM_NPC</span> tutorial</a> for more information about this
action, which is used when adding NPCs to Baldur’s Gate 1. BG2 mods
should not use this command. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">ADD_MAP_NOTE</span><a id="ADD_MAP_NOTE"></a><a id="hevea_default460"></a> xCoord yCoord color <a href="#String"><span class="c003">String</span></a></td><td class="c014"> If the file currently being patched is an <a href="#ARE"><span class="c003">ARE</span></a> area file, this
patch command adds a map note to it. Valid colors include: gray,
violent, green, orange, red, blue, darkblue, lightgray.
Example:
<pre class="verbatim">COPY_EXISTING ~ar0202.are~ ~override/ar0202.are~
  ADD_MAP_NOTE #123 #777 ~violet~
  ~This is my new map note!  Yippee!~
</pre>
Special thanks to Japh for coding this feature. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">ADD_KNOWN_SPELL</span><a id="ADD_KNOWN_SPELL"></a><a id="hevea_default461"></a> splName spellLevel spellType</td><td class="c014"> When applied to a CRE file, this <a href="#patch"><span class="c003">patch</span></a> causes the given spell to
be known. Note that spellLevel counts from 0 (e.g., you should say
<span class="c003">#2</span> for a third-level Fireball). Possible values for spellType are
<span class="c003">priest</span>, <span class="c003">innate</span> and <span class="c003">wizard</span>. Example:
<pre class="verbatim">COPY_EXISTING ~some.cre~ ~override/some.cre~
  ADD_KNOWN_SPELL ~SPPR314~ #2 ~priest~
  // Unholy Blight is now known as a 3rd level priest spell
</pre>
Special thanks to Japh for coding this feature. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">ADD_MEMORIZED_SPELL</span><a id="ADD_MEMORIZED_SPELL"></a><a id="hevea_default462"></a> splName spellLevel spellType
<span class="c002"> [ </span><span class="c003">(</span> <a href="#value"><span class="c003">value</span></a> <span class="c003">)</span> <span class="c002"> ] </span></td><td class="c014">
When applied to a CRE file, this <a href="#patch"><span class="c003">patch</span></a> causes the given
spell to be memorized one more time (or value times if
specified). The spell is additionally added to the creature’s list
of known spells. Note that spellLevel counts from 0 (e.g., you
should say <span class="c003">#2</span> for a third-level Fireball). Possible values for
spellType are <span class="c003">priest</span>, <span class="c003">innate</span> and <span class="c003">wizard</span>. Example:<pre class="verbatim">COPY_EXISTING ~some.cre~ ~override/some.cre~
  ADD_MEMORIZED_SPELL ~SPPR314~ #2 ~priest~ ( 5 )
  // Unholy Blight is now memorized five times as 3rd priest
</pre></td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">REMOVE_KNOWN_SPELL</span><a id="REMOVE_KNOWN_SPELL"></a><a id="hevea_default463"></a> splName <span class="c002"> list </span></td><td class="c014"> When applied to a CRE file, this <a href="#patch"><span class="c003">patch</span></a> causes all of the
listed spells to be removed. Example:
<pre class="verbatim">COPY_EXISTING ~aerie.cre~ ~override/aerie.cre~
  REMOVE_KNOWN_SPELL ~sppr101~ ~sppr102~
</pre>
Special thanks to Japh for coding this feature. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">REMOVE_MEMORIZED_SPELL</span><a id="REMOVE_MEMORIZED_SPELL"></a><a id="hevea_default464"></a> splName <span class="c002"> list </span></td><td class="c014"> When applied to a CRE file, this <a href="#patch"><span class="c003">patch</span></a> causes all of the
listed spells to be removed from their memory. Example:
<pre class="verbatim">COPY_EXISTING ~aerie.cre~ ~override/aerie.cre~
  REMOVE_MEMORIZED_SPELL ~sppr101~ ~sppr102~
</pre>
</td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">SET_BG2_PROFICIENCY</span><a id="SET_BG2_PROFICIENCY"></a><a id="hevea_default465"></a> String <a href="#value"><span class="c003">value</span></a></td><td class="c014">	Removes all effects from the current CRE file that alter the proficiency specified by
	String (relative to Stats.ids). After that, if value is different from zero, add an effect
	to set said proficiency to value. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">ADD_CRE_ITEM</span><a id="ADD_CRE_ITEM"></a><a id="hevea_default466"></a> itmName charge1 charge2 charge3 flags slot <span class="c002"> [ </span><span class="c003">EQUIP</span> <span class="c002"> ]  [ </span><span class="c003">TWOHANDED</span> <span class="c002"> ]  [ </span><span class="c003">NOMOVE</span> <span class="c002"> ] </span></td><td class="c014">
Add the item itmName to the current CRE file, with the number of
charges determined by charge1, charge2 and charge3, respectively. Each
charge should be an integer, either in the form of <span class="c003">#</span>integer or
<span class="c003">(</span> <a href="#value"><span class="c003">value</span></a> <span class="c003">)</span>. The argument flags must be a string
consisting of one of <span class="c003">none</span>, <span class="c003">identified</span>, <span class="c003">unstealable</span>,
<span class="c003">stolen</span>, <span class="c003">undroppable</span>, <span class="c003">identified&amp;stolen</span>,
<span class="c003">identified&amp;unstealable</span>, <span class="c003">identified&amp;undroppable</span>,
<span class="c003">unstealable&amp;undroppable</span>, <span class="c003">stolen&amp;undroppable</span>,
<span class="c003">identified&amp;stolen&amp;undroppable</span>,
<span class="c003">identified&amp;unstealable&amp;undroppable</span>. The argument slot should be
a whitespace-separated list of entries chosen from <span class="c003">helmet</span>,
<span class="c003">armor</span>, <span class="c003">shield</span>, <span class="c003">gloves</span>, <span class="c003">lring</span>, <span class="c003">rring</span>, <span class="c003">amulet</span>,
<span class="c003">belt</span>, <span class="c003">boots</span>, <span class="c003">weapon1</span>, <span class="c003">weapon2</span>, <span class="c003">weapon3</span>,
<span class="c003">weapon4</span>, <span class="c003">quiver1</span>, <span class="c003">quiver2</span>, <span class="c003">quiver3</span>, <span class="c003">quiver4</span>,
<span class="c003">cloak</span>, <span class="c003">qitem1</span>, <span class="c003">qitem2</span>, <span class="c003">qitem3</span>, <span class="c003">inv1</span>, <span class="c003">inv2</span>,
<span class="c003">inv3</span>, <span class="c003">inv4</span>, <span class="c003">inv5</span>, <span class="c003">inv6</span>, <span class="c003">inv7</span>, <span class="c003">inv8</span>, <span class="c003">inv9</span>,
<span class="c003">inv10</span>, <span class="c003">inv11</span>, <span class="c003">inv12</span>, <span class="c003">inv13</span>, <span class="c003">inv14</span>, <span class="c003">inv15</span>,
<span class="c003">inv16</span>. On PST, there are the additional slots <span class="c003">tattoo1</span>,
<span class="c003">tattoo2</span>, <span class="c003">tattoo3</span>, <span class="c003">earring1</span>, <span class="c003">earring2</span>, <span class="c003">inv17</span>,
<span class="c003">inv18</span>, <span class="c003">inv19</span> and <span class="c003">inv20</span>. On IWD2, there are the additional
slots <span class="c003">shield1</span>, <span class="c003">shield2</span>, <span class="c003">shield3</span>, <span class="c003">shield4</span>, <span class="c003">inv17</span>,
<span class="c003">inv18</span>, <span class="c003">inv19</span>, <span class="c003">inv20</span>, <span class="c003">inv21</span>, <span class="c003">inv22</span>, <span class="c003">inv23</span> and
<span class="c003">inv24</span>. <a href="#ADD_CRE_ITEM"><span class="c003">ADD_CRE_ITEM</span></a> will add the item to the first empty slot in
the list. If no slot is empty, the item will be placed in the first
slot in the list and the item that previously occupied the slot will
be moved to the general inventory. If the general inventory is full,
the moved item will be discarded. Additionally, slot may contain one
or more entries chosen from <span class="c003">inv</span>, <span class="c003">qitem</span>, <span class="c003">quiver</span>,
<span class="c003">weapon</span>, <span class="c003">ring</span>. These entries unfold to the full range of
corresponding slots. For example, <span class="c003">qitem</span> unfolds to <span class="c003">qitem1</span>,
<span class="c003">qitem2</span> and <span class="c003">qitem3</span>. On PST, you may additionally use <span class="c003">tattoo</span>
and <span class="c003">earring</span>. On IWD2, you may additionally use <span class="c003">shield</span>. The
optional argument <span class="c003">EQUIP</span> only applies to the weapon slots only and
will make the creature have the weapon selected. The optional argument
<span class="c003">TWOHANDED</span> also only applies to weapon slots and will cause items
in the shield slot to be unequipped. The optional argument <span class="c003">NOMOVE</span>
will cause the new item to be added to the specified slot(s) only if
there is an empty slot, otherwise the new item is placed in the
inventory. See <a href="#sec-add-cre-item"><span class="c003">ADD_CRE_ITEM</span> tutorial</a>. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">REPLACE_CRE_ITEM</span><a id="REPLACE_CRE_ITEM"></a><a id="hevea_default467"></a> itmName <span class="c003">#</span>charge1 <span class="c003">#</span>charge2 <span class="c003">#</span>charge3 flags slot <span class="c002"> [ </span><span class="c003">EQUIP</span> <span class="c002"> ]  [ </span><span class="c003">TWOHANDED</span> <span class="c002"> ] </span></td><td class="c014"> If there’s an item in the slot position, replace it; otherwise, process <a href="#ADD_CRE_ITEM"><span class="c003">ADD_CRE_ITEM</span></a> </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">REMOVE_CRE_ITEM</span><a id="REMOVE_CRE_ITEM"></a><a id="hevea_default468"></a> itmName <span class="c002"> list </span></td><td class="c014"> Remove the listed items from the current creature. Does nothing if an item is not possessed.
	Multiple instances are removed. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">REMOVE_CRE_ITEMS</span><a id="REMOVE_CRE_ITEMS"></a><a id="hevea_default469"></a></td><td class="c014"> Remove all items from the current creature. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">REMOVE_CRE_EFFECTS</span><a id="REMOVE_CRE_EFFECTS"></a><a id="hevea_default470"></a></td><td class="c014"> Remove all effects from the current creature. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">REMOVE_KNOWN_SPELLS</span><a id="REMOVE_KNOWN_SPELLS"></a><a id="hevea_default471"></a></td><td class="c014"> Remove all known spells from the current creature. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">REMOVE_MEMORIZED_SPELLS</span><a id="REMOVE_MEMORIZED_SPELLS"></a><a id="hevea_default472"></a></td><td class="c014"> Remove all memorized spells from the current creature. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">PATCH_SILENT</span><a id="PATCH_SILENT"></a><a id="hevea_default473"></a></td><td class="c014">makes WeiDU skip all messages; it’s reenabled once a component
is installed (or fails to), or a <a href="#PRINT"><span class="c003">PRINT</span></a>, <a href="#PATCH_PRINT"><span class="c003">PATCH_PRINT</span></a>,
<a href="#VERBOSE"><span class="c003">VERBOSE</span></a> or <a href="#PATCH_VERBOSE"><span class="c003">PATCH_VERBOSE</span></a> is found. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">PATCH_VERBOSE</span><a id="PATCH_VERBOSE"></a><a id="hevea_default474"></a></td><td class="c014">undoes the latest <a href="#SILENT"><span class="c003">SILENT</span></a> or <a href="#PATCH_SILENT"><span class="c003">PATCH_SILENT</span></a> command. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">INNER_PATCH</span><a id="INNER_PATCH"></a><a id="hevea_default475"></a> buffString <span class="c003">BEGIN</span> <a href="#patch"><span class="c003">patch</span></a> <span class="c002"> list </span><span class="c003">END</span></td><td class="c014"> Any WeiDU variables inside <span class="c003">%</span>s within buffString are replaced by
their values. All of the <a href="#patch"><span class="c003">patch</span></a>es given are evaluated as if the
contents of the current file were buffString. Any modifications to
buffString are thrown away (making this mostly useful for reads).
Example:
<pre class="verbatim">INNER_PATCH "ABC" BEGIN
  READ_BYTE 0x2 "myvar"
END
PATCH_PRINT "myvar is %myvar%"
</pre>
This sequence will always print <span class="c003">myvar is 67</span> (since 67 is the ASCII
code for <span class="c003">C</span>). </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">INNER_PATCH_SAVE</span><a id="INNER_PATCH_SAVE"></a><a id="hevea_default476"></a> savevar buffString <span class="c003">BEGIN</span> <a href="#patch"><span class="c003">patch</span></a> <span class="c002"> list </span><span class="c003">END</span></td><td class="c014"> As with <a href="#INNER_PATCH"><span class="c003">INNER_PATCH</span></a>, except that any modifications to buffString are stored inside
savevar.
Example:
<pre class="verbatim">SPRINT foo "ABC"
INNER_PATCH_SAVE bar "%foo%" BEGIN
  WRITE_BYTE 0x2 65
END
PATCH_PRINT "foo is %foo%, bar is %bar%"
</pre>
This sequence will always print <span class="c003">foo is ABC, bar is ABA </span> (since 65 is the ASCII
code for <span class="c003">A</span>). </td></tr>
<tr><td class="c012"> or</td><td class="c014"><span class="c005">INNER_PATCH_FILE</span><a id="INNER_PATCH_FILE"></a><a id="hevea_default477"></a> resource <span class="c003">BEGIN</span> <a href="#patch"><span class="c003">patch</span></a> <span class="c002"> list </span><span class="c003">END</span></td><td class="c014"> Any WeiDU variables inside <span class="c003">%</span>s within resource are replaced by
their values. If the resulting resource is present in the game or in the
override folder, the <a href="#patch"><span class="c003">patch</span></a>es given are evaluated as if the
current file were that resource. If not, nothing happens. Any
modifications to that resource are thrown away (making this mostly useful
for reads).
Example:
<pre class="verbatim">INNER_PATCH_FILE "SW1H01.ITM" BEGIN
  READ_BYTE 0x1 "myvar"
END
PATCH_PRINT "myvar is %myvar%"
</pre>
This sequence will always print <span class="c003">myvar is 84</span> (since 84 is the ASCII
code for <span class="c003">T</span> and <span class="c003">SW1H01.ITM</span> starts with <span class="c003">ITM</span>). </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">INNER_ACTION</span><a id="INNER_ACTION"></a><a id="hevea_default478"></a> <span class="c003">BEGIN</span> <a href="#TP2%20Action"><span class="c003">TP2 Action</span></a> <span class="c002"> list </span><span class="c003">END</span></td><td class="c014"> See the <a href="#sec-inner-action"><span class="c003">INNER_ACTION</span> tutorial</a>, but loosely the current
<a href="#COPY"><span class="c003">COPY</span></a> is paused, the given <a href="#TP2%20Action"><span class="c003">TP2 Action</span></a>s are executed, and
then the current <a href="#COPY"><span class="c003">COPY</span></a> is resumed. <em>Note that an
</em><a href="#INNER_ACTION"><span class="c003"><em>INNER_ACTION</em></span></a><em> should never modify a file that is being modified by
the current action. For example, never put <span class="c003">APPEND  foo.2da </span> inside of
<span class="c003">COPY_EXISTING  foo.2da </span>. More formally, if the inner action and the
outer action both modify the same file, the results are undefined.</em></td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">EDIT_SAV_FILE</span><a id="EDIT_SAV_FILE"></a><a id="hevea_default479"></a> level <span class="c002"> [ </span><span class="c003">ADD_IF_MISSING</span> <span class="c002"> ]  [ </span>filename <span class="c002"> list  ] </span><span class="c003">BEGIN</span> <a href="#TP2%20Patch"><span class="c003">TP2 Patch</span></a> <span class="c002"> list </span><span class="c003">END</span></td><td class="c014">
The current file should be a <span class="c003">SAV</span> file. <a href="#EDIT_SAV_FILE"><span class="c003">EDIT_SAV_FILE</span></a>
will iterate over the files contained within the <span class="c003">SAV</span> file, set
the variable <span class="c003">SAV_FILE</span> to the name of the current file and
evaluate the patch list against the decompressed contents of
<span class="c003">SAV_FILE</span>. The file contents are then recompressed into the
<span class="c003">SAV</span> file using the specified compression level. level can be 0
to 9, where 0 means no compression, 1 is the fastest compression and
9 is the best compression.<p>If the list of filenames is non-empty, only files whose name appear
in that list are patched (the comparison is case-insensitive,
variables and arrays are parsed if using <a href="#EVALUATE_BUFFER"><span class="c003">EVALUATE_BUFFER</span></a> or
<a href="#AUTO_EVAL_STRINGS"><span class="c003">AUTO_EVAL_STRINGS</span></a>). If the optional <span class="c003">ADD_IF_MISSING</span> is
provided, the file will be loaded if it exists (determined with
<a href="#FILE_EXISTS_IN_GAME"><span class="c003">FILE_EXISTS_IN_GAME</span></a>) and the patches are applied. If the
file does not exist, the patches will instead be applied to the
empty buffer. The resulting file is added to the SAV itself.</p></td></tr>
<tr><td class="c012"> or</td><td class="c014"><span class="c005">DECOMPRESS_REPLACE_FILE</span><a id="DECOMPRESS_REPLACE_FILE"></a><a id="hevea_default480"></a> start length uncompressedlength</td><td class="c014">	Decompress (ZLIB) the <code>start...start+length-1</code> portion of the current
	file (requires to specify the uncompressed length as well). The result overwrites
	the current file. It’s equivalent to
	<code>DECOMPRESS_INTO_FILE start length uncompressedlength 0 BUFFER_LENGTH</code>
</td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">DECOMPRESS_INTO_FILE</span><a id="DECOMPRESS_INTO_FILE"></a><a id="hevea_default481"></a> start length uncompressedlength overwritefrom
overwriteto</td><td class="c014">	Decompress (ZLIB) the <code>start...start+length-1</code> portion of the current
	file (requires to specify the uncompressed length as well). The result overwrites
	the overwritefrom...overwriteto-1 portion of the current file.
</td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">DECOMPRESS_INTO_VAR</span><a id="DECOMPRESS_INTO_VAR"></a><a id="hevea_default482"></a> start length uncompressedlength varName</td><td class="c014">	Decompress (ZLIB) the <code>start...start+length-1</code> portion of the current
	file (requires to specify the uncompressed length as well). The result is stored
	into varName.
</td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">COMPRESS_REPLACE_FILE</span><a id="COMPRESS_REPLACE_FILE"></a><a id="hevea_default483"></a> start length level</td><td class="c014">	Compress (ZLIB) the <code>start...start+length-1</code> portion of the current
	file (level is 0 to 9; 0 means don’t compress, 1 is fastest compression, 9 is best
	compression). The result overwrites
	the current file. It’s equivalent to
	<code>DECOMPRESS_INTO_FILE start length uncompressedlength 0 BUFFER_LENGTH</code>
</td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">COMPRESS_INTO_FILE</span><a id="COMPRESS_INTO_FILE"></a><a id="hevea_default484"></a> start length level overwritefrom
overwriteto</td><td class="c014">	Compress (ZLIB) the <code>start...start+length-1</code> portion of the current
	file (level is 0 to 9; 0 means don’t compress, 1 is fastest compression, 9 is best
	compression). The result overwrites
	the overwritefrom...overwriteto-1 portion of the current file.
</td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">COMPRESS_INTO_VAR</span><a id="COMPRESS_INTO_VAR"></a><a id="hevea_default485"></a> start length level varName</td><td class="c014">	Compress (ZLIB) the <code>start...start+length-1</code> portion of the current
	file (level is 0 to 9; 0 means don’t compress, 1 is fastest compression, 9 is best
	compression). The result is stored into varName.
</td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">LAUNCH_PATCH_MACRO</span><a id="LAUNCH_PATCH_MACRO"></a><a id="hevea_default486"></a> <a href="#String"><span class="c003">String</span></a></td><td class="c014"> Launch a patch macro. Refer to the <a href="#macros"><span class="c003">macros</span></a> section for
additional information. You may use <span class="c005">LPM</span><a id="LPM"></a><a id="hevea_default487"></a> as a synonym
for <a href="#LAUNCH_PATCH_MACRO"><span class="c003">LAUNCH_PATCH_MACRO</span></a>.
</td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">LAUNCH_PATCH_FUNCTION</span><a id="LAUNCH_PATCH_FUNCTION"></a><a id="hevea_default488"></a> <a href="#String"><span class="c003">String</span></a>
<span class="c002"> [ </span><span class="c003">INT_VAR</span> <a href="#variable"><span class="c003">variable</span></a> <span class="c002"> [ </span><span class="c003">=</span> <a href="#value"><span class="c003">value</span></a> <span class="c002"> ] </span>... <span class="c002"> ]  [ </span><span class="c003">STR_VAR</span> <a href="#variable"><span class="c003">variable</span></a> <span class="c002"> [ </span><span class="c003">=</span> <span class="c002"> [ </span><a href="#EVALUATE_BUFFER"><span class="c003">EVALUATE_BUFFER</span></a>
<span class="c002"> ] </span><a href="#String"><span class="c003">String</span></a> <span class="c002"> ] </span>... <span class="c002"> ]  [ </span><span class="c003">RET</span> <a href="#variable"><span class="c003">variable</span></a> <span class="c002"> [ </span><span class="c003">=</span> <a href="#String"><span class="c003">String</span></a> <span class="c002"> ] </span>... <span class="c002"> ]  [ </span><span class="c003">RET_ARRAY</span> <a href="#variable"><span class="c003">variable</span></a> <span class="c002"> [ </span><span class="c003">=</span> <a href="#String"><span class="c003">String</span></a> <span class="c002"> ] </span>... <span class="c002"> ] </span><span class="c003">END</span></td><td class="c014"> Launch a patch function. Refer to the <a href="#sec-functions"><span class="c003">Functions</span></a> section for
additional information. You may use <span class="c005">LPF</span><a id="LPF"></a><a id="hevea_default489"></a> as a synonym
for <a href="#LAUNCH_PATCH_FUNCTION"><span class="c003">LAUNCH_PATCH_FUNCTION</span></a>.
</td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">PATCH_TIME</span><a id="PATCH_TIME"></a><a id="hevea_default490"></a> <a href="#String"><span class="c003">String</span></a> <span class="c003">BEGIN</span> <a href="#patch"><span class="c003">patch</span></a>
<span class="c002"> list </span><span class="c003">END</span></td><td class="c014"> Measure the time taken to execute the <a href="#patch"><span class="c003">patch</span></a>es and report
it under the label <a href="#String"><span class="c003">String</span></a> together with the other time
measurements at the end of the mod’s debug file.
</td></tr>
<tr><td class="c012">&nbsp;</td></tr>
<tr><td class="c012">
<span class="c005">when</span><a id="when"></a><a id="hevea_default491"></a></td><td class="c014">&nbsp;</td><td class="c014">A <a href="#when"><span class="c003">when</span></a> clause gives you local control over when a
<a href="#COPY"><span class="c003">COPY</span></a>, <a href="#COPY_EXISTING"><span class="c003">COPY_EXISTING</span></a> or <a href="#APPEND_COL"><span class="c003">APPEND_COL</span></a> happens. If the
<a href="#COPY"><span class="c003">COPY</span></a> or <a href="#COPY_EXISTING"><span class="c003">COPY_EXISTING</span></a> contains multiple files, each one
is checked against the <a href="#when"><span class="c003">when</span></a> clauses separately. </td></tr>
<tr><td class="c012">is</td><td class="c014"><span class="c005">IF_SIZE_IS</span><a id="IF_SIZE_IS"></a><a id="hevea_default492"></a> fileSize</td><td class="c014">True if the input file size is
fileSize. You may use <span class="c005">I_S_I</span><a id="I_S_I"></a><a id="hevea_default493"></a> as a synonym for <a href="#IF_SIZE_IS"><span class="c003">IF_SIZE_IS</span></a>. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">IF</span><a id="IF"></a><a id="hevea_default494"></a> <a href="#regexp"><span class="c003">regexp</span></a></td><td class="c014">True if the input file contains
<a href="#regexp"><span class="c003">regexp</span></a>. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">UNLESS</span><a id="UNLESS"></a><a id="hevea_default495"></a> <a href="#regexp"><span class="c003">regexp</span></a></td><td class="c014">False if the input file contains
<a href="#regexp"><span class="c003">regexp</span></a>. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">BUT_ONLY_IF_IT_CHANGES</span><a id="BUT_ONLY_IF_IT_CHANGES"></a><a id="hevea_default496"></a></td><td class="c014">True only if the file is actually
changed by patching actions. Unlike all other <a href="#when"><span class="c003">when</span></a> clauses, this
one is evaluated just before the result would be written out to the disk.
You may use <span class="c005">BUT_ONLY</span><a id="BUT_ONLY"></a><a id="hevea_default497"></a> as a synonym for <a href="#BUT_ONLY_IF_IT_CHANGES"><span class="c003">BUT_ONLY_IF_IT_CHANGES</span></a>. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">IF_EXISTS</span><a id="IF_EXISTS"></a><a id="hevea_default498"></a></td><td class="c014">
True only if the file exists. For <a href="#COPY"><span class="c003">COPY</span></a>, this check is done
with <a href="#FILE_EXISTS"><span class="c003">FILE_EXISTS</span></a>. For <a href="#COPY_EXISTING"><span class="c003">COPY_EXISTING</span></a>,
<a href="#COPY_EXISTING_REGEXP"><span class="c003">COPY_EXISTING_REGEXP</span></a>, <a href="#COPY_RANDOM"><span class="c003">COPY_RANDOM</span></a>, <span class="c003">APPEND</span> and
<a href="#APPEND_COL"><span class="c003">APPEND_COL</span></a> this check is done with
<a href="#FILE_EXISTS_IN_GAME"><span class="c003">FILE_EXISTS_IN_GAME</span></a>. For <a href="#COPY_ALL_GAM_FILES"><span class="c003">COPY_ALL_GAM_FILES</span></a>, this when
clause is redundant. </td></tr>
<tr><td class="c012">&nbsp;</td></tr>
<tr><td class="c012">
<span class="c005">offset</span><a id="offset"></a><a id="hevea_default499"></a></td><td class="c014">&nbsp;</td><td class="c014">A <a href="#offset"><span class="c003">offset</span></a> is a normal <a href="#value"><span class="c003">value</span></a>.
</td></tr>
<tr><td class="c012">&nbsp;</td></tr>
<tr><td class="c012"> <span class="c005">value</span><a id="value"></a><a id="hevea_default500"></a></td><td class="c014">&nbsp;</td><td class="c014">An expression that evaluates to an integer. See
<a href="#--debug-value"><span class="c003">--debug-value</span></a>. </td></tr>
<tr><td class="c012">is</td><td class="c014">integer</td><td class="c014">An absolute location or amount. You may format your numbers
in decimal, hex, octal or binary. Use 0x for hex, 0o for octal and 0b for
binary. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c003">(</span> <a href="#value"><span class="c003">value</span></a> <span class="c003">)</span></td><td class="c014">&nbsp;</td></tr>
<tr><td class="c012">or</td><td class="c014"><a href="#value"><span class="c003">value</span></a> <span class="c003">+</span> <a href="#value"><span class="c003">value</span></a></td><td class="c014">Addition. </td></tr>
<tr><td class="c012">or</td><td class="c014"><a href="#value"><span class="c003">value</span></a> <span class="c003">-</span> <a href="#value"><span class="c003">value</span></a></td><td class="c014">Subtraction. </td></tr>
<tr><td class="c012">or</td><td class="c014"><a href="#value"><span class="c003">value</span></a> <span class="c003">*</span> <a href="#value"><span class="c003">value</span></a></td><td class="c014">Multiplication. </td></tr>
<tr><td class="c012">or</td><td class="c014"><a href="#value"><span class="c003">value</span></a> <span class="c003">/</span> <a href="#value"><span class="c003">value</span></a></td><td class="c014">Division. Division by zero yields
the value zero. Briefly, fractions are dropped and the result is an integer
(so 11 / 6 = 1). More technically, “this division rounds the real quotient
of its arguments towards zero” -- see
<a href="http://caml.inria.fr/pub/docs/manual-ocaml/libref/Pervasives.html"><span class="c003">http://caml.inria.fr/pub/docs/manual-ocaml/libref/Pervasives.html</span></a>
for more information.
</td></tr>
<tr><td class="c012">or</td><td class="c014"><a href="#value"><span class="c003">value</span></a> <span class="c005">MODULO</span><a id="MODULO"></a><a id="hevea_default501"></a> <a href="#value"><span class="c003">value</span></a></td><td class="c014">An operation that
returns the remainder of a division between two numbers. If the second
value is 0, the returned value is 0. You may use <span class="c003">REM as a synonym. </span></td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">BYTE_AT</span><a id="BYTE_AT"></a><a id="hevea_default502"></a> <a href="#offset"><span class="c003">offset</span></a></td><td class="c014"> The 8-bit value from the file at the given <a href="#offset"><span class="c003">offset</span></a>. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">SBYTE_AT</span><a id="SBYTE_AT"></a><a id="hevea_default503"></a> <a href="#offset"><span class="c003">offset</span></a></td><td class="c014"> The 8-bit signed value from the file at the given <a href="#offset"><span class="c003">offset</span></a>. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">SHORT_AT</span><a id="SHORT_AT"></a><a id="hevea_default504"></a> <a href="#offset"><span class="c003">offset</span></a></td><td class="c014"> The 16-bit value from the file at the given <a href="#offset"><span class="c003">offset</span></a>. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">SSHORT_AT</span><a id="SSHORT_AT"></a><a id="hevea_default505"></a> <a href="#offset"><span class="c003">offset</span></a></td><td class="c014"> The 16-bit signed value from the file at the given <a href="#offset"><span class="c003">offset</span></a>. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">LONG_AT</span><a id="LONG_AT"></a><a id="hevea_default506"></a> <a href="#offset"><span class="c003">offset</span></a></td><td class="c014"> The 32-bit value from the file at the given <a href="#offset"><span class="c003">offset</span></a>. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">SLONG_AT</span><a id="SLONG_AT"></a><a id="hevea_default507"></a> <a href="#offset"><span class="c003">offset</span></a></td><td class="c014"> The 32-bit signed value from the file at the given <a href="#offset"><span class="c003">offset</span></a>. </td></tr>
<tr><td class="c012">or</td><td class="c014"><a href="#value"><span class="c003">value</span></a> <span class="c005">**</span><a id="**"></a><a id="hevea_default508"></a> <a href="#value"><span class="c003">value</span></a></td><td class="c014">Exponentiation. The first
value is raised to the power of the second. This is done by converting both
to floating point numbers, calculating the exponent, and converting the
answer back to a 32-bit integer. If anything goes wrong the value zero is
returned or the result is undefined. </td></tr>
<tr><td class="c012">or</td><td class="c014"><a href="#value"><span class="c003">value</span></a> <span class="c005">**</span><a id="hevea_default509"></a> <span class="c003">(</span> <a href="#value"><span class="c003">value</span></a> <a href="#value"><span class="c003">value</span></a> <span class="c003">)</span></td><td class="c014"> Fractional exponentiation. <span class="c003">a ** (b c)</span> yields <span class="c003">a</span> raised to the
power of <span class="c003">(b/c)</span>. All of the internal operations are done in floating
point. If anything goes wrong, zero is returned or the result is
undefined. Example:
<pre class="verbatim">SET x = 100 ** 2
SET y = 100 ** (1 2) // square root of 100 = 10
SET z = 100 ** (1 3) // cube root of 100 = 4.64
PATCH_PRINT "w = %w%, x = %x%, y = %y%, z = %z%"
</pre>
yields <span class="c003">x = 10000, y = 10, z = 4</span>. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><a href="#value"><span class="c003">value</span></a> <span class="c005">=</span><a id="="></a><a id="hevea_default510"></a> <a href="#value"><span class="c003">value</span></a></td><td class="c014"><em>Integer</em> Equality. If the two
values evaluate to equal integers, the result is 1. Otherwise, the result
is 0. See <a href="#STRING_COMPARE"><span class="c003">STRING_COMPARE</span></a> for comparing <a href="#String"><span class="c003">String</span></a>s. Synonym:
<span class="c005">==</span><a id="hevea_default511"></a>.
</td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">NOT</span><a id="NOT"></a><a id="hevea_default512"></a> <a href="#value"><span class="c003">value</span></a></td><td class="c014">Negation. If the value is 0, the result is 1.
Otherwise the result is 0. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">ABS</span><a id="ABS"></a><a id="hevea_default513"></a> <a href="#value"><span class="c003">value</span></a></td><td class="c014">Absolute value. If the value is &gt;= 0, the result
is x. Otherwise the result is -x. </td></tr>
<tr><td class="c012">or</td><td class="c014"><a href="#value"><span class="c003">value</span></a> <span class="c005">!=</span><a id="!="></a><a id="hevea_default514"></a> <a href="#value"><span class="c003">value</span></a></td><td class="c014"><em>Integer</em> Inequality. If
the two values evaluate to equal integers, the result is 0. Otherwise the
result is 1. See <a href="#STRING_COMPARE"><span class="c003">STRING_COMPARE</span></a> for comparing <a href="#String"><span class="c003">String</span></a>s. </td></tr>
<tr><td class="c012">or</td><td class="c014"><a href="#value"><span class="c003">value</span></a> <span class="c005">OR</span><a id="OR"></a><a id="hevea_default515"></a> <a href="#value"><span class="c003">value</span></a></td><td class="c014">Disjunction. If either value is
non-zero, the result is 1. Otherwise, the result is 0. Synonym: <span class="c005">||</span><a id="hevea_default516"></a>. </td></tr>
<tr><td class="c012">or</td><td class="c014"><a href="#value"><span class="c003">value</span></a> <span class="c005">AND</span><a id="AND"></a><a id="hevea_default517"></a> <a href="#value"><span class="c003">value</span></a></td><td class="c014">Conjunction. If both values are
non-zero, the result is 1. Otherwise, the result is 0. Synonym: <span class="c005">&amp;&amp;</span><a id="hevea_default518"></a>. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><a href="#value"><span class="c003">value</span></a> <span class="c005">BAND</span><a id="BAND"></a><a id="hevea_default519"></a> <a href="#value"><span class="c003">value</span></a></td><td class="c014">Bitwise And.
<span class="c003">0b101 BAND 0b110 = 0b100</span>. Synonym: <span class="c005">&amp;</span><a id="hevea_default520"></a>.</td></tr>
<tr><td class="c012">or</td><td class="c014"><a href="#value"><span class="c003">value</span></a> <span class="c005">BOR</span><a id="BOR"></a><a id="hevea_default521"></a> <a href="#value"><span class="c003">value</span></a></td><td class="c014">Bitwise Or.
<span class="c003">0b101 BOR 0b110 = 0b111</span>. Synonym: <span class="c005">|</span><a id="hevea_default522"></a>. </td></tr>
<tr><td class="c012">or</td><td class="c014"><a href="#value"><span class="c003">value</span></a> <span class="c005">BXOR</span><a id="BXOR"></a><a id="hevea_default523"></a> <a href="#value"><span class="c003">value</span></a></td><td class="c014">Bitwise Exclusive Or.
<span class="c003">0b101 BXOR 0b110 = 0b011</span>. Synonym: <span class="c005">^^</span><a id="hevea_default524"></a>. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">BNOT</span><a id="BNOT"></a><a id="hevea_default525"></a> <a href="#value"><span class="c003">value</span></a></td><td class="c014">Bitwise Not.
<span class="c003">BNOT 0b111 = 0b1111111111111111111111111111000</span>. Synonym: <span class="c005"><code>`</code></span><a id="hevea_default526"></a>. </td></tr>
<tr><td class="c012">or</td><td class="c014"><a href="#value"><span class="c003">value</span></a> <span class="c005">BLSL</span><a id="BLSL"></a><a id="hevea_default527"></a> <a href="#value"><span class="c003">value</span></a></td><td class="c014">Bitwise Logical Shift Left.
<span class="c003">0b101 BLSL 2 = 0b10100</span>. Synonym: <span class="c005">&lt;&lt;</span><a id="hevea_default528"></a>. </td></tr>
<tr><td class="c012">or</td><td class="c014"><a href="#value"><span class="c003">value</span></a> <span class="c005">BLSR</span><a id="BLSR"></a><a id="hevea_default529"></a> <a href="#value"><span class="c003">value</span></a></td><td class="c014">Bitwise Logical Shift Right.
<span class="c003">0b101 BLSR 2 = 0b1</span>. Synonym: <span class="c005">&gt;&gt;</span><a id="hevea_default530"></a>. </td></tr>
<tr><td class="c012">or</td><td class="c014"><a href="#value"><span class="c003">value</span></a> <span class="c005">BASR</span><a id="BASR"></a><a id="hevea_default531"></a> <a href="#value"><span class="c003">value</span></a></td><td class="c014">Bitwise Arithmetic Shift Right.
This is an arithmetic shift: the sign bit of the first value is replicated
and inserted in the vacated bits. <span class="c003">0b101 BASR 2 = 0b1</span>. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><a href="#value"><span class="c003">value</span></a> <span class="c005">&gt;</span><a id="hevea_default532"></a> <a href="#value"><span class="c003">value</span></a></td><td class="c014">If the first value is
greater than the second, the result is 1. Otherwise, the result is 0. </td></tr>
<tr><td class="c012">or</td><td class="c014"><a href="#value"><span class="c003">value</span></a> <span class="c005">&gt;=</span><a id="hevea_default533"></a> <a href="#value"><span class="c003">value</span></a></td><td class="c014">If the first value is
greater than or equal to the second, the result is 1. Otherwise, the result
is 0. </td></tr>
<tr><td class="c012">or</td><td class="c014"><a href="#value"><span class="c003">value</span></a> <span class="c005">&lt;</span><a id="hevea_default534"></a> <a href="#value"><span class="c003">value</span></a></td><td class="c014">If the first value is
less than the second, the result is 1. Otherwise, the result
is 0. </td></tr>
<tr><td class="c012">or</td><td class="c014"><a href="#value"><span class="c003">value</span></a> <span class="c005">&lt;=</span><a id="hevea_default535"></a> <a href="#value"><span class="c003">value</span></a></td><td class="c014">If the first value is
less than or equal to the second, the result is 1. Otherwise, the result
is 0. </td></tr>
<tr><td class="c012">or</td><td class="c014"><a href="#value"><span class="c003">value</span></a> <span class="c005">?</span><a id="hevea_default536"></a> <a href="#value"><span class="c003">value</span></a> <span class="c003">:</span> <a href="#value"><span class="c003">value</span></a></td><td class="c014">An expression-valued conditional. If the first value is not 0 then the
second value is evaluated and returned, otherwise the third value is
evaluated and returned. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><a href="#String"><span class="c003">String</span></a> <span class="c005">STRING_COMPARE</span><a id="STRING_COMPARE"></a><a id="hevea_default537"></a> <a href="#String"><span class="c003">String</span></a></td><td class="c014">This is legacy syntax for <a href="#STRING_EQUAL"><span class="c003">STRING_EQUAL</span></a>:
This expression evaluates to 0 if and only if its two string arguments are
equal (have the same length and the same contents). Otherwise it will evaluate
to a negative or positive integer, depending on whether the first string argument
would sort lexicographically before or after the second string argument.
<a href="#variable"><span class="c003">variable</span></a>s within the strings (e.g., “<span class="c003">%mykit%</span>”) are replaced by
their values. Note that variables that you want expanded <em>must</em> be put in %’s,
otherwise the raw text will be used.
You may use <span class="c005">STR_CMP</span><a id="STR_CMP"></a><a id="hevea_default538"></a> as a synonym for <a href="#STRING_COMPARE"><span class="c003">STRING_COMPARE</span></a>. This
function works just like C’s <span class="c003">strcmp</span>.
Note also that <a href="#STRING_EQUAL"><span class="c003">STRING_EQUAL</span></a> and <a href="#STRING_COMPARE"><span class="c003">STRING_COMPARE</span></a> are similar,
but <a href="#STRING_EQUAL"><span class="c003">STRING_EQUAL</span></a> has more intuitive return values. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><a href="#String"><span class="c003">String</span></a> <span class="c005">STRING_COMPARE_CASE</span><a id="STRING_COMPARE_CASE"></a><a id="hevea_default539"></a> <a href="#String"><span class="c003">String</span></a></td><td class="c014">This is legacy syntax for <a href="#STRING_EQUAL_CASE"><span class="c003">STRING_EQUAL_CASE</span></a>:
As <a href="#STRING_COMPARE"><span class="c003">STRING_COMPARE</span></a>, but the comparison ignores case. That is,
<span class="c003">"ANOMEN"</span> and <span class="c003">"aNoMeN"</span> are considered equal.</td></tr>
<tr><td class="c012">
or</td><td class="c014"><a href="#String"><span class="c003">String</span></a> <span class="c005">STRING_EQUAL</span><a id="STRING_EQUAL"></a><a id="hevea_default540"></a> <a href="#String"><span class="c003">String</span></a></td><td class="c014">This expression evaluates to 1 if and only if its two string arguments are
equal (have the same length and the same contents), otherwise it values to 0.
<a href="#variable"><span class="c003">variable</span></a>s within the strings (e.g., “<span class="c003">%mykit%</span>”) are replaced
by their values.
Note that variables that you want expanded <em>must</em> be put in %’s,
otherwise the raw text will be used.
Note also that <a href="#STRING_EQUAL"><span class="c003">STRING_EQUAL</span></a> and <a href="#STRING_COMPARE"><span class="c003">STRING_COMPARE</span></a> are similar,
but <a href="#STRING_EQUAL"><span class="c003">STRING_EQUAL</span></a> has more intuitive return values. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><a href="#String"><span class="c003">String</span></a> <span class="c005">STRING_EQUAL_CASE</span><a id="STRING_EQUAL_CASE"></a><a id="hevea_default541"></a> <a href="#String"><span class="c003">String</span></a></td><td class="c014">As <a href="#STRING_EQUAL"><span class="c003">STRING_EQUAL</span></a>, but the comparison ignores case. That is,
<span class="c003">"ANOMEN"</span> and <span class="c003">"aNoMeN"</span> are considered equal. You may use
<span class="c005">STR_EQ</span><a id="STR_EQ"></a><a id="hevea_default542"></a> as a synonym for <a href="#STRING_EQUAL_CASE"><span class="c003">STRING_EQUAL_CASE</span></a>.</td></tr>
<tr><td class="c012">
or</td><td class="c014"><a href="#String"><span class="c003">String</span></a> <span class="c005">STRING_MATCHES_REGEXP</span><a id="STRING_MATCHES_REGEXP"></a><a id="hevea_default543"></a> <a href="#String"><span class="c003">String</span></a></td><td class="c014">As <a href="#STRING_COMPARE_CASE"><span class="c003">STRING_COMPARE_CASE</span></a>, but the second string is treated as a
<a href="#regexp"><span class="c003">regexp</span></a>. Thus <span class="c003">"AR1005" STRING_MATCHES_REGEXP "AR[0-9]+"</span>
evaluates to 0 (“no difference”). You may use
<span class="c005">STRING_COMPARE_REGEXP</span><a id="STRING_COMPARE_REGEXP"></a><a id="hevea_default544"></a> as a synonym. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><a href="#String"><span class="c003">String</span></a> <span class="c005">STRING_CONTAINS_REGEXP</span><a id="STRING_CONTAINS_REGEXP"></a><a id="hevea_default545"></a> <a href="#String"><span class="c003">String</span></a></td><td class="c014">As <a href="#STRING_MATCHES_REGEXP"><span class="c003">STRING_MATCHES_REGEXP</span></a>, but it evaluates to 0 if the first string
contains the second <a href="#regexp"><span class="c003">regexp</span></a>. Thus <span class="c003">"AR1005" STRING_CONTAINS_REGEXP
"[w-z]"</span> evaluates to 1 (“mismatch”).<p><em>Be warned that this does the exact opposite of what the name suggests.</em> </p></td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">GAME_IS</span><a id="GAME_IS"></a><a id="hevea_default546"></a> <a href="#String"><span class="c003">String</span></a></td><td class="c014">Returns true if the IE game variant
is one of the entries in String, otherwise it returns false. String is a list of
whitespace-separated entries, chosen from (case doesn’t matter)
<code>bg2=soa, tob, iwd2, pst, bg1, totsc, iwd=iwd1, how, totlm, tutu, tutu_totsc, bgt, ca, iwd_in_bg2, bgee, bg2ee, eet, iwdee, pstee</code>.
In the list, <code>bg2=soa</code> means that <code>bg2</code> and <code>soa</code> are synonyms,
and you can use whichever one you like. Please note that the items in the list are
defined to be mutually exclusive (except <code>tob</code> will detect both plain ToB
and ToB with BGT installed, for legacy purposes), so <code>bg2</code> will detect a
SoA-only game, without either ToB or Tutu installed. As such, a mod which is
usable with any flavor of BG2 and any flavor of Tutu or BG: EE would contain
<code>REQUIRE_PREDICATE GAME_IS ~bg2 tob tutu tutu_totsc bgee bg2ee~</code> . </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">ENGINE_IS</span><a id="ENGINE_IS"></a><a id="hevea_default547"></a> <a href="#String"><span class="c003">String</span></a></td><td class="c014">Functions like <a href="#GAME_IS"><span class="c003">GAME_IS</span></a>
except <code>bg2=soa</code> will detect SoA-based Tutu games in addition to SoA games,
and <code>tob</code> will detect ToB-based Tutu games in addition to ToB and BGT games.
As such, a mod that requires Throne of Bhaal’s engine enhancements could use
<code>REQUIRE_PREDICATE ENGINE_IS ~tob~</code> . </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">GAME_INCLUDES</span><a id="GAME_INCLUDES"></a><a id="hevea_default548"></a> <a href="#String"><span class="c003">String</span></a></td><td class="c014">
Returns true if the IE game variant includes the game content
specified by String. String is a single game chosen from
<code>bg1, totsc, bg2=soa, tob, pst, iwd=iwd1, how, totlm, iwd2, ca, sod</code>. In
the list, <code>bg2=soa</code> means that <code>bg2</code> and <code>soa</code> are
synonyms, and you can use whichever one you like. Please note that
unlike <a href="#GAME_IS"><span class="c003">GAME_IS</span></a> you only specify a single game, rather than a
list of games. As an example, <code>GAME_INCLUDES ~tob~</code> will return
true for any game which includes the ToB content, such as ToB itself,
BGT or BG2EE. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">IDS_OF_SYMBOL</span><a id="IDS_OF_SYMBOL"></a><a id="hevea_default549"></a> <span class="c003">(</span> File <a href="#String"><span class="c003">String</span></a> <span class="c003">)</span></td><td class="c014">Will return the number associated with String in File.ids,
or -1 if String is not associated in File.ids. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">VARIABLE_IS_SET</span><a id="VARIABLE_IS_SET"></a><a id="hevea_default550"></a> <a href="#String"><span class="c003">String</span></a></td><td class="c014">Returns true if the variable String is set (there’s a variable called either
<code>String</code> or <code>%String%</code>, regardless of whether it is a string or an
integer). </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">IS_AN_INT</span><a id="hevea_default551"></a> <a href="#String"><span class="c003">String</span></a></td><td class="c014">Returns true if the variable String is set to an integer (there’s a variable called either
<code>String</code> or <code>%String%</code> with integer value). </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">TRA_ENTRY_EXISTS</span><a id="TRA_ENTRY_EXISTS"></a><a id="hevea_default552"></a> <span class="c003">(</span> <a href="#String"><span class="c003">String</span></a> <a href="#String"><span class="c003">String</span></a> <span class="c002"> list </span><span class="c003">)</span></td><td class="c014">	returns true if the variable String maps to a valid TRA entry.
	If the <a href="#String"><span class="c003">String</span></a> list is empty the tra entry is looked for into the loaded TRAs,
	otherwise it’s looked for into the listed TRA files.
</td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">IS_SILENT</span><a id="hevea_default553"></a></td><td class="c014">Returns true if the output is currently silenced, false otherwise. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">MOD_IS_INSTALLED</span><a id="MOD_IS_INSTALLED"></a><a id="hevea_default554"></a> modTp2Name modComponent</td><td class="c014">Returns true if the modComponent of modTp2Name is installed. The syntax
is the same as with <a href="#REQUIRE_COMPONENT"><span class="c003">REQUIRE_COMPONENT</span></a>. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">INSTALL_ORDER</span><a id="INSTALL_ORDER"></a><a id="hevea_default555"></a> modTp2Name1 modComponent1 <span class="c003">AFTER</span> modTp2Name2 modComponent2</td><td class="c014">Returns true if the modComponent1 of modTp2Name1 is installed after the modComponent2
of modTp2Name2 (and both components are installed). The syntax
is the same as with <a href="#REQUIRE_COMPONENT"><span class="c003">REQUIRE_COMPONENT</span></a>. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">INSTALL_ORDER</span><a id="hevea_default556"></a> modTp2Name1 modComponent1 <span class="c003">BEFORE</span> modTp2Name2 modComponent2</td><td class="c014">Returns true if the modComponent1 of modTp2Name1 is installed before the modComponent2
of modTp2Name2 (and both components are installed). The syntax
is the same as with <a href="#REQUIRE_COMPONENT"><span class="c003">REQUIRE_COMPONENT</span></a>. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">ID_OF_LABEL</span><a id="ID_OF_LABEL"></a><a id="hevea_default557"></a> modTp2Name String</td><td class="c014"> Returns the numerical identifier (component number) of the component
in modTp2Name which has the given <a href="#LABEL"><span class="c003">LABEL</span></a>. Returns
-2<sup>31</sup> if no such tp2 exists, said tp2 has no
component with that <a href="#LABEL"><span class="c003">LABEL</span></a>, or two or more components have
that <a href="#LABEL"><span class="c003">LABEL</span></a>. In the last two cases will print a WARNING. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">STATE_WHICH_SAYS</span><a id="STATE_WHICH_SAYS"></a><a id="hevea_default558"></a> <a href="#text"><span class="c003">text</span></a> <span class="c003">FROM</span> <a href="#String"><span class="c003">String</span></a></td><td class="c014"> String must be an in-game or in-override .dlg file. Returns:
<ol class="enumerate" type=1><li class="li-enumerate">
Fails the installation if it can’t evaluate the text (an <span class="c003">@x</span> reference out of bounds)
</li><li class="li-enumerate">-3 if the text is not currently in the tlk or in the list of strings to add
</li><li class="li-enumerate">-2 if the text is spoken (= <code>SAY ~Foo~</code>) at least twice in the file String
</li><li class="li-enumerate">-1 if the text is never spoken in the file String
</li></ol>
Otherwise it returns the number of the state in which text is spoken in the file String.
<span class="c003">@x</span> references are taken from the loaded TRA files (the ones defined in the
<a href="#Language"><span class="c003">Language</span></a> part).
</td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">STATE_WHICH_SAYS</span><a id="hevea_default559"></a> <a href="#value"><span class="c003">value</span></a><span class="c003"> IN </span><a href="#String"><span class="c003">String</span></a><span class="c003">1 FROM </span><a href="#String"><span class="c003">String</span></a><span class="c003">2</span></td><td class="c014"> As above, except that <span class="c003">@x</span> references are taken from
the String1 tra file. In particular, one <code>%s</code> in String1 is expanded to the list
of directories; for example (as of Sola v102), <code>solarom/%s/epilogue.tra</code> would match
<pre class="verbatim">    solarom/american/epilogue.tra
    solarom/french/epilogue.tra
    solarom/german/epilogue.tra
    solarom/italian/epilogue.tra
    solarom/polski/epilogue.tra
    solarom/portuguese/epilogue.tra
    solarom/russian/epilogue.tra
</pre>
</td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">RESOLVE_STR_REF</span><a id="RESOLVE_STR_REF"></a><a id="hevea_default560"></a> <span class="c003">(</span> <a href="#text"><span class="c003">text</span></a> <span class="c003">)</span></td><td class="c014">Resolves the given text (adding it to the tlk), and returns its TLK index
(so you can pass the result of this command to a function which then uses
<a href="#WRITE_LONG"><span class="c003">WRITE_LONG</span></a> rather than <a href="#SAY"><span class="c003">SAY</span></a>).
</td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">NEXT_STRREF</span><a id="NEXT_STRREF"></a><a id="hevea_default561"></a></td><td class="c014">Returns the next available string reference in the TLK file.
</td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">RANDOM</span><a id="RANDOM"></a><a id="hevea_default562"></a> <span class="c003">(</span> <a href="#value"><span class="c003">value</span></a> <a href="#value"><span class="c003">value</span></a> <span class="c003">)</span></td><td class="c014">A random-number generator. The first <a href="#value"><span class="c003">value</span></a> is the lower bound, the
second value is the upper bound. A random integer between the lower bound
and the upper bound (inclusive) is returned. Thus <span class="c003">RANDOM(3 5)</span> can
return 3, 4 or 5. If the lower bound is greater than the upper bound, zero
is returned. See also <a href="#RANDOM_SEED"><span class="c003">RANDOM_SEED</span></a>. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">BUFFER_LENGTH</span><a id="BUFFER_LENGTH"></a><a id="hevea_default563"></a></td><td class="c014">Returns the length of the string currently being patched, or 0 if outside of
a patch expression. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">INDEX</span><a id="INDEX"></a><a id="hevea_default564"></a> <span class="c003">(</span> <a href="#optcase"><span class="c003">optcase</span></a> <a href="#optexact"><span class="c003">optexact</span></a> <a href="#string"><span class="c003">string</span></a>1
<a href="#string"><span class="c003">string</span></a>2 <span class="c002"> [ </span><a href="#value"><span class="c003">value</span></a> <span class="c002"> ] </span><span class="c003">)</span></td><td class="c014">Returns the index of the first regexp match of string1 inside string2, or
-1 if not found. If provided, value specifies from what point of string2
the searching should begin (instead of 0).
</td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">RINDEX</span><a id="RINDEX"></a><a id="hevea_default565"></a> <span class="c003">(</span> <a href="#optcase"><span class="c003">optcase</span></a> <a href="#optexact"><span class="c003">optexact</span></a> <a href="#string"><span class="c003">string</span></a>1
<a href="#string"><span class="c003">string</span></a>2 <span class="c002"> [ </span><a href="#value"><span class="c003">value</span></a> <span class="c002"> ] </span><span class="c003">)</span></td><td class="c014">Returns the index of the last regexp match of string1 inside string2, or
-1 if not found. If provided, value specifies from what point of string2
the searching should begin (instead of <a href="#STRING_LENGTH"><span class="c003">STRING_LENGTH</span></a> string2).
</td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">INDEX_BUFFER</span><a id="INDEX_BUFFER"></a><a id="hevea_default566"></a> <span class="c003">(</span> <a href="#optcase"><span class="c003">optcase</span></a> <a href="#optexact"><span class="c003">optexact</span></a> <a href="#string"><span class="c003">string</span></a>
<span class="c002"> [ </span><a href="#value"><span class="c003">value</span></a> <span class="c002"> ] </span><span class="c003">)</span></td><td class="c014">Returns the index of the first regexp match of string inside the current string, or
-1 if not found. If provided, value specifies from what point of the string
the searching should begin (instead of 0<span class="c003">)</span>.
</td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">RINDEX_BUFFER</span><a id="RINDEX_BUFFER"></a><a id="hevea_default567"></a> <span class="c003">(</span> <a href="#optcase"><span class="c003">optcase</span></a> <a href="#optexact"><span class="c003">optexact</span></a> <a href="#string"><span class="c003">string</span></a>
<span class="c002"> [ </span><a href="#value"><span class="c003">value</span></a> <span class="c002"> ] </span><span class="c003">)</span></td><td class="c014">Returns the index of the last regexp match of string inside the current string, or
-1 if not found. If provided, value specifies from what point of the string
the searching should begin (instead of <a href="#BUFFER_LENGTH"><span class="c003">BUFFER_LENGTH</span></a>).
</td></tr>
<tr><td class="c012"> or</td><td class="c014"><span class="c005">STRING_LENGTH</span><a id="STRING_LENGTH"></a><a id="hevea_default568"></a> <a href="#String"><span class="c003">String</span></a></td><td class="c014">Returns the length of the argument <a href="#String"><span class="c003">String</span></a> (after variable evaluation). </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">FILE_CONTAINS</span><a id="FILE_CONTAINS"></a><a id="hevea_default569"></a> fileName <a href="#regexp"><span class="c003">regexp</span></a></td><td class="c014">
Evaluates to 1 if the file <span class="c003">fileName</span> contains the regular
expression <a href="#regexp"><span class="c003">regexp</span></a> and 0 otherwise. Case is ignored. Use
<a href="#RESOURCE_CONTAINS"><span class="c003">RESOURCE_CONTAINS</span></a> if you want to search game resources;
<span class="c003">FILE_CONTAINS</span> looks in the file system and does not search biff
files. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">FILE_CONTAINS_EVALUATED</span><a id="FILE_CONTAINS_EVALUATED"></a><a id="hevea_default570"></a> <span class="c003">(</span> fileName varsRegexp <span class="c003">)</span></td><td class="c014">
First, all WeiDU variables enclosed in <span class="c003">%</span>s in <span class="c003">varsRegexp</span> and
<span class="c003">fileName</span> are substituted. The expression is 1 if the resulting
<a href="#regexp"><span class="c003">regexp</span></a> occurs in <span class="c003">fileName</span> and 0 otherwise. If
<span class="c003">fileName</span> does not exist or has size 0, the result is 0. The
comparison ignores case. See also <a href="#FILE_CONTAINS"><span class="c003">FILE_CONTAINS</span></a>. Use
<a href="#RESOURCE_CONTAINS"><span class="c003">RESOURCE_CONTAINS</span></a> if you want to search game
resources. <span class="c003">FILE_CONTAINS_EVALUATED</span> will first search the file
system and only load game resources if the file was not found in the
file system.<p>Example usage:</p><pre class="verbatim">COPY_EXISTING_REGEXP ~.*\.CRE~ ~override~
  READ_BYTE   0x273 class
  READ_ASCII  0x280 deathvar
  PATCH_IF (class = 14) AND // class 14 = CLERIC_MAGE
           (NOT FILE_CONTAINS_EVALUATED(~pdialog.2da~
                                        ~%deathvar%~))
    THEN BEGIN
      ADD_CRE_ITEM ~POTN08~ #10 #10 #10 ~IDENTIFIED~ ~INV15~
    END
  BUT_ONLY_IF_IT_CHANGES
</pre><p>
The example gives ten healing potions to all cleric-mages who cannot join
the party. Notably it excludes Aerie
since she has the death variable <span class="c003">Aerie</span> and <span class="c003">pdialog.2da</span> contains
<span class="c003">AERIE</span>. </p></td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">RESOURCE_CONTAINS</span><a id="RESOURCE_CONTAINS"></a><a id="hevea_default571"></a> fileName varsRegexp</td><td class="c014">
fileName and varsRegexp are evaluated for variables. fileName is
loaded as a game resource (searching only the biffs and the override
directories) and a <a href="#regexp"><span class="c003">regexp</span></a> search is performed on the file
contents. The result is 1 if the regexp varsRegexp occurs within
fileName, or otherwise 0. The comparison ignores case. If fileName
does not exist or has a file size 0, the result is 0. </td></tr>
<tr><td class="c012">
is</td><td class="c014"><span class="c005">FILE_EXISTS</span><a id="FILE_EXISTS"></a><a id="hevea_default572"></a> fileName</td><td class="c014">Evaluates to 1 if the file exists in the
filesystem (or the bif file is referenced inside
the chitin.key) and evaluates to 0 otherwise.
The results of <a href="#FILE_EXISTS"><span class="c003">FILE_EXISTS</span></a> are undefined if fileName is a directory.
</td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">DIRECTORY_EXISTS</span><a id="DIRECTORY_EXISTS"></a><a id="hevea_default573"></a> dirName</td><td class="c014">Evaluates to 1 if dirName is a
directory and exists in the filesystem and evaluates to 0 otherwise.
</td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">FILE_EXISTS_IN_GAME</span><a id="FILE_EXISTS_IN_GAME"></a><a id="hevea_default574"></a> fileName</td><td class="c014">Evaluates to 1 if the file
exists as a game resource and has non-zero size. Evaluates to 0 otherwise.
<a href="#BIFF"><span class="c003">BIFF</span></a>s and the <span class="c003">override</span> directory are searched in the standard
manner. Evaluates to 0 for a file that does not exist but has been
<a href="#ALLOW_MISSING"><span class="c003">ALLOW_MISSING</span></a>’d.</td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">FILE_MD5</span><a id="FILE_MD5"></a><a id="hevea_default575"></a> fileName md5sum</td><td class="c014">Evaluates to 1 if the file exists
and has the given MD5 checksum. Evaluates to 0 otherwise. Two different
files are exceptionally unlikely to have the same MD5 checksum. In any
event, the discovered checksum is printed to the log. If the file does not
exist, it evaluates to 0. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">FILE_IS_IN_COMPRESSED_BIFF</span><a id="FILE_IS_IN_COMPRESSED_BIFF"></a><a id="hevea_default576"></a> fileName</td><td class="c014">Evaluates to 1 if the file
is stored in a compressed biff (ignoring copies in the override). Evaluates to
0 otherwise (the file is not in a biff, or it is in an uncompressed biff).
</td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">BIFF_IS_COMPRESSED</span><a id="BIFF_IS_COMPRESSED"></a><a id="hevea_default577"></a> fileName</td><td class="c014">Evaluates to 1 if the file
is a compressed biff. Evaluates to 0 otherwise.<p>FileName must match against the contents of what is stored in chitin.key
(similar to how command-line arguments that touch bif files work). For
example, <code>data/AREA000A.bif</code>. Notably, <a href="#SOURCE_BIFF"><span class="c003">SOURCE_BIFF</span></a> outputs
file names compatible with this command.
</p></td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c005">FILE_SIZE</span><a id="FILE_SIZE"></a><a id="hevea_default578"></a> fileName fileSize</td><td class="c014">Evaluates to 1 if the
size of the file <span class="c003">fileName</span> is exactly <span class="c003">fileSize</span>. Evaluates to 0
otherwise. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">SIZE_OF_FILE</span><a id="SIZE_OF_FILE"></a><a id="hevea_default579"></a> fileName</td><td class="c014">Returns the size of fileName or -1 if the file does not exist. Variables in
fileName are evaluated. fileName can be a file on the local file system or an
inlined file.
</td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">VALID_SCRIPT_ACTIONS</span><a id="VALID_SCRIPT_ACTIONS"></a><a id="hevea_default580"></a> <a href="#variable"><span class="c003">variable</span></a></td><td class="c014">
Variable can be an array construct and should be or evaluate to a
string of whitespace-separated <a href="#Infinity%20Engine%20action"><span class="c003">Infinity Engine action</span></a>s.
Returns true if the string compiles into BCS without
unrecoverable errors, otherwise false.</td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">VALID_SCRIPT_TRIGGERS</span><a id="VALID_SCRIPT_TRIGGERS"></a><a id="hevea_default581"></a> <a href="#variable"><span class="c003">variable</span></a></td><td class="c014">
Variable can be an array construct and should be or evaluate to a
string of whitespace-separated <a href="#Infinity%20Engine%20trigger"><span class="c003">Infinity Engine trigger</span></a>s.
Returns true of the string compiles into BCS without
unrecoverable errors, otherwise false.</td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c003">%</span><a href="#variable"><span class="c003">variable</span></a><span class="c003">%</span></td><td class="c014"> The value of the <a href="#variable"><span class="c003">variable</span></a> is used. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c005">EVALUATE_BUFFER</span><a id="hevea_default582"></a> <a href="#variable"><span class="c003">variable</span></a></td><td class="c014"> User variables inside the given string are evaluated one additional
time. You may prepend <a href="#EVALUATE_BUFFER"><span class="c003">EVALUATE_BUFFER</span></a> when a <a href="#value"><span class="c003">value</span></a> is
called for and you would normally use a string. You may also use it for
<a href="#SET"><span class="c003">SET</span></a> and <a href="#SPRINT"><span class="c003">SPRINT</span></a> statements. Example:
<pre class="verbatim">SPRINT x ~y~
SET y = 5
SPRINT z EVALUATE_BUFFER ~tricky %%x%%~
SET EVALUATE_BUFFER "%x%" += 77
PATCH_PRINT "y is %y% ; z is %z%"
</pre>
This prints out <span class="c003">y is 82 ; z is tricky 5</span>. You may also do hackery like
<span class="c003">FILE_SIZE "myfile" "%%indirection%%"</span>. Be very careful with this
feature. </td></tr>
<tr><td class="c012">or</td><td class="c014"><code>$array(index list)</code></td><td class="c014"> The so-called <em>array construct</em>. See the <a href="#sec-array-construct">tutorial</a>.
</td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c003">%<span class="c007">WEIDU_ARCH</span></span><a id="WEIDU_ARCH"></a><a id="hevea_default583"></a><span class="c003">%</span></td><td class="c014">The special variable <span class="c003">WEIDU_ARCH</span>
is set to either <span class="c003">"x86"</span>, <span class="c003">"amd64"</span> or <span class="c003">"mac"</span> at WeiDU startup and can be used to
determine the architecture of the WeiDU binary. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c003">%<span class="c007">WEIDU_OS</span></span><a id="WEIDU_OS"></a><a id="hevea_default584"></a><span class="c003">%</span></td><td class="c014">The special variable <span class="c003">WEIDU_OS</span> is set to either
<span class="c003">"win32"</span> or <span class="c003">"osx"</span> or <span class="c003">"unix"</span> at WeiDU startup and can be used to
determine the operating system for which the WeiDU binary was compiled. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c003">%<span class="c007">COMPONENT_NUMBER</span></span><a id="COMPONENT_NUMBER"></a><a id="hevea_default585"></a><span class="c003">%</span></td><td class="c014">The special variable <span class="c003">COMPONENT_NUMBER</span>
is set to the number of the component being installed. </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c003">%<span class="c007">INTERACTIVE</span></span><a id="INTERACTIVE"></a><a id="hevea_default586"></a><span class="c003">%</span></td><td class="c014">The special variable <span class="c003">INTERACTIVE</span>
is set to 1 if the install is being done interactively (IE you launched setup-mymod.exe and you’re
installing mymod), or is set to 0 if the install is being done non-interactively (IE you launched
setup-mymod.exe and now weidu is reinstalling othermod due to the domino uninstall and reinstall). </td></tr>
<tr><td class="c012">
or</td><td class="c014"><a href="#variable"><span class="c003">variable</span></a></td><td class="c014"> The value of the <a href="#variable"><span class="c003">variable</span></a> is used.
In a <a href="#patch"><span class="c003">patch</span></a> <a href="#value"><span class="c003">value</span></a>, you may use either <span class="c003">%myvar%</span> or
<span class="c003">myvar</span> to get the value of a variable, provided that your variable’s
name is not the same as a WeiDU syntactic keyword or known
<a href="#sec-constant">constant</a>. Also note that while it is common to “call out”
variables by putting quotation marks around them, this is not necessary
if the variable is unambiguous. Thus the following three <a href="#patch"><span class="c003">patch</span></a>es
are all equivalent:
<pre class="verbatim">SET "x" = "%y%" + "%z%"       // these all
SET "x" = "y" + "z"           //    do the
SET x = y + z                 //  same thing
</pre> </td></tr>
<tr><td class="c012">
or</td><td class="c014"><span class="c003">NAME1</span></td><td class="c014">The offset within an infinity engine resource where the unidentified general name (e.g., "Battle Axe") is stored. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c003">NAME2</span></td><td class="c014">The offset within an infinity engine resource where the identified general name (e.g., "K’logarath +4") is stored. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c003">UNIDENTIFIED_DESC</span></td><td class="c014">The offset within an infinity engine resource where the unidentified description (e.g., "The hand axe or throwing axe is also known as a hatchet ...") is stored. </td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c003">IDENTIFIED_DESC</span></td><td class="c014">As above ... ("Clans have gone to war to possess K’log...")</td></tr>
<tr><td class="c012">or</td><td class="c014"><span class="c003">BIO</span></td><td class="c014">As above ... NPC Biography</td></tr>
<tr><td class="c012">or</td><td class="c014">...</td><td class="c014">Almost everything in <span class="c003">SNDSLOT.IDS</span> or <span class="c003">SOUNDOFF.IDS</span>
works as well. </td></tr>
<tr><td class="c012">&nbsp;</td></tr>
<tr><td class="c012">
<span class="c005">variable</span><a id="variable"></a><a id="hevea_default587"></a></td><td class="c014">&nbsp;</td><td class="c014">A variable is a textual name that holds a
<a href="#value"><span class="c003">value</span></a>. Variables are usually set with <a href="#READ_BYTE"><span class="c003">READ_BYTE</span></a>,
<a href="#SET"><span class="c003">SET</span></a> or <a href="#SPRINT"><span class="c003">SPRINT</span></a>. </td></tr>
<tr><td class="c012">is</td><td class="c014"><a href="#String"><span class="c003">String</span></a></td><td class="c014">You may name the variable whatever you like, but stay
away from the special characters used in <a href="#regexp"><span class="c003">regexp</span></a>s. When you want to
obtain the value of a variable, enclose it in <span class="c003">%</span>s.<p>Example: If a file contains the two binary integers 33 and 77, then after
executing:</p><pre class="verbatim">READ_LONG   0 ~myvar~
WRITE_LONG  4 ( ~%myvar%~ + 11 )
</pre><p>The file will contain the two binary integers 33 and 44. </p></td></tr>
</table>
<!--TOC section id="sec22" WeiDU <span class="c003">TP2 Tutorials</span>-->
<h2 class="section" id="sec22">10  WeiDU <a href="#TP2"><span class="c003">TP2</span></a> Tutorials</h2><!--SEC END --><p>
<a id="TP Tutorials"></a></p><p>Note: it’s advised to read these tutorials in the order they were written,
as often a tutorial depends on contents explained in the tutorials before
it. If the tutorial-writer is kind enough, they’ll state dependencies while
introducing the subject.</p>
<!--TOC subsection id="sec23" <span class="c003">COPY_EXISTING_REGEXP (Last update: v232)</span>-->
<h3 class="subsection" id="sec23">10.1  <a href="#COPY_EXISTING_REGEXP"><span class="c003">COPY_EXISTING_REGEXP</span></a> (Last update: v232)</h3><!--SEC END --><p>
This tutorial was thoughtfully provided by Japheth and edited by Wisp to
conform to contemporary good practices.</p><p>The purpose of <a href="#COPY_EXISTING"><span class="c003">COPY_EXISTING</span></a> and <a href="#COPY_EXISTING_REGEXP"><span class="c003">COPY_EXISTING_REGEXP</span></a> is to
patch a file for patching. It will grab the file out of the <a href="#BIFF"><span class="c003">BIFF</span></a>s,
or if an <span class="c003">override</span> version exists, it will grab it out of the override
folder.</p><p><a href="#COPY_EXISTING_REGEXP"><span class="c003">COPY_EXISTING_REGEXP</span></a>, <a href="#EXTEND_BOTTOM_REGEXP"><span class="c003">EXTEND_BOTTOM_REGEXP</span></a> and
<a href="#EXTEND_TOP_REGEXP"><span class="c003">EXTEND_TOP_REGEXP</span></a> can be potentially powerful actions if you need
to make some changes to a certain set of files all in one shot.</p><p>Consider this example for <a href="#COPY_EXISTING_REGEXP"><span class="c003">COPY_EXISTING_REGEXP</span></a>:</p><p>In my mod I want to make it so that all 1-handed swords only do D6 damage,
rather than the varying damages they do in SOA. To do this with the
"normal" <a href="#COPY_EXISTING"><span class="c003">COPY_EXISTING</span></a>, I would have to write out all the one
handed swords like this:</p><pre class="verbatim">COPY_EXISTING ~sw1h01.itm~ ~override~
              ~sw1h02.itm~ ~override~
              etc...
</pre><p>That could take a lot of time to do. Using <a href="#COPY_EXISTING_REGEXP"><span class="c003">COPY_EXISTING_REGEXP</span></a> I
can minimize writing 70+ lines of code into 3 lines of code. Take a look
at this:</p><pre class="verbatim">COPY_EXISTING_REGEXP ~sw1h..[^abc].*itm~ ~override~
  //our patching code goes here
</pre><p>I’ll explain how the <a href="#regexp"><span class="c003">regexp</span></a> wildcards in the above example work:
I want to avoid copying over the files sw1h54a.itm, sw1h54b.itm and
sw1h54c.itm because they are the three components that make up the
Equalizer and are thus not actual swords. The regexp fragment <code>[^abc]</code>
is an exclusion set that will match any character but “a”, “b” and “c”.</p>
<!--TOC subsection id="sec24" <span class="c003">EXTEND_TOP_REGEXP</span>-->
<h3 class="subsection" id="sec24">10.2  <a href="#EXTEND_TOP_REGEXP"><span class="c003">EXTEND_TOP_REGEXP</span></a></h3><!--SEC END --><p>
This tutorial was thoughtfully provided by Japheth.</p><p>Let’s take this situation that I was in:</p><p>I am making a Hirelings mod, and in order to get non-party NPC’s to
transition from area to area, I needed to make use of a combination of
MakeGlobal(), InMyArea(O:Object*) and MoveGlobalObject(O:Object*,O:Target*).</p><p>I originally put the script that moves them from area to area into
baldur.bcs (this script is constantly running in the game), but for some
strange reason, the cre’s wouldn’t move to smaller areas, only the large
"main" areas. (Like The Docks, Temple District, Slums, etc.) So I
figured, "Huh, guess I’m going to have to put the script in every area
script". (Area scripts are scripts that are assigned to areas that are ran
while you are in the area. Pretty obvious, right?)</p><p>Now, writing the code to <a href="#EXTEND_TOP"><span class="c003">EXTEND_TOP</span></a> this little script into every area
script would of taken quite a while, and well, rather than do that, I
humbly requested Wes to implement the <a href="#regexp"><span class="c003">regexp</span></a> feature of
<a href="#EXTEND_TOP"><span class="c003">EXTEND_TOP</span></a> and <a href="#EXTEND_BOTTOM"><span class="c003">EXTEND_BOTTOM</span></a>, and Westley obliged. (My penance
for that request is writing the docs you are reading right now.)</p><p>So now with Wes’ help, I could <a href="#EXTEND_TOP"><span class="c003">EXTEND_TOP</span></a> to every area in 1 fell
swoop. If you were to open up NI and expand the <a href="#BCS"><span class="c003">BCS</span></a> tree, you
would see a whole crapload of scripts that begin with the prefix AR. These
are the area scripts I mentioned before. They go from
AR0014 to AR6400. So now, using <a href="#regexp"><span class="c003">regexp</span></a>, here is how you would
extend the script to the top of every area script:</p><pre class="verbatim">EXTEND_TOP_REGEXP ~ar[0-6].*bcs~ ~pathtoscript/patch.bcs~
</pre><p>So there we are, instead of 100+ lines of code, I minimized it to 1 lines.
Now, if you are understanding regexp at all, you probably are going “Hey
wait, why didn’t you just go <a href="#EXTEND_TOP_REGEXP"><span class="c003">EXTEND_TOP_REGEXP</span></a><span class="c003"> "ar.*bcs"
"pathtoscript/patch.bcs"</span> ?” Well, in fact, I did do that at first, but I
forgot to account that there are other “normal” scripts that begin with AR.
So, I had to write it so that the <a href="#regexp"><span class="c003">regexp</span></a> had the number after the
initial AR so that WeiDU would know only to patch the script to area files.</p>
<!--TOC subsection id="sec25" <span class="c003">READ_BYTE and PATCH_IF (Last update: v232)</span>-->
<h3 class="subsection" id="sec25">10.3  <a href="#READ_BYTE"><span class="c003">READ_BYTE</span></a> and <a href="#PATCH_IF"><span class="c003">PATCH_IF</span></a> (Last update: v232)</h3><!--SEC END --><p>This tutorial was thoughtfully provided by Japheth, and shamelessly edited
by Bigg to use PATCH_IF rather than IF_EVAL. It was then further edited by
Wisp to conform to contemporary good practices.</p><p><a href="#READ_BYTE"><span class="c003">READ_BYTE</span></a>, <a href="#READ_SHORT"><span class="c003">READ_SHORT</span></a> and <a href="#READ_LONG"><span class="c003">READ_LONG</span></a> can be
potentially powerful functions when used in conjunction with
<a href="#PATCH_IF"><span class="c003">PATCH_IF</span></a>.</p><p>Here’s a brief demonstration.</p><p>The scenario: I want to make all longswords require 10 strength,
rather than their normal 6. To do that manually would be a pain, so why
not use the great feature of <a href="#READ_BYTE"><span class="c003">READ_BYTE</span></a>/LONG/SHORT?</p><p>Here’s how it’s done.</p><p>First of all, we need to copy all the items so they are ready to be patched.
Here’s how we do that:</p><pre class="verbatim">COPY_EXISTING_REGEXP ~.*\.itm~ ~override~
</pre><p>All this does is copy all files with a .itm extension to the override folder.</p><p>Next, we read the value of the item-type offset into a variable. We’ll use the variable
name "type".</p><pre class="verbatim">READ_SHORT 0x1c type
</pre><p>I found the offset by looking at the file format for items in the IESDP:
<a href="https://gibberlings3.github.io/iesdp/index.htm"><span class="c003">https://gibberlings3.github.io/iesdp/index.htm</span></a>. The
variable "type" can really be anything, it’s just what I’ve chosen.</p><p>We should edit the item only if the item is really a longsword:</p><pre class="verbatim">PATCH_IF (type = 0x14) BEGIN
</pre><p>0x14 is just the value for longsword. If you look at the item-type offset (which
is 0x1c) in the IESDP, you will see a link to a list of known values. 0x14 is the
value for large/long swords.</p><p>Now that we’re done reading that into a variable and doing the checks, we can now
<a href="#WRITE_BYTE"><span class="c003">WRITE_BYTE</span></a> the value we want to give our new longswords. That is, a strength
requirement of 10.</p><pre class="verbatim">WRITE_BYTE 0x26 10
</pre><p>0x26 is the offset for required strength. Again, I found this offset by referring to the IESDP beforehand.</p><pre class="verbatim">END
BUT_ONLY_IF_IT_CHANGES
</pre><p>Finally, we close the BEGIN that was after PATCH_IF and tell WeiDU not to copy
the item if it didn’t change (IE, if it wasn’t a long sword).</p><p>So, to loop through the logic again, this is what we’re saying:</p><p>If the category is longsword, set the required strength to 10. If
there are no changes, ignore the file and don’t copy it over.</p><p>And that’s it. Now all items with the category Longsword will have a required strength of 10.
Pretty neat, eh? Obviously you can do many, many other types of
thing with these functions. So go ahead and experiment.</p><p>Here’s the full code:</p><pre class="verbatim">COPY_EXISTING_REGEXP ~.*\.itm~ ~override~
  READ_SHORT 0x1c type

  PATCH_IF (type = 0x14) BEGIN
    WRITE_BYTE 0x26 10
  END
BUT_ONLY_IF_IT_CHANGES
</pre><p>Oh yeah, and if you’re going "But I don’t know when to <a href="#READ_SHORT"><span class="c003">READ_SHORT</span></a>
or <a href="#WRITE_LONG"><span class="c003">WRITE_LONG</span></a>. It’s so confusing," don’t worry, cause
it kind of is if you’ve never worked with bytes before. Here’s a very brief
synopsis.</p><p>Use READ/WRITE_SHORT for anything that is two bytes. You can determine this
easily by looking at the field you want to change in the IESDP or the program
Near Infinity and subtracting the next listed field’s offset from the offset
of the field you want to change.</p><p>For example, if I wanted to change Bodhi’s Max HP here’s what I would do.
First look at her creature file in NI. (She has many, but for the sake of
argument, we’ll use bodhi.cre). If you look at the Max HP field, it says
it’s offset is 26h. The next field in the creature file is Animation ID,
which is 28h. So, subtracting 28h from 26h gives you 2h. The perfect
<a href="#WRITE_SHORT"><span class="c003">WRITE_SHORT</span></a> size.</p><p>Use READ/WRITE_LONG for anything that is 4 bytes. Use the above example to
figure this out as well.</p><p>Use READ/WRITE_BYTE for anything that is one byte. Again, use the
above example to figure this out.</p><p>Use <a href="#WRITE_ASCII"><span class="c003">WRITE_ASCII</span></a> for things like script name, dialogues, scripts,
etc. Note, that if you’re <a href="#WRITE_ASCII"><span class="c003">WRITE_ASCII</span></a>ing to say, the script name,
and the previous script-name entry is longer than the one
you’re writing, then you’ll have spillover after <a href="#WRITE_ASCII"><span class="c003">WRITE_ASCII</span></a>. To
avoid this, specify a required size that equals the length of the script-name field.
So, if I have
</p><pre class="verbatim">WRITE_ASCII 0x280 ~Guy~
</pre><p>
I would actually want to write this
</p><pre class="verbatim">WRITE_ASCII 0x280 ~Guy~ #32
</pre><p>These are by no means "hard and fast" rules, but generally they ring true.</p><p>Also, if you tried to run the template, you’d have noticed that it didn’t work
correctly. That’s because there are some corrupt files in the key (that is,
files of size 0). To avoid that, WeiDU gives us the <code>SOURCE_SIZE</code> variable,
which is set to the original file size, in number of bytes. We can simply check that the
file is large enough. Using either NI or the IESDP, we see that a basic itm file must be
least 0x72 bytes long, so we can check that before doing anything:</p><pre class="verbatim">COPY_EXISTING_REGEXP ~.*\.itm~ ~override~
  PATCH_IF (SOURCE_SIZE &gt; 0x71) BEGIN
    READ_SHORT 0x1c type

    PATCH_IF (type = 0x14) BEGIN
      WRITE_BYTE 0x26 10
    END
  END
BUT_ONLY_IF_IT_CHANGES
</pre><p>Again, we instruct WeiDU to not do a thing if the file is not large enough.</p><p>And that, as they say, is that.</p>
<!--TOC subsection id="sec26" <span class="c003">values and expressions (Last update: v232)</span>-->
<h3 class="subsection" id="sec26">10.4  <a href="#value"><span class="c003">value</span></a>s and expressions (Last update: v232)</h3><!--SEC END --><p>
This tutorial was thoughtfully provided by Japheth, and shamelessly edited
by Bigg to use PATCH_IF rather than IF_EVAL. It was then further edited by
Wisp to conform to contemporary good practices.</p><p><span class="c007">Note well:</span> This tutorial can be considered an example of how to use
WeiDU’s low-level functionality. The preferred way of accomplishing the task in
this tutorial (adding items to creatures) is with <a href="#ADD_CRE_ITEM"><span class="c003">ADD_CRE_ITEM</span></a>. Many
other things can and should today also be done with higher-level functionality.</p><p>Using expressions with WeiDU can get quite complex, however the power they
give you is more than worth the effort in learning how to use them.</p><p>Say, for instance, that you want to give a creature file a shield that
doesn’t have one originally. The old way to do this would be to add the
item to the creature file using Near Infinity or ShadowKeeper and then copy
that creature file over upon installation of your mod. However, now that
INSERT/DELETE_BYTES and READ/WRITE_BYTE/LONG/SHORT take expressions, we can
do this "on the fly" when installing your mod.</p><p>The benefits of doing it this way should be obvious. Now you no longer
have to overwrite someone else’s modifications to that creature file. You
can simply add your shield and leave their modifications intact. (Unless
of course *they* also decided to give the exact same creature a shield.
And if that’s the case, the shield you specify won’t be used because of our
<a href="#PATCH_IF"><span class="c003">PATCH_IF</span></a> statement.)</p><p>Anyways, on to the example. I’ll use acolyte1.cre as my example creature.</p><p><span class="c007">Caveat:</span> This will only work on standard-ordered creature files, for
which
</p><pre class="verbatim">known_spells_offset &lt;=
memorization_offset &lt;=
memorized_spells_offset &lt;=
effects_offset &lt;=
items_offset &lt;=
item_slots_offset
</pre><p>The first thing we want to do is copy the creature over so it’s ready for
patching, and ensure it isn’t corrupt. That’s easy to do using a simple
<a href="#COPY_EXISTING"><span class="c003">COPY_EXISTING</span></a> statement:</p><pre class="verbatim">COPY_EXISTING ~acolyte1.cre~ ~override~
  PATCH_IF (SOURCE_SIZE &gt; 0x2d3) BEGIN
</pre><p>Next, we need to read in the offsets so we know where to insert our bytes and
where to update our number of items. I figured out these offsets by simply
viewing the creature file in Near Infinity.</p><p>The offsets we need to read in are the item slots offset, the items offset and
the number of items. This is how we do it:</p><pre class="verbatim">READ_LONG 0x2bc itemsoffset
READ_LONG 0x2b8 itemslot
READ_LONG 0x2c0 numberofitems
</pre><p>"itemsoffset", "itemslot" and "numberofitems" can be anything you choose, but I
would name them something that’s easy to remember because we’ll be using
them later.</p><p>Next, we’re going to read in the shield slot to make sure that it’s empty.
We do this by taking the "itemslot" variable and adding 0x04 to it which we
know is always going to be the shield slot. (You can verify this by
looking at a creature file in NI. If you look at the offset 0x2b8 it will
have the offset for item slots. If you add 0x04 to that number, it should
equal the offset for the shield slot.)</p><p>This is done like so:</p><pre class="verbatim">READ_SSHORT (itemslot + 0x04) shield
</pre><p>We want to tell WeiDU only to do this if the shield slot is
*empty*. This is where <a href="#PATCH_IF"><span class="c003">PATCH_IF</span></a> comes in handy. The way a creature
file is setup is that if a slot is set to -1, it means it’s empty. WeiDU can
read signed values with e.g., <a href="#READ_SSHORT"><span class="c003">READ_SSHORT</span></a>. Signed values are ones for
which a subset of values are interpreted as having a negative sign. In this
example, if we were to read the value with <span class="c003">READ_SHORT</span> instead, all values
would be interpreted as positive (so instead of -1, the value of "shield" would
be 65535).</p><pre class="verbatim">PATCH_IF (shield = "-1") BEGIN
</pre><p>Now, we have to update the shield slot to reflect that it’s the newest item
out of all the items the creature has equipped. This is a bit misleading
because in the slots part of the creature file, they count from 0. So, all
we need to do is take the value of 0x2c0 (The number of items the creature
has.) and use that as our value to write.</p><p>To do that, this is what we do:</p><pre class="verbatim">WRITE_SHORT (itemslot + 0x04) numberofitems
</pre><p>Now we have to update the itemslot offset value to reflect the fact that
we’re adding a new item to the creature. An item is *always* 0x14 bytes.
We already know the offset of the itemslot offset and we’ve already read
it’s value, so all we need to do is add 0x14 to it</p><pre class="verbatim">WRITE_LONG 0x2b8 (itemslot + 0x14)
</pre><p>The last step before inserting our bytes is to increase the numberofitems by 1 to
reflect the fact that we’ve added an item to the creature. We’ve already
read in the number of items into "numberofitems" so this is dead easy:</p><pre class="verbatim">WRITE_LONG 0x2c0 (numberofitems + 1)
</pre><p>Now we can actually insert out bytes. To do this we have to take the
number of items that the creature has multiplied by 0x14 and add that to
the itemsoffset. (The reason we can’t just insert it right at
"itemsoffset" is because it would mess up the order of the items in game.
If we inserted the shield at the beginning, then the creature would more
than likely have some items equipped in some weird places in the game.)</p><p>This is done like so:</p><pre class="verbatim">INSERT_BYTES (itemsoffset + numberofitems * 0x14) 0x14
</pre><p>Now we can actually write our information for our item. You don’t need the
.itm extension at all, just everything before the .itm. And again, since
the item entry is always the first entry in an item field on a creature
file, we just need to use the same formula as above because we’ll be
writing at the same offset that we inserted our bytes at:</p><pre class="verbatim">WRITE_ASCII (itemsoffset + numberofitems * 0x14) ~shld01~
</pre><p>If you wanted to add a magical shield to the creature file and wanted it to
be already identified in the slot, then you would simply have to add 0x10
bytes to the previous expression and <a href="#WRITE_LONG"><span class="c003">WRITE_LONG</span></a> the value of 1.
Like this:</p><pre class="verbatim">WRITE_LONG (itemsoffset + (numberofitems * 0x14) + 0x10) 1
</pre><p>Finally, we close the PATCH_IF statements and add BUT_ONLY_IF_CHANGES.</p><pre class="verbatim">    END
  END
BUT_ONLY_IF_IT_CHANGES
</pre><p>Here’s the full code:</p><pre class="verbatim">COPY_EXISTING ~acolyte1.cre~ ~override~
  PATCH_IF (SOURCE_SIZE &gt; 0x2d3) BEGIN
    READ_LONG 0x2bc itemsoffset
    READ_LONG 0x2b8 itemslot
    READ_LONG 0x2c0 numberofitems
    READ_SSHORT (itemslot + 0x04) shield

    PATCH_IF (shield = "-1") BEGIN

      WRITE_SHORT (itemslot + 0x04) numberofitems
      WRITE_LONG 0x2b8 (itemslot + 0x14)
      WRITE_LONG 0x2c0 (numberofitems + 1)

      INSERT_BYTES (itemsoffset + numberofitems * 0x14) 0x14

      WRITE_ASCII (itemsoffset + numberofitems * 0x14) ~shld01~
    END
  END
BUT_ONLY_IF_IT_CHANGES
</pre><p>Note that you can use the <a href="#PRINT"><span class="c003">PRINT</span></a> action in a <a href="#TP2"><span class="c003">TP2</span></a> to debug
your code as well. Like this:</p><pre class="verbatim">COPY_EXISTING ~acolyte1.cre~ ~override~
  PATCH_IF (SOURCE_SIZE &gt; 0x2d3) BEGIN
    READ_LONG 0x2bc itemsoffset
    READ_LONG 0x2b8 itemslot
    READ_LONG 0x2c0 numberofitems
    READ_SSHORT (itemslot + 0x04) shield

    PATCH_IF (shield = "-1") BEGIN

      WRITE_SHORT (itemslot + 0x04) numberofitems
      WRITE_LONG 0x2b8 (itemslot + 0x14)
      WRITE_LONG 0x2c0 (numberofitems + 1)

      INSERT_BYTES (itemsoffset + numberofitems * 0x14) 0x14

      WRITE_ASCII (itemsoffset + numberofitems * 0x14) ~shld01~
    END
  END
BUT_ONLY_IF_IT_CHANGES

PRINT ~The value of the items offset is %itemsoffset%~
</pre><p>I should also mention that the above code for adding an item to a creature
file is "portable" in a sense. You would only have to change a couple
things. The changes that would have to be made are as follows:</p><ol class="enumerate" type=1><li class="li-enumerate">
Change acolyte1.cre to the actual creature that you want to modify
</li><li class="li-enumerate">You’ll have to change ("itemslot" + 0x04) to something else if you
are adding anything else but a shield. You can figure this out by
subtracting the slot offset of the slot you want to modify from the item
slots offset.
</li><li class="li-enumerate">You would need to change  shld01  to the item you are going to add.
</li><li class="li-enumerate">You’d have to add your own flags if they need adding (i.e.
Identified, Not Stealable, etc.).
</li></ol><p>And that’s the end of it. All this can be a bit tricky, but as I mentioned
above, it can be quite powerful as well.</p><p><a id="sec-add-store-item"></a></p>
<!--TOC subsection id="sec27" <span class="c003">ADD_STORE_ITEM</span> (Last Update: v211)-->
<h3 class="subsection" id="sec27">10.5  <span class="c003">ADD_STORE_ITEM</span> (Last Update: v211)</h3><!--SEC END --><p>
This tutorial and this feature were thoughtfully provided by Japheth.</p><p>Using ADD_STORE_ITEM is a relatively painless procedure. Consider this
example: I want to add a new item to <span class="c003">ribald.sto</span> in BGII. There were
two ways of doing this before.</p><ol class="enumerate" type=1><li class="li-enumerate">
I could add the item to the store beforehand and then simply copy over
the new store file upon installing my mod.</li><li class="li-enumerate">I could use WeiDU’s <a href="#READ_BYTE"><span class="c003">READ_BYTE</span></a> and <a href="#WRITE_BYTE"><span class="c003">WRITE_BYTE</span></a> patch
expressions to patch the item into the store while installing.
</li></ol><p>Now we can do #2 rather easily thanks to ADD_STORE_ITEM.</p><p>First off copy over the store file to set it up for patching as you
normally would.</p><pre class="verbatim">COPY_EXISTING ~ribald.sto~ ~override~
</pre><p>Next we issue the ADD_STORE_ITEM patch expression with the following
arguments:</p><pre class="verbatim">ADD_STORE_ITEM "myitem" #10 #0 #0 ~IDENTIFIED~ #5
</pre><p>"myitem" is the name of the item file that we will want to appear in the
store without it’s .itm extension.
#10 is the first extension headers number of charges
The two #0s that follow are the second and third extension headers number
of charges.
 IDENTIFED  is the flag that we want on the item.</p><p>#5 is the number of items that will be in stock.</p><p>Pretty easy stuff right?</p><p>You can also add an optional + after ADD_STORE_ITEM if you want to
overwrite an item that already exists in the store.</p><p>So, if we wanted to replace HAMM05.ITM in ribald.sto this is what we’d
do:</p><pre class="verbatim">ADD_STORE_ITEM + ~hamm05~ #10 #0 #0 ~IDENTIFIED~ #5
</pre><p>One final note: remember to copy over your new item because
ADD_STORE_ITEM doesn’t do that part for you.</p><p>So, a complete set of actions that would patch a store file and copy over
the new item would look like this:</p><pre class="verbatim">COPY_EXISTING ~ribald.sto~ ~override~
ADD_STORE_ITEM ~myitem~ #10 #0 #0 ~IDENTIFIED~ #5

COPY ~mymod/myitem.itm~ ~override~
</pre><p>Note that you can also add a final optional string argument if you want
the store to have unlimited copies of that item:</p><pre class="verbatim">ADD_STORE_ITEM ~myitem~ #10 #0 #0 ~IDENTIFIED~ #1 ~UNLIMITED~
</pre><p>Note that as of v188 you can specify the position of the item being added:
</p><pre class="verbatim">COPY_EXISTING ~ribald.sto~ ~override~
  ADD_STORE_ITEM ~myitem~   AFTER  ~olditem~ #10 #0 #0 ~IDENTIFIED~ #5
  ADD_STORE_ITEM ~otheritm~ BEFORE ~olditem~ #10 #0 #0 ~IDENTIFIED~ #5
</pre><p>
Valid options for position are:</p><p><span class="c003">FIRST</span> will add the item at the top of the stack.
This is the default, equivalent to putting nothing there.</p><p><span class="c003">LAST</span> will add the item to the bottom of the stack.</p><p><span class="c003">BEFORE  olditem </span> will add the item exactly before olditem,
or to the top of the stack if olditem is missing.</p><p><span class="c003">AFTER  olditem </span> will add the item exactly after olditem,
or to the bottom of the stack if olditem is missing.</p><p>As of 192, if there’s a list of items in BEFORE|AFTER olditem (IE <code>~item1 item2 item3~</code>),
we add the new item BEFORE or AFTER the first item that is present in the list.</p><p>As of 211, you can specify a (zero-based) hardcoded position via <code>AT position</code>.</p><p><a id="sec-add-gam-npc"></a></p>
<!--TOC subsection id="sec28" <span class="c003">ADD_GAM_NPC</span>-->
<h3 class="subsection" id="sec28">10.6  <span class="c003">ADD_GAM_NPC</span></h3><!--SEC END --><p>
This tutorial and this feature were thoughtfully provided by Japheth.</p><p>In BGII, the game engine was refined so that when any NPC joined your party
they would be added to the baldur.gam file, regardless of the fact if they
were in there already or not.</p><p>Sadly, in BG1 this is not the case. If you were to simply CreateCreature
any old NPC and add them to your party, as soon as you moved to another
area the game would crash and die.</p><p>This is where ADD_GAM_NPC comes in handy for all you BG1 modders out there.</p><p>By using ADD_GAM_NPC you can patch your NPC into all the <span class="c003">baldur.gam</span>
files on an end users install. This includes the default <a href="#GAM"><span class="c003">GAM</span></a> file
that’s loaded up when you start a new game as well as all the <a href="#GAM"><span class="c003">GAM</span></a>
files in the <span class="c003">save</span> and <span class="c003">mpsave</span> directories.</p><p>Note: However, there really is no foolproof way to back up all the save
games, so you may want to warn the end user in a readme to manually back
them up themselves beforehand.</p><p>Anyways, I digress.</p><p>To use ADD_GAM_NPC you have to first copy over the <a href="#CRE"><span class="c003">CRE</span></a> file that
you will want to appear in the <a href="#GAM"><span class="c003">GAM</span></a> file. I’m pretty sure we all
know how to do this, but for completeness, here it is:</p><pre class="verbatim">COPY ~mymod/mynpc.cre~ ~override~
</pre><p>After the <a href="#COPY"><span class="c003">COPY</span></a> statement, make sure you do all your <a href="#SAY"><span class="c003">SAY</span></a>s
and any other type of patching that you’ll want to do for your .cre file.
You will <em>always</em> want to use ADD_GAM_NPC last since you want the
updates to your cre file to be reflected in the <a href="#GAM"><span class="c003">GAM</span></a> file as well.</p><p>Here’s a typical patch statement for most NPC mods:</p><pre class="verbatim">COPY ~mymod/mynpc.cre~ ~override~
  SAY NAME1 ~Japh~
  SAY NAME2 ~Japh~
</pre><p>So, after doing all that, we would issue ADD_GAM_NPC with the following
arguments:</p><pre class="verbatim">ADD_GAM_NPC "mynpc" "ar2600" #123 #456
</pre><p>"mynpc" is the name of your NPCs cre file that you’re copying over without
the .cre extension.</p><p>"ar2600" is the area that you want him/her placed in. In this case we’re
placing the NPC in Candlekeep.</p><p>#123 is the x co-ordinate on the map.</p><p>#456 is the y co-ordinate on the map.</p><p>That’s all there is to it. Just to recap, here’s the full set of
expressions we would use:</p><pre class="verbatim">COPY ~mymod/mynpc.cre~ ~override~
  SAY NAME1 ~Japh~
  SAY NAME2 ~Japh~
  // Do any other patching stuff here

ADD_GAM_NPC ~mynpc~ ~ar2600~ #123 #456
</pre><p>Note: Again, I have to stress the importance of warning the end users to
backup their save and mpsave directories beforehand. There really is no
elegant way to do this via WeiDU (well, maybe there is, but I can’t think
of a way) so I’d just warn them.</p><p><a id="sec-set-2da-entry"></a></p>
<!--TOC subsection id="sec29" <span class="c003">SET_2DA_ENTRY</span>-->
<h3 class="subsection" id="sec29">10.7  <span class="c003">SET_2DA_ENTRY</span></h3><!--SEC END --><p>This tutorial was thoughtfully provided by Idobek.</p><p>There have been some queries about <a href="#SET_2DA_ENTRY"><span class="c003">SET_2DA_ENTRY</span></a> in the WeiDU
forum recently. This is a consolidation of my posts on the subject.
The command takes this form:</p><pre class="verbatim">SET_2DA_ENTRY value value value newEntry
</pre><p>The first value is the row, the second is the column and the third is the
required column count. The entry on the given column of the given row is
set to <span class="c003">newEntry</span>, but only rows with at least as many columns as the
required column count are considered. The upper-left entry is 0,0. For
example, given the following 2DA file:</p><pre class="verbatim">2DA V1.0
*
     ROWNAME        LOWER MIXED HELP
0    RESERVE        *     *     *
1    BERSERKER      25179 25151 25201
2    WIZARD_SLAYER  25180 25152 25203
3    KENSAI         25181 25153 25204
4    CAVALIER       25182 25154 25206
</pre><p>Then the patch:</p><pre class="verbatim">SET_2DA_ENTRY 3 1 5 ~SAMURAI~
</pre><p>would result in:</p><pre class="verbatim">2DA V1.0
*
     ROWNAME        LOWER MIXED HELP
0    RESERVE        *     *     *
1    BERSERKER      25179 25151 25201
2    WIZARD_SLAYER  25180 25152 25203
3    SAMURAI        25181 25153 25204
4    CAVALIER       25182 25154 25206
</pre><p>So the columns and rows you want WeiDU to consider are:</p><pre class="verbatim">      Column0 Column1       Column2 Column3 Column4

              ROWNAME       LOWER   MIXED   HELP
Row0: 0       RESERVE       *       *       *
Row1: 1       BERSERKER     25179   25151   25201
Row2: 2       WIZARD_SLAYER 25180   25152   25203
Row3: 3       KENSAI        25181   25153   25204
Row4: 4       CAVALIER      25182   25154   25206
</pre><p>The total number of columns is five. If, however, you put 1 as your
required column count then you tell WeiDU you want to consider all rows
with at least 1 column. So your row numbers change:</p><pre class="verbatim">Row0: 2DA V1.0
Row1: *
Row2:      ROWNAME        LOWER MIXED HELP
Row3: 0    RESERVE        *     *     *
Row4: 1    BERSERKER      25179 25151 25201
Row5: 2    WIZARD_SLAYER  25180 25152 25203
Row6: 3    KENSAI         25181 25153 25204
Row7: 4    CAVALIER       25182 25154 25206
</pre><p>So the required column count is what you use to tell WeiDU which row you
want to use as row0. So using the code
</p><pre class="verbatim">SET_2DA_ENTRY 3 1 1 ~SAMURAI~
</pre><p>
would result in:</p><pre class="verbatim">2DA V1.0
*
     ROWNAME        LOWER MIXED HELP
0    SAMURAI        *     *     *
1    BERSERKER      25179 25151 25201
2    WIZARD_SLAYER  25180 25152 25203
3    KENSAI         25181 25153 25204
4    CAVALIER       25182 25154 25206
</pre><p>Hopefully, that explains the required column count a little better.</p><p>Finally, if <span class="c003">newEntry</span> is a string that contains any
<span class="c003">%WeiDU_Variables%</span> they are replaced by their values.
That’s the end of this tutorial.</p><p><a id="sec-while"></a></p>
<!--TOC subsection id="sec30" <span class="c003">WHILE</span> Loops (Last update: v232)-->
<h3 class="subsection" id="sec30">10.8  <span class="c003">WHILE</span> Loops (Last update: v232)</h3><!--SEC END --><p>This tutorial was thoughtfully provided by Idobek, and shamelessly edited
by Bigg to use PATCH_IF rather than IF_EVAL, and PATCH_IF rather than WHILE.
It was then further edited by Wisp to make it look slightly more contemporary.</p><p><span class="c007">Note:</span> In almost all circumstances, it is preferable to use <a href="#FOR"><span class="c003">FOR</span></a>
instead.</p><p>So what is a <span class="c003">WHILE</span> loop? Well, very simply put it is a way of
applying the same patch to a file multiple times under a different
condition each time. Or it is a way of applying different patches depending
upon the conditions. This example will show both of these methods. Keeping
in theme we are going to modify the damage done by axes. Now, some axes
have both a melee <em>and</em> a ranged ability. We are going to want to
change both of these abilities but give different damage to ranged and
melee.</p><p>First, as always, we need to copy the files ready for patching, and throw
in the usual sanity check:
</p><pre class="verbatim">COPY_EXISTING_REGEXP ~.*\.itm~ ~override~
  PATCH_IF (SOURCE_SIZE &gt; 0x71) BEGIN
</pre><p>
We only want to modify axes so let’s find out what the item is:
</p><pre class="verbatim">READ_BYTE 0x1c category
</pre><p>
Once we are done with our patching we will use <a href="#PATCH_IF"><span class="c003">PATCH_IF</span></a> to tell
WeiDU to only patch axes:</p><pre class="verbatim">PATCH_IF (category = 25) BEGIN
</pre><p>
Now, we need to find out how many abilities there are and where they are
located:
</p><pre class="verbatim">READ_LONG 0x64 abilitiesoffset
READ_SHORT 0x68 numberofabilities
</pre><p>
So far, so good. Here’s where the fun begins. We want to patch examine
every ability in the item. We use a <span class="c003">WHILE</span> loop to patch the
abilities one by one. We open the loop like so:
</p><pre class="verbatim">WHILE (numberofabilities &gt; 0) BEGIN
</pre><p>
For the <span class="c003">WHILE</span> loop to progress and close we need to modify the
"numberofabilities" variable. We use the <a href="#SET"><span class="c003">SET</span></a> command to do this:</p><pre class="verbatim">SET numberofabilities = (numberofabilities - 1)
END
</pre><p>
These lines are placed at the end of the <span class="c003">WHILE</span> loop. WeiDU will
process the abilities from last to first and reduce the "numberofabilities"
variable by one each time. Once the "numberofabilities" variable hits zero the
<span class="c003">WHILE</span> loop will stop.</p><p>OK, now we need to find out what type of ability we are looking at. Within
an item an ability is 0x38 bytes, abilities also count from 0 within items
so we must take this into account:
</p><pre class="verbatim">READ_BYTE (abilitiesoffset + (numberofabilities - 1) * 0x38) abilitytype
</pre><p>
Now we get to the meat of the patch. This patch is conditional on the
ability type we have just read. First we will deal with the melee damage
patch. We are going to be using a <a href="#PATCH_IF"><span class="c003">PATCH_IF</span></a> command to do this</p><pre class="verbatim">PATCHING (abilitytype = 1) BEGIN
</pre><p>
So we are patching when the ability type is 1 (melee). Time for the actual patch:
</p><pre class="verbatim">WRITE_SHORT (abilitiesoffset + (numberofabilities - 1) * 0x38 + 0x16) 6
WRITE_SHORT (abilitiesoffset + (numberofabilities - 1) * 0x38 + 0x18) 2
</pre><p>
Time to close the PATCH_IF statement.
</p><pre class="verbatim">END
</pre><p>
We use exactly the same method for ranged abilities:
</p><pre class="verbatim">
PATCH_IF (abilitytype = 2) BEGIN
   WRITE_SHORT (abilitiesoffset + (numberofabilities - 1) * 0x38 + 0x16) 12
   WRITE_SHORT (abilitiesoffset + (numberofabilities - 1) * 0x38 + 0x18) 1
END
</pre><p>
We can now close the main loop (using the aforementioned method):
</p><pre class="verbatim">SET numberofabilities = (numberofabilities - 1)
END
</pre><p>
We are done with our patches so we can add our usual END and BUT_ONLY.
</p><pre class="verbatim">END
END
BUT_ONLY_IF_IT_CHANGES
</pre><p>
The full code is:
</p><pre class="verbatim">COPY_EXISTING_REGEXP ~.*\.itm~ ~override~
  PATCH_IF (SOURCE_SIZE &gt; 0x71) BEGIN
    READ_BYTE 0x1c category
    PATCH_IF (category = 25) BEGIN
      READ_LONG 0x64 abilitiesoffset
      READ_SHORT 0x68 numberofabilities
      WHILE (numberofabilities &gt; 0) BEGIN
        READ_BYTE (abilitiesoffset + (numberofabilities - 1) * 0x38) abilitytype
        PATCH_IF (abilitytype = 1) BEGIN
          WRITE_SHORT (abilitiesoffset + (numberofabilities - 1) * 0x38 + 0x16) 6
          WRITE_SHORT (abilitiesoffset + (numberofabilities - 1) * 0x38 + 0x18) 2
        END
        PATCH_IF (abilitytype = 2) BEGIN
          WRITE_SHORT (abilitiesoffset + (numberofabilities - 1) * 0x38 + 0x16) 12
          WRITE_SHORT (abilitiesoffset + (numberofabilities - 1) * 0x38 + 0x18) 1
        END
        SET numberofabilities = (numberofabilities - 1)
      END
    END
  END
BUT_ONLY_IF_IT_CHANGES
</pre><p>So what have we done? Let’s list the steps involved:
</p><ol class="enumerate" type=1><li class="li-enumerate">
First off we copied all the item files ready for patching.
</li><li class="li-enumerate">Then we the read in the item category.
</li><li class="li-enumerate">We also read in the number of abilities and the file location of those abilities.
</li><li class="li-enumerate">We open a <span class="c003">WHILE</span> loop based upon the number of abilities.
</li><li class="li-enumerate">Within the <span class="c003">WHILE</span> loop, we read in the ability type.
</li><li class="li-enumerate">Next we defined a new variable to indicate that we had not yet patched any melee type abilities.
</li><li class="li-enumerate">We opened a <a href="#PATCH_IF"><span class="c003">PATCH_IF</span></a> statement.
</li><li class="li-enumerate">We patched melee abilities to do 2D6 damage.
</li><li class="li-enumerate">We closed this <a href="#PATCH_IF"><span class="c003">PATCH_IF</span></a> loop.
</li><li class="li-enumerate">We repeated steps 6-9 to give the ranged abilities 1D12 damage.
</li><li class="li-enumerate">We closed our main <span class="c003">WHILE</span> loop by reducing the number of abilities by 1 and indicating that it should stop if the number of abilities reached 0.
</li><li class="li-enumerate">We used a <a href="#PATCH_IF"><span class="c003">PATCH_IF</span></a> statement to ensure the patch is only applied to axes.
</li></ol><p>That’s the end of this tutorial.</p>
<!--TOC subsection id="sec31" Bitwise Operators (Last update: v232)-->
<h3 class="subsection" id="sec31">10.9  Bitwise Operators (Last update: v232)</h3><!--SEC END --><p>This tutorial was thoughtfully provided by CamDawg, and shamelessly edited
by Bigg to use PATCH_IF rather than IF_EVAL. It was then further edited by
Wisp to make it look slightly more contemporary.</p><p>This was a topic that I struggled with while trying to convert some kits
with unusual item restrictions. Thanks to WeiDU’s new bitwise operators,
this is a process that can done dynamically and non-destructively and
affect all items of a particular type, even if added or altered by another
mod (assuming yours is installed after others of course ). The basic idea
is to construct a function in WeiDU that:</p><ol class="enumerate" type=1><li class="li-enumerate">
Searches through all item files in the game
</li><li class="li-enumerate">Reads selected data from an item (type, usability, etc)
</li><li class="li-enumerate">Alters specific data on an item without changing anything else
</li></ol><p>This tutorial is basically an expansion on Japheth’s excellent
READ/BYTE/LONG/SHORT tutorial and I suggest you take a look at that before
going further.</p><p>My initial problem came about when trying to make specific items usable or
unusable by a particular class/race/kit. If you look at the item file
structure at IESDP, you see that all of the unusability flags of an item
are controlled by the individual bits of bytes 0x1E, 0x1F, 0x20 and 0x21
for class/race alignment restrictions and 0x29, 0x2B, 0x2D and 0x2F for the
individual kit restrictions. (Near Infinity combines and displays the four
bytes of class/race restrictions as a single chunk of data.)</p><p>A quick aside about notation before I proceed. Numbers in binary (the
strings of bits) are preceded with 0b and hexadecimal numbers (typically
the bytes) are preceded with 0x. Eight bits make a byte and bits are read
right-to-left. So if the second bit is 1 and the rest 0, then the bit would
be written as 0b00000010.</p><p>If you were trying to alter the usability of a specific class or race,
simply using a <a href="#WRITE_BYTE"><span class="c003">WRITE_BYTE</span></a> command on any of these particular bytes
would result in changing the usability of an item by all the classes in the
particular byte. The new bitwise operators provide an easier solution.</p><p>First we need to look at what the new operators <a href="#BAND"><span class="c003">BAND</span></a> and
<a href="#BOR"><span class="c003">BOR</span></a> do with bits. They are both ways of combining two bytes, based
on different rules. Both <a href="#BAND"><span class="c003">BAND</span></a> and <a href="#BOR"><span class="c003">BOR</span></a> compare the
individual bits (bit 0 vs bit 0, bit 1 vs bit 1, etc. all the way through
bit 7 vs bit 7) of two bytes. For each individual bit, the following tables
are used to determine the value:</p><pre class="verbatim">0 BAND 0 = 0
0 BAND 1 = 0
1 BAND 0 = 0
1 BAND 1 = 1

0 BOR 0 = 0
0 BOR 1 = 1
1 BOR 0 = 1
1 BOR 1 = 1
</pre><p>So if byte 0x23 is 0b00110101 and byte 0x24 is 0b10010001, then 0x23 BAND
0x24 is 0b00010001 whereas 0x23 BOR 0x24 is 0b10110101.</p><p>Back to relating this to unusability in items. For an item to be flagged as
unusable, the corresponding bit must be set to 1. A 0 means a particular
item is usable by the class/race. Let’s look at the example of changing
mage robes usable by bards. This would go into your TP2 file.</p><pre class="verbatim">COPY_EXISTING_REGEXP GLOB ~.*\.itm~ ~override~ //copies all item files
  PATCH_IF (SOURCE_SIZE &gt; 0x71) BEGIN // avoid crashing on empty items
    READ_BYTE    0x20 mage //reads the byte containing the mage usability flag
    PATCH_IF ((mage BAND 0b00000100) = 0b00000000) BEGIN // if it is usable by mages
      READ_BYTE    0x1E bard //reads the byte containing bard usability flag
      READ_SHORT    0x1C type //reads the byte containing item type
      PATCH_IF (type = 67) OR (type = 2) BEGIN // if it is a robe or armor
        WRITE_BYTE    0x1E (bard BAND 0b10111111)  // makes usable by bards
      END
    END
  END
BUT_ONLY_IF_IT_CHANGES
</pre><p>This is the same basic idea in Japheth’s BYTE tutorial , except now we’re
utilizing the bitwise operators in the writing and evaluation commands. The
mage usability flag is the bit 2 in byte 0x20 (IESDP). By checking "mage"
BAND 0b00000100, the values of any of the 7 other bits (0-1,3-7) are set to
0, whereas bit 2 is equal to 0 if and only if it is 0 to begin with.
Therefore the statement will only be true if the item is usable by mages
(bit 2 = 0). If that is true and the item is a robe or armor, then we write
("bard" BAND 0b10111111) into the bard usability byte, 0x1E. By using 1
in bits 0-5 and 7, this ensures that the original value of the flag is
preserved, and using 0 in bit 6 ensures that bit 6 is set to 0 regardless
of its previous value--making it usable by bards whether it was before or
not.</p><p>Just as an aside, you could read the entire usability block with a
<a href="#READ_LONG"><span class="c003">READ_LONG</span></a> at 0x1E. However, it becomes a pain because then you need
to start writing out all 32 bits when doing the bitwise operations.</p><p>Let’s try another example. Let’s try making large weapons such as
two-handed swords and halberds unusable by short folks--gnomes, halflings,
and dwarves.</p><pre class="verbatim">COPY_EXISTING_REGEXP GLOB ~.*\.itm~ ~override~ //copies all item files
  PATCH_IF (SOURCE_SIZE &gt; 0x71) BEGIN // avoid crashing on empty items
    READ_BYTE    0x21 race //reads the byte containing race usability flags we're interested in
    READ_BYTE    0x31 prof //reads the byte containing item type
    PATCH_IF (prof = 93) OR    // two-handed sword
             (prof = 99) BEGIN // or halberd
      WRITE_BYTE    0x21 (race BOR 0b00010101)  // makes unusable by dwarves, halflings, and gnomes
    END
  END
BUT_ONLY_IF_IT_CHANGES

</pre><p>In this case, rather than reading the ’type’ byte of the item, I’ve opted
for the ’proficiency’ byte. Many two-handed swords in BG2 are classed as
long swords for some reason so in this case proficiency is a better
indicator if it is a two-handed sword IMHO.</p><p>The unusability flags for dwarves, halflings and gnomes are all in byte
0x2F at bits 0, 2, and 4 respectively (thanks again IESDP). By writing
"race" BOR 0b00010101 to byte 0x2F we’re preserving the values of bits
1,3, and 5-7 while setting the 0, 2, and 4 bits to 1 (unusable) regardless
of their previous values.</p><p>Thanks especially to Smoketest for helping me with this, Japheth for the
tutorial that inspired this and the help given, and the IESDP team.</p><p><a id="sec-scripting-styles"></a></p>
<!--TOC subsection id="sec32" Scripting Styles (Last Update: v232)-->
<h3 class="subsection" id="sec32">10.10  Scripting Styles (Last Update: v232)</h3><!--SEC END --><p>While the <a href="#BCS"><span class="c003">BCS</span></a> and <a href="#BAF"><span class="c003">BAF</span></a> script formats are common to all
Infinity Engine games, there are three main variants. The variations deal
largely with how “object parameters” are expressed. The style used by
Baldur’s Gate, Baldur’s Gate 2, and Icewind Dale is considered to be the
default. This document will not explain Infinity Engine scripting -- look
for a tutorial elsewhere.</p><table class="c000 cellpadding1" border=1><tr><td class="c012">BG BAF Object</td><td class="c014"><span class="c003">EA.GENERAL.RACE.CLASS.SPECIFIC.GENDER.ALIGN</span> </td></tr>
<tr><td class="c012">PST BAF Object</td><td class="c014"><span class="c003">EA.FACTION.TEAM.GENERAL.RACE.CLASS.SPECIFIC.GENDER.ALIGN</span> </td></tr>
<tr><td class="c012">IWD2 BAF Object</td><td class="c014"><span class="c003">EA.GENERAL.RACE.SUBRACE.CLASS.SPECIFIC.GENDER.ALIGNMNT</span> </td></tr>
</table><p>If <span class="c003">SUBRACE.IDS</span> is present in <span class="c003">CHITIN.</span><a href="#KEY"><span class="c003">KEY</span></a>, the scripting
style is autodetected as IWD2. Otherwise, if <span class="c003">BONES.IDS</span> is present,
the scripting style is autodetected as PST. Otherwise, if <span class="c003">CLOWNRAN.IDS</span> is
present, the scripting syle is autodetected as IWD1. Otherwise, if <span class="c003">FLYTHR01.MVE</span>
is present, the scripting style is autodetected as BG2. Otherwise, if <span class="c003">OH1000.ARE</span>
or <span class="c003">OH6000.ARE</span> are present, the scripting style is autodetected as BGEE/BG2.
Otherwise the scripting style is set to BG1. The <span class="c003">--script-style</span> command-line
argument and the <a href="#SCRIPT_STYLE"><span class="c003">SCRIPT_STYLE</span></a> <a href="#TP2"><span class="c003">TP2</span></a> flag both override this default.
You should not need to use <span class="c003">--script-style</span> explicitly if the
<span class="c003">--game</span> is set correctly.</p><p>Furthermore, the scripting style is coupled with the format used for TLK strings. If
the scripting style is BG2, strings are stored in the BG2 format.</p><p>Also, <span class="c003">IWD1</span> and <span class="c003">IWD2</span> have different rules for parsing certain IDS files,
which contain spaces and/or commas in the tokens.</p><p><a id="sec-subcomponent"></a></p>
<!--TOC subsection id="sec33" TP2 <span class="c003">SUBCOMPONENT</span> Groups (Last Update: v192)-->
<h3 class="subsection" id="sec33">10.11  TP2 <span class="c003">SUBCOMPONENT</span> Groups (Last Update: v192)</h3><!--SEC END --><p>This tutorial was thoughtfully provided by CamDawg, and edited by the Bigg
to account for FORCED_SUBCOMPONENT.</p><p><span class="c003">SUBCOMPONENT</span>s allow to group together a set of mutually exclusive mod
components into a single menu-style selection. The primary purpose of
<span class="c003">SUBCOMPONENT</span>s is to streamline mod installation and to make life easier for
end users. For example, <span class="c003">SUBCOMPONENT</span>s are ideal if you wish to provide
multiple portrait selections for an NPC mod, have several kits available to
one NPC, or for changes that conflict with one another (i.e. raising an XP
cap to 10 million or raising it to 20 million). We’ll use the first
one (multiple portrait options) as an example.</p><p>Without <span class="c003">SUBCOMPONENT</span>s, the install dialogue would look something like this:</p><pre class="verbatim">Install Component [Delainy Portrait 1 by Bob]?
[I]nstall, [N]ot Install, or [Q]uit

Install Component [Delainy Portrait 2 by Fred]?
[I]nstall, [N]ot Install, or [Q]uit

Install Component [Delainy Portrait 3 by Wilhelmus]?
[I]nstall, [N]ot Install, or [Q]uit
</pre><p>The end user would need to click through the options each time. Worse,
conflicting components could be installed. These problems can be limited
somewhat by judicious use of predicates, but taking advantage of the
<span class="c003">SUBCOMPONENT</span> feature yields far superior results:</p><pre class="verbatim">Install Component [Delainy Portrait]?
[N]o, [Q]uit, or choose one:
 1] Portrait 1 by Bob
 2] Portrait 2 by Fred
 3] Portrait 3 by Wilhelmus
</pre><p>Only one of these options can be installed at any time; re-installing
and selecting a different <span class="c003">SUBCOMPONENT</span> will automatically uninstall the
previously installed one. Setting this up is dead simple:</p><pre class="verbatim">BEGIN ~Portrait 1 by Bob~
/* The string above is displayed in the subcomponent listing, i.e. the list
with 1] 2] 3] etc. You can, of course, use TRA references instead for this
and the SUBCOMPONENT string below. */
SUBCOMPONENT ~ Delainy Portrait~
/* The string above is displayed as the component listing and must be the
same for each SUBCOMPONENT. The tp2 code that follows is only executed if
this SUBCOMPONENT is selected. */
COPY ~Delainy/portraits/opt1G.bmp~ ~override/CDDELAIG.bmp~
COPY ~Delainy/portraits/opt1M.bmp~ ~override/CDDELAIM.bmp~
COPY ~Delainy/portraits/opt1S.bmp~ ~override/CDDELAIS.bmp~

BEGIN ~Portrait 2 by Fred~
SUBCOMPONENT ~ Delainy Portrait~
COPY ~Delainy/portraits/opt2G.bmp~ ~override/CDDELAIG.bmp~
COPY ~Delainy/portraits/opt2M.bmp~ ~override/CDDELAIM.bmp~
COPY ~Delainy/portraits/opt2S.bmp~ ~override/CDDELAIS.bmp~

BEGIN ~Portrait 3 by Wilhelmus~
SUBCOMPONENT ~ Delainy Portrait~
COPY ~Delainy/portraits/opt3G.bmp~ ~override/CDDELAIG.bmp~
COPY ~Delainy/portraits/opt3M.bmp~ ~override/CDDELAIM.bmp~
COPY ~Delainy/portraits/opt3S.bmp~ ~override/CDDELAIS.bmp~
</pre><p>Any <a href="#REQUIRE_FILE"><span class="c003">REQUIRE_FILE</span></a>s or other module requirements for the whole group
should be put with the first subcomponent. If such a requirement fails,
none of the subcomponents can be installed. In addition, each individual
subcomponent can be guarded by its own predicate. If that predicate fails,
that particular subcomponent cannot be installed. Example:</p><pre class="verbatim">BEGIN ~Imoen: Turnip-Mage~
SUBCOMPONENT ~Imoen Mage Kit~ (FILE_EXISTS_IN_GAME ~turnip.spl~)
  // This particular subcomponent will only be displayed if TURNIP.SPL
  // exists. If it does not, you can still install other subcomponents.
</pre><p>One note about <span class="c003">SUBCOMPONENT</span>s and mod ordering: WeiDU will display
<span class="c003">SUBCOMPONENT</span>s in a single grouping no matter if they fall consecutively
in the <a href="#TP2"><span class="c003">TP2</span></a>. However, the component number (the one that gets placed in
<span class="c003">weidu.log</span> and the one you check for in <a href="#REQUIRE_COMPONENT"><span class="c003">REQUIRE_COMPONENT</span></a> et al.) is
still based on their <a href="#TP2"><span class="c003">TP2</span></a> order.</p><p>As of v192, if all subcomponents fail their requirement, then we don’t ask about
the specific group; moreover, if at least one of the subcomponents is defined with
<span class="c003">FORCED_SUBCOMPONENT</span> rather than <span class="c003">SUBCOMPONENT</span>, then the user is forced to
install one of them. This could be useful if you want to ask the user if he wants
biffing of wav files or not (as you need different actions for either choice).</p><p><a id="sec-add-cre-item"></a></p>
<!--TOC subsection id="sec34" <span class="c003">ADD_CRE_ITEM</span> (Last Update: v240)-->
<h3 class="subsection" id="sec34">10.12  <span class="c003">ADD_CRE_ITEM</span> (Last Update: v240)</h3><!--SEC END --><p>
This tutorial was thoughtfully provided by Japheth.</p><p>This command is a little bit more complex.</p><p>Here is the syntax:</p><pre class="verbatim">COPY_EXISTING ~alynar.cre~ ~override~
  ADD_CRE_ITEM ~itemname~ #charge1 #charge2 #charge3 ~Flags~ ~Inventory Slots~ [EQUIP] [TWOHANDED] [NOMOVE]
</pre><p><span class="c003">EQUIP</span> and <span class="c003">TWOHANDED</span> are optional and are only needed when
dealing with weapons. <span class="c003">NOMOVE</span> is likewise optional and controls
whether <span class="c003">ADD_CRE_ITEM</span> should move items to make room for the new
item. If no items are moved and there are no empty slots, the new item
will not be added. Conversely, if an item is moved and there is no
empty slot into which to move it, the moved item is lost.</p><p>I’ll give some examples now.</p><p>Example #1:</p><p>If I want to add a Ring of Protection to Sir Alynar, here’s what I’d do:</p><pre class="verbatim">COPY_EXISTING ~alynar.cre~ ~override~
  ADD_CRE_ITEM ~ring06~ #0 #0 #0 ~IDENTIFIED~ ~RRING LRING~
</pre><p>This will add the item to his right ring slot. If that slot is full, it
will be added to the left ring slot. If both are full, we move the current
right ring (the first slot in the list) to an an empty inventory slot so
that the Ring of Protection is still put in it’s appropriate slot.</p><p>Example #2:</p><p>If I want to add a +2 Longsword to his second weapon slot, but <em>don’t</em>
want to equip it, here’s what I’d do:</p><pre class="verbatim">COPY_EXISTING ~alynar.cre~ ~override~
  ADD_CRE_ITEM ~sw1h06~ #0 #0 #0 ~IDENTIFIED~ ~WEAPON2~
</pre><p>Again, if there happens to be a weapon in his second weapon slot already,
then we simply move that weapon to an empty inventory slot.</p><p>Example #3:</p><p>Same deal as example #2 except now I want to equip the sword.</p><pre class="verbatim">COPY_EXISTING ~alynar.cre~ ~override~
  ADD_CRE_ITEM ~sw1h06~ #0 #0 #0 ~IDENTIFIED~ ~WEAPON2~ EQUIP
</pre><p>This will put the sword in his second weapon slot and equip it. And again,
if there’s already a weapon in that slot, it will be moved to an empty
inventory slot.</p><p>Example #4:</p><p>If you want to add a two-handed weapon <em>and</em> equip it, here’s what you do:</p><pre class="verbatim">COPY_EXISTING ~alynar.cre~ ~override~
  ADD_CRE_ITEM ~sw2h01~ #0 #0 #0 ~NONE~ ~WEAPON2~ EQUIP TWOHANDED
</pre><p>This will place the item in the second weapon slot (and again, if there’s
already a weapon there it’s moved to inventory), remove anything that’s in
the shield slot and put it in an empty inventory slot and finally it will
equip the weapon.</p><p>If you just want to add a two-handed weapon to a cre but don’t need it
equipped, then you don’t have to worry about specifying <span class="c003">EQUIP</span> or
<span class="c003">TWOHANDED</span>.</p><p>Finally, it is worth noting that any WeiDU variables inside <span class="c003">%</span>s in the
<span class="c003">itemname</span> will be replaced by their values.</p><p>Phew, that’s it.</p><p>Note: starting from v189, you can use INV, QITEM, QUIVER, WEAPON and RING as
shortcuts respectively
to INV1 INV2 ... INV15 INV16, QITEM1 QITEM2 QITEM3, QUIVER1 QUIVER2 QUIVER3,
WEAPON1...WEAPON4, RRING LRING.</p><p>In IWD2, INV unfolds to INV1..INV24, SHIELD to SHIELD1..4.</p><p>In PST, INV unfolds to INV1..20, TATTOO to TATTOO1..3, EARRING to EARING1..2,
QITEM to QITEM1..5, QUIVER1..5. PST also supports HAND, but loses SHIELD and
HELMET.</p>
<!--TOC subsection id="Prompt Customization" <span class="c003"><span class="c007">Prompt Customization</span></span>-->
<h3 class="subsection" id="Prompt Customization">10.13  <span class="c005">Prompt Customization</span><a id="hevea_default588"></a></h3><!--SEC END --><p>
This tutorial was thoughtfully provided by Rastor, and edited by Wisp to
clarify the role of <span class="c003">prompts.tra</span>.</p><p>A customized installer can make your mod look more unique to your end user,
giving a feel that “This isn’t your basic, cookie-cutter mod.” WeiDU
actually allows for a great deal of customization of the mod installer
program (ie. the <span class="c003">setup-mymod.exe</span> file). For the most part, just about
every line of text can be changed to suit your needs. This tutorial will
show you how.</p><p><span class="c007">Understanding the Installer</span>.
WeiDU, like most computer programs, draws every line of text that it
displays from a series of strings. In a default installer (simply a
renamed weidu.exe and the appropriate .tp2), all of the strings that WeiDU
displays are programmed into WeiDU’s source code. Fortunately, weidu
allows you to overwrite these strings with ones of your own choosing.</p><p><span class="c007">prompts.tra</span>.
In the WeiDU download package (from http://www.weidu.org), you will find a
file in the <span class="c003">examples</span> folder called <span class="c005">prompts.tra</span><a id="prompts.tra"></a><a id="hevea_default589"></a>. This is the
file that you modify to customize your installer. Go look at it now.</p><p>WeiDU defines a number of default tra references, which are displayed
at different points during the installation. The tra-reference numbers
and default text are reproduced in the <span class="c003">prompts.tra</span> file. By
editing or translating this text, and loading the resulting tra
strings as any other, the text displayed by WeiDU can be changed.</p><p><span class="c007">An Example</span>.
Let us assume for a minute that you want the question asking if users want
to install to read:
</p><pre class="verbatim">You are a big stupid moron if you do not install the [Component Name].
Install?
[Y]es you idiot or [N]o, bonehead or [Q]uit
</pre><p>For obvious reasons, you would never want your mod’s installer to
actually say that but it will serve as a good working example.</p><p>To change the install component text, find the section of prompts.tra that
corresponds with the text that you wish to change. In this case, we want
to change <span class="c003">@-1006</span> and <span class="c003">@-1008</span>. If you look at these lines, you will
see a strange <br>
n that does not actually appear when the installer is
running. This is a line feed (or “new line”) character. It simply
indicates that you want any text following it to be inserted below the text
that precedes the line feed.</p><p>The name of the component in your mod is always inserted immediately
following <span class="c003">@-1006</span> without any spaces. This means that you are going to
want to include a space or a bracket or some other distinguishing character
at the end of your new text, otherwise the installer’s text will look
quite strange. The name of the component also is always followed (with no
spaces) by either line <span class="c003">@-1007</span> or <span class="c003">@-1008</span> depending on whether the
component is already installed or not.</p><p>If you want to include more text in your custom line before the <span class="c003">[I]nstall</span> or
<span class="c003">[N]ot Install</span> stuff, then simply place it before the <br>
n character.</p><p>To generate the custom text that I presented above, change the lines in
your prompts.tra file to read:
</p><pre class="verbatim">@-1006= "You are a big stupid moron if you do not install the ["
@-1008= "].  Install?\n[Y]es you idiot or [N]o, bonehead or [Q]uit"
</pre><p>After making these changes, place <span class="c003">prompts.tra</span> into the TRA folder.</p><p>If you are familiar with the default text in the installer, then you will
recognize the all of the lines that are listed in <span class="c003">prompts.tra</span>. You may
change any of the text, but simply remember the meaning of the line feed.
The WeiDU installer will not word wrap, meaning that if you insert
a very large line that is not broken up by <br>
n, the user will not be able
to see all of it. You should do some experimentation to determine the
optimal length for each line (it’s roughly 72 characters).</p><p><span class="c007">What you cannot change</span>.
Although WeiDU does allow for a large degree of customization, there are a
few things that you cannot change. You cannot change the input keys used to
collect the player’s response. You cannot change the <span class="c003">Copying one file</span>
and <span class="c003">Compiling dialogues</span> (and the similar) text.</p><p><a id="sec-inner-action"></a></p>
<!--TOC subsection id="sec36" <span class="c003">INNER_ACTION</span>-->
<h3 class="subsection" id="sec36">10.14  <span class="c003">INNER_ACTION</span></h3><!--SEC END --><p>Normally I would start off with <em>do not use this feature</em>, but since
this <a href="#patch"><span class="c003">patch</span></a> can basically only be used to do really obscure things,
you’re probably already a master if you’re considering it.</p><p>We’ll use <a href="#INNER_ACTION"><span class="c003">INNER_ACTION</span></a> in the context of a hypothetical mod
that causes all monsters to drop special “skins” that can be worn by the
PCs, granting the PCs all of the “natural talents” (e.g., fire
resistance, seeing through invisibility, animation avatar) of that monster.</p><p>First, we will specially prepare a “template” object -- a special blank
“skin” item that has slots equipped effects like “fire resistance bonus
+0” and “natural armor class 10” and “change creature animation”. Each
creature “skin” will be a specialized copy of this template.</p><p>Then we’ll consider each monster in turn. We’ll read the fire resistance
value from the monster and write that value into a copy of the “skin”
item. Then we’ll repeat the process for “armor class”, “cold
resistance”, etc. We’ll also copy over any “CRE effects” the creature
might have (e.g., “can see invisible”) and make them additional equipped
effects of the “skin” item. Finally we’ll add that personalized “skin”
item to the monster’s inventory. If the monster is <span class="c003">C6BODHI.CRE</span>, we’ll
call the skin <span class="c003">C6BODHI.ITM</span>.</p><p>Note that you would normally <em>always</em> use a modder prefix for your new
items and other files.</p><p>We’ll give the code in pieces. First, we want to go over every existing
creature and make sure that <span class="c003">CREATURE.ITM</span> doesn’t already exist in the
game. If it does we won’t make a “skin” for that monster. We’ll also
include a little size sanity check to make sure that we’re not ready any
degenerate 0-byte files.</p><pre class="verbatim">COPY_EXISTING_REGEXP GLOB ~.*\.cre~ ~override~
  PATCH_IF
    (SOURCE_SIZE &gt; 0x2c8) AND
    (NOT FILE_CONTAINS_EVALUATED("%SOURCE_RES%.ITM" "ITM"))
  THEN BEGIN // %SOURCE_RES%.ITM does not exist.
</pre><p>See <span class="c003">SOURCE_RES</span>. Using <span class="c003">"ITM"</span> as the
second argument makes <a href="#FILE_CONTAINS_EVALUATED"><span class="c003">FILE_CONTAINS_EVALUATED</span></a> behave like
<span class="c003">FILE_EXISTS_EVALUATED</span>, since any real item contains <span class="c003">ITM</span> as part of
its header.</p><p>Now we’re going to read the animation, armor class, resistances, and
creature effects. We’ll also equip this creature with its special skin,
even through we haven’t made that skin yet.</p><pre class="verbatim">    READ_SHORT 0x28    anim_id
    READ_SHORT 0x46    natural_ac
    READ_ASCII 0x59    resists (11) // read 11 bytes (even 0's)
    READ_LONG  0x2c4   eff_off
    READ_LONG  0x2c8   num_eff
    READ_ASCII eff_off effects (num_eff * 264)
    ADD_CRE_ITEM ~%SOURCE_RES%~ #0 #0 #0 ~IDENTIFIED~ ~INV10~
</pre><p>Since there are 11 resistances (e.g., fire, cold, magic fire, ...) we are
just leaving them in a string as an array of bytes rather than making up
individual variables for each one. Now we want to go about creating our
special skin item. We’ll use the mysterious <a href="#INNER_ACTION"><span class="c003">INNER_ACTION</span></a> to do so.</p><pre class="verbatim">    INNER_ACTION BEGIN
      COPY ~foo/footemp.itm~ ~override/%SOURCE_RES%.ITM~
        WRITE_SHORT 0x76 anim_id
        WRITE_SHORT 0xa6 natural_ac
</pre><p>Using <a href="#SOURCE_RES"><span class="c003">SOURCE_RES</span></a> as part of a computed <a href="#COPY"><span class="c003">COPY</span></a> destination is
normally somewhat dangerous because it is reset every time you enter a
<a href="#COPY"><span class="c003">COPY</span></a> -- but we’re OK here.</p><p>Our template <span class="c003">footemp.itm</span> item has a number of pre-made equipped
abilities (e.g., no dispel, bypass resistance, apply 100 % of the time to
the wearer, last while equipped) that are just lacking concrete values.
Here we fill in the animation and armor class. Next we’ll do the
resistances:</p><pre class="verbatim">        // copy over all resistances
        FOR (i=0; i&lt;11 ; i=i+1) BEGIN
          INNER_PATCH "%resists%" BEGIN
            READ_BYTE i resist_i
          END
          foo_resist_off = 0xd6 + (i * (0x102 - 0xd2))
          WRITE_LONG foo_resist_off resist_i
        END
</pre><p>For each of the 11 resistances we remember its value from the creature by
using <a href="#INNER_PATCH"><span class="c003">INNER_PATCH</span></a> to get it out of our <span class="c003">resists</span> “array”. The
resistance effects in <span class="c003">footemp.itm</span> are stored in the same order as the
creature resistances are in a <a href="#CRE"><span class="c003">CRE</span></a> file.</p><p>Having handled the standard resistances we now turn to creature effects.
We don’t know in advance how many creature effects there will be, so for
each one we will make a new effect structure and insert it into our skin
item. We’ll get the new effect structure by copying one of the ones that
was already there (called <span class="c003">dummy_eff</span> in the code below).</p><p>Unfortunately, creature effects are not stored in quite the same way as item
effects, so we can’t copy them over directly. Instead, from each creature
effect we’ll extract the opcode, value and resource fields. We end up with
a three step process: (1) insert some bytes into the skin file to hold the new
effect, (2) copy over the <span class="c003">dummy_eff</span> effect structure as a framework,
and (3) fill in the appropriate values from the creature effect. Here it
is:</p><pre class="verbatim">        // copy all CRE effects
        PATCH_IF num_eff &gt; 0 THEN BEGIN
          READ_ASCII 0x72 dummy_eff (0x30)
          FOR (i=0; i&lt;num_eff; i=i+1) BEGIN
            INNER_PATCH "%effects%" BEGIN
              READ_ASCII ((i * 264) +  8) "cre_eff_opcode" (0x4)
              READ_ASCII ((i * 264) + 20) "cre_eff_value"  (0x8)
              READ_ASCII ((i * 264) + 40) "cre_eff_res"    (0x8)
            END
            INSERT_BYTES 0x72 0x30                        // step 1
            WRITE_EVALUATED_ASCII 0x72 "%dummy_eff%"      // step 2
            WRITE_EVALUATED_ASCII 0x72 "%cre_eff_opcode%" // step 3
            WRITE_EVALUATED_ASCII 0x76 "%cre_eff_value%"  // step 3
            WRITE_EVALUATED_ASCII 0x86 "%cre_eff_res%"    // step 3
          END
          READ_SHORT  0x70 num_global_itm_eff
          WRITE_SHORT 0x70 (num_global_itm_eff + num_eff)
        END
    END
</pre><p>Huzzah. Notice our use of variables to “pass information” between the
main copying action and the <a href="#INNER_ACTION"><span class="c003">INNER_ACTION</span></a>. Yes, I hate WeiDU syntax
as well. Why do you ask? Anyway, after that we update the item header to
take into account the new global effects.</p><pre class="verbatim">  END
  BUT_ONLY_IF_IT_CHANGES
</pre><p>Finally we close off our sanity-checks and throw in the ever-popular
<a href="#BUT_ONLY_IF_IT_CHANGES"><span class="c003">BUT_ONLY_IF_IT_CHANGES</span></a>. It would be “easy” (read: annoying and
time-consuming but possible) to extend this hackery so that it also stole
all of the effects from undroppable items held by creature (e.g., most
“undead” immunities are actually stored in <span class="c003">RING95.ITM</span> and not as
creature effects) by nesting yet-another <a href="#INNER_ACTION"><span class="c003">INNER_ACTION</span></a>. You could
even be selective and avoid copying over effects like “minimum hit
points”. Then you could perhaps create an on-the-fly description for the
“skin” item using <a href="#SAY_EVALUATED"><span class="c003">SAY_EVALUATED</span></a>.</p><p>Bonus points if you actually understood this code. Additional bonus points
if you find a real use for <a href="#INNER_ACTION"><span class="c003">INNER_ACTION</span></a> in your mod. As a closing
warning, do not try to re-invent the WeiMorph wheel using a <a href="#TP2"><span class="c003">TP2</span></a>
script -- email Japheth instead.</p><p><a id="sec-set-2da-entry-later-now"></a></p>
<!--TOC subsection id="sec37" <span class="c003">SET_2DA_ENTRY_LATER</span> and <span class="c003">SET_2DA_ENTRIES_NOW</span> (Last Update: v241)-->
<h3 class="subsection" id="sec37">10.15  <span class="c003">SET_2DA_ENTRY_LATER</span> and <span class="c003">SET_2DA_ENTRIES_NOW</span> (Last Update: v241)</h3><!--SEC END --><p><a href="#SET_2DA_ENTRY_LATER"><span class="c003">SET_2DA_ENTRY_LATER</span></a> and <a href="#SET_2DA_ENTRIES_NOW"><span class="c003">SET_2DA_ENTRIES_NOW</span></a> are
extensions of the <a href="#SET_2DA_ENTRY"><span class="c003">SET_2DA_ENTRY</span></a> patch, so you should be
familiar with <span class="c003">SET_2DA_ENTRY</span> before reading this tutorial. A
<a href="#sec-set-2da-entry">tutorial</a> for <span class="c003">SET_2DA_ENTRY</span> exists.</p><p>The main difference between the standard <a href="#SET_2DA_ENTRY"><span class="c003">SET_2DA_ENTRY</span></a> and
these variants is that <span class="c003">SET_2DA_ENTRY</span> changes the file each
instance, while <span class="c003">SET_2DA_ENTRY_LATER</span> stores a list of changes in
memory and relies on <span class="c003">SET_2DA_ENTRIES_NOW</span> to flush the changes and
update the file. This can result in better performance than
<span class="c003">SET_2DA_ENTRY</span>. According to Weimer’s calculations, using the
deferred approach gives an edge when 5 or more <span class="c003">SET_2DA_ENTRY</span> are
to be applied to the same file.</p><p>To illustrate the differences, consider the following code, which allows
for thieves, cleric/thieves and mage/thieves to put 3 proficiency
points in Two-weapon fighting using <span class="c003">SET_2DA_ENTRY</span>:
</p><pre class="verbatim">COPY_EXISTING ~weapprof.2da~ ~override~
  SET_2DA_ENTRY 34 7  1 3
  SET_2DA_ENTRY 34 39 1 3
  SET_2DA_ENTRY 34 40 1 3
</pre><p>Compare this with the equivalent code using <span class="c003">SET_2DA_ENTRY_LATER</span>
and <span class="c003">SET_2DA_ENTRIES_NOW</span>:
</p><pre class="verbatim">COPY_EXISTING ~weapprof.2da~ ~override~
  SET_2DA_ENTRY_LATER ~_#_#_#weapprof~ 34 7  3
  SET_2DA_ENTRY_LATER ~_#_#_#weapprof~ 34 39 3
  SET_2DA_ENTRY_LATER ~_#_#_#weapprof~ 34 40 3
  SET_2DA_ENTRIES_NOW ~_#_#_#weapprof~ 1
</pre><p>The first approach makes three self-contained changes to the 2DA table
in weapprof.2da. Each <span class="c003">SET_2DA_ENTRY</span> loads the table, makes a
change and saves the table.</p><p>The second approach stores three changes to the 2DA table in memory
with <span class="c003">SET_2DA_ENTRY_LATER</span>. Finally, <span class="c003">SET_2DA_ENTRIES_NOW</span> loads
the 2DA table, makes the stored changes and saves the table. The
string <code>~_#_#_#weapprof~</code> is used for storing the changes and
whatever form it takes, it should only be used for
<span class="c003">SET_2DA_ENTRY_LATER</span> and <span class="c003">SET_2DA_ENTRIES_NOW</span>. Avoid using
variables with names containing the same string in other contexts. It
is safe to use the same string in consecutive uses of
<span class="c003">SET_2DA_ENTRY_LATER</span>, but not in parallel
uses. <span class="c003">SET_2DA_ENTRIES_NOW</span> finalizes a series and makes the string
safe to re-use. You can use <span class="c003">%variables%</span> in the string. One
suggestion is to use a prefix specific to <span class="c003">SET_2DA_ENTRY_LATER</span> and
onto that append the name of the file being edited, like
<code>~_#_#_#weapprof~</code>, where <code>_#_#_#</code> is the prefix and
<code>weapprof</code> is the name of the file. It is specifically not safe
to use the same string for <a href="#READ_2DA_ENTRY_FORMER"><span class="c003">READ_2DA_ENTRY_FORMER</span></a> as you are
using for <span class="c003">SET_2DA_ENTRY_LATER</span>.</p>
<!--TOC subsection id="sec38" <span class="c003">READ_2DA_ENTRIES_NOW</span> and <span class="c003">READ_2DA_ENTRY_FORMER</span> (Last Update: v241)-->
<h3 class="subsection" id="sec38">10.16  <span class="c003">READ_2DA_ENTRIES_NOW</span> and <span class="c003">READ_2DA_ENTRY_FORMER</span> (Last Update: v241)</h3><!--SEC END --><p><a href="#READ_2DA_ENTRIES_NOW"><span class="c003">READ_2DA_ENTRIES_NOW</span></a> and <a href="#READ_2DA_ENTRY_FORMER"><span class="c003">READ_2DA_ENTRY_FORMER</span></a> are
extensions of <a href="#READ_2DA_ENTRY"><span class="c003">READ_2DA_ENTRY</span></a>. You are advised to be familiar
with how <a href="#READ_2DA_ENTRY"><span class="c003">READ_2DA_ENTRY</span></a> works before reading this
tutorial.</p><p>Much like how <a href="#SET_2DA_ENTRY_LATER"><span class="c003">SET_2DA_ENTRY_LATER</span></a> and
<a href="#SET_2DA_ENTRIES_NOW"><span class="c003">SET_2DA_ENTRIES_NOW</span></a> offer a performance improvement over
<a href="#SET_2DA_ENTRY"><span class="c003">SET_2DA_ENTRY</span></a> for a sufficiently large number of writes,
<span class="c003">READ_2DA_ENTRIES_NOW</span> and <span class="c003">READ_2DA_ENTRY_FORMER</span> offer a
performance improvement over <span class="c003">READ_2DA_ENTRY</span> for a sufficiently
large number of reads.</p><p>To illustrate the differences, consider the following code, which reads
values from a 2DA file using <span class="c003">READ_2DA_ENTRY</span>:
</p><pre class="verbatim">COPY_EXISTING ~kitlist.2da~ ~override~
  READ_2DA_ENTRY 0 1 9 somevar // somevar will be "RESERVE"
</pre><p>Compare this with the equivalent code using <span class="c003">READ_2DA_ENTRIES_NOW</span>
and <span class="c003">READ_2DA_ENTRY_FORMER</span>:
</p><pre class="verbatim">COPY_EXISTING ~kitlist.2da~ ~override~
  READ_2DA_ENTRIES_NOW ~_#_#_#read_kitlist~ 9
  READ_2DA_ENTRY_FORMER ~_#_#_#read_kitlist~ 0 1 somevar // somevar will be "RESERVE"
</pre><p>In the first approach, each 2DA entry is read in a self-contained
manner. Each time, the 2DA table is loaded and the entry from the given
row and column is extracted and stored in the variable.</p><p>The second approach loads the table once and stores it as an array of
discrete values. Retrieving a value from the table is only a matter of
getting the value of a variable. The names of the storage variables
are derived from the string, <code>~_#_#_#read_kitlist~</code> in this
case. Additionally, a variable <code>%_#_#_#read_kitlist%</code> is defined,
with a value equalling the number of rows that have at least 9
columns. In other words, using <span class="c003">READ_2DA_ENTRIES_NOW</span> additionally
gives you the equivalent of <a href="#COUNT_2DA_ROWS"><span class="c003">COUNT_2DA_ROWS</span></a>. It is not
necessarily safe to make use of the same string in consecutive uses of
<span class="c003">READ_2DA_ENTRIES_NOW</span>. If you have used the same string when
reading from another 2DA table and you attempt to retrieve a value
from a column greater than the required column count, the result is
undefined. It is specifically not safe to use the same string you use
for <span class="c003">READ_2DA_ENTRIES_NOW</span> as you are using for
<a href="#SET_2DA_ENTRY_LATER"><span class="c003">SET_2DA_ENTRY_LATER</span></a>. In this example, the string follows the
same structure as in the <span class="c003">SET_2DA_ENTRY_LATER</span> and
<span class="c003">SET_2DA_ENTRIES_NOW</span> tutorial, but with the string <code>read_</code>
prepended to the file name, to make sure the two strings can never be
identical.</p><p><a id="macros"></a></p>
<!--TOC subsection id="sec39" <span class="c003">DEFINE,LAUNCH,LOCAL</span> and everything else about personal <span class="c003"><span class="c007">macros</span></span> (Last Update: v188)-->
<h3 class="subsection" id="sec39">10.17  <span class="c003">DEFINE,LAUNCH,LOCAL</span> and everything else about personal <span class="c005">macros</span><a id="hevea_default590"></a> (Last Update: v188)</h3><!--SEC END --><p>Macros were originally intended as a way to repeat a certain tp2 block
with small or no changes without resorting to copy-and-paste.</p><p><span class="c007">Note well:</span> In almost all circumstances it is preferable to use functions instead
of macros.</p><p>First, disclaimers: it’s very easy to shoot yourself in the foot, since
there aren’t any limits to the variable scoping of macros. Due to this reason, this tutorial
will skip on most basic stuff - if you’re going to consider this, you should
already be a master of patching. <br>
Also, for brevity, I’ll give only examples involving tp2 actions. You can
do everything you’re about to read here by substituting DEFINE_ACTION_MACRO
and LAUNCH_ACTION_MACRO with DEFINE_PATCH_MACRO and LAUNCH_PATCH_MACRO. There
is no change in the treatment of LOCAL_SPRINT/LOCAL_SET.</p><p>For starters, you might want to define a macro that prints "Hello World!" to
the screen.</p><pre class="verbatim">// at the tp2 flag level, IE after AUTHOR but before components.
DEFINE_ACTION_MACRO ~HW~ BEGIN
  PRINT ~Hello World!~
END

/* ... */

// a component
BEGIN ~Print Hello World and do nothing~
LAUNCH_ACTION_MACRO ~HW~
</pre><p>So, the syntax is quite simple:
</p><pre class="verbatim">DEFINE_ACTION_MACRO name-of-the-macro BEGIN
  local variables list
  action list
END
</pre><p>
will bind the action listed here with name-of-the-macro. We’ll deal with
local variables later. After that, LAUNCH_ACTION_MACRO name-of-the-macro
will work like if you copy-pasted there the action list defined in
DEFINE_ACTION_MACRO.</p><p>Well, suppose you wanted to say ’Hello Jon!’ or ’Hello Jack!’ or any other
name, rather than only ’Hello World!’. Do you have to define a macro for each
of these? Of course not, since all variables defined before the LAUNCH_ACTION_MACRO
instruction is called are not cleared, and so can be read (or written) during execution of the macro.</p><pre class="verbatim">// before calling, have the string ~HW_Name~ contain the name of the person
// to greet.
DEFINE_ACTION_MACRO ~HW~ BEGIN
  PRINT ~Hello %HW_Name%!~
END

/* ... */
OUTER_SPRINT ~HW_Name~ ~Jon~
LAUNCH_ACTION_MACRO ~HW~
OUTER_SPRINT ~HW_Name~ ~Jack~
LAUNCH_ACTION_MACRO ~HW~
</pre><p>Variables inside macros that are changed keep their new value once the
macro has finished being computed. This is bad and good at the same time.
For example, you might want to calculate a factorial:
</p><pre class="verbatim">// set ~factorial_index~ to the factorial you'd like to compute,
// ~factorial_result~ to 1,
// keep a backup copy of ~factorial_index~
// ~factorial_result~ will yield the resulting factorial.
DEFINE_ACTION_MACRO ~factorial~ BEGIN
  ACTION_IF factorial_index != 1 THEN
  BEGIN
    OUTER_SET factorial_result = factorial_result * factorial_index
    OUTER_SET factorial_index = factorial_index - 1
     LAUNCH_ACTION_MACRO ~factorial~
  END
END

/* ... */
OUTER_SET factorial_index_old = 5
OUTER_SET factorial_index = 5
OUTER_SET factorial_result = 1
LAUNCH_ACTION_MACRO ~factorial~
PRINT ~%factorial_index_old%! = %factorial_result%~
</pre><p>
The fact that variables are kept through the entire tp2 execution (formally,
that they are global) is good, since you have a way of ’remembering’ the result;
however, the bad part is that it may happen that variables are changed even if you
didn’t want them to.<br>
Note: risks grow exponentially as you use macros by somebody else.</p><p>By the way, another (rarely) useful feature of macros used here is that they
can call themselves (formally, they are recursive).</p><p>To solve the problem with variables being changed inside a macro, I provided
a rudimentary form of scoping: the aforementioned local variables list part.</p><p>Note: if ’global’ and ’local’ variables mean nothing to you (for example, if you
don’t have experience in programming in real life languages) you might have
problems in understanding the logic beneath the rest of this tutorial. You’ll do
fine with the tutorials about standard macros.</p><p>Basically, at the beginning of the macro declaration, you may use
</p><pre class="verbatim">LOCAL_SET name = value
LOCAL_SPRINT variable string
</pre><p>
to declare a variable as local, and assign it a new value. Use this for all variables
that don’t need to be changed by the macro. After computing the macro, these variables
are set to the value they had before the macro was processed. They work for both
actions and patches. For example, here is a corrected
factorial macro (also converted to patch):
</p><pre class="verbatim">// set ~tb#factorial_index~ to the factorial you'd like to compute,
// ~tb#factorial_result~ to 1,
// ~ftb#actorial_result~ will yield the resulting factorial.
DEFINE_PATCH_MACRO ~tb#factorial~ BEGIN
  LOCAL_SET tb#factorial_index = factorial_index
  PATCH_IF tb#factorial_index != 1 THEN
  BEGIN
    SET tb#factorial_result = tb#factorial_result * tb#factorial_index
    SET tb#factorial_index = tb#factorial_index - 1
    LAUNCH_PATCH_MACRO ~tb#factorial~
  END
END

/* ... */
SET ~tb#factorial_index~ = 5
SET ~tb#factorial_result~ = 1
LAUNCH_PATCH_MACRO ~tb#factorial~
PATCH_PRINT ~%tb#factorial_index%! = %tb#factorial_result%~
</pre>
<!--TOC subsection id="sec40" standard macros (Last Update: v188)-->
<h3 class="subsection" id="sec40">10.18  standard macros (Last Update: v188)</h3><!--SEC END --><p>For your convenience, WeiDU includes some standard macros for you to use.
See <a href="#sec-macros-listing">Macros Listing</a> for a listing of all macros and how to invoke
them in detail. Here I’ll describe the standard syntax.</p><p>In our example, we’ll use the tb#factorial macro (which is the same as the
last example in the preceding tutorial).</p><p>Description (from <a href="#sec-macros-listing">Macros Listing</a>):
<code>tb#factorial</code>: computes the factorial of a number. <br>
This is a PATCH macro.
</p><ul class="itemize"><li class="li-itemize">
SET <code>tb#factorial_index</code> to the factorial you’d like to compute.
</li><li class="li-itemize">SET <code>tb#factorial_result</code> to 1;
</li><li class="li-itemize">The result is <code>tb#factorial_result</code>.
</li></ul><p>Read the instructions on the variables to set:
</p><pre class="verbatim">SET ~tb#factorial_index~ = 5
SET ~tb#factorial_result~ = 1
LAUNCH_PATCH_MACRO ~tb#factorial~
PATCH_PRINT ~%tb#factorial_index%! = %tb#factorial_result%~
</pre><p>
(since you’ve read the warnings from the previous tutorial, standard macros
make use of LOCAL_SET/SPRINT to avoid overwriting variables that shouldn’t
change).</p><p>Another example:</p><p><code>tb#fix_file_size</code>: overwrites all files matching a certain regexp with a
certain standard file, if they are under a certain size. <br>
This is an ACTION macro.
</p><ul class="itemize"><li class="li-itemize">
SET <code>tb#fix_file_size_min</code> to the maximum allowed size
(files whose size is exactly this value are NOT overwritten).
</li><li class="li-itemize">SPRINT <code>tb#fix_file_size_target</code> to the standard file used to replace file(s) that match the regexp.
</li><li class="li-itemize">SPRINT <code>tb#fix_file_size_category</code> to a descriptive name.
</li><li class="li-itemize">SPRINT <code>tb#fix_file_size_regexp</code> to the regexp for the file(s) to be checked for a match.
</li></ul><p>
So, to overwrite all item files that are smaller than 0x72 with sw1h01.itm
(for example the corrupted iplot*.itm files)
</p><pre class="verbatim">OUTER_SET tb#fix_file_size_min = 0x72
OUTER_SPRINT tb#fix_file_size_target "SW1H01.ITM"
OUTER_SPRINT tb#fix_file_size_category "items"
OUTER_SPRINT tb#fix_file_size_regexp "^.*\.itm$"
LAUNCH_ACTION_MACRO ~tb#fix_file_size~
</pre><p><a id="sec-group"></a></p>
<!--TOC subsection id="sec41" <span class="c003">GROUP</span> (Last update: V221)-->
<h3 class="subsection" id="sec41">10.19  <span class="c003">GROUP</span> (Last update: V221)</h3><!--SEC END --><p>The GROUP flag came about in discussing component management with an
abnormally large number of independent components, e.g. BG2 Tweaks. Previously
WeiDU lacked a satisfactory way to organize such a mod. The closest feature
would be the top level ASK_EVERY_COMPONENT, which only allows for a single
all-or-none approach.</p><p>The solution is a new component flag, GROUP, with the following syntax (and example):</p><p>Code:
</p><pre class="verbatim">GROUP string

Code:
BEGIN ~100% Learn Spells~
GROUP ~Convenience Tweaks~
// component code

BEGIN ~Identify All Items~
GROUP ~Convenience Tweaks~
// component code

BEGIN ~Give Edwin his BG2 Stats~
GROUP ~NPC Tweaks~
// component code

BEGIN ~ Give Jaheira her BG2 Stats~
GROUP ~NPC Tweaks~
// component code
</pre><p>Upon installing the mod, the player is now presented with meta-options on
each group at a high level:</p><p>Code:
</p><pre class="verbatim">Would you like to display the category [Convenience Tweaks]? [Y]es/[N]o
Would you like to display the category [NPC Tweaks]? [Y]es/[N]o
</pre><p>Selecting <code>[N]o</code> on any group suppresses those options from being
displayed, leading to a simpler and more controlled installer experience for
the player. In the provided example, selecting <code>[N]o</code> to Convenience
Tweaks and <code>[Y]es</code> to NPC Tweaks would result in WeiDU starting
installation by asking to install the Give Edwin his BG2 Stats component.</p><p>GROUP operates independently of SUBCOMPONENT, meaning you can use both to
organize the mod as needed. A few other items of note:
</p><ul class="itemize"><li class="li-itemize">
A component can belong to multiple GROUPs; a component is not offered
for install if and only if none of its member groups are selected
</li><li class="li-itemize">You could, in theory, have two components in the same SUBCOMPONENT
grouping but different GROUPs. Don’t do this.
</li><li class="li-itemize">You can give a GROUP a condition, by adding a patch_expression after the
GROUP definition. This way, the user will not be asked about that GROUP (and
its components will be automatically skipped). If you give different conditions
to the components in a GROUP, these conditions are OR()red.
</li><li class="li-itemize">Because of a couple of issues with ordering and/or GROUPs not appearing,
you are encouraged to put, at the end of your tp2, a dummy component for each
GROUP, in the order you’d like to show them to the user. For the above example,
if you want to ask about the ’Convenience Tweaks’ group before the ’NPC Tweaks’
one, the code becomes:
<pre class="verbatim">BEGIN ~100% Learn Spells~
GROUP ~Convenience Tweaks~
// component code

BEGIN ~Identify All Items~
GROUP ~Convenience Tweaks~
// component code

BEGIN ~Give Edwin his BG2 Stats~
GROUP ~NPC Tweaks~
// component code

BEGIN ~ Give Jaheira her BG2 Stats~
GROUP ~NPC Tweaks~
// component code

BEGIN ~Dummy component because it's too hard to fix this in WeiDU~
DEPRECATED ~Dummy component~
GROUP ~Convenience Tweaks~

BEGIN ~Dummy component because it's too hard to fix this in WeiDU~
DEPRECATED ~Dummy component~
GROUP ~NPC Tweaks~ GAME_IS ~bg2 tob~ // will not be asked for in Tutu
</pre>
This isn’t needed for the above example, but it might be needed in more complex
scenarios.
</li><li class="li-itemize">If some components of a mod are in a GROUP, but others are not, the
non-GROUPed components will always be presented.
</li><li class="li-itemize">Using a GROUP anywhere in your mod will act as an implied
ASK_EVERY_COMPONENT tp2 flag.
</li></ul><p>
<a id="sec-array-construct"></a></p>
<!--TOC subsection id="sec42" <span class="c003">array construct</span>-->
<h3 class="subsection" id="sec42">10.20  <span class="c003">array construct</span></h3><!--SEC END --><p>The array construct is a facile way of constructing multi-component
variables. If you come from a programming background, the array
construct has little in common with conventional arrays. It can be
more accurately thought of as a multi-dimensional cross between an array
and a dictionary.</p><p>The array construct can have any number of keys but only a single result.</p><p>The construct is formed as follows:
<code>$variable(key list)</code></p><p>The construct can be used to store a result when used on the left-hand
side of an expression or to retrieve a result when used on the
right-hand side. For example, the following code snippet illustrates
how the array construct could be used to dynamically construct a
dictionary at install-time. A dictionary can be used to look up an
associated value for any key value included in the dictionary. Here we
use it to parse kitlist.2da to construct a dictionary of which
CLAB-file is associated with each kit.</p><pre class="verbatim">COPY_EXISTING kitlist.2da override
  READ_2DA_ENTRIES_NOW kitlist 9
  FOR (i = 1; i &lt; kitlist; ++i) BEGIN
    READ_2DA_ENTRY_FORMER kitlist i 1 kit
    READ_2DA_ENTRY_FORMER kitlist i 5 clab
    SPRINT $kitlist("%kit%") "%clab%"
  END
BUT_ONLY
</pre><p>Arrays can either be iterated over with the action
<a href="#ACTION_PHP_EACH"><span class="c003">ACTION_PHP_EACH</span></a> or patch <a href="#PHP_EACH"><span class="c003">PHP_EACH</span></a>.</p><pre class="verbatim">ACTION_PHP_EACH kitlist AS kit =&gt; clab BEGIN
  PRINT "Kit %kit% uses CLAB-file %clab%"
END
</pre><p>You can easily make use of the dictionary properties by using the
array construct on the right-hand side of the expression and inserting
one of the keys found in the construct.</p><pre class="verbatim">OUTER_SPRINT clab $kitlist(cavalier)
PRINT "The Cavalier kit uses the CLAB-file %clab%"
</pre><p>Using an invalid key produces the same result as trying to use an
undefined variable. Using multiple keys works analogously. As a
completely artificial example:</p><pre class="verbatim">OUTER_SET $var(a b c) = 1
OUTER_SET number = $var(a b c)
</pre><p>The array construct can also be used to retrieve results from arrays
constructed in other ways, like with <a href="#ACTION_DEFINE_ARRAY"><span class="c003">ACTION_DEFINE_ARRAY</span></a> or
<a href="#ACTION_DEFINE_ASSOCIATIVE_ARRAY"><span class="c003">ACTION_DEFINE_ASSOCIATIVE_ARRAY</span></a>. For example:</p><pre class="verbatim">ACTION_DEFINE_ARRAY array BEGIN a b c END
OUTER_SPRINT letter $array(2)
PRINT "The second letter is %letter%" // Will print "b"
</pre><p><a id="sec-modder"></a></p>
<!--TOC subsection id="sec43" <span class="c003">MODDER</span> (Last update: v247)-->
<h3 class="subsection" id="sec43">10.21  <span class="c003">MODDER</span> (Last update: v247)</h3><!--SEC END --><p>The MODDER flag allows for more debugging info to be reported. It is suggested to
leave MODDER enabled while you’re developing your mod and then disable it before
you ship it to the players. However, given different coding styles, it is possible
that something gets interpreted as a critical bug for some users and as expected
behavior for others. For this reason, it’s possible to fine-tune the reporting level
for some of the bugs that are found. This is done by writing additional modifiers
after your MODDER statement, for example:
</p><pre class="verbatim">MODDER setup_tra fail area_variables none missing_extern warn
</pre><p>Each option can be set to either NONE, WARN or FAIL with the above syntax,
with the obvious meaning. If none are chosen, WARN is assumed. WARN may generate false positives.
In this case, "INSTALLED WITH WARNINGS" is not displayed.</p><p>Options set via the the command line supercede options set via the MODDER statement.</p><p>Here the list of feedback options that you can configure, along with use cases when you
should deactivate them. In all other cases, using FAIL or WARN is a case of personal
preference (for example, use WARN early in the development process and FAIL when you’re
near the beta status).
</p><ul class="itemize"><li class="li-itemize">
setup_tra: a dialogue/script uses @references that aren’t available from
its own tra file, but are taken instead from the tp2-level setup.tra.
<br>
 When to use NONE: you’re knowingly using references from
setup.tra into scripts and/or dialogues, rather than using file-specific TRA files.
</li><li class="li-itemize">area_variables: the variable scope in a BAF/D <code>*Global*("varname","scope")</code>
statement is six characters long, but not GLOBAL, MYAREA, LOCALS, or a valid area name.
<br>
 When to use NONE: you biff your .are files using bat files, or you copy them to
		 the override after compiling your scripts.
</li><li class="li-itemize">missing_extern: an EXTERN transition in a D file references a DLG file that
doesn’t exist, nor is created in the current file.
<br>
 When to use NONE: you have two separate D files that EXTERN to each other.
</li><li class="li-itemize">missing_resref: a file referenced by a scripting command (EG a CRE file for a
CreateCreature action) is not available.
<br>
 When to use NONE: you biff your files using bat files, or you copy them to
		 the override after compiling your scripts.
</li><li class="li-itemize">ict2_actions: you call an I_C_T2 into a state which has different actions.
		 If the different actions look like they’re caused by another mod ICT2’ing in
		 the same state, only the warning is printed, further actions are not processed.
<br>
 When to use NONE: you want to ICT2 into a state with different exit actions.
</li><li class="li-itemize">missing_eval: WeiDU thinks that you forgot to use EVALUATE_BUFFER to evaluate
variables in a command. Currently used for:
<ul class="itemize"><li class="li-itemize">
WRITE_ASCII (vs. WRITE_ASCIIE)
</li><li class="li-itemize">STR_VAR
</li><li class="li-itemize">COMPILE
</li><li class="li-itemize">arrays
</li></ul>
</li><li class="li-itemize">overwriting_file: you are writing to a file that exists (physically and/or in biffs).
</li><li class="li-itemize">fun_args: functions are launched with <code>INT_VAR</code>s or <code>STR_VAR</code>s
that and not included in the function’s definition.
</li></ul><p>An important note: if a tp2 sets MODDER, the debugging mode might propagate to
other mods. As such, <em>REMEMBER TO TURN MODDER OFF WHEN YOU RELEASE YOUR MOD.</em></p><p><a id="sec-readln"></a></p>
<!--TOC subsection id="sec44" <span class="c003">READLN</span> (Last update: v203)-->
<h3 class="subsection" id="sec44">10.22  <span class="c003">READLN</span> (Last update: v203)</h3><!--SEC END --><p>Attention. You are urged to use something other than READLN if you
can. You can read more at the end of this tutorial.</p><p>This tutorial has been brought to you by plainab.</p><p>The goal of this tutorial is to explain the use of READLN within the tp2 structure.
READLN can be used as an action or as a patch. My experience has been in using it
as an action command. I will describe the usage of READLN and then give you some
examples of its use. To put it bluntly READLN stands for "read line" and it’s use
causes WeiDU to pause and read any information entered by the user on the interface
screen and to then store that information within the given variable.</p><p>Syntax:
</p><pre class="verbatim">ACTION_READLN ~variable~
PATCH_READLN ~variable~
</pre><p>Lets build an example from scratch:</p><p>First we need to have something we want to change. For this example we will use the
stack amount for item files. We could pick a high number and simply use:</p><pre class="verbatim">COPY_EXISTING_REGEXP ~.*\.itm~ ~override~
 WRITE_SHORT 0x38 9999 //stack value
BUT_ONLY_IF_IT_CHANGES
</pre><p>Or we can let the end user choose how many items they want in their stacks.
To do that we first need to ask the user a question.</p><pre class="verbatim">PRINT ~How many of one item do you want to be able to be stacked?~
</pre><p>If we leave it at this, weidu will display the question, but keep running.
We have to make weidu pause and that is where READLN comes in. So we now have:</p><pre class="verbatim">PRINT ~How many of one item do you want to be able to be stacked?~
ACTION_READLN ~new_stack~
</pre><p>We can then take this entered value and use it on our copy block.</p><p>So the usage in this example would be:</p><pre class="verbatim">BEGIN ~Modify the stack value of all items~
PRINT ~How many of one item do you want to be able to be stacked?~
ACTION_READLN ~new_stack~

COPY_EXISTING_REGEXP ~.*\.itm~ ~override~
 WRITE_SHORT 0x38 %new_stack% //stack value
BUT_ONLY_IF_IT_CHANGES
</pre><p>You could leave it at this and it will work, but I will tell you now that the end
user can input any character from their keyboard. READLN doesn’t care what is
entered, but weidu may have problems if it is expecting an integer rather than text.
To get around that issue we need to add a loop that will re-ask the question when the
user enters the incorrect type of information.</p><pre class="verbatim">BEGIN ~Modify the stack value of all items~
PRINT ~How many of one item do you want to be able to be stacked?~
ACTION_READLN ~new_stack~

OUTER_WHILE NOT(IS_AN_INT %new_stack%) BEGIN
 PRINT ~How many of one item do you want to be able to be stacked?~
 ACTION_READLN ~new_stack~
END

COPY_EXISTING_REGEXP ~.*\.itm~ ~override~
 WRITE_SHORT 0x38 %new_stack% //stack value
BUT_ONLY_IF_IT_CHANGES
</pre><p>The loop we added looks to see if the entered value is an integer and if the
entered value is not an integer then it will re-ask the question. This loop
will go indefinitely until the user inputs the correct type of information.
Should your user not understand why they keep getting asked the question you may
wish to add new text to your questions to help them to understand what it is
you are looking for. As in this example:</p><pre class="verbatim">BEGIN ~Modify the stack value of all items~
PRINT ~How many of one item do you want to be able to be stacked?
Please enter your answer as an integer.~
ACTION_READLN ~new_stack~

OUTER_WHILE NOT(IS_AN_INT %new_stack%) BEGIN
 PRINT ~Your answer was not an integer.
Please enter your answer as an integer.
How many of one item do you want to be able to be stacked?~
 ACTION_READLN ~new_stack~
END

COPY_EXISTING_REGEXP ~.*\.itm~ ~override~
 WRITE_SHORT 0x38 %new_stack% //stack value
BUT_ONLY_IF_IT_CHANGES
</pre><p>That is the basics on asking for information from the user and then applying that
information later on in the install process. PATCH_READLN works just like
ACTION_READLN only it’s location of use within the tp2 is different.</p><p><br>

Another use of READLN is to create options that the user can choose from.
Top level options are taken care of by the use of SUBCOMPONENT and/or GROUP, but since
WeiDU cannot nest subcomponents, you can use READLN to offer additional choices beneath
the first set of subcomponents. Here’s an example of a finished product where READLN is
used to offer additional choices to a subcomponent. The relevant parts to this discussion
were taken from iiProjectileRetrievalMod. I helped to create this portion of the mod.
It works. I have however since learned of better methods that would eliminate some of the
READLN usage from this example.</p><pre class="verbatim">BEGIN ~Easy TUTU~
SUBCOMPONENT ~Projectile Retrieval Mod~
INCLUDE ~iiprojectiler/E22.tph~  // Easy TUTU version of mod

BEGIN ~All other Infinity Engine Games~
SUBCOMPONENT ~Projectile Retrieval Mod~

PRINT ~Please tell me how you'd like to modify your files.

1. I want to modify ALL thrown/projectiles at once.
2. I want to modify each thrown/projectile one at a time.

PLEASE ENTER  1 OR 2  ~
ACTION_READLN how
OUTER_WHILE NOT(IS_AN_INT %how%) || (%how% &gt; 2) || (%how% &lt; 1) BEGIN
 PRINT ~Please tell me how you'd like to modify your files.

1. I want to modify ALL thrown/projectiles at once.
2. I want to modify each thrown/projectile one at a time.

PLEASE ENTER  1 OR 2  ~
 ACTION_READLN how
END

ACTION_IF (%how% = 1) THEN BEGIN
 PRINT ~Please choose how you'd like ALL your projectiles retrieved.

1. Plain projectile only -&gt; Plain projectile only
2. All projectiles       -&gt; Plain projectile only
3. Each projectile       -&gt; Each projectile
4. Magical projectiles   -&gt; Reduced Magical/Plain projectiles

PLEASE ENTER  1, 2, 3, OR 4  ~
 ACTION_READLN choice
 OUTER_WHILE NOT(IS_AN_INT %choice%) OR (%choice% &gt; 4) OR (%choice% &lt; 1) BEGIN
  PRINT ~Please choose how you'd like ALL your projectiles retrieved.

1. Plain projectile only -&gt; Plain projectile only
2. All projectiles       -&gt; Plain projectile only
3. Each projectile       -&gt; Each projectile
4. Magical projectiles   -&gt; Reduced Magical/Plain projectiles

PLEASE ENTER  1, 2, 3, OR 4  ~
  ACTION_READLN choice
 END
</pre><p>There is a problem with using READLN. Notably, READLN pauses the
installation until the user inputs an answer. This requires the player
to baby-sit the installation and attentively watch for READLNs. It
also causes problems for automated installation tools, which are
increasingly becoming popular. Modders are urged to be choose
solutions beside READLN, such as subcomponents, or even making use of
configuration files, if these are suitable.</p><p><a id="sec-functions"></a></p>
<!--TOC subsection id="sec45" <span class="c003">Functions</span> (Last update: V247)-->
<h3 class="subsection" id="sec45">10.23  <span class="c003">Functions</span> (Last update: V247)</h3><!--SEC END --><p>Macros can have unintended side effects because they change the global variable environment.
You have to be extremely careful when interacting with the “outside”.</p><p>That’s why functions were introduced in v209. Any changes to the variables are only visible
inside the function. You can also provide default arguments and return values.</p><p>As with macros these functions come in an ACTION and a PATCH variant. So the corresponding
commands are: DEFINE_ACTION_FUNCTION / DEFINE_PATCH_FUNCTION (both actions) and
LAUNCH_ACTION_FUNCTION (action) / LAUNCH_PATCH_FUNCTION (patch).</p><p>Before you can use a function you have to DEFINE it:
</p><pre class="verbatim">DEFINE_PATCH_FUNCTION count_spells INT_VAR level = 1 STR_VAR type = "WI" RET num BEGIN
    SET num = 0
    PATCH_IF (~%SOURCE_EXT%~ STRING_EQUAL_CASE ~CRE~) THEN BEGIN
        // do some magic here that actually counts the number of spells and sets
        // the variable num to that number.
    END
END
</pre><p>The function is defined with default values for the variables
<code>level</code> and <code>type</code>. These default values override any values
the corresponding variables may have in the environment of the
function’s caller, unless other values are provided as part of calling
the function (<span class="c006">vide infra</span>).</p><p>After that you can LAUNCH it:
</p><pre class="verbatim">COPY_EXISTING ~my.cre~ ~override~
    // count number of level 1 wizard spells (default arguments of the function)
    LAUNCH_PATCH_FUNCTION count_spells RET lvl1_wizard = num END
    // and now the level 5 priest spells
    LAUNCH_PATCH_FUNCTION count_spells INT_VAR level = 5 STR_VAR type = "PR" RET lvl5_priest = num END

    PATCH_PRINT ~This CRE has %lvl1_wizard% level 1 wizard spells and %lvl5_priest% level 5 priest spells~
</pre><p>The first time the function is called, the definition’s default values
for <code>level</code> and <code>type</code> are used. The second time, the values
of the variables are given when the function is called.</p><p>Any variables you change inside the function will revert back to their old value
after the function finishes.
That’s why you have to specify what values should be return values.
You can do this in the RET part of the function definition (<code>RET num</code>).
When you launch the function you can use these variables to import the value
into your current variable environment (<code>RET lvl1_wizard = num</code>).
Separate the variables with a space character if you have multiple return values.</p><p>As of V244, you can return whole arrays with the <code>RET_ARRAY</code>
keyword. Like with <code>RET</code>, you can optionally assign the array to
a different name by using assignment when launching the function.</p><pre class="verbatim">DEFINE_ACTION_FUNCTION foobar
  RET_ARRAY
    foo
    bar
BEGIN
  ACTION_DEFINE_ARRAY foo BEGIN 1 2 3 END
  ACTION_DEFINE_ARRAY bar BEGIN a b c END
END

LAF foobar RET_ARRAY foo baz = bar END

// After the function has returned, the arrays foo and baz will exist
// The array baz will be derived from the array bar

ACTION_PHP_EACH foo AS _ =&gt; v BEGIN
  PRINT "%v%" // will print 1, 2 and 3
END

ACTION_PHP_EACH baz AS _ =&gt; v BEGIN
  PRINT "%v%" // will print a, b and c
END

</pre><p>If you don’t need certain features simply omit them:
</p><pre class="verbatim">DEFINE_ACTION_FUNCTION xyz INT_VAR x = 1 y = 2 z = 3 BEGIN
    PRINT ~x: %x%, y: %y%, z: %z%~
END

LAUNCH_ACTION_FUNCTION xyz END
</pre><p>Starting from V210, you can also specify a variable that will be local to the
function environment, without being passed back to the calling environment,
by adding either STR_VAR or INT_VAR to the LAUNCH bit:
</p><pre class="verbatim">DEFINE_ACTION_FUNCTION xyz INT_VAR x = 1 y = 2 z = 3 BEGIN
    PRINT ~x: %x%, y: %y%, z: %z%~
END

LAUNCH_ACTION_FUNCTION xyz INT_VAR x = 0 END

OUTER_SET y = 5
LAUNCH_ACTION_FUNCTION xyz INT_VAR y END // synonym for INT_VAR y = y
</pre><p><a id="sec-get-offset-array12"></a></p>
<!--TOC subsection id="sec46" <span class="c003">GET_OFFSET_ARRAY</span> and <span class="c003">GET_OFFSET_ARRAY2</span> (last edit: 218)-->
<h3 class="subsection" id="sec46">10.24  <span class="c003">GET_OFFSET_ARRAY</span> and <span class="c003">GET_OFFSET_ARRAY2</span> (last edit: 218)</h3><!--SEC END --><p>Many thanks to Wisp for providing this tutorial.</p><p>GET_OFFSET_ARRAY and GET_OFFSET_ARRAY2 are means for obtaining information about certain types of file structures without using the usual READs, FORs etc. GET_OFFSET_ARRAY can, for example, be used to find the starting offsets for all the extended headers (abilities) in an item, while GET_OFFSET_ARRAY2 can be used to find the starting offsets for all extended effects in the item. Since the effect structure is organised by the ability structure, GET_OFFSET_ARRAY2 is conventionally used together with GET_OFFSET_ARRAY.</p><p>The seven values required by GET_OFFSET_ARRAY are:
</p><pre class="verbatim">1. Offset
2. Read length of "Offset"
3. Iterations
4. Read length of "Iterations"
5. Index
6. Read length of "Index"
7. Length between iterations.
</pre><p>Acceptable values for read length are 0 (don’t read), 2 (SHORT) and 4 (LONG). Length between iterations depends on the file structure you are working with. In our item example, length between iterations is 0x38 while we are using GET_OFFSET_ARRAY. If we were working with a spell instead, it would be 0x28.</p><p>In the item example, "Offset" is 0x64, which gives the ability offset when read.
The value read from "Iterations" is the number reads that should be performed. "Iterations" is 0x68 in the item example, which gives the number of abilities when read.
The value read from "Index" is the number of iterations into the file the current read should be made. This is not always relevant for GET_OFFSET_ARRAY, but for reading general effects (on-equip effects), this is 0x6e.</p><p>GET_OFFSET_ARRAY2 requires an additional value. Let’s call it Offset2. This value is normally obtained as the result from GET_OFFSET_ARRAY. In our item example this value is the starting offset for the current ability. The value of "Offset" is now 0x6a, which gives the effect offset. The value of "Iterations" is now 0x1e, which gives the number of effects, the value of "Index" is now 0x20 and both are read from Offset2 + value (unlike GET_OFFSET_ARRAY where they are read from the start of the file).</p><p>For example, if we wanted to know how many levels Blackrazor can drain, we could use this code:
</p><pre class="verbatim">COPY_EXISTING miscbc.itm override
  GET_OFFSET_ARRAY ab_array 0x64 4 0x68 2 0 0 0x38
  PHP_EACH ab_array AS int =&gt; ab_off BEGIN
    GET_OFFSET_ARRAY2 fx_array ab_off ITM_V10_HEAD_EFFECTS
    PHP_EACH fx_array AS int =&gt; fx_off BEGIN
      READ_SHORT fx_off fx_type
      PATCH_IF fx_type = 216 BEGIN
        READ_LONG fx_off + 0x4 amount
        PATCH_PRINT "I drain %amount% level(s)"
      END
    END
  END
BUT_ONLY
</pre><p><a id="sec-match-and-try"></a></p>
<!--TOC subsection id="sec47" <span class="c003">MATCH</span> and <span class="c003">TRY</span> (last edit: 245)-->
<h3 class="subsection" id="sec47">10.25  <span class="c003">MATCH</span> and <span class="c003">TRY</span> (last edit: 245)</h3><!--SEC END --><p><code>MATCH</code> is the equivalent of switch..case in mainstream languages (except
it also works on strings, similar to OCaml’s match..with). This is a type of
selection control statement whose purpose is to allow the value of a variable
or expression to control the flow of program execution via a multiway branch.
The main reasons for using this type of statement include improving clarity
and reducing otherwise repetitive coding.</p><p><span class="c007">N.B.</span> <span class="c003">TRY</span> is generally <em>not safe</em> to use because many
errors are intended to be fatal and if the mod installation were to
proceed anyway, it might do so in an inconsistent state, with resource
leaks or with other errors. <a href="#ACTION_RERAISE"><span class="c003">ACTION_RERAISE</span></a> and
<a href="#PATCH_RERAISE"><span class="c003">PATCH_RERAISE</span></a> mitigates or eliminates these risks, since the
unsafe part is allowing the installation to continue and re-raising
the error allows it to fail, like intended.</p><p><code>TRY</code> is used to detect TP2 failures (= anything that blocks the installation
and prints "NOT INSTALLED DUE TO ERRORS") and allows the modder to run custom
code (without forcibly failing the installation). The syntax is very similar
to <code>MATCH</code>, which is why these two commands are presented together.</p><p>This tutorial documents <code>ACTION_MATCH</code> and <code>ACTION_TRY</code>, but the
patch equivalents (<code>PATCH_MATCH</code> and <code>PATCH_TRY</code>) are also
available.</p><p>This is a sample code for <code>MATCH</code>:
</p><pre class="verbatim">ACTION_MATCH 12 + 14 // value
WITH
  15 16 // guards
  BEGIN
    PRINT ~15 or 16~ // guarded actions
  END
  15 + 5 ~str.*with%vars% and regexp~
  BEGIN
    PRINT ~15 + 5 or matches "str.*with%vars% and regexp"~
  END
  DEFAULT
    PRINT ~default~ // default actions
END
</pre><p>To begin with, the value (12 + 14) is evaluated (can be any integer or a string).
After that, it is compared against each guard: it is neither 15 nor 16, so its
guarded action is not executed. Similarly, it is neither 15 + 5 (= 20)
nor does it match the regexp <code>~str.*with%vars% and regexp~</code> after evaluating
variables and case-insensitive regexp, so its guarded actions aren’t executed either.
Since no listed value is printed, the default action(s) are executed (in this case,
<code>PRINT ~default~</code>).</p><p><code>MATCH</code> can also compare against strings:
</p><pre class="verbatim">OUTER_SET var = 15
ACTION_MATCH ~string%var%~
WITH
  ~string12~ ~string2.*~
  BEGIN
    PRINT ~string12 or string2.*~
  END
  ~string1[12345]~
  BEGIN
    PRINT ~string1[12345]~
  END
  DEFAULT
    PRINT ~default~
END
</pre><p>
In this case, <code>PRINT ~string1[12345]~</code> is executed.</p><p>Guards can also have a condition associated; in that case, the value must match
against one of the guards and the condition must be true:
</p><pre class="verbatim">ACTION_MATCH ~%something%~
WITH
  ~none~ WHEN GAME_IS ~BG1 TotSC~
  BEGIN
    // ~none~ and the game is BG1
  END
  ~none~
  BEGIN
    // ~none~ and the game is not BG1
  END
  DEFAULT
    // not ~none~
END
</pre><p>It is also possible to have a condition without a guard, in which case the
syntax is:
</p><pre class="verbatim">ACTION_MATCH ~%something%~
WITH
  ANY GAME_IS ~BG1 TotSC~
  BEGIN
    // the game is BG1
  END
  ANY GAME_IS ~SoA ToB~
  BEGIN
    // the game is BG2
  END
  DEFAULT
    // not BG1 or BG2
END
</pre><p>Specific cases that might be worth mentioning:
it is possible for a guarded action to be empty, to have no default actions,
or to only have default actions, as per the following examples:
</p><pre class="verbatim">ACTION_MATCH ~%something%~
WITH
  ~no action~ ~none~ ~empty~ ~~
  BEGIN
    // empty guarded action: default action never executed
  END
  ~error~
  BEGIN
    FAIL ~error~
  END
  DEFAULT
    DO_THIS_AND_THAT
END

ACTION_MATCH ~%something%~
WITH
  ~value1~ ~value2~ ~value3~
  BEGIN
    DO_SOMETHING
  END
  ~error~
  BEGIN
    FAIL ~error~
  END
  DEFAULT
    // no default action: nothing is done for unmatched values
END

ACTION_MATCH ~%something%~
WITH
  DEFAULT
    // no guarded actions, only default actions: always executed
    DO_THIS_AND_THAT
END
</pre><p>Also, no more than one group of actions is executed:
</p><pre class="verbatim">ACTION_MATCH ~string123~
WITH
  ~string123~
  BEGIN
    DO_THIS // executed
  END
  ~string123~
  BEGIN
    DO_THAT // not executed
  END
  DEFAULT
    DO_BOTH // also not executed
END
</pre><p>
<br>
<br>
<br>
<br>
<code>TRY</code> is similar to <code>MATCH</code>:
</p><pre class="verbatim">ACTION_TRY
  COPY ~override/sw1h01.itm~ ~override~
  DO_SOMETHING_ELSE
WITH
  ~Unix.Unix_error(20, "stat", "override/sw1h01.itm")~
  BEGIN
    PRINT ~I caught sw1h01.itm not found!~
  END
  ~Unix.Unix_error(20, "stat", "override/.*.itm")~
  BEGIN
    PRINT ~I caught another missing item!~
  END
  DEFAULT
    PRINT ~I caught another error!~
END
</pre><p>The actions in <code>ACTION_TRY</code> are executed. If none of those fails, the
<code>WITH</code> part is skipped; otherwise, the error message is printed as usual
(use <a href="#SILENT"><span class="c003">SILENT</span></a>), the exception text (from the ERROR: blah blah line) is
saved to the <code>%ERROR_MESSAGE%</code> variable, and a <code>MATCH</code> is executed
on that.</p><p>After running the correct error handling code, execution continues after the
end of the <code>ACTION_TRY</code> block. If you still want to block the
installation, use <code>ACTION_RERAISE</code> (in theory, you could use
<code>FAIL ~%ERROR_MESSAGE%~</code>, but this changes the exception and its text,
which would cause you headaches when nesting multiple <code>TRY</code>s).</p><p><a id="sec-quick-menu"></a></p>
<!--TOC subsection id="sec48" <span class="c003">QUICK_MENU</span> (last edit: 227)-->
<h3 class="subsection" id="sec48">10.26  <span class="c003">QUICK_MENU</span> (last edit: 227)</h3><!--SEC END --><p>This tp2 flag is used to define groups of components that the user will be
offered to install in a single step. Sample code:</p><pre class="verbatim">QUICK_MENU
  ALWAYS_ASK 5 END
  ~Red~ BEGIN 1 2 END
  ~Green~ BEGIN 2 3 END
  ~Blue~ BEGIN 4 6 END
END
</pre><p>The user will be presented with the following prompt:</p><pre class="verbatim">The test/test.tp2 mod has 13 distinct optional components.
To save time, you can choose what to do with them at a high level rather than being asked about each one.

[A]sk about each component, [S]kip all, or choose a pre-defined selection:
 1] Red
 2] Green
 3] Blue
</pre><p>If some mod components were already installed, the option to [U]ninstall
or [R]einstall the currently installed components will also be offered.</p><p>If the user chooses to install a pre-defined selection, then its components
will be installed, and ALL other components of the mod will be uninstalled
if already installed.</p><p>Components in ALWAYS_ASK will always be asked for individually if the user
chose to install one of the pre-defined selections (or, of course, if he chose
[A]). If the user chose [S], [R] or [U] the same action will be applied to the
components in ALWAYS_ASK.</p><p>Caveats:
</p><ul class="itemize"><li class="li-itemize">
If a component is in both ALWAYS_ASK and a pre-defined selection the mod
will refuse to install.
</li><li class="li-itemize">Because of a complex problem whose details are too technical for this
document, component 0 of your mod must be empty (or your mod will refuse to
install), must not be in any pre-defined selection or in ALWAYS_ASK (or your
mod will refuse to install) and will always be (re)installed (unless the user
chooses [S]kip all).<p>This also means that your mod’s components will always be grouped together (you
can’t install a component from your mod, then a second mod, and then other
components of your mod).
</p></li><li class="li-itemize">Some of the listed failure points are not checked for when the mod is
installed non-interactively (--yes, --force-install and friends). Test the menu
system at least once before releasing your mod, even if you do the bulk of the
development of your mod using --yes and the like.
</li></ul><p><a id="sec-handle-audio-and-handle-tilesets"></a></p>
<!--TOC subsection id="sec49" <span class="c003">HANDLE_AUDIO</span> and <span class="c003">HANDLE_TILESETS</span>-->
<h3 class="subsection" id="sec49">10.27  <span class="c003">HANDLE_AUDIO</span> and <span class="c003">HANDLE_TILESETS</span></h3><!--SEC END --><p><a href="#HANDLE_AUDIO"><span class="c003">HANDLE_AUDIO</span></a> and <a href="#HANDLE_TILESETS"><span class="c003">HANDLE_TILESETS</span></a> are convenience
functions for the common tasks of installing mod-supplied audio and
tilesets. All IE games are supported and the specifics for each game
is handled automatically. The functions are designed to take care of
as many as the platform-specific details as possible, including the
differences between Windows, OS&nbsp;X and
GNU/Linux.</p><p>There is one exception to this, however. At present, to use
<code>HANDLE_AUDIO</code> you need to include oggdec.exe for Windows and SoX
for OS&nbsp;X in your mod. To use
<code>HANDLE_TILESETS</code> you need to include tisunpack for Windows and
OS&nbsp;X. In both cases it is recommended
that GNU/Linux users install oggdec and tisunpack themselves. Most
modern GNU/Linux distributions come with oggdec already installed. A
copy of tisunpack compiled for GNU/Linux is distributed together with
the Linux version of WeiDU. If you want to facilitate the installation
of your mod on GNU/Linux, you should state that your mod depends on
oggdec or tisunpack, as appropriate.</p><p><a href="#HANDLE_AUDIO"><span class="c003">HANDLE_AUDIO</span></a> expects your audio to be in the Ogg Vorbis format.
If you have WAV or WAVC files, you do not need <code>HANDLE_AUDIO</code>,
you can simply copy them to the override.</p><p>With no configuration, <code>HANDLE_AUDIO</code> expects your audio,
oggdec.exe and SoX to be located in <code>mymod/audio</code>. Using
<code>HANDLE_AUDIO</code> is then as simple as a single line of TP2:
</p><pre class="verbatim">LAF HANDLE_AUDIO END
</pre><p><code>LAF</code> is an alias for <a href="#LAUNCH_ACTION_FUNCTION"><span class="c003">LAUNCH_ACTION_FUNCTION</span></a>.
<code>HANDLE_AUDIO</code> is a completely independent function, and does not
have no be placed before or after anything else in your TP2 file. It
is equivalent to a TP2 action and you obviously need to place it in
the right component, but that is it.</p><p><code>HANDLE_AUDIO</code> can also be configured to use audio in a different
directory, through the string variable <code>audio_path</code>. The value of
this variable is the directory in which <code>HANDLE_AUDIO</code> should
look for audio, oggdec.exe and SoX. So, for instance, if you keep your
sounds in <code>mymod/sound</code> you would configure <code>HANDLE_AUDIO</code>
like so:
</p><pre class="verbatim">LAF HANDLE_AUDIO STR_VAR audio_path = ~mymod/sound~ END
</pre><p>
If you want <code>HANDLE_AUDIO</code> to look for oggdec.exe or SoX in
another directory than <code>audio_path</code>, you can use the
<code>oggdec_path</code> and <code>sox_path</code> variables. For example, if you
have your voice-overs in <code>mymod/audio/vo</code>, your music in
<code>mymod/audio/music</code>, and oggdec.exe and SoX in <code>mymod/audio</code>
you could install it like so:
</p><pre class="verbatim">LAF HANDLE_AUDIO
  STR_VAR
    audio_path = ~mymod/audio/vo~
    oggdec_path = ~mymod/audio~
    sox_path = ~mymod/audio~
END
LAF HANDLE_AUDIO
  INT_VAR
    music = 1
  STR_VAR
    audio_path = ~mymod/audio/music~
    oggdec_path = ~mymod/audio~
    sox_path = ~mymod/audio~
END
</pre><p>
The integer variable <code>music</code> simply tells <code>HANDLE_AUDIO</code>
that you want the audio handled as music. This only makes a difference
on BGEE.</p><p>The function <a href="#HANDLE_TILESETS"><span class="c003">HANDLE_TILESETS</span></a> follow the same design as
<code>HANDLE_AUDIO</code>. <code>HANDLE_TILESETS</code> decompresses and installs
TIZ files rather than OGG files and uses tisunpack rather than
oggdec/SoX.</p><p>With no configuration, <code>HANDLE_TILESETS</code> expects your TIZ files
to be located in <code>mymod/tiz</code>. Additionally, it expects tisunpack
for Windows to be located in <code>mymod/tiz/win32</code> and tisunpack for
OS&nbsp;X to be located in
<code>mymod/tiz/osx</code>. You install you tilesets like so:
</p><pre class="verbatim">LAF HANDLE_TILESETS END
</pre><p>
The string variables <code>tiz_path</code> and <code>tisunpack_path</code> allow
you to configure <code>HANDLE_TILESETS</code> to look for TIZ files or
tisunpack in other directories. Note that you do not specify the
individual directories for tisunpack for Windows or tisunpack for OS
X. Instead you specify the parent directory and WeiDU will then use
the value of the variable <a href="#WEIDU_OS"><span class="c003">WEIDU_OS</span></a> to find the right version
of tisunpack. For example, if you keep your TIZ files in
<code>mymod/tilesets</code> and tisunpack for Windows in
<code>mymod/bin/win32</code> and tisunpack for
OS&nbsp;X in <code>mymod/bin/osx</code> you
could install your tilesets like so:
</p><pre class="verbatim">LAF HANDLE_TILESETS
  STR_VAR
    tiz_path = ~mymod/tilesets~
    tisunpack_path = ~mymod/bin~
END
</pre><p>To conclude this tutorial, here is a fictional (but valid) example of
a TP2 file of a mod where <code>HANDLE_AUDIO</code> and
<code>HANDLE_TILESETS</code> are used:
</p><pre class="verbatim">BACKUP ~fl#xmpl/backup~
AUTHOR ~Wisp~

BEGIN ~E. G. McExample NPC~

COPY ~fl#xmpl/copy~ override

COMPILE ~fl#xmpl/compile~

LAF HANDLE_AUDIO END

LAF HANDLE_TILESETS END

COPY ~fl#xmpl/character/fl#xmpl.cre~ override
  SAY NAME1 ~E. G. McExample~
  SAY NAME2 ~E. G. McExample~
  // Other SAYs

// End of File
</pre>
<!--TOC section id="Code dumps" <span class="c003"><span class="c007">Code dumps</span></span>-->
<h2 class="section" id="Code dumps">11  <span class="c005">Code dumps</span><a id="hevea_default591"></a></h2><!--SEC END --><p>
This section contains code snippets that serve to document functionality
not covered elsewhere.</p><p>These snippets are provided by Miloch.
</p><pre class="verbatim">//For each dialogue, change GivePartyGold() to GiveGoldForce() actions
ACTION_FOR_EACH dialog IN ~arkion~ ~ardrou~ ~berrun~ ~brevli~ ~brielb~ ~forthe~ ~gurke~ BEGIN
  ACTION_IF FILE_EXISTS_IN_GAME ~%dialog%.dlg~ BEGIN
    COPY_EXISTING ~%dialog%.dlg~ ~override~
      PATCH_IF SOURCE_SIZE &gt; 0x34 BEGIN
        DECOMPILE_DLG_TO_D
        REPLACE_TEXTUALLY CASE_INSENSITIVE EXACT_MATCH ~GivePartyGold~ ~GiveGoldForce~
        COMPILE_D_TO_DLG
      END
    BUT_ONLY
  END
END

//Compress a BAM
COPY ~bambatch/bam~ ~bambatch/bam~
  READ_ASCII 0x0 sg (4) //Signature
  PATCH_IF (~%sg%~ STRING_EQUAL_CASE ~BAM ~ = 1) BEGIN
    dl = SOURCE_SIZE //Data length
    COMPRESS_REPLACE_FILE 0 dl 9
    INSERT_BYTES 0x0 0xc
    WRITE_ASCII 0x0 ~BAMCV1  ~
    WRITE_LONG 0x8 dl
  END ELSE BEGIN
    PATCH_PRINT ~%SOURCE_FILE% is not an uncompressed BAM.~
  END
BUT_ONLY

//Decompress a BAM
COPY ~bambatch/bam~ ~bambatch/bam~
  READ_ASCII 0x0 sg (4) //Signature
  PATCH_IF (~%sg%~ STRING_EQUAL_CASE ~BAMC~ = 1) BEGIN
    READ_LONG 0x8 dl //Uncompressed data length
    DECOMPRESS_REPLACE_FILE 0xc (SOURCE_SIZE - 0xc) dl
  END ELSE BEGIN
    PATCH_PRINT ~%SOURCE_FILE% is not a compressed BAM.~
  END
BUT_ONLY

//Defines an array associating creatures with a new amount of gold
ACTION_DEFINE_ASSOCIATIVE_ARRAY newgold BEGIN
  ~arkion~ =&gt; 100
  ~ardrou~ =&gt; 10
  ~berrun~ =&gt; 58
  ~brevli~ =&gt; 5
  ~brielb~ =&gt; 200
  ~gurke~ =&gt; 20
  ~oublek~ =&gt; 1000
  ~perdue%~ =&gt; 75
  ~pheirk%~ =&gt; 38
  ~scar~ =&gt; 1026
  ~sonner~ =&gt; 150
  ~wenric~ =&gt; 170
  ~jarlaxle~ =&gt; 25
  ~ppsime~ =&gt; 50
  ~yschearl~ =&gt; 150
END

//Writes the new amount of gold for each creature above if it exists
ACTION_PHP_EACH newgold AS crename =&gt; gold BEGIN
  ACTION_IF FILE_EXISTS_IN_GAME ~%crename%.cre~ BEGIN
    COPY_EXISTING ~%crename%.cre~ ~override~
      PATCH_IF SOURCE_SIZE &gt; 0x2d3 BEGIN
        WRITE_LONG 0x1c gold
      END
    BUT_ONLY
  END
END
</pre><p><a id="sec-macros-listing"></a></p>
<!--TOC section id="sec51" Macros Listing-->
<h2 class="section" id="sec51">12  Macros Listing</h2><!--SEC END --><p>
These macros are automatically shipped with WeiDU.</p><p><code>tb#factorial</code>: computes the factorial of a number. <br>
This is a PATCH macro.
</p><ul class="itemize"><li class="li-itemize">
SET <code>tb#factorial_index</code> to the factorial you’d like to compute.
</li><li class="li-itemize">SET <code>tb#factorial_result</code> to 1;
</li><li class="li-itemize">The result is <code>tb#factorial_result</code>.
</li></ul><p><code>tb#fix_file_size</code>: overwrites all files matching a certain regexp with a
certain standard file, if they are under a certain size. <br>
This is an ACTION macro.
</p><ul class="itemize"><li class="li-itemize">
SET <code>tb#fix_file_size_min</code> to the maximum allowed size
(files whose size is exactly this value are NOT overwritten).
</li><li class="li-itemize">SPRINT <code>tb#fix_file_size_target</code> to the standard file used to replace file(s) that match the regexp.
</li><li class="li-itemize">SPRINT <code>tb#fix_file_size_category</code> to a descriptive name.
</li><li class="li-itemize">SPRINT <code>tb#fix_file_size_regexp</code> to the regexp for the file(s) to be checked for a match.
</li></ul><p><br>

Note that, differently from the standalone versions, for these macros you <em>need</em>
to set all the needed values - they aren’t initialized automatically. This is untrue functions
(they are initialized to either 0 or the empty string, except for <code>probability1</code> which is initialized to 100).</p><p><code>DELETE_SPELL_EFFECT</code>: deletes all extended effects with specified opcode from a spell.
This is a PATCH macro and function.
</p><ul class="itemize"><li class="li-itemize">
SET <code>opcode_to_delete</code> to the opcode of the effect you want to delete. Opcode of (-1) will match all effects.
</li></ul><p><code>DELETE_ITEM_EFFECT</code>: deletes all extended effects with specified opcode from an item.
This is a PATCH macro and function.
</p><ul class="itemize"><li class="li-itemize">
SET <code>opcode_to_delete</code> to the opcode of the effect you want to delete. Opcode of (-1) will match all effects.
</li></ul><p><code>DELETE_ITEM_EQEFFECT</code>: deletes all equipping effects with specified opcode from an item.
This is a PATCH macro and function.
</p><ul class="itemize"><li class="li-itemize">
SET <code>opcode_to_delete</code> to the opcode of the effect you want to delete. Opcode of (-1) will match all effects.
</li></ul><p><code>DELETE_CRE_EFFECT</code>: deletes all effects with specified opcode from a creature. (Warning: doesn’t check EFF version)
This is a PATCH macro and function.
</p><ul class="itemize"><li class="li-itemize">
SET <code>opcode_to_delete</code> to the opcode of the effect you want to delete. Opcode of (-1) will match all effects.
</li></ul><p><code>ITEM_EFFECT_TO_SPELL</code>: copies all extended effects from the current item to the first extended header of a spell.
This is a PATCH macro and function.
</p><ul class="itemize"><li class="li-itemize">
SET <code>type</code> to the header type to copy the effect from (use 99 to specify ’all types’).
</li><li class="li-itemize">SET <code>header</code> to number of extended header the effect should be copied from (use 99 to specify ’every header’).
</li><li class="li-itemize">SET <code>insert_point</code> to the index into the spell file at which the effects should be inserted. A value of 0 will have the effects inserted as the first effects of the spell. Effects are inserted as the last effects by default.
</li><li class="li-itemize">SPRINT <code>new_itm_spl</code> to a spell you want to copy effects to.
</li></ul><p><code>ADD_SPELL_EFFECT</code>: adds an extended effect to a spell. All variables except <code>probability1</code> and <code>insert_point</code> are 0 by default.
This is a PATCH macro and function.
</p><ul class="itemize"><li class="li-itemize">
SET <code>opcode</code> to opcode
</li><li class="li-itemize">SET <code>target</code> to target type
</li><li class="li-itemize">SET <code>timing</code> to timing type
</li><li class="li-itemize">SET <code>parameter1</code> to first parameter
</li><li class="li-itemize">SET <code>parameter2</code> to second parameter
</li><li class="li-itemize">SET <code>power</code> to power
</li><li class="li-itemize">SET <code>resist_dispel</code> to magic resistance/dispel type
</li><li class="li-itemize">SET <code>duration</code> to duration
</li><li class="li-itemize">SET <code>probability1</code> to probability 1 (default 100)
</li><li class="li-itemize">SET <code>probability2</code> to probability 2
</li><li class="li-itemize">SPRINT <code>resource</code> to resource (8 chars max)
</li><li class="li-itemize">SET <code>dicenumber</code> to number of dices to be thrown
</li><li class="li-itemize">SET <code>dicesize</code> to size of dices to be thrown
</li><li class="li-itemize">SET <code>savingthrow</code> to type of savingthrow to be allowed against the effect
</li><li class="li-itemize">SET <code>savebonus</code> to saving throw bonus
</li><li class="li-itemize">SET <code>special</code> to the special parameter (only valid for functions; not macros)
</li><li class="li-itemize">SET <code>header</code> to number of extended header (starting from 1) the effect should be added to (by default the effect is added to every header).
</li><li class="li-itemize">SET <code>insert_point</code> to the position of the effect. If this variable is 0 the effect will be inserted as the first effect of the extended header. If this variable is negative or greater than the number of effects, the effect will be inserted as the last effect. The effect is added as the last effect by default.
</li></ul><p><code>ADD_ITEM_EFFECT</code>: adds an extended effect to an item. All variables except <code>probability1</code>, <code>type</code> and <code>insert_point</code> are 0 by default.
This is a PATCH macro and function.
</p><ul class="itemize"><li class="li-itemize">
SET <code>opcode</code> to opcode
</li><li class="li-itemize">SET <code>target</code> to target type
</li><li class="li-itemize">SET <code>timing</code> to timing type
</li><li class="li-itemize">SET <code>parameter1</code> to first parameter
</li><li class="li-itemize">SET <code>parameter2</code> to second parameter
</li><li class="li-itemize">SET <code>power</code> to power
</li><li class="li-itemize">SET <code>resist_dispel</code> to magic resistance/dispel type
</li><li class="li-itemize">SET <code>duration</code> to duration
</li><li class="li-itemize">SET <code>probability1</code> to probability 1 (default 100)
</li><li class="li-itemize">SET <code>probability2</code> to probability 2
</li><li class="li-itemize">SPRINT <code>resource</code> to resource (8 chars max)
</li><li class="li-itemize">SET <code>dicenumber</code> to number of dices to be thrown
</li><li class="li-itemize">SET <code>dicesize</code> to size of dices to be thrown
</li><li class="li-itemize">SET <code>savingthrow</code> to type of savingthrow to be allowed against the effect
</li><li class="li-itemize">SET <code>savebonus</code> to saving throw bonus
</li><li class="li-itemize">SET <code>special</code> to the special parameter (only valid for functions; not macros)
</li><li class="li-itemize">SET <code>header</code> to number of extended header (starting from 1) the effect should be added to (by default the effect is added to every header).
</li><li class="li-itemize">SET <code>type</code> to the type of header to which the effect should be added or 99 for all types. Defaults to 3 (magic).
</li><li class="li-itemize">SET <code>insert_point</code> to the position of the effect. If this variable is 0 the effect will be inserted as the first effect of the extended header. If this variable is negative or greater than the number of effects, the effect will be inserted as the last effect. The effect is added as the last effect by default.
</li></ul><p><code>ADD_ITEM_EQEFFECT</code>: adds an equipping effect to an item. All variables except <code>probability1</code> are 0 by default.
This is a PATCH macro and function.
</p><ul class="itemize"><li class="li-itemize">
SET <code>opcode</code> to opcode
</li><li class="li-itemize">SET <code>target</code> to target type
</li><li class="li-itemize">SET <code>timing</code> to timing type
</li><li class="li-itemize">SET <code>parameter1</code> to first parameter
</li><li class="li-itemize">SET <code>parameter2</code> to second parameter
</li><li class="li-itemize">SET <code>power</code> to power
</li><li class="li-itemize">SET <code>resist_dispel</code> to magic resistance/dispel type
</li><li class="li-itemize">SET <code>duration</code> to duration
</li><li class="li-itemize">SET <code>probability1</code> to probability 1 (default 100)
</li><li class="li-itemize">SET <code>probability2</code> to probability 2
</li><li class="li-itemize">SPRINT <code>resource</code> to resource (8 chars max)
</li><li class="li-itemize">SET <code>dicenumber</code> to number of dices to be thrown
</li><li class="li-itemize">SET <code>dicesize</code> to size of dices to be thrown
</li><li class="li-itemize">SET <code>savingthrow</code> to type of savingthrow to be allowed against the effect
</li><li class="li-itemize">SET <code>savebonus</code> to saving throw bonus
</li><li class="li-itemize">SET <code>special</code> to the special parameter (only valid for functions; not macros)
</li><li class="li-itemize">SET <code>insert_point</code> to the position of the effect. If this variable is 0 the effect will be inserted as the first effect of the extended header. If this variable is negative or greater than the number of effects, the effect will be inserted as the last effect. The effect is added as the first effect by default.
</li></ul><p><code>ADD_SPELL_CFEFFECT</code>: adds a casting-feature effect to a spell. All variables except <code>probability1</code> are 0 by default.
This is a PATCH macro and function.
</p><ul class="itemize"><li class="li-itemize">
SET <code>opcode</code> to opcode
</li><li class="li-itemize">SET <code>target</code> to target type
</li><li class="li-itemize">SET <code>timing</code> to timing type
</li><li class="li-itemize">SET <code>parameter1</code> to first parameter
</li><li class="li-itemize">SET <code>parameter2</code> to second parameter
</li><li class="li-itemize">SET <code>power</code> to power
</li><li class="li-itemize">SET <code>resist_dispel</code> to magic resistance/dispel type
</li><li class="li-itemize">SET <code>duration</code> to duration
</li><li class="li-itemize">SET <code>probability1</code> to probability 1 (default 100)
</li><li class="li-itemize">SET <code>probability2</code> to probability 2
</li><li class="li-itemize">SPRINT <code>resource</code> to resource (8 chars max)
</li><li class="li-itemize">SET <code>dicenumber</code> to number of dices to be thrown
</li><li class="li-itemize">SET <code>dicesize</code> to size of dices to be thrown
</li><li class="li-itemize">SET <code>savingthrow</code> to type of savingthrow to be allowed against the effect
</li><li class="li-itemize">SET <code>savebonus</code> to saving throw bonus
</li><li class="li-itemize">SET <code>special</code> to the special parameter (only valid for functions; not macros)
</li><li class="li-itemize">SET <code>insert_point</code> to the position of the effect. If this variable is 0 the effect will be inserted as the first effect of the extended header. If this variable is negative or greater than the number of effects, the effect will be inserted as the last effect. The effect is added as the first effect by default.
</li></ul><p><code>ADD_CRE_EFFECT</code>: adds an effect to a creature. All variables except probability1 are 0 by default.
This is a PATCH macro and function.
</p><ul class="itemize"><li class="li-itemize">
SET <code>opcode</code> to opcode
</li><li class="li-itemize">SET <code>timing</code> to timing type
</li><li class="li-itemize">SET <code>target</code> to target type
</li><li class="li-itemize">SET <code>parameter1</code> to first parameter
</li><li class="li-itemize">SET <code>parameter2</code> to second parameter
</li><li class="li-itemize">SET <code>parameter3</code> to third parameter
</li><li class="li-itemize">SET <code>parameter4</code> to forth parameter
</li><li class="li-itemize">SET <code>power</code> to power
</li><li class="li-itemize">SET <code>resist_dispel</code> to magic resistance/dispel type
</li><li class="li-itemize">SET <code>duration</code> to duration
</li><li class="li-itemize">SET <code>probability1</code> to probability 1 (default 100)
</li><li class="li-itemize">SET <code>probability2</code> to probability 2
</li><li class="li-itemize">SPRINT <code>resource</code> to resource (8 chars max)
</li><li class="li-itemize">SPRINT <code>resource2</code> to second resource (8 chars max)
</li><li class="li-itemize">SPRINT <code>vvcresource</code> to VVC resource (8 chars max)
</li><li class="li-itemize">SPRINT <code>effsource</code> to effect source
</li><li class="li-itemize">SPRINT <code>effvar</code> to effect variable
</li><li class="li-itemize">SET <code>dicenumber</code> to number of dices to be thrown
</li><li class="li-itemize">SET <code>dicesize</code> to size of dices to be thrown
</li><li class="li-itemize">SET <code>savingthrow</code> to type of savingthrow to be allowed against the effect
</li><li class="li-itemize">SET <code>savebonus</code> to saving throw bonus
</li><li class="li-itemize">SET <code>school</code> to magical school
</li><li class="li-itemize">SET <code>special</code> to the special parameter (only valid for functions; not macros)
</li><li class="li-itemize">SET <code>lowestafflvl</code> to lowest affected level
</li><li class="li-itemize">SET <code>highestafflvl</code> to highest affected level
</li><li class="li-itemize">SET <code>casterx</code> to caster X position
</li><li class="li-itemize">SET <code>castery</code> to caster Y position
</li><li class="li-itemize">SET <code>targetx</code> to target X position
</li><li class="li-itemize">SET <code>targety</code> to target Y position
</li><li class="li-itemize">SET <code>restype</code> to source resource type
</li><li class="li-itemize">SET <code>sourceslot</code> to source resource slot
</li><li class="li-itemize">SET <code>casterlvl</code> to caster level
</li><li class="li-itemize">SET <code>sectype</code> to secondary type
</li><li class="li-itemize">SET <code>insert_point</code> to the index at which the new effect
is to be inserted. 0 is first and negative values or values
equal to or exceeding the existing number of effects are last.
</li></ul><p><code>DELETE_CRE_ITEM</code>: deletes all matching items from a creature. Regexp allowed.
This is a PATCH macro and function.
</p><ul class="itemize"><li class="li-itemize">
SPRINT <code>item_to_delete</code> to the item you want to delete.
</li></ul><p><code>DELETE_STORE_ITEM</code>: deletes all matching items from a store. Regexp allowed.
This is a PATCH macro and function.
</p><ul class="itemize"><li class="li-itemize">
SPRINT <code>item_to_delete</code> to the item you want to delete.
</li></ul><p><code>DELETE_AREA_ITEM</code>: deletes all matching items from an area. Regexp allowed.
This is a PATCH macro and function.
</p><ul class="itemize"><li class="li-itemize">
SPRINT <code>item_to_delete</code> to the item you want to delete.
</li></ul><p><code>REPLACE_STORE_ITEM</code>: replaces all matching items in a store with another item. Regexp allowed.
This is a PATCH macro and function.
</p><ul class="itemize"><li class="li-itemize">
SPRINT <code>old_item</code> to the item you want to be replaced
</li><li class="li-itemize">SPRINT <code>new_item</code> to the new item
</li><li class="li-itemize">SET <code>number_in_stock</code> to number of new items in stock (default 0)
</li><li class="li-itemize">SPRINT <code>flags</code> to flags new item should have (usual weidu syntax: STOLEN, IDENTIFIEDSTOLEN, etc). Default - no flags.
</li><li class="li-itemize">SET <code>charges1</code> to number of charges of first magical ability (default 0)
</li><li class="li-itemize">SET <code>charges2</code> to number of charges of second magical ability (default 0)
</li><li class="li-itemize">SET <code>charges3</code> to number of charges of third magical ability (default 0)
</li></ul><p><code>REPLACE_AREA_ITEM</code>: replaces all matching items in an area with another item. Regexp allowed.
This is a PATCH macro and function.
</p><ul class="itemize"><li class="li-itemize">
SPRINT <code>old_item</code> to the item you want to be replaced
</li><li class="li-itemize">SPRINT <code>new_item</code> to the new item
</li><li class="li-itemize">SPRINT <code>flags</code> to flags the new item should have (usual weidu syntax: STOLEN, IDENTIFIEDSTOLEN, etc). Default - no flags.
</li><li class="li-itemize">SET <code>charges1</code> to amount in stock/number of charges of first magical ability (default 0)
</li><li class="li-itemize">SET <code>charges2</code> to number of charges of second magical ability (default 0)
</li><li class="li-itemize">SET <code>charges3</code> to number of charges of third magical ability (default 0)
</li></ul><p><code>ADD_AREA_ITEM</code>: adds an item to a container of an area.
This is a PATCH macro and function.
</p><ul class="itemize"><li class="li-itemize">
SPRINT <code>item_to_add</code> to the item you want to add
</li><li class="li-itemize">SET <code>container_to_add_to</code> to the number of the container the item should be added to. The count starts at 1.
</li><li class="li-itemize">SPRINT <code>flags</code> to flags the item should have (usual weidu syntax: STOLEN, IDENTIFIEDSTOLEN, etc). Default - no flags.
</li><li class="li-itemize">SET <code>charges1</code> to amount in stock/number of charges of first magical ability (default 0)
</li><li class="li-itemize">SET <code>charges2</code> to number of charges of second magical ability (default 0)
</li><li class="li-itemize">SET <code>charges3</code> to number of charges of third magical ability (default 0)
</li></ul><p><code>ADD_CRE_ITEM_FLAGS</code>: adds flags to all matching items possessed by a creature. Regexp allowed.
This is a PATCH macro and function.
</p><ul class="itemize"><li class="li-itemize">
SPRINT <code>item_to_change</code> to the item the flags should be added to
</li><li class="li-itemize">SPRINT <code>flags</code> to flags you need to add (usual weidu syntax: STOLEN, IDENTIFIEDSTOLEN, etc).
</li></ul><p><code>REMOVE_CRE_ITEM_FLAGS</code>: removes flags from all matching items possessed by a creature. Regexp allowed.
This is a PATCH macro and function.
</p><ul class="itemize"><li class="li-itemize">
SPRINT <code>item_to_change</code> to the item the flags should be removed from
</li><li class="li-itemize">SPRINT <code>flags</code> to flags you need to remove (usual weidu syntax: STOLEN, IDENTIFIEDSTOLEN, etc).
</li></ul><p><code>SET_CRE_ITEM_FLAGS</code>: set flags to all matching items possessed by a creature. Regexp allowed.
This is a PATCH macro and function.
</p><ul class="itemize"><li class="li-itemize">
SPRINT <code>item_to_change</code> to the item which flags should be set
</li><li class="li-itemize">SPRINT <code>flags</code> to flags you need to set (usual weidu syntax: STOLEN, IDENTIFIEDSTOLEN, etc).
</li></ul><p><code>READ_SOUNDSET</code>: reads soundset of a creature and stores it as an array of string references This is an ACTION macro.
</p><ul class="itemize"><li class="li-itemize">
SPRINT <code>npc</code> to the target creature (with .cre extension)
</li><li class="li-itemize">SPRINT <code>soundset</code> to the name of soundset you want.
</li></ul><p><code>WRITE_SOUNDSET</code>: writes soundset to all matching creatures. Regexp allowed.
This is an ACTION macro.
</p><ul class="itemize"><li class="li-itemize">
SPRINT <code>npc</code> to a creature in question (with .cre extension)
</li><li class="li-itemize">SPRINT <code>soundset</code> to name of soundset you have.
</li><li class="li-itemize">SET <code>overwrite</code> to 2 if you want new soundset to overwrite the old one completely. Set it to 1 if you want to overwrite old string references only with non-empty new references (may keep some old). Set it to 0 it you want to overwrite only empty old references with new ones.
</li></ul><p><code>FJ_CRE_VALIDITY</code>: Checks whether a CRE file is well-formed or not, fixes some common bugs, and reports whether the CRE file is still broken or not. In particular:
</p><ul class="itemize"><li class="li-itemize">
reports invalidity if it is charbase.cre, shorter than the minimum size, the signature mismatches, or a sub-structure has members and its offset is in the header.
</li><li class="li-itemize">if a empty sub-structure’s offset is in the header, point them to the end of the header.
</li><li class="li-itemize">if the cre is valid, force it to use proper order (known spells, spell memorization info, memorized spells, effects, items, item slot).
</li><li class="li-itemize">forces the CRE file to use EFF V2 effects internally (or EFF V1 if on BG1).
</li></ul><p>
This is a PATCH function.
</p><ul class="itemize"><li class="li-itemize">
INT_VAR <code>do_message</code> to 1 if you want explicit an explicit message regarding the cre invalidity. Defaults to 0.
</li><li class="li-itemize">INT_VAR <code>do_reindex</code> to 0 if you don’t want the creature file to be reindexed. Defaults to 1.
</li><li class="li-itemize">INT_VAR <code>do_eff</code> to 0 if you don’t want EFFv1 &lt;-&gt; EFFv2 conversion to be applied. Defaults to 1.
</li><li class="li-itemize">RET <code>valid</code> returns 1 if the CRE is well-formed, 0 otherwise.
</li></ul><p><code>FJ_CRE_REINDEX</code>: reorders creatures with nonstandard offset orders. Called by FJ_CRE_VALIDITY automatically if relevant.<br>
<br>
This is a PATCH function.
</p><ul class="itemize"><li class="li-itemize">
INT_VAR <code>do_reindex</code> to 0 if you don’t want the creature file to be reindexed. Defaults to 1.
</li><li class="li-itemize">INT_VAR <code>do_eff</code> to 0 if you don’t want EFFv1 &lt;-&gt; EFFv2 conversion to be applied. Defaults to 1.
</li></ul><p><code>FJ_CRE_EFF_V2</code>: Converts creatures using version 1 effects to version 2. Called by FJ_CRE_VALIDITY or FJ_CRE_REINDEX automatically if relevant.<br>
This is a PATCH function.</p><p><code>T-CRE_EFF_V1</code>: Converts creatures using version 2 effects to version 1. Called by FJ_CRE_VALIDITY or FJ_CRE_REINDEX automatically if relevant.<br>
This is a PATCH function.</p><p><code>ADD_AREA_REGION_TRIGGER</code>: adds an area region to the current are file.
This is a PATCH macro and function. Unlike other macros you do not need to set every variable. You are only required to set those values that you need to write.
</p><ul class="itemize"><li class="li-itemize">
SPRINT <code>ab_RT_Name</code> -- Name to assign to new region
</li><li class="li-itemize">SET <code>ab_RT_Type</code> -- Type of trigger -- 0=proximity;1=info;2=travel
</li><li class="li-itemize">SET <code>ab_RT_BbLX</code> -- Bounding Box - low x value - LEFT
</li><li class="li-itemize">SET <code>ab_RT_BbLY</code> -- Bounding Box - low y value - TOP
</li><li class="li-itemize">SET <code>ab_RT_BbHX</code> -- Bounding Box - High x value - RIGHT
</li><li class="li-itemize">SET <code>ab_RT_BbHY</code> -- Bounding Box - High y value - BOTTOM
</li><li class="li-itemize">SET <code>ab_RT_VxPr</code> -- Number of Vertex Pairs for current region
</li><li class="li-itemize">SET <code>ab_RT_CuId</code> -- Cursor Index - points to a graphic in cursors.bam
</li><li class="li-itemize">SPRINT <code>ab_RT_Dest</code> -- Destination Area
</li><li class="li-itemize">SPRINT <code>ab_RT_EntN</code> -- Entrance Name
</li><li class="li-itemize">SET <code>ab_RT_Fbit</code> -- Flag bits set in bit format which are read right to left - 0=off; 1=on
</li><li class="li-itemize">SET <code>ab_RT_Itxt</code> -- Info text
</li><li class="li-itemize">SET <code>ab_RT_TDtD</code> -- Trap Detection Difficulty
</li><li class="li-itemize">SET <code>ab_RT_TRmD</code> -- Trap Removal Difficulty
</li><li class="li-itemize">SET <code>ab_RT_TSet</code> -- Trap is set - 0=no; 1=yes
</li><li class="li-itemize">SET <code>ab_RT_TDet</code> -- Trap is detected - 0=no; 1=yes
</li><li class="li-itemize">SET <code>ab_RT_LPoX</code> -- Launch Point X
</li><li class="li-itemize">SET <code>ab_RT_LPoY</code> -- Launch Point Y
</li><li class="li-itemize">SPRINT <code>ab_RT_KeyI</code> -- Key Item
</li><li class="li-itemize">SET <code>ab_RT_Rbcs</code> -- Region Script file
</li><li class="li-itemize">SET <code>ab_RT_ALPX</code> -- Alternate Launch Point X
</li><li class="li-itemize">SET <code>ab_RT_ALPY</code> -- Alternate Launch Point Y
</li><li class="li-itemize">SET <code>ab_RT_Dial</code> -- Dialog file (used only in PST)
</li></ul><p><br>
The vertex points are separated by their XY values
You may have as many pairs as you need. Just copy this set and increment the #.
Example: For the X values: <code>ab_RT_Vx_X_0</code>, <code>ab_RT_Vx_X_1</code>, <code>ab_RT_Vx_X_2</code><br>
 For the Y values: <code>ab_RT_Vx_Y_0</code>, <code>ab_RT_Vx_Y_1</code>, <code>ab_RT_Vx_Y_2</code>
</p><ul class="itemize"><li class="li-itemize">
SET <code>ab_RT_Vx_X_0</code> -- Point #0 X value
</li><li class="li-itemize">SET <code>ab_RT_Vx_Y_0</code> -- Point #0 Y value
</li></ul><p><br>
NOTE: The original code released in WeiDU v211 has been overhauled and re-released in v212. Therefore, the user defined variable names have been changed. If you used the 211 version you will need to update your mod to use the variables in this version. Sorry for the inconvenience...</p><p><br>
<code>RES_NUM_OF_SPELL_NAME</code>: converts a spell.ids reference to resource name.
This is an ACTION and PATCH macro and function.
</p><ul class="itemize"><li class="li-itemize">
SPRINT <code>spell_name</code> to the IDS symbolic reference of a spell.
</li><li class="li-itemize">RET <code>spell_num</code> to the IDS numerical reference of that spell.
</li><li class="li-itemize">RET <code>spell_res to</code> the resource name for the referenced spell.
</li></ul><p>
<br>

<code>RES_NAME_OF_SPELL_NUM</code>: converts a spell.ids reference to resource name.
This is an ACTION and PATCH macro and function.
</p><ul class="itemize"><li class="li-itemize">
SET <code>spell_num</code> to the IDS numerical reference of that spell.
</li><li class="li-itemize">RET <code>spell_name</code> to the IDS symbolic reference of a spell.
</li><li class="li-itemize">RET <code>spell_res</code> to the resource name for the referenced spell.
</li></ul><p>
<br>

<code>NAME_NUM_OF_SPELL_RES</code>: converts a spell resource name to a spell.ids reference.
This is an ACTION and PATCH macro and function.
</p><ul class="itemize"><li class="li-itemize">
SPRINT <code>spell_res</code> to the resource name for the referenced spell.
</li><li class="li-itemize">RET <code>spell_num</code> to the IDS numerical reference of that spell.
</li><li class="li-itemize">RET <code>spell_name</code> to the IDS symbolic reference of a spell.
</li></ul><p>
<br>

<code>GET_UNIQUE_FILE_NAME</code>: Creates a file name that is currently unallocated.
This is a PATCH and ACTION function.
This function will create a filename using __ as a prefix. __ is reserved by
The Bigg and writeable by anybody, as long as you dynamically create the file
name (either by using this function or other code of your devising). The algorithm
creates file names in base 36, going from __0000.ext to __zzzz.ext; this allows for
36 ^ 4 = 1679616 unique file names.</p><p>To allow users to reinstall your mod without breaking the identity of these files, you
can use the ’base’ parameter to ensure that the same thing will be mapped to the same
file on reinstalls. For instance, if you’re iterating through Mages to give each of
them a spellbook, base should contain your modder prefix, an identifier for the purpose
of the call, and the file name you’re working on, for instance:
<code>~tb#spellbooks_%SOURCE_RES%~</code>
</p><ul class="itemize"><li class="li-itemize">
STR_VAR <code>extension</code> to the desired extension (required).
</li><li class="li-itemize">STR_VAR <code>base</code> to a string unique to your mod and current file (optional).
</li><li class="li-itemize">RET <code>filename</code> the currently unallocated file name (sans the extension).
</li></ul><p>
<br>

<code>ALTER_AREA_ENTRANCE</code>: patch coordinates and orientation of <a href="http://gibberlings3.net/iesdp/file_formats/ie_formats/are_v1.htm#formAREAV1_0_Entrance">area party entrance points</a>.
This is a PATCH function. For all integer variables, a negative value results in no change to that field and the default value is -1. The variable <code>entrance_name</code> is required.
</p><ul class="itemize"><li class="li-itemize">
INT_VAR <code>x_coord</code> to the new X coordinate.
</li><li class="li-itemize">INT_VAR <code>y_coord</code> to the new Y coordinate.
</li><li class="li-itemize">INT_VAR <code>orient</code> to the new orientation.
</li><li class="li-itemize">STR_VAR <code>entrance_name</code> to the name of the entrance point to be altered. This variable is required.
</li></ul><p>
<br>

<code>ALTER_AREA_REGION</code>: patch <a href="http://gibberlings3.net/iesdp/file_formats/ie_formats/are_v1.htm#formAREAV1_0_Info">area regions</a>, also known as area triggers.
This is a PATCH function. For all integer variables except <code>info_point</code>, a negative value results in no change and the default value is -1. The variable <code>info_point</code> results in no change if it has the default value 99999999. In the case of flags, a value of 1 will set the flag and a value of 0 will unset it. For all string variables except <code>region_name</code>, the default value is the string "same", which results in no change to that field. The variable <code>region_name</code> is required.
</p><ul class="itemize"><li class="li-itemize">
INT_VAR <code>type</code> to the new type of the region.
</li><li class="li-itemize">INT_VAR <code>cursor</code> to the new cursor index to be used.
</li><li class="li-itemize">INT_VAR <code>trap_detect</code> to the new difficulty of trap detection.
</li><li class="li-itemize">INT_VAR <code>trap_remove</code> to the new difficulty of trap removal.
</li><li class="li-itemize">INT_VAR <code>trapped</code> to whether the region should be trapped.
</li><li class="li-itemize">INT_VAR <code>detected</code> to whether the trap should be detected.
</li><li class="li-itemize">INT_VAR <code>flag_locked</code> to the new value of the flag known as <span class="c003">locked</span> or <span class="c003">invisible trap</span> (bit 0).
</li><li class="li-itemize">INT_VAR <code>flag_resets</code> to the new value of the flag known as <span class="c003">trap resets</span> (bit 1).
</li><li class="li-itemize">INT_VAR <code>flag_party_required</code> to the new value of the flag known as <span class="c003">party is required</span> (bit 2).
</li><li class="li-itemize">INT_VAR <code>flag_trap_detectable</code> to the new value of the flag known as <span class="c003">trap is detectable</span> (bit 3).
</li><li class="li-itemize">INT_VAR <code>flag_trap_enemies</code> to the new value of the flag known as <span class="c003">trap can be set off by enemies</span> (bit 4).
</li><li class="li-itemize">INT_VAR <code>flag_tutorial</code> to the new value of the flag known as <span class="c003">tutorial trigger</span> (bit 5).
</li><li class="li-itemize">INT_VAR <code>flag_trap_npcs</code> to the new value of the flag known as <span class="c003">trap can be set off by NPCs</span> (bit 6).
</li><li class="li-itemize">INT_VAR <code>flag_silent</code> to the new value of the flag known as <span class="c003">silent trigger</span> (bit 7).
</li><li class="li-itemize">INT_VAR <code>flag_deactivated</code> to the new value of the flag known as <span class="c003">deactivated</span> (bit 8).
</li><li class="li-itemize">INT_VAR <code>flag_impassable_npc</code> to the new value of the flag known as <span class="c003">cannot be passed by NPCs</span> (bit 9).
</li><li class="li-itemize">INT_VAR <code>flag_activation_point</code> to the new value of the flag known as <span class="c003">use activation point</span> (bit 10).
</li><li class="li-itemize">INT_VAR <code>flag_connect_to_door</code> to the new value of the flag known as <span class="c003">connected to door</span> (bit 11).
</li><li class="li-itemize">INT_VAR <code>bounding_left</code> to the new value of the left edge of the bounding box. The vertices remain unchanged.
</li><li class="li-itemize">INT_VAR <code>bounding_top</code> to the new value of the top edge of the bounding box. The vertices remain unchanged.
</li><li class="li-itemize">INT_VAR <code>bounding_right</code> to the new value of the right edge of the bounding box. The vertices remain unchanged.
</li><li class="li-itemize">INT_VAR <code>bounding_bottom</code> to the new value of the bottom edge of the bounding box. The vertices remain unchanged.
</li><li class="li-itemize">INT_VAR <code>info_point</code> to the new string reference of the info point.
</li><li class="li-itemize">INT_VAR <code>launch_x</code> to the new x coordinate of the launch point.
</li><li class="li-itemize">INT_VAR <code>launch_y</code> to the new y coordinate of the launch point.
</li><li class="li-itemize">INT_VAR <code>activate_x</code> to the new x coordinate of the activation point.
</li><li class="li-itemize">INT_VAR <code>activate_y</code> to the new y coordinate of the activation point.
</li><li class="li-itemize">STR_VAR <code>region_name</code> to the name of the region to be patched. This variable is required.
</li><li class="li-itemize">STR_VAR <code>destination_area</code> to the resref of the new destination area.
</li><li class="li-itemize">STR_VAR <code>entrance_name</code> to the new entrance name of the destination area.
</li><li class="li-itemize">STR_VAR <code>region_key</code> to the resref of the key item.
</li><li class="li-itemize">STR_VAR <code>region_script</code> to the resref of the region script.
</li></ul><p>
<br>

<code>ALTER_AREA_ACTOR</code>: patch <a href="http://gibberlings3.net/iesdp/file_formats/ie_formats/are_v1.htm#formAREAV1_0_Actor">area actors</a>.
This is a PATCH function. All integer variables, except <code>expiry</code>, default to the value -1 and a negative value results in no change to the corresponding field. The variable <code>expiry</code> instead has a default value of -2. In the case of flags, a value of 1 will set the flag and a value of 0 will unset it. All string variables except <code>actor_name</code> default to the string "same", which results in no change to the corresponding field. The variable <code>actor_name</code> is required.
</p><ul class="itemize"><li class="li-itemize">
INT_VAR <code>x_coord</code> to the new x coordinate. Unless <code>dest_x</code> is defined, <code>x_coord</code> is used as the x-value of the destination, as well.
</li><li class="li-itemize">INT_VAR <code>y_coord</code> to the new y coordinate. Unless <code>dest_y</code> is defined, <code>y_coord</code> is used as the y-value of the destination, as well.
</li><li class="li-itemize">INT_VAR <code>dest_x</code> to the new x destination.
</li><li class="li-itemize">INT_VAR <code>dest_y</code> to the new y destination.
</li><li class="li-itemize">INT_VAR <code>spawned</code> to the new spawned value.
</li><li class="li-itemize">INT_VAR <code>animation</code> to the new animation value.
</li><li class="li-itemize">INT_VAR <code>orient</code> to the new facing direction.
</li><li class="li-itemize">INT_VAR <code>expiry</code> to the new expiration time.
</li><li class="li-itemize">INT_VAR <code>wander</code> to the new wander-distance value.
</li><li class="li-itemize">INT_VAR <code>follow</code> to the new follow-distance value.
</li><li class="li-itemize">INT_VAR <code>times_talked</code> to the new number of times the actor has been talked to.
</li><li class="li-itemize">INT_VAR <code>flag_cre_unattached</code> to the new value of the flag known as <span class="c003">CRE attached</span> (bit 0).
</li><li class="li-itemize">INT_VAR <code>flag_seen_party</code> to the new value of the flag known as <span class="c003">has seen party</span> (bit 1).
</li><li class="li-itemize">INT_VAR <code>flag_invulnerable</code> to the new value of the flag known as <span class="c003">invulnerable</span> (bit 2).
</li><li class="li-itemize">INT_VAR <code>flag_override_script_name</code> to the new value of the flag known as override script name (bit 3).
</li><li class="li-itemize">INT_VAR <code>flag_time_0</code> through <code>flag_time_23</code> to the new values of the actor’s appearance schedule.
</li><li class="li-itemize">STR_VAR <code>actor_name</code> to the name of the actor to be patched. This variable is required.
</li><li class="li-itemize">STR_VAR <code>dlg_file</code> to the resref of the new dialogue file.
</li><li class="li-itemize">STR_VAR <code>script_override</code> to the resref of the new override script.
</li><li class="li-itemize">STR_VAR <code>script_general</code> to the resref of the new general script.
</li><li class="li-itemize">STR_VAR <code>script_class</code> to the resref of the new class script.
</li><li class="li-itemize">STR_VAR <code>script_race</code> to the resref of the new race script.
</li><li class="li-itemize">STR_VAR <code>script_default</code> to the resref of the new default script.
</li><li class="li-itemize">STR_VAR <code>script_specifics</code> to the resref of the new specifics script.
</li><li class="li-itemize">STR_VAR <code>cre_file</code> to the resref of the new creature file.
</li></ul><p>
<br>

<code>ALTER_AREA_CONTAINER</code>: patch <a href="http://gibberlings3.net/iesdp/file_formats/ie_formats/are_v1.htm#formAREAV1_0_Container">area containers</a>, but not their contents. This is a PATCH function. All integer variables default to -1 and negative values result in no change to the corresponding field. In the case of flags, a value of 1 will set the flag and a value of 0 will unset it. All string variables except <code>container_name</code> default to the string "same", which results in no change to the corresponding field. The variable <code>container_name</code> is required.
</p><ul class="itemize"><li class="li-itemize">
INT_VAR <code>coord_x</code> to the new x coordinate.
</li><li class="li-itemize">INT_VAR <code>coord_y</code> to the new y coordinate.
</li><li class="li-itemize">INT_VAR <code>container_type</code> to the new type of the container.
</li><li class="li-itemize">INT_VAR <code>trapped</code> to whether the container should be trapped.
</li><li class="li-itemize">INT_VAR <code>detected</code> to whether the container trap should be detected.
</li><li class="li-itemize">INT_VAR <code>launch_x</code> to the new x coordinate of the launch point.
</li><li class="li-itemize">INT_VAR <code>launch_y</code> to the new y coordinate of the launch point.
</li><li class="li-itemize">INT_VAR <code>bounding_left</code> to the new value of the left edge of the bounding box. The vertices remain unchanged.
</li><li class="li-itemize">INT_VAR <code>bounding_top</code> to the new value of the top edge of the bounding box. The vertices remain unchanged.
</li><li class="li-itemize">INT_VAR <code>bounding_right</code> to the new value of the right edge of the bounding box. The vertices remain unchanged.
</li><li class="li-itemize">INT_VAR <code>bounding_bottom</code> to the new value of the bottom edge of the bounding box. The vertices remain unchanged.
</li><li class="li-itemize">INT_VAR <code>range</code> to the new trigger-range value.
</li><li class="li-itemize">INT_VAR <code>lockpick_strref</code> to the new strref of the lockpick string.
</li><li class="li-itemize">INT_VAR <code>lock_difficulty</code> to the new difficulty of the lock.
</li><li class="li-itemize">INT_VAR <code>trap_detect</code> to the new difficulty of trap detection.
</li><li class="li-itemize">INT_VAR <code>trap_remove</code> to the new difficulty of trap removal.
</li><li class="li-itemize">INT_VAR <code>flag_locked</code> to the new value of the flag known as <span class="c003">locked</span> (bit 0).
</li><li class="li-itemize">INT_VAR <code>flag_mlocked</code> to the new value of the flag known as <span class="c003">magical lock</span> (bit 2).
</li><li class="li-itemize">INT_VAR <code>flag_resets</code> to the new value of the flag known as <span class="c003">trap resets</span> (bit 3).
</li><li class="li-itemize">INT_VAR <code>flag_disabled</code> to the new value of the flag known as <span class="c003">disabled</span> (bit 5).
</li><li class="li-itemize">STR_VAR <code>container_name</code> to the name of the container to be patched. This variable is required.
</li><li class="li-itemize">STR_VAR <code>container_script</code> to the resref of the new container script.
</li><li class="li-itemize">STR_VAR <code>container_key</code> to the resref of the new container key.
</li></ul><p>
<br>

<code>ALTER_AREA_DOOR</code>: patch <a href="http://gibberlings3.net/iesdp/file_formats/ie_formats/are_v1.htm#formAREAV1_0_Door">area doors.</a> This is a PATCH function. All integer variables, except <code>string_unlock</code> and <code>string_speaker</code>, default to -1 and negative values result in no change to the corresponding field. The variables <code>string_unlock</code> and <code>string_speaker</code> instead default to 99999999. In the case of flags, a value of 1 will set the flag and a value of 0 will unset it. All string variables except <code>door_name</code> default to the string "same", which results in no change to the corresponding field. The variable <code>door_name</code> is required.
</p><ul class="itemize"><li class="li-itemize">
INT_VAR <code>bounding_open_left</code> to the new value of the left edge of the open-state bounding box. The vertices remain unchanged.
</li><li class="li-itemize">INT_VAR <code>bounding_open_top</code> to the new value of the top edge of the open-state bounding box. The vertices remain unchanged.
</li><li class="li-itemize">INT_VAR <code>bounding_open_right</code> to the new value of the right edge of the open-state bounding box. The vertices remain unchanged.
</li><li class="li-itemize">INT_VAR <code>bounding_open_bottom</code> to the new value of the bottom edge of the open-state bounding box. The vertices remain unchanged.
</li><li class="li-itemize">INT_VAR <code>bounding_closed_left</code> to the new value of the left edge of the closed-state bounding box. The vertices remain unchanged.
</li><li class="li-itemize">INT_VAR <code>bounding_closed_top</code> to the new value of the top edge of the closed-state bounding box. The vertices remain unchanged.
</li><li class="li-itemize">INT_VAR <code>bounding_closed_right</code> to the new value of the right edge of the closed-state bounding box. The vertices remain unchanged.
</li><li class="li-itemize">INT_VAR <code>bounding_closed_bottom</code> to the new value of the bottom edge of the closed-state bounding box. The vertices remain unchanged.
</li><li class="li-itemize">INT_VAR <code>door_hp</code> to the new hit-point value.
</li><li class="li-itemize">INT_VAR <code>door_ac</code> to the new armor-class value.
</li><li class="li-itemize">INT_VAR <code>cursor</code> to the new cursor index.
</li><li class="li-itemize">INT_VAR <code>trap_detect</code> to the new difficulty of trap detection.
</li><li class="li-itemize">INT_VAR <code>trap_remove</code> to the new difficulty of trap removal.
</li><li class="li-itemize">INT_VAR <code>trapped</code> to whether the door should be trapped.
</li><li class="li-itemize">INT_VAR <code>detected</code> to whether the door trap should be detected.
</li><li class="li-itemize">INT_VAR <code>launch_x</code> to the new x coordinate of the launch point.
</li><li class="li-itemize">INT_VAR <code>launch_y</code> to the new y coordinate of the launch point.
</li><li class="li-itemize">INT_VAR <code>door_detect</code> to the new difficulty of door detection.
</li><li class="li-itemize">INT_VAR <code>lock_difficulty</code> to the new difficulty of the lock.
</li><li class="li-itemize">INT_VAR <code>open_x</code> to the new x coordinate of the opening point.
</li><li class="li-itemize">INT_VAR <code>open_y</code> to the new y coordinate of the opening point.
</li><li class="li-itemize">INT_VAR <code>close_x</code> to the new x coordinate of the closing point.
</li><li class="li-itemize">INT_VAR <code>close_y</code> to the new y coordinate of the closing point.
</li><li class="li-itemize">INT_VAR <code>string_unlock</code> to the new string reference of the unlock message.
</li><li class="li-itemize">INT_VAR <code>string_speaker</code> to the new string reference of the dialogue-speaker name.
</li><li class="li-itemize">INT_VAR <code>flag_open</code> to the new value of the flag known as <span class="c003">door open</span> (bit 0).
</li><li class="li-itemize">INT_VAR <code>flag_locked</code> to the new value of the flag known as <span class="c003">door locked</span> (bit 1).
</li><li class="li-itemize">INT_VAR <code>flag_resets</code> to the new value of the flag known as <span class="c003">reset trap</span> (bit 2).
</li><li class="li-itemize">INT_VAR <code>flag_detectable</code> to the new value of the flag known as <span class="c003">trap detectable</span> (bit 3).
</li><li class="li-itemize">INT_VAR <code>flag_forced</code> to the new value of the flag known as <span class="c003">broken</span> (bit 4).
</li><li class="li-itemize">INT_VAR <code>flag_no_close</code> to the new value of the flag known as <span class="c003">can’t close</span> (bit 5).
</li><li class="li-itemize">INT_VAR <code>flag_located</code> to the new value of the flag known as <span class="c003">linked</span> (bit 6).
</li><li class="li-itemize">INT_VAR <code>flag_secret</code> to the new value of the flag known as <span class="c003">door hidden</span> (bit 7).
</li><li class="li-itemize">INT_VAR <code>flag_detected</code> to the new value of the flag known as <span class="c003">door found</span> (bit 8).
</li><li class="li-itemize">INT_VAR <code>flag_no_look</code> to the new value of the flag known as <span class="c003">don’t block line of sight</span> (bit 9).
</li><li class="li-itemize">INT_VAR <code>flag_uses_key</code> to the new value of the flag known as <span class="c003">remove key</span> (bit 10).
</li><li class="li-itemize">INT_VAR <code>flag_sliding</code> to the new value of the flag known as <span class="c003">ignore obstacles when closing</span> (bit 11).
</li><li class="li-itemize">STR_VAR <code>door_name</code> to the name of the door to be patched. This variable is required.
</li><li class="li-itemize">STR_VAR <code>door_open_sound</code> to the resource reference of the opening sound.
</li><li class="li-itemize">STR_VAR <code>door_close_sound</code> to the resource reference of the closing sound.
</li><li class="li-itemize">STR_VAR <code>door_key</code> to the resref of the new door key.
</li><li class="li-itemize">STR_VAR <code>door_script</code> to the resref of the new door script.
</li><li class="li-itemize">STR_VAR <code>travel_trigger</code> to the new travel-trigger name. This field is 24 bytes in length.
</li><li class="li-itemize">STR_VAR <code>dialogue</code> to the new resource reference of the dialogue file.
</li></ul><p>
<br>

<code>ALTER_ITEM_EFFECT</code>: patch <a href="http://gibberlings3.net/iesdp/file_formats/ie_formats/itm_v1.htm#itmv1_Feature_Block">global (equipping) effects</a> and/or <a href="http://gibberlings3.net/iesdp/file_formats/ie_formats/itm_v1.htm#itmv1_Extended_Header">effects on extended headers</a>. This is a PATCH function. All integer variables except <code>check_globals</code>, <code>check_headers</code>, <code>header</code> and <code>savebonus</code> default to -1 and negative values result in no change to the corresponding field. The integer variables <code>check_globals</code>, <code>check_headers</code> and <code>header</code> default to 0. The integer variable <code>savebonus</code> defaults to -11 and values lower than -10 result in no change to the corresponding field. The string variable <code>resource</code> defaults to the string "same", which results in no change to the corresponding field.</p><p>Note that both <code>check_globals</code> and <code>check_headers</code> are 0 by default, so you need to change one or both of these to 1 to perform any patching at all. If you patch headers, you can further target by using type to target melee, ranged, or magical headers. <code>match_opcode</code> can be left at -1 to match all effects on your targeted range or targeted to a specific opcode. If the opcode itself needs to be changed, you can use <code>match_opcode</code> to target the existing effect and <code>new_opcode</code> as the new opcode to use. <code>duration_high</code> is an alternative to <code>duration</code>, mainly for changing the overall duration of an item’s effects. The idea is to allow you to mass patch effects to new durations while leaving the one-time only cosmetics and visuals--which are usual instant or only run for a few seconds--unchanged.
</p><ul class="itemize"><li class="li-itemize">
INT_VAR <code>check_globals</code> to whether to check global (on-equip) effects (0 for no, 1 for yes). (default 0)
</li><li class="li-itemize">INT_VAR <code>check_headers</code> to whether to check effects on extended headers (0 for no, 1 for yes). (default 0)
</li><li class="li-itemize">INT_VAR <code>header</code> to the number of the ability header that should be altered. A value of 0 matches all headers. (default 0)
</li><li class="li-itemize">INT_VAR <code>header_type</code> to which type of header that should be checked. If this variable is -1, all header types will be checked.
</li><li class="li-itemize">INT_VAR <code>match_opcode</code> to which type of opcode to match. If this variable is -1, all opcodes are a match.
</li><li class="li-itemize">INT_VAR <code>new_opcode</code> to the value the matched opcode should be changed into.
</li><li class="li-itemize">INT_VAR <code>target</code> to the new target.
</li><li class="li-itemize">INT_VAR <code>power</code> to the new power.
</li><li class="li-itemize">INT_VAR <code>parameter1</code> to the new parameter1.
</li><li class="li-itemize">INT_VAR <code>parameter2</code> to the new parameter2.
</li><li class="li-itemize">INT_VAR <code>timing</code> to the new timing mode.
</li><li class="li-itemize">INT_VAR <code>resist_dispel</code> to the new resist/dispel.
</li><li class="li-itemize">INT_VAR <code>duration</code> to the new duration.
</li><li class="li-itemize">INT_VAR <code>duration_high</code> to the new duration, but is only written if the existing duration is greater than 5.
</li><li class="li-itemize">INT_VAR <code>probability1</code> to the new probability1 (the upper bound).
</li><li class="li-itemize">INT_VAR <code>probability2</code> to the new probability2 (the lower bound).
</li><li class="li-itemize">INT_VAR <code>dicenumber</code> to the new number of dice. This field is instead used for maximum hit-dice (HD) by some opcodes.
</li><li class="li-itemize">INT_VAR <code>dicesize</code> to the new size of dice. This field is also instead for minimum hit-dice (HD) by some opcodes.
</li><li class="li-itemize">INT_VAR <code>savingthrow</code> to the new saving-throw type.
</li><li class="li-itemize">INT_VAR <code>savebonus</code> to the new saving-throw bonus/penalty. This variable can take negative values down to -10 while still writing to the corresponding field. (default -11)
</li><li class="li-itemize">INT_VAR <code>special</code> to the new special parameter.
</li><li class="li-itemize">STR_VAR <code>resource</code> to the new resource reference.
</li></ul><p>
<br>

<code>ALTER_ITEM_HEADER</code>: patch <a href="http://gibberlings3.net/iesdp/file_formats/ie_formats/itm_v1.htm#itmv1_Extended_Header">ability headers</a> on items. This is a PATCH function. All integer variables except <code>match_icon</code> and <code>header</code> default to -1 and negative values result in no change to the corresponding field. The integer variables <code>match_icon</code> and <code>header</code> default to 0. In the case of flags, a value of 1 will set the flag and a value of 0 will unset it. The string variable <code>icon</code> defaults to the string "same", which results in no change to the corresponding field.</p><p><code>header_type</code> is used to limit the scope of matching. The default value of -1 will match all types of headers while values of 0-4 will match headers with those values. If <code>match_icon</code> is 1, the icon resource reference will be match with the <code>icon</code> variable as an additional qualifier. This is useful for items which have multiple magic abilities. <code>header</code> can also be used to limit patching to the Nth header, counting from 1 as the first header. The default is 0, which will match all headers.</p><ul class="itemize"><li class="li-itemize">
INT_VAR <code>header_type</code> to the type of header to be matched. If this variable is -1, all headers will be a match. (default -1)
</li><li class="li-itemize">INT_VAR <code>match_icon</code> to whether to match the ability icon (0 for no, 1 for yes). (default 0)
</li><li class="li-itemize">INT_VAR <code>header</code> to the number of the ability header (starting from 1) that should be altered. A value of 0 matches all header. (default 0)
</li><li class="li-itemize">INT_VAR <code>new_header_type</code> to the value the matched header should be changed into.
</li><li class="li-itemize">INT_VAR <code>identify</code> to the new identification requirement.
</li><li class="li-itemize">INT_VAR <code>location</code> to the new new ability location.
</li><li class="li-itemize">INT_VAR <code>target</code> to the new target.
</li><li class="li-itemize">INT_VAR <code>target_count</code> to the new target count.
</li><li class="li-itemize">INT_VAR <code>range</code> to the new range.
</li><li class="li-itemize">INT_VAR <code>launcher</code> to the new required launcher.
</li><li class="li-itemize">INT_VAR <code>speed</code> to the new speed factor.
</li><li class="li-itemize">INT_VAR <code>thac0_bonus</code> to the new THAC0 bonus.
</li><li class="li-itemize">INT_VAR <code>dicesize</code> to the new dice size.
</li><li class="li-itemize">INT_VAR <code>primary_type</code> to the new primary type (school).
</li><li class="li-itemize">INT_VAR <code>dicenumber</code> to the new number of dice.
</li><li class="li-itemize">INT_VAR <code>secondary_type</code> to the new secondary type.
</li><li class="li-itemize">INT_VAR <code>damage_bonus</code> to the new damage bonus.
</li><li class="li-itemize">INT_VAR <code>damage_type</code> to the new damage type.
</li><li class="li-itemize">INT_VAR <code>charges</code> to the new number of charges.
</li><li class="li-itemize">INT_VAR <code>drained</code> to the new charge-depletion behaviour.
</li><li class="li-itemize">INT_VAR <code>projectile</code> to the new projectile.
</li><li class="li-itemize">INT_VAR <code>animation_overhand</code> to the new overhand animation percentage.
</li><li class="li-itemize">INT_VAR <code>animation_backhand</code> to the new backhand animation percentage.
</li><li class="li-itemize">INT_VAR <code>animation_thrust</code> to the new thrust animation percentage.
</li><li class="li-itemize">INT_VAR <code>arrow</code> to the new arrow qualifier.
</li><li class="li-itemize">INT_VAR <code>bolt</code> to the new bolt qualifier.
</li><li class="li-itemize">INT_VAR <code>bullet</code> to the new bullet qualifier.
</li><li class="li-itemize">INT_VAR <code>flag_strength</code> to the new value of the flag known as <span class="c003">add strength bonus</span> (bit 0).
</li><li class="li-itemize">INT_VAR <code>flag_break</code> to the new value of the flag known as <span class="c003">breakable</span> (bit 1).
</li><li class="li-itemize">INT_VAR <code>flag_strength_damage</code> to the new value of the flag known as <span class="c003">add strength bonus to damage only</span> (bit 2). This flag is not available in all games.
</li><li class="li-itemize">INT_VAR <code>flag_strength_thac0</code> to the new value of the flag known as <span class="c003">add strength bonus to THAC0 only</span> (bit 3). This flag is not available in all games.
</li><li class="li-itemize">INT_VAR <code>flag_hostile</code> to the new value of the flag known as <span class="c003">hostile</span> (bit 10).
</li><li class="li-itemize">INT_VAR <code>flag_recharge</code> to the new value of the flag known as <span class="c003">recharges</span> (bit 11).
</li><li class="li-itemize">INT_VAR <code>flag_bypass</code> to the new value of the flag known as <span class="c003">bypass armor</span> (bit 16). This flag is not available in all games.
</li><li class="li-itemize">INT_VAR <code>flag_keenedge</code> to the new value of the flag known as <span class="c003">keen edge</span> (bit 17). This flag is not available in all games.
</li><li class="li-itemize">INT_VAR <code>flag_backstab</code> to the new value of the flag known as <span class="c003">toggle backstab</span> (bit 25). This flag is not available in all games.
</li><li class="li-itemize">INT_VAR <code>flag_noinvisible</code> to the new value of the flag known as <span class="c003">cannot target invisible</span> (bit 26). This flag is not available in all games.
</li><li class="li-itemize">STR_VAR <code>icon</code> to the resource reference to be used for matching if <code>match_icon</code> is 1, or the new ability icon if <code>match_icon</code> is 0.
</li></ul><p>
<br>

<code>DELETE_ITEM_HEADER</code>: delete ability headers, also known as <a href="http://gibberlings3.net/iesdp/file_formats/ie_formats/itm_v1.htm#itmv1_Extended_Header">extended headers</a>, from items. This is a PATCH function. All integer variables default to 0.</p><p>This function will delete one or more ability headers, along with all of their associated effects, and properly re-index the file.</p><ul class="itemize"><li class="li-itemize">
INT_VAR <code>header_type</code> to the header type to delete. If this variable is -1, all header types will be a match. (default 0)
</li></ul><p>
<br>

<code>ALTER_SPELL_EFFECT</code>: patch <a href="http://gibberlings3.net/iesdp/file_formats/ie_formats/spl_v1.htm#splv1_Feature_Block">effects</a> on spells. This is a PATCH function. All integer variables except <code>check_globals</code>, <code>check_headers</code>, <code>header</code> and <code>savebonus</code> default to -1 and negative values result in no change to the corresponding field. The integer variables <code>check_globals</code> and <code>header</code> default to 0. The integer variable <code>check_headers</code> defaults to 1. The integer variable <code>savebonus</code> defaults to -11 and values lower than -10 result in no change to the corresponding field. The string variable <code>resource</code> defaults to the string "same", which results in no change to the corresponding field.</p><p>The function will by default only check effects on headers. You can change this by changing the values of the variables <code>check_globals</code> and <code>check_headers</code>. If you patch headers, you can further target by using type to target melee, ranged, or magical headers. <code>match_opcode</code> can be left at -1 to match all effects on your targeted range or targeted to a specific opcode. If the opcode itself needs to be changed, you can use <code>match_opcode</code> to target the existing effect and <code>new_opcode</code> as the new opcode to use. <code>duration_high</code> is an alternative to <code>duration</code>, mainly for changing the overall duration of an item’s effects. The idea is to allow you to mass patch effects to new durations while leaving the one-time only cosmetics and visuals--which are usual instant or only run for a few seconds--unchanged.
</p><ul class="itemize"><li class="li-itemize">
INT_VAR <code>check_globals</code> to whether to check global effects (0 for no, 1 for yes). (default 0)
</li><li class="li-itemize">INT_VAR <code>check_headers</code> to whether to check effects on extended headers (0 for no, 1 for yes). (default 1)
</li><li class="li-itemize">INT_VAR <code>header</code> to the number of the ability header that should be altered. A value of 0 matches all headers. (default 0)
</li><li class="li-itemize">INT_VAR <code>header_type</code> to which type of header that should be checked. If this variable is -1, all header types will be checked.
</li><li class="li-itemize">INT_VAR <code>match_opcode</code> to which type of opcode to match. If this variable is -1, all opcodes are a match.
</li><li class="li-itemize">INT_VAR <code>new_opcode</code> to the value the matched opcode should be changed into.
</li><li class="li-itemize">INT_VAR <code>target</code> to the new target.
</li><li class="li-itemize">INT_VAR <code>power</code> to the new power.
</li><li class="li-itemize">INT_VAR <code>parameter1</code> to the new parameter1.
</li><li class="li-itemize">INT_VAR <code>parameter2</code> to the new parameter2.
</li><li class="li-itemize">INT_VAR <code>timing</code> to the new timing mode.
</li><li class="li-itemize">INT_VAR <code>resist_dispel</code> to the new resist/dispel.
</li><li class="li-itemize">INT_VAR <code>duration</code> to the new duration.
</li><li class="li-itemize">INT_VAR <code>duration_high</code> to the new duration, but is only written if the existing duration is greater than 5.
</li><li class="li-itemize">INT_VAR <code>probability1</code> to the new probability1 (the upper bound).
</li><li class="li-itemize">INT_VAR <code>probability2</code> to the new probability2 (the lower bound).
</li><li class="li-itemize">INT_VAR <code>dicenumber</code> to the new number of dice. This field is instead used for maximum hit-dice (HD) by some opcodes.
</li><li class="li-itemize">INT_VAR <code>dicesize</code> to the new size of dice. This field is also instead for minimum hit-dice (HD) by some opcodes.
</li><li class="li-itemize">INT_VAR <code>savingthrow</code> to the new saving-throw type.
</li><li class="li-itemize">INT_VAR <code>savebonus</code> to the new saving-throw bonus/penalty. This variable can take negative values down to -10 while still writing to the corresponding field. (default -11)
</li><li class="li-itemize">INT_VAR <code>special</code> to the new special parameter.
</li><li class="li-itemize">STR_VAR <code>resource</code> to the new resource reference.
</li></ul><p>
<br>

<code>ALTER_SPELL_HEADER</code>: patch <a href="http://gibberlings3.net/iesdp/file_formats/ie_formats/spl_v1.htm#splv1_Extended_Header">ability headers</a> on spells. This is a PATCH function.All integer variables except <code>match_icon</code> and <code>header</code> default to -1 and negative values result in no change to the corresponding field. The integer variables <code>match_icon</code> and <code>header</code> default to 0. The string variable <code>icon</code> defaults to the string "same", which results in no change to the corresponding field.</p><p><code>header_type</code> is used to limit the scope of matching. The default value of -1 will match all types of headers while values of 0-4 will match headers with those values. If <code>match_icon</code> is 1, the icon resource reference will be match with the <code>icon</code> variable as an additional qualifier. This is useful for items which have multiple magic abilities. <code>header</code> can also be used to limit patching to the Nth header, counting from 1 as the first header. The default is 0, which will match all headers.</p><ul class="itemize"><li class="li-itemize">
INT_VAR <code>header_type</code> to the type of header to be matched. If this variable is -1, all headers will be a match. (default -1)
</li><li class="li-itemize">INT_VAR <code>match_icon</code> to whether to match the ability icon (0 for no, 1 for yes). (default 0)
</li><li class="li-itemize">INT_VAR <code>header</code> to the number of the ability header (starting from 1) that should be altered. A value of 0 matches all header. (default 0)
</li><li class="li-itemize">INT_VAR <code>new_header_type</code> to the value the matched header should be changed into.
</li><li class="li-itemize">INT_VAR <code>location</code> to the new new ability location.
</li><li class="li-itemize">INT_VAR <code>target</code> to the new target.
</li><li class="li-itemize">INT_VAR <code>target_count</code> to the new target count.
</li><li class="li-itemize">INT_VAR <code>range</code> to the new range.
</li><li class="li-itemize">INT_VAR <code>min_level</code> to the new required minimum level.
</li><li class="li-itemize">INT_VAR <code>speed</code> to the new speed factor.
</li><li class="li-itemize">INT_VAR <code>thac0_bonus</code> to the new THAC0 bonus.
</li><li class="li-itemize">INT_VAR <code>dicesize</code> to the new dice size.
</li><li class="li-itemize">INT_VAR <code>dicenumber</code> to the new number of dice.
</li><li class="li-itemize">INT_VAR <code>damage_bonus</code> to the new damage bonus.
</li><li class="li-itemize">INT_VAR <code>damage_type</code> to the new damage type.
</li><li class="li-itemize">INT_VAR <code>charges</code> to the new number of charges.
</li><li class="li-itemize">INT_VAR <code>projectile</code> to the new projectile.
</li><li class="li-itemize">STR_VAR <code>icon</code> to the resource reference to be used for matching if <code>match_icon</code> is 1, or the new ability icon if <code>match_icon</code> is 0.
</li></ul><p>
<br>

<code>DELETE_SPELL_HEADER</code>: delete ability headers, also known as <a href="http://gibberlings3.net/iesdp/file_formats/ie_formats/itm_v1.htm#itmv1_Extended_Header">extended headers</a>, from spells. This is a PATCH function. The integer variable <code>header_type</code> defaults to 0. The integer variable <code>min_level</code> defaults to -1 and if this variable is 0 or greater, only headers with a matching minimum level will be deleted.</p><p>This function will delete one or more ability headers, along with all of their associated effects, and properly re-index the file.</p><ul class="itemize"><li class="li-itemize">
INT_VAR <code>header_type</code> to the header type to delete. If this variable is -1, all header types will be a match. (default 0)
</li><li class="li-itemize">INT_VAR <code>min_level</code> to the minimum level to be matched. If this variable is negative, it will not be used for matching. (default -1)
</li></ul><p>
<br>

<code>CLONE_EFFECT</code>: This is a patch function for creature, item, or spell files that will match an existing effect and create a new one based on the matched effect. Numerous variables are available for matching the specified effect and for specifying new values in the new effect based on the matched effect.</p><p>The first batch of variables are meta-variables which will help determine the scope of the function:</p><ul class="itemize"><li class="li-itemize">
INT_VAR <code>check_globals</code> to whether the function should loop through global effects on items (also known as equipping effects) and spells (default is 1). Creature effects are all global effects, so this variable will always be considered to be one when this function is run on a creature.
</li><li class="li-itemize">INT_VAR <code>check_headers</code> to whether the function should loop through effects on extended headers on items and spells if set to 1 (default is 1). Creatures have no extended headers, so this variable is ignored when used on creatures.
</li><li class="li-itemize">INT_VAR <code>header</code> to whether the function should target effects on one specific header, counting the first header as zero. A negative value will match all headers (default is -1). Creatures have no extended headers, so this variable is ignored when used on creatures.
</li><li class="li-itemize">INT_VAR <code>header_type</code> to whether the function should only clone effects on extended headers of the specified type (1 - melee, 2 - ranged, etc.). Negative values will look at effects on all headers (default is -1). Creatures have no extended headers, so this variable is ignored when used on creatures.
</li><li class="li-itemize">INT_VAR <code>multi_match</code> to the number of effects to clone in the active stack. If you just want to match the first effect and have the function stop, use 1. Otherwise the function will continue matching until the number of cloned effects matches this value. The function will always make at least one change (e.g. 0 or negative values are treated as 1). (default is 999).
</li><li class="li-itemize">INT_VAR <code>verbose</code> to whether the function should provide some rudimentary information on how many effects were added (default is 0).
</li><li class="li-itemize">INT_VAR <code>silent</code> to whether the function should suppress warnings when no effects were added. This option also suppresses the <span class="c003">verbose</span> option (default is 0).
</li><li class="li-itemize">STR_VAR <code>insert</code> to the relative position the cloned effect should be inserted at. A value of ’below’ puts the new, cloned effect immediately below the matched effect. Values of ’first’ or last’ will put the new effect at the top or bottom of the effect stack, respectively. All other values will default to ’above’, where the effect is added immediately before the matched effect (default is ’above’).
</li></ul><p>The next batch of variables sets the function boundaries on matching an effect to clone. Any variables not specified will not be used to determine a match. The function will only determine an effect is a match only if ALL of the variables specified are matched.</p><ul class="itemize"><li class="li-itemize">
INT_VAR <code>match_opcode</code> to the opcode of effects to be matched (default -1).
</li><li class="li-itemize">INT_VAR <code>match_target</code> to the target of effects to be matched (default -1).
</li><li class="li-itemize">INT_VAR <code>match_power</code> to the power of effects to be matched (default -1).
</li><li class="li-itemize">INT_VAR <code>match_parameter1</code> to parameter1 of effects to be matched (default -1).
</li><li class="li-itemize">INT_VAR <code>match_parameter2</code> to parameter2 of effects to be matched (default -1).
</li><li class="li-itemize">INT_VAR <code>match_timing</code> to the timing of effects to be matched (default -1).
</li><li class="li-itemize">INT_VAR <code>match_resist_dispel</code> to the resist/dispel setting of effects to be matched (default -1).
</li><li class="li-itemize">INT_VAR <code>match_duration</code> to the duration of effects to be matched (default -1).
</li><li class="li-itemize">INT_VAR <code>match_probability1</code> to probability1 (the upper bound) of effects to be matched (default -1).
</li><li class="li-itemize">INT_VAR <code>match_probability2</code> to probability2 (the lower bound) of effects to be matched (default -1).
</li><li class="li-itemize">INT_VAR <code>match_dicenumber</code> to the number of dice of effects to be matched (default -1). This field is instead used for maximum hit-dice (HD) by some opcodes.
</li><li class="li-itemize">INT_VAR <code>match_dicesize</code> to the size of dice of effects to be matched (default -1). This field is used instead for minimum hit-dice (HD) by some opcodes.
</li><li class="li-itemize">INT_VAR <code>match_savingthrow</code> to the saving throw type of effects to be matched (default -1).
</li><li class="li-itemize">INT_VAR <code>match_savebonus</code> to the saving throw bonus of effects to be matched (default -11). Since saving throws can range into negative values, this variable can match all the way down to -10.
</li><li class="li-itemize">INT_VAR <code>match_special</code> to the special field of effects to be matched (default -1). The special field is used by some EE effects.
</li><li class="li-itemize">STR_VAR <code>match_resource</code> to the resource of effects to be matched (default "SAME").
</li></ul><p>Once a matching effect is found, a new effect is created (STR_VAR
<code>insert</code> determines its placement) with all of the same
specifications as the matched effect. The next series of variables
allows the function to change the fields to new values in the
newly-created effect. All integer variables have the default value -1,
except savebonus which defaults to -11. If the value of a variable is
less than or equal to the default value, the new effect inherits the
corresponding value of the matched effect.</p><ul class="itemize"><li class="li-itemize">
INT_VAR <code>opcode</code> to the value the of the new effect’s opcode.
</li><li class="li-itemize">INT_VAR <code>target</code> to the new effect’s target.
</li><li class="li-itemize">INT_VAR <code>power</code> to the new effect’s power.
</li><li class="li-itemize">INT_VAR <code>parameter1</code> to the new effect’s parameter1.
</li><li class="li-itemize">INT_VAR <code>parameter2</code> to the new effect’s parameter2.
</li><li class="li-itemize">INT_VAR <code>timing</code> to the new effect’s timing mode.
</li><li class="li-itemize">INT_VAR <code>resist_dispel</code> to the new effect’s resist/dispel setting.
</li><li class="li-itemize">INT_VAR <code>duration</code> to the new effect’s duration.
</li><li class="li-itemize">INT_VAR <code>probability1</code> to the new effect’s probability1 (the upper bound).
</li><li class="li-itemize">INT_VAR <code>probability2</code> to the new effect’s probability2 (the lower bound).
</li><li class="li-itemize">INT_VAR <code>dicenumber</code> to the new effect’s number of dice. This field is instead used for maximum hit-dice (HD) by some opcodes.
</li><li class="li-itemize">INT_VAR <code>dicesize</code> to the new effect’s size of dice. This field is also instead for minimum hit-dice (HD) by some opcodes.
</li><li class="li-itemize">INT_VAR <code>savingthrow</code> to the new effect’s saving-throw type.
</li><li class="li-itemize">INT_VAR <code>savebonus</code> to the new effect’s saving-throw bonus/penalty. This variable can take negative values down to -10 while still writing to the corresponding field.
</li><li class="li-itemize">INT_VAR <code>special</code> to the new effect’s special field. The special field is used by many EE effects.
</li><li class="li-itemize">STR_VAR <code>resource</code> to the new effect’s resource reference.
</li></ul><p>
<br>

<code>DELETE_EFFECT</code>: This is a patch function for creature, item, or spell files that will match an existing effect and then delete it. Numerous variables are available for matching the specified effect.</p><p>The first batch of variables are meta-variables which will help determine the scope of the function:</p><ul class="itemize"><li class="li-itemize">
INT_VAR <code>check_globals</code> to whether the function should loop through global effects on items (also known as equipping effects) and spells (default is 1). Creature effects are all global effects, so this variable will always be considered to be one when this function is run on a creature.
</li><li class="li-itemize">INT_VAR <code>check_headers</code> to whether the function should loop through effects on extended headers on items and spells (default is 1). Creatures have no extended headers, so this variable is ignored when used on creatures.
</li><li class="li-itemize">INT_VAR <code>header</code> to whether the function should target effects on one specific header, counting the first header as zero. A negative value will match all headers (default is -1). Creatures have no extended headers, so this variable is ignored when used on creatures.
</li><li class="li-itemize">INT_VAR <code>header_type</code> to whether the function should only delete effects on extended headers of the specified type (1 - melee, 2 - ranged, etc.). Negative values will look at effects on all headers (default is -1). Creatures have no extended headers, so this variable is ignored when used on creatures.
</li><li class="li-itemize">INT_VAR <code>multi_match</code> to the number of effects to delete in the active stack. If you just want to match the first effect and have the function stop, use 1. Otherwise the function will continue matching until the number of deleted effects matches this value. The function will always make at least one change (e.g. 0 or negative values are treated as 1). (default is 999).
</li><li class="li-itemize">INT_VAR <code>verbose</code> to whether the function should provide some rudimentary information on how many effects were deleted (default is 0).
</li></ul><p>The next batch of variables sets the function boundaries on matching an effect to delete. Any variables not specified will not be used to determine a match. The function will only determine an effect is a match only if ALL of the variables specified are matched.</p><ul class="itemize"><li class="li-itemize">
INT_VAR <code>match_opcode</code> to the opcode of effects to be matched (default -1).
</li><li class="li-itemize">INT_VAR <code>match_target</code> to the target of effects to be matched (default -1).
</li><li class="li-itemize">INT_VAR <code>match_power</code> to the power of effects to be matched (default -1).
</li><li class="li-itemize">INT_VAR <code>match_parameter1</code> to parameter1 of effects to be matched (default -1).
</li><li class="li-itemize">INT_VAR <code>match_parameter2</code> to parameter2 of effects to be matched (default -1).
</li><li class="li-itemize">INT_VAR <code>match_timing</code> to the timing of effects to be matched (default -1).
</li><li class="li-itemize">INT_VAR <code>match_resist_dispel</code> to the resist/dispel setting of effects to be matched (default -1).
</li><li class="li-itemize">INT_VAR <code>match_duration</code> to the duration of effects to be matched (default -1).
</li><li class="li-itemize">INT_VAR <code>match_probability1</code> to probability1 (the upper bound) of effects to be matched (default -1).
</li><li class="li-itemize">INT_VAR <code>match_probability2</code> to probability2 (the lower bound) of effects to be matched (default -1).
</li><li class="li-itemize">INT_VAR <code>match_dicenumber</code> to the number of dice of effects to be matched (default -1). This field is instead used for maximum hit-dice (HD) by some opcodes.
</li><li class="li-itemize">INT_VAR <code>match_dicesize</code> to the size of dice of effects to be matched (default -1). This field is used instead for minimum hit-dice (HD) by some opcodes.
</li><li class="li-itemize">INT_VAR <code>match_savingthrow</code> to the saving throw type of effects to be matched (default -1).
</li><li class="li-itemize">INT_VAR <code>match_savebonus</code> to the saving throw bonus effects to be matched (default -11). Since saving throws can range into negative values, this variable can match all the way down to -10.
</li><li class="li-itemize">INT_VAR <code>match_special</code> to the special field of effects to be matched (default -1). The special field is used by some EE effects.
</li><li class="li-itemize">STR_VAR <code>match_resource</code> to the resource of effects to be matched (default "SAME").
</li></ul><p>Once a matching effect is found it is deleted. The function will continue to delete effects from the stack until the number of effects deleted matches the <code>multi_match</code> variable.<br>
<br>

<code>ALTER_EFFECT</code>: This is a patch function for creature, item, or spell files that will match an existing effect and alter it based on the defined variables. Numerous variables are available for matching the specified effect and for specifying new values.</p><p>The first batch of variables are meta-variables which will help determine the scope of the function:</p><ul class="itemize"><li class="li-itemize">
INT_VAR <code>check_globals</code> to whether the function should loop through global effects on items (also known as equipping effects) and spells (default is 1). Creature effects are all global effects, so this variable will always be considered to be one when this function is run on a creature.
</li><li class="li-itemize">INT_VAR <code>check_headers</code> to whether the function should loop through effects on extended headers on items and spells (default is 1). Creatures have no extended headers, so this variable is ignored when used on creatures.
</li><li class="li-itemize">INT_VAR <code>header</code> to whether the function should target effects on one specific header, counting the first header as zero. A negative value will match all headers (default is -1). Creatures have no extended headers, so this variable is ignored when used on creatures.
</li><li class="li-itemize">INT_VAR <code>header_type</code> to whether the function should only alter effects on extended headers of the specified type (1 - melee, 2 - ranged, etc.). Negative values will look at effects on all headers (default is -1). Creatures have no extended headers, so this variable is ignored when used on creatures.
</li><li class="li-itemize">INT_VAR <code>multi_match</code> to the number of effects to alter in the active stack. If you just want to match the first effect and have the function stop, use 1. Otherwise the function will continue matching until the number of altered effects matches this value. The function will always make at least one change (e.g. 0 or negative values are treated as 1). (default is 999).
</li><li class="li-itemize">INT_VAR <code>verbose</code> to whether the function should provide some rudimentary information on how many effects were added (default is 0).
</li><li class="li-itemize">INT_VAR <code>silent</code> to whether the function should suppress warnings when no effects were altered. This option also suppresses the <span class="c003">verbose</span> option (default is 0).
</li></ul><p>The next batch of variables sets the function boundaries on matching an effect to alter. Any variables not specified will not be used to determine a match. The function will only determine an effect is a match only if ALL of the variables specified are matched.</p><ul class="itemize"><li class="li-itemize">
INT_VAR <code>match_opcode</code> to the opcode of effects to be matched (default is -1).
</li><li class="li-itemize">INT_VAR <code>match_target</code> to the target of effects to be matched (default is -1).
</li><li class="li-itemize">INT_VAR <code>match_power</code> to the power of effects to be matched (default is -1).
</li><li class="li-itemize">INT_VAR <code>match_parameter1</code> to parameter1 of effects to be matched (default is -1).
</li><li class="li-itemize">INT_VAR <code>match_parameter2</code> to parameter2 of effects to be matched (default is -1).
</li><li class="li-itemize">INT_VAR <code>match_timing</code> to the timing of effects to be matched (default is -1).
</li><li class="li-itemize">INT_VAR <code>match_resist_dispel</code> to the resist/dispel setting of effects to be matched (default is -1).
</li><li class="li-itemize">INT_VAR <code>match_duration</code> to the duration of effects to be matched (default is -1).
</li><li class="li-itemize">INT_VAR <code>match_probability1</code> to probability1 (the upper bound) of effects to be matched (default is -1).
</li><li class="li-itemize">INT_VAR <code>match_probability2</code> to probability2 (the lower bound) of effects to be matched (default is -1).
</li><li class="li-itemize">INT_VAR <code>match_dicenumber</code> to the number of dice of effects to be matched (default is -1). This field is instead used for maximum hit-dice (HD) by some opcodes.
</li><li class="li-itemize">INT_VAR <code>match_dicesize</code> to the size of dice of effects to be matched (default is -1). This field is used instead for minimum hit-dice (HD) by some opcodes.
</li><li class="li-itemize">INT_VAR <code>match_savingthrow</code> to the saving throw type of effects to be matched (default is -1).
</li><li class="li-itemize">INT_VAR <code>match_savebonus</code> to the saving trow bonus effects to be matched (default is -11). Since saving throws can range into negative values, this variable can match all the way down to -10.
</li><li class="li-itemize">INT_VAR <code>match_special</code> to the special field of effects to be matched (default is -1). The special field is used by some EE effects.
</li><li class="li-itemize">STR_VAR <code>match_resource</code> to the resource of effects to be matched (default is "SAME").
</li></ul><p>Once a matching effect is found, the next series of variables allows
the function to change the fields to these new values in the matched
effect. All integer variables have the default value -1, except
savebonus which defaults to -11. The function does not change the
fields if the value of the corresponding value is less than or equal
to the default value.</p><ul class="itemize"><li class="li-itemize">
INT_VAR <code>opcode</code> to the value the of the altered effect’s opcode.
</li><li class="li-itemize">INT_VAR <code>target</code> to the altered effect’s target.
</li><li class="li-itemize">INT_VAR <code>power</code> to the altered effect’s power.
</li><li class="li-itemize">INT_VAR <code>parameter1</code> to the altered effect’s parameter1.
</li><li class="li-itemize">INT_VAR <code>parameter2</code> to the altered effect’s parameter2.
</li><li class="li-itemize">INT_VAR <code>timing</code> to the altered effect’s timing mode.
</li><li class="li-itemize">INT_VAR <code>resist_dispel</code> to the altered effect’s resist/dispel setting.
</li><li class="li-itemize">INT_VAR <code>duration</code> to the altered effect’s duration.
</li><li class="li-itemize">INT_VAR <code>probability1</code> to the altered effect’s probability1 (the upper bound).
</li><li class="li-itemize">INT_VAR <code>probability2</code> to the altered effect’s probability2 (the lower bound).
</li><li class="li-itemize">INT_VAR <code>dicenumber</code> to the altered effect’s number of dice. This field is instead used for maximum hit-dice (HD) by some opcodes.
</li><li class="li-itemize">INT_VAR <code>dicesize</code> to the altered effect’s size of dice. This field is also instead for minimum hit-dice (HD) by some opcodes.
</li><li class="li-itemize">INT_VAR <code>savingthrow</code> to the altered effect’s saving-throw type.
</li><li class="li-itemize">INT_VAR <code>savebonus</code> to the altered effect’s saving-throw bonus/penalty. This variable can take negative values down to -10 while still writing to the corresponding field.
</li><li class="li-itemize">INT_VAR <code>special</code> to the new effect’s special field. The special field is used by many EE effects.
</li><li class="li-itemize">STR_VAR <code>resource</code> to the altered effect’s resource reference.
</li></ul><p>
<br>

<code>SUBSTRING</code>: returns a substring of the provided string. This is an ACTION and PATCH function. All integer variables default to 0.</p><p>The function will fail with an error if either <code>start</code> or <code>length</code> are negative or if any of <code>start</code>, <code>length</code> or the sum of the two is greater than the length of <code>string</code>.
</p><ul class="itemize"><li class="li-itemize">
INT_VAR <code>start</code> to the string index (0 based) from which the start of the substring should be read.
</li><li class="li-itemize">INT_VAR <code>length</code> to the length of the substring to be read.
</li><li class="li-itemize">STR_VAR <code>string</code> to the string the substring should be read from.
</li><li class="li-itemize">RET <code>substring</code> the substring read from the provided string.
</li></ul><p>
<br>

<code>ADD_CRE_SCRIPT</code>: assigns a script to a creature in the first available slot. This is a PATCH function. By default, the function will try all 5 script slots from <code>SCRIPT_OVERRIDE</code> to <code>SCRIPT_DEFAULT</code>.</p><p>The function will fail with an error if the file being patched does not have a signature (first 3 bytes) that case-sensitively equals <span class="c003">CRE</span>, if either <code>offset_start</code> or <code>offset_end</code> are negative, if <code>offset_end</code> is less than <code>offset_start</code> or if <code>offset_end</code> is greater than the size of the file being patched.
</p><ul class="itemize"><li class="li-itemize">
INT_VAR <code>offset_start</code> to the offset from which the search for an empty slot should start. (default <code>SCRIPT_OVERRIDE</code>)
</li><li class="li-itemize">INT_VAR <code>offset_end</code> to the offset at which the search should end. (default <code>SCRIPT_DEFAULT</code>)
</li><li class="li-itemize">STR_VAR <code>script</code> to the resource reference of the script to be assigned.
</li><li class="li-itemize">RET <code>success</code> a return value indicating whether the script was successfully assigned. 1 signifies success and 0 signifies that no empty slot was found. A harmless warning will be printed if the function was unsuccessful.
</li></ul><p>
<br>

<span class="c005"><code>HANDLE_AUDIO</code></span><a id="HANDLE_AUDIO"></a><a id="hevea_default592"></a>: install Ogg--Vorbis compressed audio files in a safe and easy manner. This is an ACTION function.</p><p>This function supports Windows, OS&nbsp;X, GNU/Linux and all IE games, including BG:EE. If the game is not BG:EE, the audio will be decompressed and the resulting .wav files will be <a href="#MOVE"><span class="c003">MOVE</span></a>d to the override. If the game is BG:EE, the .ogg files are copied into the override and renamed into .wav files. Refer to the <a href="#sec-handle-audio-and-handle-tilesets"><span class="c003">HANDLE_AUDIO and HANDLE_TILESETS tutorial</span></a> for usage examples and a more practical explanation.</p><p>If the audio files need to be decompressed, this function will use oggdec.exe on Windows, which is by default expected to be found in <code>audio_path</code>. The most recent version of oggdec can be downloaded <a href="http://downloads.xiph.org/releases/vorbis/vorbis-tools-win32-bin.7z">here</a> (direct link). On OS&nbsp;X, SoX will be used, which is by default also expected to be found in <code>audio_path</code>. SoX compiled for OS&nbsp;X can be downloaded <a href="http://sourceforge.net/projects/sox/files/sox/14.4.1/sox-14.4.1-macosx.zip/download">here</a>. On GNU/Linux, oggdec will be used, but it is expected to be found on the system path and the user should install it him/herself. If you provide installation instructions for GNU/Linux, just include something to the effect of “install oggdec, which is usually part of the package vorbis-tools”.</p><p>If the decompression utility cannot be found, the user is warned that the audio files were not installed.</p><ul class="itemize"><li class="li-itemize">
INT_VAR <code>music</code> if this variable is not 0 and the game is BG:EE, the audio files are given the extension .acm instead of .wav. This variable has no effect if the game is not BG:EE. By default its value is 0.
</li><li class="li-itemize">STR_VAR <code>audio_path</code> to the path your .ogg files are stored in. By default this variable is <code>~%MOD_FOLDER%/audio~</code>.
</li><li class="li-itemize">STR_VAR <code>oggdec_path</code> to the path oggdec is located in. By default this variable is <code>~%audio_path%~</code>.
</li><li class="li-itemize">STR_VAR <code>sox_path</code> to the path SoX is located in. By default this variable is <code>~%audio_path%~</code>.
</li><li class="li-itemize">STR_VAR <code>output_path</code> to the path the audio should be installed into. By default this variable is <span class="c003">override</span>.
</li></ul><p>
<br>

<span class="c005"><code>HANDLE_TILESETS</code></span><a id="HANDLE_TILESETS"></a><a id="hevea_default593"></a>: install TISpack-compressed tilesets in a safe and easy manner. This is an ACTION function.</p><p>This function supports Windows, OS&nbsp;X, GNU/Linux and all IE games that support the <a href="http://gibberlings3.net/iesdp/file_formats/ie_formats/tis_v1.htm"><span class="c003">TIS V1</span></a> file format. The program tisunpack, part of <a href="http://www.pocketplane.net/mambo/index.php?option=com_content&task=blogcategory&id=137&Itemid=96">TISpack</a>, is used to decompress the provided .tiz files and the resulting .tis files are placed in the override. Refer to the <a href="#sec-handle-audio-and-handle-tilesets"><span class="c003">HANDLE_AUDIO and HANDLE_TILESETS tutorial</span></a> for usage examples and a more practical explanation.</p><p>This function expects to find tisunpack for one or more of Windows, OS&nbsp;X or GNU/Linux in a common directory under the subdirectories <span class="c003">win32</span>, <span class="c003">osx</span>, and <span class="c003">unix</span>, respectively. For example, in <span class="c003">mymod/tiz/win32</span>, <span class="c003">mymod/tiz/osx</span> and <span class="c003">mymod/tiz/unix</span>, the common directory is <span class="c003">mymod/tiz</span> and <span class="c003">mymod/tiz/win32/tisunpack.exe</span> should be a valid file. For GNU/Linux, this function also supports tisunpack being located on the system path (something the user would take care of). If you choose to leave tisunpack to the user, you should mention this requirement in any installation instructions you provide.</p><p>If tisunpack for the user’s platform could not be found, the installation fails.</p><ul class="itemize"><li class="li-itemize">
STR_VAR <code>tiz_path</code> to the path your .tiz files are stored in. By default this variable is <code>~%MOD_FOLDER%/tiz~</code>.
</li><li class="li-itemize">STR_VAR <code>tisunpack_path</code> to the common directory where the subdirectories <span class="c003">win32</span>, <span class="c003">osx</span> and <span class="c003">unix</span> are located. By default this variable is <code>~%tiz_path%~</code>.
</li><li class="li-itemize">STR_VAR <code>output_path</code> to the path the tilesets should be installed into. By default this variable is <span class="c003">override</span>.
</li></ul><p>
<br>

<span class="c005"><code>HANDLE_CHARSETS</code></span><a id="HANDLE_CHARSETS"></a><a id="hevea_default594"></a>: runtime-convert <span class="c003">TRA</span> files to/from <span class="c003">UTF-8</span> in a safe and easy manner. This is an ACTION function.</p><p>This function supports Windows, OS&nbsp;X and GNU/Linux. This function can run in two modes: let’s call them forward and reverse. The forward mode is used for converting <span class="c003">TRA</span> files from legacy “ANSI” character sets into UTF-8 for use by EE-type games. The reverse mode converts UTF-8 into the legacy “ANSI” character sets used by the original game editions. The variable <code>from_utf8</code> controls whether the function runs in forward or reverse. <code>HANDLE_CHARSETS</code> needs to be used before any text is installed and is compatible with <a href="#AUTO_TRA"><span class="c003">AUTO_TRA</span></a> and all other methods of loading <span class="c003">TRA</span> files, unless the option <code>out_path</code> is used.</p><p>Conversion is handled by the program <span class="c003">iconv</span>. The program is available as part of the base system on OS&nbsp;X and GNU/Linux but a Windows version needs to be included in your mod. A Windows version can be downloaded <a href="http://gnuwin32.sourceforge.net/packages/libiconv.htm">here</a>.</p><p>In order to function, <code>HANDLE_CHARSETS</code> needs to know a few things. First, you need to specify where you keep your <span class="c003">TRA</span> files. You do this with the variable <code>tra_path</code>. Second, <code>HANDLE_CHARSETS</code> needs to know where the Windows version of <span class="c003">iconv</span> is located. You do this with the variable <code>iconv_path</code>. Third, <code>HANDLE_CHARSETS</code> needs to know which character set the <span class="c003">TRA</span> files are in and which character set they should be converted into. For this, the function needs to know whether to run in forward or reverse mode; you specify this with the variable <code>from_utf8</code>. If the variable is 0 (default), files are converted from a language-dependent character set into UTF-8 and cannot already be in UTF-8. If the variable is 1, files are converted from UTF-8 into a language-dependent character set. Which language-dependent character set should be used in the conversion process is specified with <code>charset_table</code> or, or you can tell <code>HANDLE_CHARSETS</code> to try to infer this by itself with <code>infer_charsets</code>. Lastly, <code>HANDLE_CHARSETS</code> needs to know which <span class="c003">TRA</span> files to convert and whether any of them should be reloaded. You can do this with <code>noconvert_array</code>, <code>convert_array</code> and <code>reload_array</code>.</p><p>Unless <code>convert_array</code> is specified, <code>HANDLE_CHARSETS</code> will recursively convert all <span class="c003">TRA</span> files in <code>tra_path</code> except those listed in <code>noconvert_array</code>. If <code>convert_array</code> is specified, only those <span class="c003">TRA</span> files listed in the array will be converted. <code>convert_array</code> may contain references to <span class="c003">TRA</span> files in subdirectories of <code>tra_path</code>.</p><ul class="itemize"><li class="li-itemize">
INT_VAR <code>infer_charsets</code> to whether <code>HANDLE_CHARSETS</code> should try to infer which language-dependent character set is used by the language in which the mod is being installed. It uses the contents of the <span class="c003">%language%</span> variable (<span class="c006">vide infra</span>). If the contents of the variable can be recognised, <code>HANDLE_CHARSETS</code> will use the character set used by the localised version of BG2 for this language. If the contents of the variable cannot be recognised, or if the <span class="c003">TRA</span> files use a different character set than the expected one, <code>HANDLE_CHARSETS</code> will fail. Refer to the compatibility matrix below for additional information. <code>infer_charsets</code> overrides <code>charset_table</code>. Defaults to 0.
</li><li class="li-itemize">INT_VAR <code>from_utf8</code> to whether the function should assume the source <span class="c003">TRA</span> files are in UTF-8 or not. The default value is 0, that is, the function assumes the <span class="c003">TRA</span> files use language-dependent charater sets and should be converted into UTF-8 when the mod is installed on EE-type games; the function produces no results on the original editions of the games. If set to 1, the source <span class="c003">TRA</span> files are assumed to be in UTF-8 and are to be converted into language-dependent character sets when the mod is installed on original editions of the games; the function produces no results when installed on EE-type games.
</li><li class="li-itemize">INT_VAR <code>verbose</code> to whether the function should print debug information. Defaults to 0.
</li><li class="li-itemize">STR_VAR <code>language</code> to the name of the language directory you wish to convert. The default value of this variable is <code>\%LANGUAGE\%</code>, in other words, the directory corresponding to the language the user selected at the start of the installation. You should never need to alter the value of this variable.
</li><li class="li-itemize">STR_VAR <code>default_language</code> to the name of the directory used by the default language of your mod, if your mod has one. The default language is typically one for which the translation is always complete and up to date and which you use to guard against incomplete translations. <code>HANDLE_CHARSETS</code> will convert the <span class="c003">TRA</span> files of the default language in addition to those of the user-selected language. Should these two languages be the same, the <span class="c003">TRA</span> files will only be converted once. Additionally, any <span class="c003">TRA</span> files listed in the <code>reload_array</code> (<span class="c006">vide infra</span>) will be reloaded for the default language before they are reloaded for the user-selected language. The default value of this variable is <code>~~</code> (the empty string).
</li><li class="li-itemize">STR_VAR <code>tra_path</code> to the path where your mod’s language directories are located. <code>%tra_path%/%language%</code> should be a valid directory containing <span class="c003">TRA</span> files.
</li><li class="li-itemize">STR_VAR <code>out_path</code> to the path to which the converted files should be directed. The default value of this variable is <code>%tra_path%</code>, that is, the converted files reversibly overwrite the originals and the conversion is transparent to the rest of your mod. Note that if <code>%tra_path</code> and <code>out_path</code> are the same directory, the conversion will naturally happen only once regardless of how many times <code>HANDLE_CHARSETS</code> are invoked, but if the directories are different, the conversion will happen for every invocation (notably, if <code>HANDLE_CHARSETS</code> is invoked among the <a href="#ALWAYS"><span class="c003">ALWAYS</span></a> actions).
</li><li class="li-itemize">STR_VAR <code>iconv_path</code> to the path where iconv.exe is located. Defaults to <code>%tra_path%/iconv</code>.
</li><li class="li-itemize">STR_VAR <code>charset_table</code> to the name of an associative array where the keys are the names of your language directories and the corresponding values are the character sets used by the respective language. The keys must be entirely in lowercase. <code>charset_table</code> is not used if you also specify <code>infer_charsets</code>.
</li><li class="li-itemize">STR_VAR <code>noconvert_array</code> to the name of an array indexed by monotonically increasing integers starting from 0. The values should be the names of <span class="c003">TRA</span> files that should not be converted into <span class="c003">UTF-8</span>. All <span class="c003">TRA</span> files in the language directory and its subdirectories except the ones listed in <code>noconvert_array</code> will be converted. The .tra file extension is optional. This variable should not be provided if you also provide <code>convert_array</code>.
</li><li class="li-itemize">STR_VAR <code>convert_array</code> to the name of an array indexed by monotonically increasing integers starting from 0. The values should be the names of <span class="c003">TRA</span> files that should be converted into <span class="c003">UTF-8</span>. Only those <span class="c003">TRA</span> files in the language directory or its subdirectories which are listed in <code>convert_array</code> will be converted. The .tra file extension is optional. If this variable is provided, <code>noconvert_array</code> will not be used.
</li><li class="li-itemize">STR_VAR <code>reload_array</code> to the name of an array indexed by monotonically increasing integers starting from 0. The values should be the names of <span class="c003">TRA</span> files which should be reloaded after they have been converted. The .tra file extension is optional. You should use this variable for reloading those <span class="c003">TRA</span> files loaded by <a href="#LANGUAGE"><span class="c003">LANGUAGE</span></a> which should also be converted.
</li><li class="li-itemize">STR_VAR <code>file_regexp</code> to a regexp expression with the file names that must be converted. Defaults to <code>.+$\backslash$.tra$</code>.
</li></ul><p>Compatibility matrix for <code>infer_charsets</code>.
</p><table class="c001 cellpading0"><tr><td class="hbar" colspan=3></td></tr>
<tr><td class="c010">Language</td><td class="c009"><code>%LANGUAGE%</code> contains</td><td class="c011">Inferred character set </td></tr>
<tr><td class="hbar" colspan=3></td></tr>
<tr><td class="c010">Simplified Chinese</td><td class="c009">schinese, zh_CN</td><td class="c011">CP936 </td></tr>
<tr><td class="c010">Traditional Chinese</td><td class="c009">tchinese</td><td class="c011">CP950 </td></tr>
<tr><td class="c010">Czech</td><td class="c009">czech, cs_CZ</td><td class="c011">CP1250 </td></tr>
<tr><td class="c010">English</td><td class="c009">english, american, en_US</td><td class="c011">CP1252 </td></tr>
<tr><td class="c010">French</td><td class="c009">french, francais, fr_FR</td><td class="c011">CP1252 </td></tr>
<tr><td class="c010">German</td><td class="c009">german, deutsch, de_DE</td><td class="c011">CP1252 </td></tr>
<tr><td class="c010">Italian</td><td class="c009">italian, italiano, it_IT</td><td class="c011">CP1252 </td></tr>
<tr><td class="c010">Japanese</td><td class="c009">japanese, ja_JP</td><td class="c011">CP932 </td></tr>
<tr><td class="c010">Korean</td><td class="c009">korean, ko_KR</td><td class="c011">CP949 </td></tr>
<tr><td class="c010">Polish</td><td class="c009">polish, polski, pl_PL</td><td class="c011">CP1250 </td></tr>
<tr><td class="c010">Russian</td><td class="c009">russian, ru_RU</td><td class="c011">CP1251 </td></tr>
<tr><td class="c010">Spanish</td><td class="c009">spanish, castilian, espanol, castellano, es_ES</td><td class="c011">CP1252 </td></tr>
<tr><td class="hbar" colspan=3></td></tr>
</table><p>
<br>

<span class="c005"><code>DELETE_WORLDMAP_LINKS</code></span><a id="DELETE_WORLDMAP_LINKS"></a><a id="hevea_default595"></a>: delete all links from one worldmap area to another. This is a PATCH function.</p><p>This function will delete links from one specified area to another. Links can be deleted from all four directional nodes (north, east, south, west) or from a specific node. Links connecting the areas in the opposite direction will not be deleted.</p><ul class="itemize"><li class="li-itemize">
STR_VAR <code>from_area</code> to the area from which the links that are to be deleted originate.
</li><li class="li-itemize">STR_VAR <code>from_node</code> to the directional node from which the links that are to be deleted originate. Legal values for this variable are “north”, “n”, “east”, “e”, “south”, “s”, “west”, “w”. Values are not case sensitive. Links are deleted from all four nodes by default.
</li><li class="li-itemize">STR_VAR <code>to_area</code> to the area to which the links that are to be deleted lead.
</li></ul><p>
<br>

<span class="c005"><code>ADD_WORLDMAP_LINKS</code></span><a id="ADD_WORLDMAP_LINKS"></a><a id="hevea_default596"></a>: add links from one worldmap area to another. This is a PATCH function.</p><p>This function add links from one specified area to another. Links can be added from all four directional nodes (north, east, south, west) or from a specific node. If a link already exists, its metadata (distance scale, random encounters, etc.) will be overwritten. Links connecting the areas in the opposite direction will not be added. If either of the areas do not exist in the worldmap, a warning is printed and no links are added.</p><ul class="itemize"><li class="li-itemize">
INT_VAR <code>distance_scale</code> to the distance scale between the two areas. <code>distance_scale</code> * 4 equals the travel time between the areas (in hours).
</li><li class="li-itemize">INT_VAR <code>default_entry</code> to the default entry location. Legal values for this variable are 1 (northern side), 2 (eastern), 4 (southern) and 8 (western). The default value is 1.
</li><li class="li-itemize">INT_VAR <code>encounter_probability</code> to the probability of a random encounter occurring.
</li><li class="li-itemize">STR_VAR <code>from_area</code> to the area from which the links should originate.
</li><li class="li-itemize">STR_VAR <code>from_node</code> to the directional node from which the links should originate. Legal values for this variable are “north”, “n”, “east”, “e”, “south”, “s”, “west” and “w”. Values are not case sensitive. Links are added to all four nodes by default.
</li><li class="li-itemize">STR_VAR <code>to_area</code> to the area to which the links should lead.
</li><li class="li-itemize">STR_VAR <code>entry</code> to the entry point in <code>to_area</code>.
</li><li class="li-itemize">STR_VAR <code>random_area1</code> to the first random-encounter area.
</li><li class="li-itemize">STR_VAR <code>random_area2</code> to the second random-encounter area.
</li><li class="li-itemize">STR_VAR <code>random_area3</code> to the third random-encounter area.
</li><li class="li-itemize">STR_VAR <code>random_area4</code> to the fourth random-encounter area.
</li><li class="li-itemize">STR_VAR <code>random_area5</code> to the fifth random-encounter area.
</li></ul><p>
<br>

<span class="c005"><code>UPDATE_PVRZ_INDICES</code></span><a id="UPDATE_PVRZ_INDICES"></a><a id="hevea_default597"></a>: update the <span class="c003">PVRZ</span> references in a <span class="c003">BAM V2</span> or <span class="c003">MOS V2</span> resource. This is a PATCH function.</p><p>This function will update the <span class="c003">PVRZ</span> references in a <span class="c003">BAM V2</span> or <span class="c003">MOS V2</span> resource with the next contiguous block of free <span class="c003">PVRZ</span> indices. This function is intended to be used in combination with the action function <a href="#INSTALL_PVRZ"><span class="c003">INSTALL_PVRZ</span></a>.</p><ul class="itemize"><li class="li-itemize">
INT_VAR <code>target_base_index</code> is an optional parameter. When specified, the function attempts to use a block of free <span class="c003">PVRZ</span> indices starting at the specified value. The default value is 1000.
</li><li class="li-itemize">RET <code>original_base_index</code> returns the lowest <span class="c003">PVRZ</span> index used by the source <span class="c003">BAM</span> or <span class="c003">MOS</span>. Returns -1 on error.
</li><li class="li-itemize">RET <code>new_base_index</code> returns the lowest <span class="c003">PVRZ</span> index used by the target <span class="c003">BAM</span> or <span class="c003">MOS</span>. Returns -1 on error.
</li><li class="li-itemize">RET <code>index_range</code> returns the range of reserved <span class="c003">PVRZ</span> indices, i.e., the difference between the smallest and biggest <span class="c003">PVRZ</span> index, inclusive. Returns 0 on error.
</li></ul><p>
<br>

<span class="c005"><code>INSTALL_PVRZ</code></span><a id="INSTALL_PVRZ"></a><a id="hevea_default598"></a>: install a <span class="c003">PVRZ</span> file and updates the <span class="c003">PVRZ</span> index. This is an ACTION function.</p><p>This function copies the specified <span class="c003">PVRZ</span> file into the target folder and updates the <span class="c003">PVRZ</span> index. This function should be used in conjunction with <a href="#UPDATE_PVRZ_INDICES"><span class="c003">UPDATE_PVRZ_INDICES</span></a>.</p><ul class="itemize"><li class="li-itemize">
INT_VAR <code>original_base_index</code> to the current base index. This value is returned by the function <a href="#UPDATE_PVRZ_INDICES"><span class="c003">UPDATE_PVRZ_INDICES</span></a> as <code>original_base_index</code>.
</li><li class="li-itemize">INT_VAR <code>new_base_index</code> to the new base index. This value is returned by the function <a href="#UPDATE_PVRZ_INDICES"><span class="c003">UPDATE_PVRZ_INDICES</span></a> as <code>new_base_index</code>.
</li><li class="li-itemize">STR_VAR <code>source_file</code> to the source file to copy. The filename must match the regular expression <span class="c003">~MOS[0-9]+\.PVRZ~</span> (e.g., MOS0000.PVRZ, mos1592.pvrz or Mos12345.PVRZ). Case is ignored.
</li><li class="li-itemize">STR_VAR <code>target_folder</code> to the target folder to copy the source file into. The default value is "override".
</li><li class="li-itemize">RET <code>success</code> is set to non-zero if the function returned successfully and is set to zero on error.
</li><li class="li-itemize">This function can additionally return all the variables automatically set by <a href="#COPY"><span class="c003">COPY</span></a>.
</li></ul><p>
<br>

<span class="c005"><code>FIND_FREE_PVRZ_INDEX</code></span><a id="FIND_FREE_PVRZ_INDEX"></a><a id="hevea_default599"></a>: attempt to find a contiguous block of free <span class="c003">PVRZ</span> indices in the game installation. This is a PATCH and an ACTION function.</p><p>This function attempts to find the first available free <span class="c003">PVRZ</span> index of a contiguous block which guarantees to fit at least <code>num_to_reserve</code> indices.</p><ul class="itemize"><li class="li-itemize">
INT_VAR <code>num_to_reserve</code> to the minimum required size of the contiguous block of free indices. This number should be no smaller than 1 nor no bigger than 999. The default value is 1.
</li><li class="li-itemize">INT_VAR <code>start_index</code> to the index the search should begin at. The default value is 1000.
</li><li class="li-itemize">RET <code>free_index</code> returns the first available index matching the specified parameters. Returns -1 on errors.
</li></ul><p>
<br>

<span class="c005"><code>DIRECTORY_OF_FILESPEC</code></span><a id="DIRECTORY_OF_FILESPEC"></a><a id="hevea_default600"></a>: returns the directory of a file specification. Compare to <a href="#SOURCE_DIRECTORY"><span class="c003">SOURCE_DIRECTORY</span></a>. This is an ACTION and PATCH function.</p><ul class="itemize"><li class="li-itemize">
STR_VAR <code>filespec</code> to the file specification, which must include an identifiable directory, or a warning will be raised.
</li><li class="li-itemize">RET <code>directory</code> returns the directory of the file specification.
</li></ul><p><span class="c005"><code>FILE_OF_FILESPEC</code></span><a id="FILE_OF_FILESPEC"></a><a id="hevea_default601"></a>: returns the file of a file specification. Compare to <a href="#SOURCE_FILE"><span class="c003">SOURCE_FILE</span></a>. This is an ACTION and PATCH function.</p><ul class="itemize"><li class="li-itemize">
STR_VAR <code>filespec</code> to the file specification, which may or may not include a directory.
</li><li class="li-itemize">RET <code>file</code> returns the file of the file specification.
</li></ul><p><span class="c005"><code>RES_OF_FILESPEC</code></span><a id="RES_OF_FILESPEC"></a><a id="hevea_default602"></a>: returns the resource name of a file specification. Compare to <a href="#SOURCE_RES"><span class="c003">SOURCE_RES</span></a>. This is an ACTION and PATCH function.</p><ul class="itemize"><li class="li-itemize">
STR_VAR <code>filespec</code> to the file specification, which must include an identifiable resource name, or a warning will be raised.
</li><li class="li-itemize">RET <code>res</code> returns the resource name of the file specification.
</li></ul><p><span class="c005"><code>EXT_OF_FILESPEC</code></span><a id="EXT_OF_FILESPEC"></a><a id="hevea_default603"></a>: returns the resource extension of a file specification. Compare to <a href="#SOURCE_EXT"><span class="c003">SOURCE_EXT</span></a>. This is an ACTION and PATCH function.</p><ul class="itemize"><li class="li-itemize">
STR_VAR <code>filespec</code> to the file specification, which must include an identifiable resource extension, or a warning will be raised.
</li><li class="li-itemize">RET <code>ext</code> returns the resource extension of the file specification.
</li></ul><p>
<br>

</p>
<!--TOC subsection id="sec52" Store-related functions-->
<h3 class="subsection" id="sec52">12.1  Store-related functions</h3><!--SEC END --><p><span class="c005"><code>ADD_STORE_ITEM_EX</code></span><a id="ADD_STORE_ITEM_EX"></a><a id="hevea_default604"></a>: adds an item to the current STO file. This is a PATCH function.</p><ul class="itemize"><li class="li-itemize">
INT_VAR <code>charge1</code> to the number of charges of the 1st ability or quantity for stackables. (Default: 0)
</li><li class="li-itemize">INT_VAR <code>charge2</code> to the number of charges of the 2nd ability. (Default: 0)
</li><li class="li-itemize">INT_VAR <code>charge3</code> to the number of charges of the 3rd ability. (Default: 0)
</li><li class="li-itemize">INT_VAR <code>stack</code> to the number of item instances the store carries in the stack. (Default: 1)
</li><li class="li-itemize">INT_VAR <code>unlimited</code> to non-zero if the store should carry an inexhaustible stack of the new item. (Default: 0)
</li><li class="li-itemize">INT_VAR <code>overwrite</code> to non-zero to overwrite any instances of an existing sale entry of matching item resref when found. (Default: 0)
</li><li class="li-itemize">INT_VAR <code>expiration</code> to the item’s expiration time, when it will be replaced with the drained item. (Default: 0)
</li><li class="li-itemize">STR_VAR <code>item_name</code> to the resource name (resref) of the item to add.
</li><li class="li-itemize">STR_VAR <code>position</code> to the desired position of the item in the list of sale entries. The following syntax is supported:
<pre class="verbatim">AFTER resref    Will place the new item directly behind the item given by "resref".
                You can list more than one resref, separated by space. The new item will be
                added after the entry of the first matching resref.
BEFORE resref   Will place the new item directly before the item given by "resref".
                You can list more than one resref, separated by space. The new item will be
                added before the entry of the first matching resref.
LAST            Will place the new item after all existing items.
FIRST           Will place the new item before all existing items.
AT value        Will place the new item at the position given by the number "value".
                Use negative values to place the new item relative to the last item position
                in reverse order.
</pre>
(Default: FIRST)
</li><li class="li-itemize">STR_VAR <code>flags</code> to numeric values or the following constants: <code>none</code>, <code>identified</code>, <code>unstealable</code>, <code>stolen</code>. Constants can be combined by using ampersand (&amp;) or space as separators (e.g. <code>identified&amp;unstealable</code>). (Default: <code>none</code>)
</li><li class="li-itemize">STR_VAR <code>sale_trigger</code> Availability trigger (STO V1.1 only). The following syntax is supported:
<pre class="verbatim">Trigger string          Example: GlobalGT("MyCondition","GLOBAL",0)
Strref value            Example: #1234
Translation reference   Example: @1000
</pre>
(Default: #-1)
</li><li class="li-itemize">RET <code>index</code> returns the index of the added item or the last matching index when overwriting items. Returns -1 if the item could not be added or updated.
</li><li class="li-itemize">RET <code>offset</code> returns the offset of the added item or the last matching offset when overwriting items. Returns -1 if the item could not be added or updated.
</li></ul><p><span class="c005"><code>ADD_STORE_DRINK</code></span><a id="ADD_STORE_DRINK"></a><a id="hevea_default605"></a>: adds a drink to the current STO file. This is a PATCH function.</p><ul class="itemize"><li class="li-itemize">
INT_VAR <code>price</code> to the price of the drink.
</li><li class="li-itemize">INT_VAR <code>rate</code> to the rate (%) of displaying a rumor.
</li><li class="li-itemize">INT_VAR <code>overwrite</code> to non-zero to overwrite any instances of an existing drink of matching <code>drink_name</code> when found. (Default: 0)
</li><li class="li-itemize">STR_VAR <code>drink_name</code> to the name of the drink.
The following syntax is supported:
<pre class="verbatim">Literal string          Example: Elminster's Choice Beer
Strref value            Example: #1234
Translation reference   Example: @1000
</pre>
</li><li class="li-itemize">STR_VAR <code>position</code> to the desired position in the list of drinks. Refer to the table below for supported expressions. The following syntax is supported:
<pre class="verbatim">AFTER name      Will place the new drink directly behind the drink given by "name". Name can
                either be a strref value (e.g. #1234) or a translation reference (e.g. @1000).
                You can list more than one name, separated by space. The new drink will be
                added after the entry of the first matching name.
BEFORE name     Will place the new drink directly before the drink given by "name". Name can
                either be a strref value (e.g. #1234) or a translation reference (e.g. @1000).
                You can list more than one name, separated by space. The new drink will be
                added before the entry of the first matching name.
LAST            Will place the new drink after all existing drinks.
FIRST           Will place the new drink before all existing drinks.
AT value        Will place the new drink at the position given by the number "value".
                Use negative values to place the new drink relative to the last drink position
                in reverse order.
</pre>
(Default: FIRST)
</li><li class="li-itemize">RET <code>index</code> returns the index of the added drink or the last matching index when overwriting drinks. Returns -1 if the drink could not be added or updated.
</li><li class="li-itemize">RET <code>offset</code> returns the offset of the added drink or the last matching offset when overwriting drinks. Returns -1 if the drink could not be added or updated.
</li></ul><p><span class="c005"><code>ADD_STORE_CURE</code></span><a id="ADD_STORE_CURE"></a><a id="hevea_default606"></a>: adds a cure to the current STO file. This is a PATCH function.</p><ul class="itemize"><li class="li-itemize">
INT_VAR <code>price</code> to the spell price.
</li><li class="li-itemize">INT_VAR <code>overwrite</code> to non-zero to overwrite any instances of an existing cure entry of matching spell resref when found. (Default: 0)
</li><li class="li-itemize">STR_VAR <code>spell_name</code> to the resource name (resref) of the spell to add.
</li><li class="li-itemize">STR_VAR <code>position</code> to the desired position in the list of cures. Refer to the table below for supported expressions. The following syntax is supported:
<pre class="verbatim">AFTER resref    Will place the new spell directly behind the spell given by "resref".
                You can list more than one resref, separated by space. The new spell will be
                added after the entry of the first matching resref.
BEFORE resref   Will place the new spell directly before the spell given by "resref".
                You can list more than one resref, separated by space. The new spell will be
                added before the entry of the first matching resref.
LAST            Will place the new spell after all existing cures.
FIRST           Will place the new spell before all existing cures.
AT value        Will place the new spell at the position given by the number "value".
                Use negative values to place the new spell relative to the last spell position
                in reverse order.
</pre>
(Default: FIRST)
</li><li class="li-itemize">RET <code>index</code> returns the index of the added cure or the last matching index when overwriting cure entries. Returns -1 if the spell could not be added or updated.
</li><li class="li-itemize">RET <code>offset</code> returns the offset of the added cure or the last matching offset when overwriting cures. Returns -1 if the spell could not be added or updated.
</li></ul><p><span class="c005"><code>ADD_STORE_PURCHASE</code></span><a id="ADD_STORE_PURCHASE"></a><a id="hevea_default607"></a>: adds one or more item categories the store will buy to the current STO file. Existing categories will be skipped.
</p><ul class="itemize"><li class="li-itemize">
INT_VAR <code>category</code> to the item category to add. A nearly complete list of supported item category codes can be found <a href="https://gibberlings3.github.io/iesdp/file_formats/ie_formats/sto_v1.htm#tableItemType">here</a>.
</li><li class="li-itemize">RET <code>index</code> returns the index of the added purchase. Returns -1 if the purchase could not be added.
</li><li class="li-itemize">RET <code>offset</code> returns the offset of the added purchase. Returns -1 if the purchase could not be added.
</li></ul><p><span class="c005"><code>REMOVE_STORE_ITEM_EX</code></span><a id="REMOVE_STORE_ITEM_EX"></a><a id="hevea_default608"></a>: removes all sale instances matching the specified item name from the current STO file. This is a patch function.
</p><ul class="itemize"><li class="li-itemize">
STR_VAR <code>item_name</code> to the resource name (resref) of the item to remove. Regular expression syntax is supported.
</li><li class="li-itemize">RET <code>index</code> returns the index of the first removed entry matching the item name, returns -1 otherwise.
</li><li class="li-itemize">RET <code>offset</code> returns the offset of the first removed entry matching the item name, returns -1 otherwise.
</li></ul><p><span class="c005"><code>REMOVE_STORE_DRINK</code></span><a id="REMOVE_STORE_DRINK"></a><a id="hevea_default609"></a>: removes all drink instances matching the specified drink name from the current STO file. This is a patch function.
</p><ul class="itemize"><li class="li-itemize">
STR_VAR <code>drink_name</code> to the name of the drink to remove. The following syntax is supported:
<pre class="verbatim">Literal string          Example: Elminster's Choice Beer
Strref value            Example: #1234
Translation reference   Example: @1000
</pre>
Note: Regular expression syntax is supported for literal strings.
</li><li class="li-itemize">RET <code>index</code> returns the index of the first removed entry matching the drink name, returns -1 otherwise.
</li><li class="li-itemize">RET <code>offset</code> returns the offset of the first removed entry matching the drink name, returns -1 otherwise.
</li></ul><p><span class="c005"><code>REMOVE_STORE_CURE</code></span><a id="REMOVE_STORE_CURE"></a><a id="hevea_default610"></a>: removes all cure instances matching the specified spell name from the current STO file. This is a patch function.
</p><ul class="itemize"><li class="li-itemize">
STR_VAR <code>spell_name</code> to the resource name (resref) of the spell to remove. Regular expression syntax is supported.
</li><li class="li-itemize">RET <code>index</code> returns the index of the first removed entry matching the spell name, returns -1 otherwise.
</li><li class="li-itemize">RET <code>offset</code> returns the offset of the first removed entry matching the spell name, returns -1 otherwise.
</li></ul><p><span class="c005"><code>REMOVE_STORE_PURCHASE</code></span><a id="REMOVE_STORE_PURCHASE"></a><a id="hevea_default611"></a>: removes the specified item category from the current STO file. This is a patch function.
</p><ul class="itemize"><li class="li-itemize">
INT_VAR <code>category</code> to the item category to remove. A nearly complete list of supported item category codes can be found <a href="https://gibberlings3.github.io/iesdp/file_formats/ie_formats/sto_v1.htm#tableItemType">here</a>.
</li><li class="li-itemize">RET <code>index</code> returns the index of the first removed entry matching the category, returns -1 otherwise.
</li><li class="li-itemize">RET <code>offset</code> returns the offset of the first removed entry matching the category, returns -1 otherwise.
</li></ul>
<!--TOC subsection id="fj_are_structure" <span class="c003"><span class="c007">fj_are_structure</span></span>-->
<h3 class="subsection" id="fj_are_structure">12.2  <span class="c005">fj_are_structure</span><a id="hevea_default612"></a></h3><!--SEC END --><p>
Adds a structure to an area file. All variables are zero or blank by default unless otherwise indicated. Fields designated by an asterisk are typically required; all others are optional.
This is a PATCH function.</p><p>Universal structure variables:
</p><ul class="itemize"><li class="li-itemize">
STR_VAR <code>fj_structure_type</code> to the type of area structure to be added (actor, region, spawn, entrance, container, itm, ambient, variable, door, animation, bitmask, songs, interrupts, note or projectile)*;
</li><li class="li-itemize">INT_VAR <code>fj_delete_mode</code> to the index of the structure to be deleted (if deleting rather than adding a new structure);
</li><li class="li-itemize">INT_VAR <code>fj_debug</code> to 1 to enable feedback
</li><li class="li-itemize">RET <code>fj_return_offset</code> returns the position of the structure in the area file;
</li></ul><p>
Actor structure variables:
</p><ul class="itemize"><li class="li-itemize">
STR_VAR <code>fj_name</code> to the actor’s name*;
</li><li class="li-itemize">INT_VAR <code>fj_loc_x</code> to the starting X (horizontal) coordinate*;
</li><li class="li-itemize">INT_VAR <code>fj_loc_y</code> to the starting Y (vertical) coordinate*;
</li><li class="li-itemize">INT_VAR <code>fj_dest_x</code> to the destination X coordinate (by default the same as <code>fj_loc_x</code>);
</li><li class="li-itemize">INT_VAR <code>fj_dest_y</code> to the destination Y coordinate (by default the same as <code>fj_loc_y</code>);
</li><li class="li-itemize">INT_VAR <code>fj_loading</code> to whether the .cre file is loaded (0=attached, 1=loaded, default 1);
</li><li class="li-itemize">INT_VAR <code>fj_spawned</code> to whether the creature has been spawned (0=no, 1=yes, default 0);
</li><li class="li-itemize">INT_VAR <code>fj_animation</code> to the actor’s animation number (from animate.ids, though the engine uses the animation set on the .cre file);
</li><li class="li-itemize">INT_VAR <code>fj_orientation</code> to the facing direction (0-15 where 0=south, 4=west, 8=north, 12=east, default 0);
</li><li class="li-itemize">INT_VAR <code>fj_expiry</code> to the actor removal timer in absolute ticks (default -1 to avoid removal);
</li><li class="li-itemize">INT_VAR <code>fj_wander_dist_actor</code> to the actor’s random walk distance limit;
</li><li class="li-itemize">INT_VAR <code>fj_mvmt_dist_actor</code> to the actor’s movement distance limit;
</li><li class="li-itemize">INT_VAR <code>fj_schedule</code> to the hourly appearance schedule (bits 0-23, default -1 or always);
</li><li class="li-itemize">INT_VAR <code>fj_num_talked</code> to the NumTimesTalkedTo (in .sav files);
</li><li class="li-itemize">STR_VAR <code>fj_dlg_resref</code> to the actor’s dialogue file (normally obtained from .cre files);
</li><li class="li-itemize">STR_VAR <code>fj_bcs_override</code> to the actor’s override script (normally obtained from .cre files);
</li><li class="li-itemize">STR_VAR <code>fj_bcs_general</code> to the actor’s general script (normally obtained from .cre files);
</li><li class="li-itemize">STR_VAR <code>fj_bcs_class</code> to the actor’s class script (normally obtained from .cre files);
</li><li class="li-itemize">STR_VAR <code>fj_bcs_race</code> to the actor’s race script (normally obtained from .cre files);
</li><li class="li-itemize">STR_VAR <code>fj_bcs_default</code> to the actor’s default script (normally obtained from .cre files);
</li><li class="li-itemize">STR_VAR <code>fj_bcs_specific</code> to the actor’s specific script (normally obtained from .cre files);
</li><li class="li-itemize">STR_VAR <code>fj_cre_resref</code> to the actor’s resource reference (creature filename)*;
</li><li class="li-itemize">STR_VAR <code>fj_cre_embedded</code> to  path/to/file.cre  if embedding a new creature (defaults to <code>fj_cre_resref</code> if not set);
</li></ul><p>
Region structure variables:
</p><ul class="itemize"><li class="li-itemize">
STR_VAR <code>fj_name</code> to the region’s name*;
</li><li class="li-itemize">INT_VAR <code>fj_type</code> to the region type (0=trap, 1=info, 2=travel)*;
</li><li class="li-itemize">INT_VAR <code>fj_box_left</code> to the leftmost X coordinate of the region’s bounding box*;
</li><li class="li-itemize">INT_VAR <code>fj_box_top</code> to the topmost Y coordinate of the region’s bounding box*;
</li><li class="li-itemize">INT_VAR <code>fj_box_right</code> to the rightmost X coordinate of the region’s bounding box*;
</li><li class="li-itemize">INT_VAR <code>fj_box_bottom</code> to the bottommost Y coordinate of the region’s bounding box*;
</li><li class="li-itemize">INT_VAR <code>fj_cursor_idx</code> to the region’s mouse cursor index (from cursors.bam)*;
</li><li class="li-itemize">STR_VAR <code>fj_destination_area</code> to the destination area resource reference (for travel regions);
</li><li class="li-itemize">STR_VAR <code>fj_destination_name</code> to the entrance name in the destination area (for travel regions);
</li><li class="li-itemize">INT_VAR <code>fj_flags</code> to the bitwise region flags;
</li><li class="li-itemize">INT_VAR <code>fj_info_point_strref</code> to the information text string reference (for info points, default -1);
</li><li class="li-itemize">INT_VAR <code>fj_trap_detect</code> to the trap detection difficulty percentage;
</li><li class="li-itemize">INT_VAR <code>fj_trap_remove</code> to the trap removal difficulty percentage;
</li><li class="li-itemize">INT_VAR <code>fj_trap_active</code> to whether the region is trapped (0=no, 1=yes);
</li><li class="li-itemize">INT_VAR <code>fj_trap_status</code> to whether the trap is detected (0=no, 1=yes);
</li><li class="li-itemize">INT_VAR <code>fj_loc_x</code> to the trap launch X coordinate*;
</li><li class="li-itemize">INT_VAR <code>fj_loc_y</code> to the trap launch Y coordinate*;
</li><li class="li-itemize">STR_VAR <code>fj_key_resref</code> to the filename of the region’s key;
</li><li class="li-itemize">STR_VAR <code>fj_reg_script</code> to the region script;
</li><li class="li-itemize">INT_VAR <code>fj_alt_x</code> to the activation point X coordinate;
</li><li class="li-itemize">INT_VAR <code>fj_alt_y</code> to the activation point Y coordinate;
</li><li class="li-itemize">STR_VAR <code>fj_sound</code> to the sound resource reference (ONLY for PST);
</li><li class="li-itemize">INT_VAR <code>fj_talk_loc_x</code> to the talk location point X coordinate (ONLY for PST);
</li><li class="li-itemize">INT_VAR <code>fj_talk_loc_y</code> to the talk location point Y coordinate (ONLY for PST);
</li><li class="li-itemize">INT_VAR <code>fj_speaker_strref</code> to the speaker’s name string reference (default -1; ONLY for PST);
</li><li class="li-itemize">STR_VAR <code>fj_dialog</code> to the region’s dialogue file (ONLY for PST);
</li><li class="li-itemize">INT_VAR <code>fj_vertex_0</code> to (X coordinate + (Y coordinate &lt;&lt; 16)) for each vertex pair*;
</li></ul><p>
Spawn structure variables:
</p><ul class="itemize"><li class="li-itemize">
STR_VAR <code>fj_name</code> to the spawn point’s name*;
</li><li class="li-itemize">INT_VAR <code>fj_loc_x</code> to the spawning X coordinate*;
</li><li class="li-itemize">INT_VAR <code>fj_loc_y</code> to the spawning Y coordinate*;
</li><li class="li-itemize">STR_VAR <code>fj_cre_resref0</code> to the resource reference of each creature spawned (0-9)*;
</li><li class="li-itemize">INT_VAR <code>fj_spawn_num</code> to the count of spawn creatures*;
</li><li class="li-itemize">INT_VAR <code>fj_difficulty</code> to the base number of creatures to spawn (encounter difficulty)*;
</li><li class="li-itemize">INT_VAR <code>fj_delay</code> to the number of seconds between spawning (default 10);
</li><li class="li-itemize">INT_VAR <code>fj_method</code> to the spawn method;
</li><li class="li-itemize">INT_VAR <code>fj_duration</code> to the creature duration (default 1000);
</li><li class="li-itemize">INT_VAR <code>fj_wander_dist_spawn</code> to the creature’s random walk distance limit (default 1000);
</li><li class="li-itemize">INT_VAR <code>fj_mvmt_dist_spawn</code> to the creature’s movement distance limit (default 1000);
</li><li class="li-itemize">INT_VAR <code>fj_max_num</code> to the maximum number of creatures to spawn*;
</li><li class="li-itemize">INT_VAR <code>fj_enable</code> to the spawn point status (0=inactive, 1=active, default 1);
</li><li class="li-itemize">INT_VAR <code>fj_schedule</code> to the hourly appearance schedule (bits 0-23, default -1 or always);
</li><li class="li-itemize">INT_VAR <code>fj_day_prob</code> to the spawn point daytime probability (default 100);
</li><li class="li-itemize">INT_VAR <code>fj_night_prob</code> to the spawn point nighttime probability (default 100);
</li><li class="li-itemize">INT_VAR <code>fj_spawn_freq</code> to the spawn frequency in seconds (Enhanced Editions only);
</li><li class="li-itemize">INT_VAR <code>fj_countdown</code> to the spawn countdown (Enhanced Editions only);
</li><li class="li-itemize">INT_VAR <code>fj_weight0...fj_weight9</code> to the weight of the spawn creatures (Enhanced Editions only);
</li></ul><p>
Entrance structure variables:
</p><ul class="itemize"><li class="li-itemize">
STR_VAR <code>fj_name</code> to the entrance’s name*;
</li><li class="li-itemize">INT_VAR <code>fj_loc_x</code> to the X coordinate*;
</li><li class="li-itemize">INT_VAR <code>fj_loc_y</code> to the Y coordinate*;
</li><li class="li-itemize">INT_VAR <code>fj_orientation</code> to the facing direction (0-15 where 0=south, 4=west, 8=north, 12=east)*;
</li></ul><p>
Container structure variables:
</p><ul class="itemize"><li class="li-itemize">
STR_VAR <code>fj_name</code> to the container’s name*;
</li><li class="li-itemize">INT_VAR <code>fj_loc_x</code> to the X coordinate*;
</li><li class="li-itemize">INT_VAR <code>fj_loc_y</code> to the Y coordinate*;
</li><li class="li-itemize">INT_VAR <code>fj_type</code> to the container type (1=bag, 2=chest, 3=drawer, 4=pile, 5=table, 6=shelf, 7=altar, 8=nonvisible, 9=spellbook, 10=body, 11=barrel, 12=crate)*;
</li><li class="li-itemize">INT_VAR <code>fj_lock_diff</code> to the lock difficulty (default 100);
</li><li class="li-itemize">INT_VAR <code>fj_flags</code> to the bitwise container flags (bit0=locked, bit3=trap resets, bit5=disabled);
</li><li class="li-itemize">INT_VAR <code>fj_trap_detect</code> to the trap detection difficulty percentage;
</li><li class="li-itemize">INT_VAR <code>fj_trap_remove_diff</code> to the trap removal difficulty percentage (default 100);
</li><li class="li-itemize">INT_VAR <code>fj_trap_active</code> to whether the container is trapped (0=no, 1=yes);
</li><li class="li-itemize">INT_VAR <code>fj_trap_status</code> to whether the trap is detected (0=no, 1=yes);
</li><li class="li-itemize">INT_VAR <code>fj_trap_loc_x</code> to the trap launch X coordinate*;
</li><li class="li-itemize">INT_VAR <code>fj_trap_loc_y</code> to the trap launch Y coordinate*;
</li><li class="li-itemize">INT_VAR <code>fj_box_left</code> to the leftmost X coordinate of the trap’s bounding box;
</li><li class="li-itemize">INT_VAR <code>fj_box_top</code> to the topmost Y coordinate of the trap’s bounding box;
</li><li class="li-itemize">INT_VAR <code>fj_box_right</code> to the rightmost X coordinate of the trap’s bounding box;
</li><li class="li-itemize">INT_VAR <code>fj_box_bottom</code> to the bottommost Y coordinate of the trap’s bounding box;
</li><li class="li-itemize">STR_VAR <code>fj_trap_script</code> to the trap’s script;
</li><li class="li-itemize">INT_VAR <code>fj_vertex_0</code> to (X coordinate + (Y coordinate &lt;&lt; 16)) for each vertex pair*;
</li><li class="li-itemize">STR_VAR <code>fj_key_resref</code> to the filename of the container’s key;
</li><li class="li-itemize">INT_VAR <code>fj_lockpick_strref</code> to the lockpick string reference (default -1);
</li></ul><p>
Item structure variables:
</p><ul class="itemize"><li class="li-itemize">
STR_VAR <code>fj_name</code> to the item’s resource reference (filename)*;
</li><li class="li-itemize">INT_VAR <code>fj_con_itm_idx</code> to the index of the container to which the item is added*;
</li><li class="li-itemize">INT_VAR <code>fj_itm_expiry</code> to the item expiration time (default 0);
</li><li class="li-itemize">INT_VAR <code>fj_charge0</code> to the charges of the 1st ability (item quantity for stackables, default 0);
</li><li class="li-itemize">INT_VAR <code>fj_charge1</code> to the charges of the 2nd ability (default 0);
</li><li class="li-itemize">INT_VAR <code>fj_charge2</code> to the charges of the 3rd ability (default 0);
</li><li class="li-itemize">INT_VAR <code>fj_flags</code> to the bitwise item flags (bit0=identified, bit1=unstealable, bit2=stolen, bit3=undroppable, default 0);
</li></ul><p>
Ambient structure variables:
</p><ul class="itemize"><li class="li-itemize">
STR_VAR <code>fj_name</code> to the ambient’s name*;
</li><li class="li-itemize">INT_VAR <code>fj_loc_x</code> to the X coordinate*;
</li><li class="li-itemize">INT_VAR <code>fj_loc_y</code> to the Y coordinate*;
</li><li class="li-itemize">INT_VAR <code>fj_radius</code> to the sound radius (default 500);
</li><li class="li-itemize">INT_VAR <code>fj_loc_z</code> to the Z coordinate (height);
</li><li class="li-itemize">INT_VAR <code>fj_pitch_variance</code> to the pitch variance;
</li><li class="li-itemize">INT_VAR <code>fj_volume_variance</code> to the volume variance;
</li><li class="li-itemize">INT_VAR <code>fj_volume</code> to the volume percentage (default 80);
</li><li class="li-itemize">STR_VAR <code>fj_wav_resref0</code> to the resource reference of each sound (0-9)*;
</li><li class="li-itemize">INT_VAR <code>fj_sound_num</code> to the number of sounds*;
</li><li class="li-itemize">INT_VAR <code>fj_delay</code> to the base interval in seconds between sounds from this ambient list;
</li><li class="li-itemize">INT_VAR <code>fj_variation</code> to the base deviation from the base interval;
</li><li class="li-itemize">INT_VAR <code>fj_schedule</code> to the hourly appearance schedule (bits 0-23, default -1 or always);
</li><li class="li-itemize">INT_VAR <code>fj_flags</code> to the bitwise ambient flags*;
</li></ul><p>
Variable structure variables:
</p><ul class="itemize"><li class="li-itemize">
STR_VAR <code>fj_name</code> to the variable’s name*;
</li><li class="li-itemize">INT_VAR <code>fj_variable_value</code> to the variable’s value*;
</li></ul><p>
Door structure variables:
</p><ul class="itemize"><li class="li-itemize">
STR_VAR <code>fj_name</code> to the door’s name*;
</li><li class="li-itemize">STR_VAR <code>fj_door_wed_id</code> to the door ID linked to the .wed file*;
</li><li class="li-itemize">INT_VAR <code>fj_flags</code> to the bitwise door flags*;
</li><li class="li-itemize">INT_VAR <code>fj_open_box_left</code> to the leftmost X coordinate of the open door’s bounding box*;
</li><li class="li-itemize">INT_VAR <code>fj_open_box_top</code> to the topmost Y coordinate of the open door’s bounding box*;
</li><li class="li-itemize">INT_VAR <code>fj_open_box_right</code> to the rightmost X coordinate of the open door’s bounding box*;
</li><li class="li-itemize">INT_VAR <code>fj_open_box_bottom</code> to the bottommost Y coordinate of the open door’s bounding box*;
</li><li class="li-itemize">INT_VAR <code>fj_closed_box_left</code> to the leftmost X coordinate of the closed door’s bounding box*;
</li><li class="li-itemize">INT_VAR <code>fj_closed_box_top</code> to the topmost Y coordinate of the closed door’s bounding box*;
</li><li class="li-itemize">INT_VAR <code>fj_closed_box_right</code> to the rightmost X coordinate of the closed door’s bounding box*;
</li><li class="li-itemize">INT_VAR <code>fj_closed_box_bottom</code> to the bottommost Y coordinate of the closed door’s bounding box*;
</li><li class="li-itemize">INT_VAR <code>fj_door_open_vert_0</code> to (X coordinate + (Y coordinate &lt;&lt; 16)) for each vertex pair of the open door*;
</li><li class="li-itemize">INT_VAR <code>fj_door_closed_vert_0</code> to (X coordinate + (Y coordinate &lt;&lt; 16)) for each vertex pair of the closed door*;
</li><li class="li-itemize">INT_VAR <code>fj_cell_open_vert_0</code> to (X coordinate + (Y coordinate &lt;&lt; 16)) for each impeded search map cell of the open door*;
</li><li class="li-itemize">INT_VAR <code>fj_cell_closed_vert_0</code> to (X coordinate + (Y coordinate &lt;&lt; 16)) for each impeded search map cell of the closed door*;
</li><li class="li-itemize">STR_VAR <code>fj_door_open_wav</code> to the door open sound;
</li><li class="li-itemize">STR_VAR <code>fj_door_close_wav</code> to the door closed sound;
</li><li class="li-itemize">INT_VAR <code>fj_cursor_idx</code> to the door’s mouse cursor index (from cursors.bam)*;
</li><li class="li-itemize">INT_VAR <code>fj_trap_detect</code> to the trap detection difficulty percentage;
</li><li class="li-itemize">INT_VAR <code>fj_trap_remove</code> to the trap removal difficulty percentage;
</li><li class="li-itemize">INT_VAR <code>fj_trap_active</code> to whether the door is trapped (0=no, 1=yes);
</li><li class="li-itemize">INT_VAR <code>fj_trap_status</code> to whether the trap is detected (0=no, 1=yes);
</li><li class="li-itemize">INT_VAR <code>fj_trap_loc_x</code> to the trap launch X coordinate*;
</li><li class="li-itemize">INT_VAR <code>fj_trap_loc_y</code> to the trap launch Y coordinate*;
</li><li class="li-itemize">STR_VAR <code>fj_key_resref</code> to the filename of the door’s key;
</li><li class="li-itemize">STR_VAR <code>fj_door_script</code> to the door script;
</li><li class="li-itemize">INT_VAR <code>fj_detect_diff</code> to the detection difficulty (for secret doors);
</li><li class="li-itemize">INT_VAR <code>fj_locked_diff</code> to the lock difficulty;
</li><li class="li-itemize">INT_VAR <code>fj_open_loc_x</code> to the X coordinate for toggling the door’s open state*;
</li><li class="li-itemize">INT_VAR <code>fj_open_loc_y</code> to the Y coordinate for toggling the door’s open state*;
</li><li class="li-itemize">INT_VAR <code>fj_closed_loc_x</code> to the X coordinate for toggling the door’s closed state*;
</li><li class="li-itemize">INT_VAR <code>fj_closed_loc_y</code> to the Y coordinate for toggling the door’s closed state*;
</li><li class="li-itemize">INT_VAR <code>fj_lockpick_strref</code> to the lockpick string reference (default -1);
</li><li class="li-itemize">STR_VAR <code>fj_travel_trigger</code> to the travel region name*;
</li><li class="li-itemize">INT_VAR <code>fj_dlg_strref</code> to the dialogue string reference (default -1);
</li><li class="li-itemize">STR_VAR <code>fj_dlg_resref</code> to the door’s dialogue file;
</li></ul><p>
Animation structure variables:
</p><ul class="itemize"><li class="li-itemize">
STR_VAR <code>fj_name</code> to the animation name*;
</li><li class="li-itemize">INT_VAR <code>fj_loc_x</code> to the X coordinate*;
</li><li class="li-itemize">INT_VAR <code>fj_loc_y</code> to the Y coordinate*;
</li><li class="li-itemize">INT_VAR <code>fj_schedule</code> to the hourly appearance schedule (bits 0-23, default -1 or always);
</li><li class="li-itemize">STR_VAR <code>fj_bam_resref</code> to the animation resource reference (filename)*;
</li><li class="li-itemize">INT_VAR <code>fj_bam_seq</code> to the BAM sequence number;
</li><li class="li-itemize">INT_VAR <code>fj_bam_frame</code> to the BAM frame number;
</li><li class="li-itemize">INT_VAR <code>fj_flags</code> to the bitwise animation flags*;
</li><li class="li-itemize">INT_VAR <code>fj_loc_z</code> to the height;
</li><li class="li-itemize">INT_VAR <code>fj_transparent</code> to the BAM transparency;
</li><li class="li-itemize">INT_VAR <code>fj_init_frame</code> to the starting frame;
</li><li class="li-itemize">INT_VAR <code>fj_loop_chance</code> to the chance of looping;
</li><li class="li-itemize">INT_VAR <code>fj_skip_cycles</code> to start delay in frames;
</li><li class="li-itemize">STR_VAR <code>fj_bmp_resref</code> to the palette bitmap;
</li><li class="li-itemize">INT_VAR <code>fj_width</code> to the animation width (only required for WBM and PVRZ resources, Enhanced Editions only);
</li><li class="li-itemize">INT_VAR <code>fj_height</code> to the animation height (only required for WBM and PVRZ resources, Enhanced Editions only);
</li></ul><p>
Bitmask structure variables:
</p><ul class="itemize"><li class="li-itemize">
STR_VAR <code>fj_bitmask</code> to  path/to/binary.file *;
</li></ul><p>
Songlist structure variables:
</p><ul class="itemize"><li class="li-itemize">
INT_VAR <code>fj_song_day</code> to the day SONGLIST.2DA entry;
</li><li class="li-itemize">INT_VAR <code>fj_song_night</code> to the night SONGLIST.2DA entry;
</li><li class="li-itemize">INT_VAR <code>fj_song_victory</code> to the victory SONGLIST.2DA entry;
</li><li class="li-itemize">INT_VAR <code>fj_song_battle</code> to the battle SONGLIST.2DA entry;
</li><li class="li-itemize">INT_VAR <code>fj_song_defeat</code> to the defeat SONGLIST.2DA entry;
</li><li class="li-itemize">INT_VAR <code>fj_song_day_alt</code> to the alternative day SONGLIST.2DA entry (default -1, Enhanced Editions only);
</li><li class="li-itemize">INT_VAR <code>fj_song_night_alt</code> to the alternative night SONGLIST.2DA entry (default -1, Enhanced Editions only);
</li><li class="li-itemize">INT_VAR <code>fj_song_victory_alt</code> to the alternative victory SONGLIST.2DA entry (default -1, Enhanced Editions only);
</li><li class="li-itemize">INT_VAR <code>fj_song_battle_alt</code> to the alternative battle SONGLIST.2DA entry (default -1, Enhanced Editions only);
</li><li class="li-itemize">INT_VAR <code>fj_song_defeat_alt</code> to the alternative defeat SONGLIST.2DA entry (default -1, Enhanced Editions only);
</li><li class="li-itemize">STR_VAR <code>fj_song_day0</code> to the day song WAV resref;
</li><li class="li-itemize">STR_VAR <code>fj_song_day1</code> to the night song WAV resref;
</li><li class="li-itemize">INT_VAR <code>fj_song_day_vol</code> to the day songs volume (default 100);
</li><li class="li-itemize">STR_VAR <code>fj_song_night0</code> to the night song WAV resref;
</li><li class="li-itemize">STR_VAR <code>fj_song_night1</code> to the second night song WAV resref;
</li><li class="li-itemize">INT_VAR <code>fj_song_night_vol</code> to the night songs volume (default 100);
</li></ul><p>
Rest interrupt structure variables
</p><ul class="itemize"><li class="li-itemize">
STR_VAR <code>fj_name</code> to the name of the rest interrupts (for editor use only);
</li><li class="li-itemize">INT_VAR <code>fj_cre_strref0...fj_cre_strref9</code> to string displayed upon party ambush (default -1);
</li><li class="li-itemize">STR_VAR <code>fj_cre_resref0...fj_cre_resref9</code> to creature resref;
</li><li class="li-itemize">STR_VAR <code>fj_spawn_num</code> to the number of spawned attackers;
</li><li class="li-itemize">STR_VAR <code>fj_difficulty</code> to the difficulty of the encounter;
</li><li class="li-itemize">STR_VAR <code>fj_duration</code> to the creature’s duration (default 1000);
</li><li class="li-itemize">STR_VAR <code>fj_wander_distance</code> to the creature’s random walk distance limit (default 1000);
</li><li class="li-itemize">STR_VAR <code>fj_mvmt_distance</code> to the creature’s movement distance limit (default 1000);
</li><li class="li-itemize">STR_VAR <code>fj_max_num</code> to maximum number of spawned creatures;
</li><li class="li-itemize">STR_VAR <code>fj_enable</code> to whether rest interrupts are enabled (0=no, 1=yes);
</li><li class="li-itemize">STR_VAR <code>fj_day_prob</code> to probability of daytime ambush;
</li><li class="li-itemize">STR_VAR <code>fj_night_prob</code> to probability of nightime ambush;
</li></ul><p>
Map note structure variables:
</p><ul class="itemize"><li class="li-itemize">
INT_VAR <code>fj_loc_x</code> to the X coordinate*;
</li><li class="li-itemize">INT_VAR <code>fj_loc_y</code> to the Y coordinate*;
</li><li class="li-itemize">INT_VAR <code>fj_note_strref</code> to the note string reference (default -1, BGII only)*;
</li><li class="li-itemize">STR_VAR <code>fj_note_text</code> to the note text (PST only)*;
</li><li class="li-itemize">INT_VAR <code>fj_strref_loc</code> to the strref location (0=external, 1=dialog.tlk, default 1);
</li><li class="li-itemize">INT_VAR <code>fj_color</code> to the map marker color (0-7);
</li><li class="li-itemize">INT_VAR <code>fj_note_id</code> to the note ID;
</li></ul><p>
Projectile trap structure variables (not available on PST):
</p><ul class="itemize"><li class="li-itemize">
STR_VAR <code>fj_name</code> to the projectile filename*;
</li><li class="li-itemize">INT_VAR <code>fj_eff_off</code> to the effect block offset;
</li><li class="li-itemize">INT_VAR <code>fj_eff_size</code> to the effect block size;
</li><li class="li-itemize">INT_VAR <code>fj_missile_num</code> to the missile.ids reference (projectl.ids - 1);
</li><li class="li-itemize">INT_VAR <code>fj_frequency</code> to the explosion length (in frames);
</li><li class="li-itemize">INT_VAR <code>fj_duration</code> to the number of explosions;
</li><li class="li-itemize">INT_VAR <code>fj_loc_x</code> to the X coordinate*;
</li><li class="li-itemize">INT_VAR <code>fj_loc_y</code> to the Y coordinate*;
</li><li class="li-itemize">INT_VAR <code>fj_loc_z</code> to the height;
</li><li class="li-itemize">INT_VAR <code>fj_target</code> to the ea.ids value of the target;
</li><li class="li-itemize">INT_VAR <code>fj_creator</code> to the index of the party member who created this projectile (0-5);
</li><li class="li-itemize">STR_VAR <code>fj_embedded_eff_0</code> to  path/to/v2.eff  or eff resref containing to projectile’s effects* Subsequent indices can be used for additional effects;
</li></ul><p>
A few examples best illustrate the use of this function.</p><p>Example 1: add an actor to an area
</p><pre class="verbatim">COPY_EXISTING ar0500.are override
  LPF fj_are_structure
    INT_VAR
    fj_loc_x          = 2780
    fj_loc_y          = 1955
    fj_dest_x         = 2780
    fj_dest_y         = 1955
    fj_animation      = 0x6110 //fighter female human
    fj_orientation    = 15     //SSE
    STR_VAR
    fj_structure_type = actor
    fj_name           = Aurora
    fj_cre_resref     = agaurora
  END
</pre><p>
Example 2: add a region to an area (in this case, a travel trigger to another area)
</p><pre class="verbatim">  LPF fj_are_structure
    INT_VAR
    fj_type         = 2    //travel
    fj_box_left     = 3415
    fj_box_top      = 625
    fj_box_right    = 3450
    fj_box_bottom   = 700
    fj_cursor_idx   = 30   //door
    fj_vertex_0     = 3415 + (625 &lt;&lt; 16)
    fj_vertex_1     = 3450 + (650 &lt;&lt; 16)
    fj_vertex_2     = 3450 + (700 &lt;&lt; 16)
    fj_vertex_3     = 3415 + (676 &lt;&lt; 16)
    STR_VAR
    fj_structure_type   = region
    fj_name             = Tran0540
    fj_destination_area = ag0540
    fj_destination_name = Exit0500
  END
</pre><p>
Example 3: add an entrance (from another area) to an area
</p><pre class="verbatim">  LPF fj_are_structure
    INT_VAR
    fj_loc_x       = 3490
    fj_loc_y       = 655
    fj_orientation = 10   //NE
    STR_VAR
    fj_structure_type = entrance
    fj_name           = Exit0540
  END
</pre><p>
Example 4: add a container to an area, then add an item to the new container
</p><pre class="verbatim">  LPF fj_are_structure
    INT_VAR
    fj_type        = 8 //nonvisible
    fj_loc_x       = 4388
    fj_loc_y       = 2876
    fj_box_left    = 4372
    fj_box_top     = 2826
    fj_box_right   = 4420
    fj_box_bottom  = 2858
    fj_trap_loc_x  = 4380
    fj_trap_loc_y  = 2870
    fj_vertex_0    = 4411 + (2858 &lt;&lt; 16)
    fj_vertex_1    = 4372 + (2845 &lt;&lt; 16)
    fj_vertex_2    = 4382 + (2826 &lt;&lt; 16)
    fj_vertex_3    = 4420 + (2839 &lt;&lt; 16)
    STR_VAR
    fj_structure_type = container
    fj_name           = ~Cornerstone~
  END
  LPF fj_are_structure
    INT_VAR
    fj_con_itm_idx    = SHORT_AT 0x74 - 1 // a new container will be last in the file
    fj_flags          = 1 // identified
    STR_VAR
    fj_name           = c6lantho
    fj_structure_type = itm
  END
</pre><p>
Example 5: add a door to an area
</p><pre class="verbatim">  LPF fj_are_structure
    INT_VAR
    fj_flags               = 0b100000000
    fj_open_box_left       = 520
    fj_open_box_top        = 724
    fj_open_box_right      = 545
    fj_open_box_bottom     = 830
    fj_closed_box_left     = 507
    fj_closed_box_top      = 761
    fj_closed_box_right    = 562
    fj_closed_box_bottom   = 869
    fj_cursor_idx          = 30
    fj_trap_loc_x          = 500
    fj_trap_loc_y          = 852
    fj_open_loc_x          = 517
    fj_open_loc_y          = 881
    fj_closed_loc_x        = 562
    fj_closed_loc_y        = 814
    fj_door_open_vert_0    = 520 + (826 &lt;&lt; 16)
    fj_door_open_vert_1    = 527 + (830 &lt;&lt; 16)
    fj_door_open_vert_2    = 545 + (798 &lt;&lt; 16)
    fj_door_open_vert_3    = 545 + (727 &lt;&lt; 16)
    fj_door_open_vert_4    = 539 + (724 &lt;&lt; 16)
    fj_door_open_vert_5    = 520 + (750 &lt;&lt; 16)
    fj_door_closed_vert_0  = 507 + (831 &lt;&lt; 16)
    fj_door_closed_vert_1  = 562 + (869 &lt;&lt; 16)
    fj_door_closed_vert_2  = 562 + (799 &lt;&lt; 16)
    fj_door_closed_vert_3  = 507 + (761 &lt;&lt; 16)
    fj_cell_open_vert_0    = 32 + (68 &lt;&lt; 16)
    fj_cell_open_vert_1    = 33 + (67 &lt;&lt; 16)
    fj_cell_open_vert_2    = 32 + (67 &lt;&lt; 16)
    fj_cell_closed_vert_0  = 32 + (70 &lt;&lt; 16)
    fj_cell_closed_vert_1  = 33 + (71 &lt;&lt; 16)
    fj_cell_closed_vert_2  = 34 + (72 &lt;&lt; 16)
    fj_cell_closed_vert_3  = 34 + (71 &lt;&lt; 16)
    fj_cell_closed_vert_4  = 33 + (70 &lt;&lt; 16)
    fj_cell_closed_vert_5  = 32 + (69 &lt;&lt; 16)
    fj_cell_closed_vert_6  = 32 + (68 &lt;&lt; 16)
    fj_cell_closed_vert_7  = 33 + (69 &lt;&lt; 16)
    fj_cell_closed_vert_8  = 34 + (70 &lt;&lt; 16)
    STR_VAR
    fj_structure_type      = door
    fj_name                = Door10
    fj_door_wed_id         = DOOR10
  END
</pre><p>
Example 6: add an animation to an area
</p><pre class="verbatim">  LPF fj_are_structure
    INT_VAR
    fj_loc_x       = 2785
    fj_loc_y       = 949
    fj_flags       = 0b00000000000000000001000110000101
    //visible, not illuminated, invisible in dark, covered by actors, shown in combat
    STR_VAR
    fj_structure_type = animation
    fj_name           = Cave1
    fj_bam_resref     = ag1100c1
  END
</pre><p>
Example 7: delete all ambients from an area
</p><pre class="verbatim">  FOR( i = SHORT_AT 0x82 ; i ; --i )BEGIN
    LPF fj_are_structure
      INT_VAR fj_delete_mode = i - 1
      STR_VAR fj_structure_type = ambient
    END
  END
</pre>
<!--TOC subsection id="sc#addWmpAre" <span class="c003"><span class="c007">sc#addWmpAre</span></span>-->
<h3 class="subsection" id="sc#addWmpAre">12.3  <span class="c005">sc#addWmpAre</span><a id="hevea_default613"></a></h3><!--SEC END --><p>
Adds an area to the worldmap. All variables are zero or blank by default unless otherwise indicated.
This is an ACTION function.</p><ul class="itemize"><li class="li-itemize">
ACTION_DEFINE_ASSOCIATIVE_ARRAY <code>toNewArea</code> to the area references that lead to the new area;
</li><li class="li-itemize">ACTION_DEFINE_ASSOCIATIVE_ARRAY <code>fromNewArea</code> to the area references that lead away from the new area;
</li><li class="li-itemize">STR_VAR <code>areName</code> to the resource reference of the area to add (like "ar0700");
</li><li class="li-itemize">STR_VAR <code>strName</code> to the descriptive name of the area (like "Waukeen’s Promenade");
</li><li class="li-itemize">STR_VAR <code>strDesc</code> to the area description that will show up when hovering the cursor over the area on the worldmap;
</li><li class="li-itemize">STR_VAR <code>worldmap</code> to the name of the .wmp file you want patched (default is "worldmap");
</li><li class="li-itemize">INT_VAR <code>mapIcon</code> to the area’s map icon index (from mapicons.bam);
</li><li class="li-itemize">INT_VAR <code>xCoord</code> to the area’s X (east-west) coordinate;
</li><li class="li-itemize">INT_VAR <code>yCoord</code> to the area’s Y (north-south) coordinate;
</li><li class="li-itemize">INT_VAR <code>tTime</code> to the area’s travel time in hours * 4 (so 2 = 8 hours);
</li><li class="li-itemize">INT_VAR <code>inclSv</code> to 1 if you want to patch saved game worldmaps as well as the master worldmap. <span class="c007">NB:</span> changes to saved games are uninstallable;
</li><li class="li-itemize">INT_VAR <code>visible</code> to 1 if you want the ’visible’ flag to be set;
</li><li class="li-itemize">INT_VAR <code>visibleAdjacent</code> to 1 if you want the ’visible from adjacent’ flag to be set;
</li><li class="li-itemize">INT_VAR <code>reachable</code> to 1 if you want the ’reachable’ flag to be set;
</li><li class="li-itemize">INT_VAR <code>visited</code> to 1 if you want the ’visited’ flag to be set;
</li><li class="li-itemize">RET <code>areNum</code> returns the worldmap entry number for the new area;
</li></ul><p>
An example best illustrates the use of this function.</p><pre class="verbatim">// add links from these area(s) to the new area
ACTION_DEFINE_ASSOCIATIVE_ARRAY toNewArea BEGIN
  "AR0020" =&gt; "Exitwmp"       // City Gates
  "AR0300" =&gt; "Exitwmp"       // Docks
  "AR0400" =&gt; "Exitwmp"       // Slums
  "AR0500" =&gt; "Exitwmp"       // Bridge District
  "AR0700" =&gt; "Exitwmp"       // Waukeen's Promenade
  "AR0800" =&gt; "Exitwmp"       // Graveyard
  "AR0900" =&gt; "Exitwmp"       // Temple District
  "AR1000" =&gt; "Exitwmp"       // Government
  "AR1100" =&gt; "Exitwmp"       // Umar Hills
  "AR1300" =&gt; "Exitwmp"       // d'Arnise Keep
  "AR1304" =&gt; "Exitwmp"       // d'Arnise Keep
  "AR2000" =&gt; "Exitwmp"       // Trademeet
  "AR1200" =&gt; "Exitwmp"       // Windspear Hills
END

// add links from the new area to these area(s)
ACTION_DEFINE_ASSOCIATIVE_ARRAY fromNewArea BEGIN
  "AR0020" =&gt; "ExitNE"      // City Gates
  "AR0300" =&gt; "ExitN"       // Docks
  "AR0400" =&gt; "ExitN"       // Slums
  "AR0500" =&gt; "ExitNE"      // Bridge District
  "AR0700" =&gt; "ExitE"       // Waukeen's Promenade
  "AR0800" =&gt; "ExitS"       // Graveyard
  "AR0900" =&gt; "ExitNW"      // Temple District
  "AR1000" =&gt; "ExitN"       // Government
  "AR1100" =&gt; "ExitSE"      // Umar Hills
  "AR1300" =&gt; "ExitSE"      // d'Arnise Keep
  "AR1304" =&gt; "ExitSE"      // d'Arnise Keep
  "AR2000" =&gt; "ExitSW"      // Trademeet
  "AR1200" =&gt; "ExitW"       // Windspear Hills
END

// calls the function and returns the worldmap entry number for the new area
LAUNCH_ACTION_FUNCTION sc#addWmpAre
    INT_VAR mapIcon = 21           // map icon
            xCoord  = 240          // x coordinate
            yCoord  = 130          // y coordinate
            tTime   = 0            // travel time *4, so two means eight hours

    STR_VAR areName = "YS0390"     // area reference, like "AR0700"
            strName = "Govt. West" // area name, like "Waukeen's Promenade"
            strDesc = "Govt. West" // area description which will show up when hovering the area on the worldmap

END
</pre><p><a id="sec-module-distribution"></a></p>
<!--TOC section id="Module Distribution" <span class="c003"><span class="c007">Module Distribution</span></span>: <span class="c003">Setup-MyMod.exe</span>-->
<h2 class="section" id="Module Distribution">13  <span class="c005">Module Distribution</span><a id="hevea_default614"></a>: <span class="c003">Setup-MyMod.exe</span></h2><!--SEC END --><p>If you rename <span class="c003">WeiDU.EXE</span> to something of the form <span class="c003">Setup-MyMod.exe</span>,
it will behave as if the following arguments were present:
</p><ul class="itemize"><li class="li-itemize">
<span class="c003">--log Setup-MyMod.DEBUG</span>
</li><li class="li-itemize"><span class="c003">Mymod/MyMod.tp2</span>
</li><li class="li-itemize"><span class="c003">Mymod/Setup-MyMod.tp2</span>
</li><li class="li-itemize"><span class="c003">MyMod.tp2</span>
</li><li class="li-itemize"><span class="c003">Setup-MyMod.tp2</span>
</li></ul>
<!--TOC subsection id="sec56" Module Distribution Conventions-->
<h3 class="subsection" id="sec56">13.1  Module Distribution Conventions</h3><!--SEC END --><p>To distribute your mod, rename <span class="c003">WeiDU.EXE</span> to <span class="c003">Setup-MyMod.EXE</span> (or
whatever), put <span class="c003">Setup-MyMod.TP2</span> file in the same directory and go!
Typically mods are distributed a ZIP files or self-extracting archives that
put the <span class="c003">EXE</span>, <a href="#TP2"><span class="c003">TP2</span></a> and module data files in the main BGII
directory.</p><p>If your mod adds new resources to the game (e.g., via <a href="#COPY"><span class="c003">COPY</span></a>) you
should be careful to pick a unique name so that you resource will not
conflict with one created by another mod. For example (and I speak from
personal experience here), naming a creature <span class="c003">BOO2.CRE</span> is just asking
for trouble. One common approach here is to pick a special prefix that uses
a character not found in normal game resources. For example, I might use
the prefix <span class="c003">W#</span> and call a sword <span class="c003">W#SWORD.ITM</span>
and a new spell <span class="c003">W#SPELL.SPL</span>. However, it it still possible to run into
conflicts, so I recommend that you check out the
Community Mod Filename Prefix Reservations project at
<a href="http://forums.blackwyrmlair.net/index.php?showtopic=113"><span class="c003">http://forums.blackwyrmlair.net/index.php?showtopic=113</span></a> and
register your own unique prefix.</p>
<!--TOC subsection id="sec57" WeiDU Return Values-->
<h3 class="subsection" id="sec57">13.2  WeiDU Return Values</h3><!--SEC END --><p>The <span class="c003">WeiDU.exe</span> (or <span class="c003">Setup-MyMod.exe</span>) process will terminate with
a “return value” (or “exit code” or “status code” or “error level”)
based on the success or failure of certain operations. Depending on your
operating system you can use this value to guide shell scripts or batch
files that include WeiDU. In general, WeiDU returns 0 on success and
non-zero on failure. Here is a concrete list of return values.</p><ul class="itemize"><li class="li-itemize">
0. General Success. No other error on this list was noticed.
</li><li class="li-itemize">1. Invalid command-line argument.
</li><li class="li-itemize">2. A <a href="#TP2"><span class="c003">TP2</span></a> <a href="#Component"><span class="c003">Component</span></a> failed to install.
A failed installation is one that displays a message like
“<span class="c003">Stopping installation because of error</span>” or
“<span class="c003">ERROR Installing [Component], rolling back to previous state</span>” or
“<span class="c003">PLEASE email the file SETUP-MYMOD.DEBUG to AUTHOR</span>” or
“<span class="c003">ERROR Re-Installing [MyMod] component 1</span>”.
</li><li class="li-itemize">3. A <a href="#TP2"><span class="c003">TP2</span></a> <a href="#Component"><span class="c003">Component</span></a> installed with warnings. A
warning is generally a non-terminal error that may, but need not
necessarily, indicate problems.
</li><li class="li-itemize">4. Parsing error. This is generally used when WeiDU fails to
parse a <a href="#TP2"><span class="c003">TP2</span></a> file.
</li></ul>
<!--TOC section id="sec58" Regular Expressions-->
<h2 class="section" id="sec58">14  Regular Expressions</h2><!--SEC END --><p>A regular expression or <span class="c005">regexp</span><a id="regexp"></a><a id="hevea_default615"></a> is "somewhat" like a DOS wildcard
but not quite. The big difference is that if you would say * in DOS you say
.* in regexp-land. Here’s a definition:</p><p>The syntax for regular expressions is the same as in Gnu Emacs. The special
characters are:
</p><pre class="verbatim">$^.*+?[]\
</pre><p>The following constructs are recognized:
</p><pre class="verbatim">   .      matches any character except newline
   *      (postfix) matches the previous expression zero, one or several times
   +      (postfix) matches the previous expression one or several times
   ?      (postfix) matches the previous expression once or not at all
   [..]   character set; ranges are denoted with -, as in [a-z];
          an initial ^, as in [^0-9], complements the set
   ^      matches at beginning of line
   $      matches at end of line
   \|     (infix) alternative between two expressions
   \(..\) grouping and naming of the enclosed expression
   \1     the text matched by the first \(...\) expression
          (\2 for the second expression, etc)
   \b     matches word boundaries
   \      quotes special characters.
</pre><p>So spe.* matches "sper01.itm" and "sper.eff" and "special".</p><p>Hopefully this is understandable to most people.</p><p><a id="sec-constant"></a></p>
<!--TOC section id="constant" WeiDU <span class="c003"><span class="c007">constant</span></span>s-->
<h2 class="section" id="constant">15  WeiDU <span class="c005">constant</span><a id="hevea_default616"></a>s</h2><!--SEC END --><p>The following keywords can be used in <span class="c003">value</span>s and evaluate to the given
integer (usually an offset in a <a href="#CRE"><span class="c003">CRE</span></a> file).</p><pre class="verbatim">// KEYWORD VALUE
AREA_CITY 0252
AREA_DAY 0260
AREA_DUNGEON 0256
AREA_FOREST 0248
AREA_NIGHT 0264
ATTACK1 0220
ATTACK2 0224
ATTACK3 0228
ATTACK4 0232
BATTLE_CRY1 0200
BATTLE_CRY2 0204
BATTLE_CRY3 0208
BATTLE_CRY4 0212
BATTLE_CRY5 0216
BIO  0x1cc
BORED 0196
COMPLIMENT1 0352
COMPLIMENT2 0356
COMPLIMENT3 0360
CRITICAL_HIT 0424
CRITICAL_MISS 0428
DAMAGE 0236
DESC  0x54
DIALOGUE_DEFAULT 0412
DIALOGUE_HOSTILE 0408
DYING 0240
EXISTANCE1 0444
EXISTANCE2 0448
EXISTANCE3 0452
EXISTANCE4 0456
EXISTANCE5 0460
HAPPY 0172
HURT 0244
IDENTIFIED_DESC  0x54
INITIAL_MEETING 0164
INSULT 0340
INTERACTION1 0320
INTERACTION2 0324
INTERACTION3 0328
INTERACTION4 0332
INTERACTION5 0336
INVENTORY_FULL 0436
LEADER 0188
MISCELLANEOUS 0384
MORALE 0168
NAME1 8
NAME2 12
PICKED_POCKET 0440
REACT_TO_DIE_GENERAL 0376
REACT_TO_DIE_SPECIFIC 0380
RESPONSE_TO_COMPLIMENT2 0388
RESPONSE_TO_COMPLIMENT3 0392
RESPONSE_TO_INSULT1 0396
RESPONSE_TO_INSULT2 0400
RESPONSE_TO_INSULT3 0404
SELECT_ACTION1 0292
SELECT_ACTION2 0296
SELECT_ACTION3 0300
SELECT_ACTION4 0304
SELECT_ACTION5 0308
SELECT_ACTION6 0312
SELECT_ACTION7 0316
SELECT_COMMON1 0268
SELECT_COMMON2 0272
SELECT_COMMON3 0276
SELECT_COMMON4 0280
SELECT_COMMON5 0284
SELECT_COMMON6 0288
SELECT_RARE1 0416
SELECT_RARE2 0420
SPECIAL1 0364
SPECIAL2 0368
SPECIAL3 0372
TARGET_IMMUNE 0432
TIRED 0192
UNHAPPY_ANNOYED 0176
UNHAPPY_BREAKING 0184
UNHAPPY_SERIOUS 0180
UNIDENTIFIED_DESC 0080
HIDDEN_IN_SHADOWS 0444
SPELL_DISRUPTED 0448
SET_A_TRAP 0452
STORE_NAME 12

SCRIPT_OVERRIDE 0x248
SCRIPT_CLASS 0x250
SCRIPT_RACE 0x258
SCRIPT_GENERAL 0x260
SCRIPT_DEFAULT 0x268
DEATHVAR 0x280
DIALOG 0x2cc
AREA_SCRIPT 0x94

BIT0  0b00000000000000000000000000000001
BIT1  0b00000000000000000000000000000010
&lt;snip&gt;
BIT31 0b10000000000000000000000000000000
</pre><p><code>WNL "\r\n"</code> // Windows new line<br>
<code>MNL "\r"</code> // (pre-OSX) Macintosh new line<br>
<code>LNL "\n"</code> // Linux/Unix/OSX new line<br>
<code>TAB "\t"</code> // tabulation character</p><p><code>REGISTRY_BG1_PATH</code> the path of BG1 (as read from the registry),
or empty if not available.<br>

<code>REGISTRY_BG2_PATH</code> ditto for BG2.<br>
<code>REGISTRY_PST_PATH</code> ditto for PST.<br>
<code>REGISTRY_IWD1_PATH</code> ditto for IWD1.<br>
<code>REGISTRY_IWD2_PATH</code> ditto for IWD2.</p><p><code>USER_DIRECTORY</code> evaluates to the directory in which user files
are kept. This is the game path on non-EE-type games. On EE-type
games, the <code>USER_DIRECTORY</code> variable is constructed from two
parts, the user directory and a game-specific directory. If the file
engine.lua exists, WeiDU will attempt to read the game-specific
directory from it. If the engine.lua does not exist or does not
contain the necessary information, WeiDU will use default paths. On
Windows, the user directory is the user’s personal directory, as read
from the Windows registry. On macOS, the user directory is
"$HOME/Documents". On Linux, the user directory is
"$HOME/.local/share". In both cases, $HOME is the user’s home
directory, as read from the pwd database. The default game-specific
path for BG: EE is "Baldur’s Gate - Enhanced Edition"; for BGII: EE it
is "Baldur’s Gate II - Enhanced Edition"; for IWD: EE it is
"Icewind Dale - Enhanced Edition"; and for PST: EE it is
"Planescape Torment - Enhanced Edition".</p><p><code>SAVE_DIRECTORY</code> evaluates to the directory in which the current
game type stores its saved games. This is
"%<code>USER_DIRECTORY</code>%/save".</p><p><code>MPSAVE_DIRECTORY</code> evaluates to the directory in which the
current game type stores its multiplayer saved games. The
determination is done the same way as with the save directory, but for
the directory mpsave instead.</p><p><code>EE_LANGUAGE</code> evaluates to the Enhanced Edition language
directory the user has selected, for example, <code>en_US</code>. This
variable is undefined on non-EE games.</p>
<!--TOC section id="sec60" Common File Formats-->
<h2 class="section" id="sec60">16  Common File Formats</h2><!--SEC END --><p>This section briefly explains some common file formats. The definitive
reference is
<a href="http://gibberlings3.net/iesdp/"><span class="c003">http://gibberlings3.net/iesdp/</span></a>.</p><ul class="itemize"><li class="li-itemize"><span class="c005">2DA</span><a id="2DA"></a><a id="hevea_default617"></a>. A 2DA file is a text file that includes some game rules
or file information. Kits, music, weapon proficiencies and experience point
caps are all controlled by 2DA files.</li><li class="li-itemize"><span class="c005">ARE</span><a id="ARE"></a><a id="hevea_default618"></a>. The ARE file format describes the content of an area
(rather than its visual representation). ARE files contain the list of actors,
items, entrances and exits, spawn points and other area-associated info.
The ARE file may contain references to other files, e.g. the list of items
in a container is stored in the ARE file, however the files themselves are
not embedded in the ARE file.</li><li class="li-itemize"><span class="c005">BAM</span><a id="BAM"></a><a id="hevea_default619"></a>. This file format describes animated graphics. Such files
are used for animations (both creature animations, item and spell animations)
and interactive GUI elements (e.g. buttons) and for logical collections of
images (e.g. fonts). BAM files can contain multiple sequences of animations,
up to a limit of 255.</li><li class="li-itemize"><span class="c005">BIFF</span><a id="BIFF"></a><a id="hevea_default620"></a>. A BIFF file is like a big ZIP file that contains other
files. Basically every file used by an Infinity Engine game is either in a
BIFF somewhere or in the <span class="c003">override</span> folder.</li><li class="li-itemize"><span class="c005">BCS</span><a id="BCS"></a><a id="hevea_default621"></a>. An Infinity Engine script. These are used to control
the actions of creatures and areas. They are basically big lists of
<span class="c003">IF</span>s. <a href="#D"><span class="c003">D</span></a> files (and also <a href="#DLG"><span class="c003">DLG</span></a> files) use the same
predicate and action syntax as BCS files.</li><li class="li-itemize"><span class="c005">CRE</span><a id="CRE"></a><a id="hevea_default622"></a>. This file format describes a "creature". Creatures can
move, have an animation, hold items, run scripts, cast spells and initiate
dialog. Creatures have several stats (some visible through the game UI) which
are generally mapped to IDS or 2DA files.</li><li class="li-itemize"><span class="c005">EFF</span><a id="EFF"></a><a id="hevea_default623"></a>. An Infinity Engine effect file. These are sometimes used
by <a href="#ITM"><span class="c003">ITM</span></a>s or <a href="#SPL"><span class="c003">SPL</span></a>s to do one specific thing. You probably
won’t use them.</li><li class="li-itemize"><span class="c005">GAM</span><a id="GAM"></a><a id="hevea_default624"></a>. This file format is used to hold game information in save
games. The GAM file does not store area, creature or item information, instead,
it stores information on the party members and the global variables which affect
party members.</li><li class="li-itemize"><span class="c005">ITM</span><a id="ITM"></a><a id="hevea_default625"></a>. An Infinity Engine item definition file. Notably,
<a href="#ITM"><span class="c003">ITM</span></a> files have identified and unidentified names that are often set
using the <a href="#TP2%20Action"><span class="c003">TP2 Action</span></a> <a href="#COPY"><span class="c003">COPY</span></a>.</li><li class="li-itemize"><span class="c005">KEY</span><a id="KEY"></a><a id="hevea_default626"></a>. A KEY file is an index into <a href="#BIFF"><span class="c003">BIFF</span></a> files. Given a
resource (like <span class="c003">sw1h01.itm</span>) you can use the KEY file to find out where
it is in the <a href="#BIFF"><span class="c003">BIFF</span></a>s. The default KEY file is <span class="c003">CHITIN.KEY</span>.</li><li class="li-itemize"><span class="c005">SPL</span><a id="SPL"></a><a id="hevea_default627"></a>. An Infinity Engine spell definition file. Spells have
names that are often set using the <a href="#TP2%20Action"><span class="c003">TP2 Action</span></a> <a href="#COPY"><span class="c003">COPY</span></a>.</li><li class="li-itemize"><span class="c005">TLK</span><a id="TLK"></a><a id="hevea_default628"></a>. A TLK file is basically a big array of strings. Items
and spells and dialogues in the game have references into this big array
instead of having actual text in them. So a sword item doesn’t have the
text "Longsword" anywhere in it. Instead if says "use strref #1234 for my
name". The game looks up the #1234th entry in the TLK file and prints that
on the screen. The default TLK file is called <span class="c003">DIALOG.</span><a href="#TLK"><span class="c003">TLK</span></a>.</li></ul>
<!--TOC section id="sec61" The Source Code-->
<h2 class="section" id="sec61">17  The Source Code</h2><!--SEC END --><p>The source code to WeiDU is available under the GNU General Public License,
as detailed in the file <span class="c003">COPYING</span>. If for some reason you are unable to
obtain a copy of the GPL, merely announce that fact on some public forum
and your mailbox will be full of copies of it for life. It’s a great way to
meet new people.</p><p>Since this is the world of Windows, I distribute a pre-compiled binary.
WeiDU is written in OCaml, a functional programming language that includes
automatic memory management, higher-order functions and efficient native
code generation. If these terms mean nothing to you, you probably won’t be
able to modify the source code.</p><p>Building WeiDU on Windows requires OCaml 4.01 or more recent, Cygwin and the
elkhound program. The OCaml installer can install the required Cygwin
packages.</p><p>WeiDU can also be built on x86/x86-64 GNU/Linux and PPC OS X. The exact status
on building WeiDU on x86/x86-64 OS X is not known, but there have been reports
of success.</p><p>WeiDU uses a Make system that aims to correctly auto-configure itself, through
the file <span class="c003">Configuration</span>.</p><p>WeiDU uses the GPL’d <span class="c003">zlib</span> and <span class="c003">xdiff</span> libraries, as well as portions from
the GPL’d <span class="c003">ocaml, batteries included</span> library.</p><p>Elkhound is available as source code under a BSD licence and as
pre-compiled x86 executables for Windows and GNU/Linux (built on
Debian Squeeze).</p><p>For more information, please refer to the forum.</p>
<!--TOC section id="Special Thanks" <span class="c003"><span class="c007">Special Thanks</span></span>-->
<h2 class="section" id="Special Thanks">18  <span class="c005">Special Thanks</span><a id="hevea_default629"></a></h2><!--SEC END --><p>
<em>Weimer’s thank you</em>:
I would like to thank the fine folks at the Infinity Engine File Format
Hacking Project, without which this would not have been possible:
<a href="http://gibberlings3.net/iesdp/"><span class="c003">http://gibberlings3.net/iesdp/</span></a>.</p><p>In addition, I make heavy use of Near Infinity for general IE mods: <a href="http://www.idi.ntnu.no/~joh/ni/"><span class="c003">http://www.idi.ntnu.no/~joh/ni/</span></a>.</p><p>The Infinity Engine Editor Pro was very good at changing <a href="#ITM"><span class="c003">ITM</span></a>s and
<a href="#SPL"><span class="c003">SPL</span></a>s, but DLTCEP is now a better choice:
<a href="http://gibberlings3.net/tools/dltcep.php"><span class="c003">http://gibberlings3.net/tools/dltcep.php</span></a>.</p><p>Kudos to my main out-of-house developer:
</p><ul class="itemize"><li class="li-itemize">
Fred S. Richardson (he slices, he dices, he sends diffs!)
</li><li class="li-itemize">Japheth (also sends diffs!)
</li></ul><p>Special thanks to my main bug-finders *cough* I mean beta-testers:
</p><ul class="itemize"><li class="li-itemize">
<em>Jason Compton </em>
</li><li class="li-itemize">Ghreyfain
</li><li class="li-itemize">Michael Lyashenko
</li><li class="li-itemize">Quitch
</li><li class="li-itemize">Dyara
</li><li class="li-itemize">M
</li><li class="li-itemize">Rene Heroux
</li><li class="li-itemize">Avenger TeamBG
</li><li class="li-itemize">Sim
</li><li class="li-itemize">devSin</li></ul><p>Special thanks to Greg Henry for being the first person to mention WeiDU to
me in a face-to-face conversation. I was quite impressed. Jason Compton is
the first person to mention WeiDU to me in a telephone conversation. Scott
McPeak is the first person to discuss my modding hobby with me in a
face-to-face conversation (and he was quite well-informed).</p><p>The Bigg would additionally like to thank the following contributors:
</p><ul class="itemize"><li class="li-itemize">
DevSin (also sends diffs and tests and compiles!)
</li><li class="li-itemize">cmorgan for his excellent throughput while testing.
</li><li class="li-itemize">Taimon (also sends diffs and tests!)
</li><li class="li-itemize">Gort (sends tp2 macros!)
</li><li class="li-itemize">vit-mg (sends documentation!)
</li><li class="li-itemize">Mike1072 (sends documentation and tp2 macros/functions!)
</li><li class="li-itemize">plainab sends tp2 macros!
</li><li class="li-itemize">wisp (sends documentation and tp2 macros/functions!)
</li><li class="li-itemize">Miloch (sends documentation and tp2 macros/functions!)
</li><li class="li-itemize">SConrad (sends tp2 functions!)
</li><li class="li-itemize">Nythrun (sends tp2 functions!)
</li><li class="li-itemize">Galactycon (sends tp2 macros!)
</li></ul><p>
and additionally
</p><ul class="itemize"><li class="li-itemize">
<em>Weimer</em> for having written (and maintained) the excellent WeiDU,
and having offered it freely (both as free beer and freedom) to the gaming
community.
</li><li class="li-itemize">All the people I’ve been modding with, all the people who played my mods,
and all of the BG modding community, for having been a very friendly community
(and, in some cases, even very good friends) in these last four years (or more,
this part was written in Jun 2008). It’s for you that I’ve learned OcaML and
started editing WeiDU.
</li></ul><p>Wisp would like to extend further thanks to the following people:
</p><ul class="itemize"><li class="li-itemize">
CamDawg (sends documentation and tp2 functions)
</li><li class="li-itemize">Nifft (sends compiles)
</li><li class="li-itemize">Antonio Favata, a.k.a. alnair (sends compiles)
</li><li class="li-itemize">Almateria (sends compiles)
</li><li class="li-itemize">Nicolás Clotta aka Crevs Daak (sends compiles)
</li><li class="li-itemize">Argent77 (sends tp2 functions and compiles)
</li></ul><p>
and also The Bigg, for having developed and maintained BiggDU for many years and, while doing so, having significantly improved upon its workings and functionality.</p>
<!--TOC section id="sec63" Informal Copyright Notice-->
<h2 class="section" id="sec63">19  Informal Copyright Notice</h2><!--SEC END --><p>
WeiDU was originally made by Westley Weimer. It was subsequently significantly
improved upon in accordance with the GPL terms by Valerio Bigiani, AKA The Bigg,
starting from version 186 (which was a closed beta, while the first public
release was the 187 one). Starting from version 232 (version 231.06 to be more precise),
maintenance and development was assumed by Fredrik Lindgren, a.k.a Wisp.</p><p>What this means is that all praise and credits should go to Weimer and Bigiani,
but all bug reports and feature requests should go to Fredrik Lindgren (a.k.a Wisp).</p><p>Since WeiDU was released under the GPL, with an added notice that you are also
allowed to distribute unmodified binaries, I assume the same holds true for
mods distributed with this version of WeiDU. However, if you feel like being
nice add a line in your readme stating that the current WeiDU may be downloaded
from &lt;insert link&gt;. Current authorized mirrors include (but may not be limited to)
all those from IEGMC, the Dragon’s Hoard Download Centre, and the SHS Download Centre.</p>
<!--TOC section id="sec64" Undocumented Features-->
<h2 class="section" id="sec64">20  Undocumented Features</h2><!--SEC END --><p>Currently undocumented:
</p><ul class="itemize"><li class="li-itemize">
<span class="c003">IF_EVAL</span>.
</li><li class="li-itemize"><span class="c003">REPLACE_BCS_BLOCK_REGEXP</span>.
</li><li class="li-itemize">Fred’s BCS diff stuff.
</li><li class="li-itemize"><span class="c003">EXTEND_MOS</span>.
</li></ul>
<!--TOC section id="sec65" Index of Terms-->
<h2 class="section" id="sec65">21  Index of Terms</h2><!--SEC END --><!--TOC section id="sec66" Index-->
<h2 class="section" id="sec66">Index</h2><!--SEC END --><p></p><table class="c001 cellpading0"><tr><td class="c013"><ul class="indexenv"><li class="li-indexenv">
**, <a href="#hevea_default508">9</a>, <a href="#hevea_default509">9</a>
<br>
<br>
</li><li class="li-indexenv">--append, <a href="#hevea_default112">6</a>
</li><li class="li-indexenv">--args, <a href="#hevea_default92">6</a>
</li><li class="li-indexenv">--args-list, <a href="#hevea_default94">6</a>
</li><li class="li-indexenv">--args-rest, <a href="#hevea_default93">6</a>
</li><li class="li-indexenv">--ask-every, <a href="#hevea_default89">6</a>
</li><li class="li-indexenv">--ask-only, <a href="#hevea_default90">6</a>
</li><li class="li-indexenv">--autolog, <a href="#hevea_default171">6</a>
</li><li class="li-indexenv">--automate, <a href="#hevea_default167">6</a>
</li><li class="li-indexenv">--automate-min, <a href="#hevea_default168">6</a>
</li><li class="li-indexenv">--backup, <a href="#hevea_default113">6</a>
</li><li class="li-indexenv">--bcmp-from, <a href="#hevea_default161">6</a>
</li><li class="li-indexenv">--bcmp-orig, <a href="#hevea_default163">6</a>
</li><li class="li-indexenv">--bcmp-patch, <a href="#hevea_default164">6</a>
</li><li class="li-indexenv">--bcmp-to, <a href="#hevea_default162">6</a>
</li><li class="li-indexenv">--biff, <a href="#hevea_default141">6</a>
</li><li class="li-indexenv">--biff-get, <a href="#hevea_default142">6</a>
</li><li class="li-indexenv">--biff-get-list, <a href="#hevea_default144">6</a>
</li><li class="li-indexenv">--biff-get-rest, <a href="#hevea_default143">6</a>
</li><li class="li-indexenv">--biff-name, <a href="#hevea_default149">6</a>
</li><li class="li-indexenv">--biff-str, <a href="#hevea_default145">6</a>
</li><li class="li-indexenv">--biff-type, <a href="#hevea_default148">6</a>
</li><li class="li-indexenv">--biff-value, <a href="#hevea_default146">6</a>
</li><li class="li-indexenv">--biff-value-at, <a href="#hevea_default147">6</a>
</li><li class="li-indexenv">--clear-memory, <a href="#hevea_default98">6</a>
</li><li class="li-indexenv">--cmp-from, <a href="#hevea_default152">6</a>
</li><li class="li-indexenv">--cmp-to, <a href="#hevea_default153">6</a>
</li><li class="li-indexenv">--continue, <a href="#hevea_default91">6</a>
</li><li class="li-indexenv">--dcmp-from, <a href="#hevea_default154">6</a>
</li><li class="li-indexenv">--dcmp-to, <a href="#hevea_default155">6</a>
</li><li class="li-indexenv">--debug-assign, <a href="#hevea_default95">6</a>
</li><li class="li-indexenv">--debug-value, <a href="#hevea_default96">6</a>
</li><li class="li-indexenv">--extract-kits, <a href="#hevea_default169">6</a>
</li><li class="li-indexenv">--force-install, <a href="#hevea_default79">6</a>
</li><li class="li-indexenv">--force-install-list, <a href="#hevea_default83">6</a>
</li><li class="li-indexenv">--force-install-rest, <a href="#hevea_default81">6</a>
</li><li class="li-indexenv">--force-uninstall, <a href="#hevea_default80">6</a>
</li><li class="li-indexenv">--force-uninstall-list, <a href="#hevea_default84">6</a>
</li><li class="li-indexenv">--force-uninstall-rest, <a href="#hevea_default82">6</a>
</li><li class="li-indexenv">--forceify, <a href="#hevea_default135">6</a>
</li><li class="li-indexenv">--ftlkin, <a href="#hevea_default109">6</a>
</li><li class="li-indexenv">--ftlkout, <a href="#hevea_default115">6</a>
</li><li class="li-indexenv">--full-from, <a href="#hevea_default120">6</a>
</li><li class="li-indexenv">--game, <a href="#hevea_default103">6</a>
</li><li class="li-indexenv">--game-by-type, <a href="#hevea_default105">6</a>
</li><li class="li-indexenv">--language, <a href="#hevea_default78">6</a>
</li><li class="li-indexenv">--list-biffs, <a href="#hevea_default139">6</a>
</li><li class="li-indexenv">--list-files, <a href="#hevea_default140">6</a>
</li><li class="li-indexenv">--log, <a href="#hevea_default170">6</a>
</li><li class="li-indexenv">--logapp, <a href="#hevea_default172">6</a>
</li><li class="li-indexenv">--make-biff, <a href="#hevea_default150">6</a>
</li><li class="li-indexenv">--make-tlk, <a href="#hevea_default133">6</a>
</li><li class="li-indexenv">--max, <a href="#hevea_default166">6</a>
</li><li class="li-indexenv">--min, <a href="#hevea_default165">6</a>
</li><li class="li-indexenv">--modder, <a href="#hevea_default97">6</a>
</li><li class="li-indexenv">--no-auto-tp2, <a href="#hevea_default101">6</a>
</li><li class="li-indexenv">--noautoupdate, <a href="#hevea_default100">6</a>
</li><li class="li-indexenv">--nocom, <a href="#hevea_default121">6</a>
</li><li class="li-indexenv">--nofrom, <a href="#hevea_default119">6</a>
</li><li class="li-indexenv">--nogame, <a href="#hevea_default104">6</a>
</li><li class="li-indexenv">--noheader, <a href="#hevea_default118">6</a>
</li><li class="li-indexenv">--noselfupdatemsg, <a href="#hevea_default102">6</a>
</li><li class="li-indexenv">--out, <a href="#hevea_default111">6</a>
</li><li class="li-indexenv">--parse-check, <a href="#hevea_default117">6</a>
</li><li class="li-indexenv">--quick-menu, <a href="#hevea_default85">6</a>
</li><li class="li-indexenv">--reinstall, <a href="#hevea_default77">6</a>
</li><li class="li-indexenv">--remove-biff, <a href="#hevea_default151">6</a>
</li><li class="li-indexenv">--safe-exit, <a href="#hevea_default87">6</a>
</li><li class="li-indexenv">--save-components-name, <a href="#hevea_default88">6</a>
</li><li class="li-indexenv">--script-style, <a href="#hevea_default73">6</a>
</li><li class="li-indexenv">--search, <a href="#hevea_default106">6</a>
</li><li class="li-indexenv">--skip-at-view, <a href="#hevea_default86">6</a>
</li><li class="li-indexenv">--strapp, <a href="#hevea_default138">6</a>
</li><li class="li-indexenv">--strfind, <a href="#hevea_default137">6</a>
</li><li class="li-indexenv">--string, <a href="#hevea_default136">6</a>
</li><li class="li-indexenv">--tcmp-from, <a href="#hevea_default156">6</a>
</li><li class="li-indexenv">--tcmp-to, <a href="#hevea_default157">6</a>
</li><li class="li-indexenv">--testtrans, <a href="#hevea_default134">6</a>
</li><li class="li-indexenv">--text, <a href="#hevea_default122">6</a>
</li><li class="li-indexenv">--tlkcmp-from, <a href="#hevea_default158">6</a>
</li><li class="li-indexenv">--tlkcmp-to, <a href="#hevea_default159">6</a>
</li><li class="li-indexenv">--tlkcmp-use-strings, <a href="#hevea_default160">6</a>
</li><li class="li-indexenv">--tlkin, <a href="#hevea_default108">6</a>
</li><li class="li-indexenv">--tlkmerge, <a href="#hevea_default110">6</a>
</li><li class="li-indexenv">--tlkout, <a href="#hevea_default114">6</a>
</li><li class="li-indexenv">--toplevel, <a href="#hevea_default124">6</a>
</li><li class="li-indexenv">--traify, <a href="#hevea_default125">6</a>
</li><li class="li-indexenv">--traify-comment, <a href="#hevea_default127">6</a>
</li><li class="li-indexenv">--traify-old-tra, <a href="#hevea_default126">6</a>
</li><li class="li-indexenv">--traify-tlk, <a href="#hevea_default132">6</a>
</li><li class="li-indexenv">--trans, <a href="#hevea_default130">6</a>
</li><li class="li-indexenv">--transin, <a href="#hevea_default74">6</a>
</li><li class="li-indexenv">--transitive, <a href="#hevea_default123">6</a>, <a href="#hevea_default173">7</a>
</li><li class="li-indexenv">--transref, <a href="#hevea_default131">6</a>
</li><li class="li-indexenv">--uninstall, <a href="#hevea_default76">6</a>
</li><li class="li-indexenv">--untraify-d, <a href="#hevea_default128">6</a>
</li><li class="li-indexenv">--untraify-tra, <a href="#hevea_default129">6</a>
</li><li class="li-indexenv">--update-all, <a href="#hevea_default99">6</a>
</li><li class="li-indexenv">--use-lang, <a href="#hevea_default107">6</a>
</li><li class="li-indexenv">--version, <a href="#hevea_default116">6</a>
</li><li class="li-indexenv">--yes, <a href="#hevea_default75">6</a>
<br>
<br>
</li><li class="li-indexenv">2DA, <a href="#hevea_default617">16</a>
<br>
<br>
</li><li class="li-indexenv">&lt;, <a href="#hevea_default534">9</a>
</li><li class="li-indexenv">&lt;&lt;, <a href="#hevea_default528">9</a>
</li><li class="li-indexenv">&lt;=, <a href="#hevea_default535">9</a>
<br>
<br>
</li><li class="li-indexenv">=, <a href="#hevea_default510">9</a>
</li><li class="li-indexenv">==, <a href="#hevea_default511">9</a>
<br>
<br>
</li><li class="li-indexenv">&gt;, <a href="#hevea_default532">9</a>
</li><li class="li-indexenv">&gt;=, <a href="#hevea_default533">9</a>
</li><li class="li-indexenv">&gt;&gt;, <a href="#hevea_default530">9</a>
<br>
<br>
</li><li class="li-indexenv">?, <a href="#hevea_default536">9</a>
<br>
<br>
</li><li class="li-indexenv">&amp;, <a href="#hevea_default520">9</a>
</li><li class="li-indexenv">&amp;&amp;, <a href="#hevea_default518">9</a>
</li><li class="li-indexenv">!=, <a href="#hevea_default514">9</a>
</li><li class="li-indexenv">|, <a href="#hevea_default522">9</a>
</li><li class="li-indexenv">||, <a href="#hevea_default516">9</a>
</li><li class="li-indexenv"><code>`</code>, <a href="#hevea_default526">9</a>
</li><li class="li-indexenv"><code>ADD_STORE_CURE</code>, <a href="#hevea_default606">12.1</a>
</li><li class="li-indexenv"><code>ADD_STORE_DRINK</code>, <a href="#hevea_default605">12.1</a>
</li><li class="li-indexenv"><code>ADD_STORE_ITEM_EX</code>, <a href="#hevea_default604">12.1</a>
</li><li class="li-indexenv"><code>ADD_STORE_PURCHASE</code>, <a href="#hevea_default607">12.1</a>
</li><li class="li-indexenv"><code>ADD_WORLDMAP_LINKS</code>, <a href="#hevea_default596">12</a>
</li><li class="li-indexenv"><code>DELETE_WORLDMAP_LINKS</code>, <a href="#hevea_default595">12</a>
</li><li class="li-indexenv"><code>DIRECTORY_OF_FILESPEC</code>, <a href="#hevea_default600">12</a>
</li><li class="li-indexenv"><code>EXT_OF_FILESPEC</code>, <a href="#hevea_default603">12</a>
</li><li class="li-indexenv"><code>FILE_OF_FILESPEC</code>, <a href="#hevea_default601">12</a>
</li><li class="li-indexenv"><code>FIND_FREE_PVRZ_INDEX</code>, <a href="#hevea_default599">12</a>
</li><li class="li-indexenv"><code>HANDLE_AUDIO</code>, <a href="#hevea_default592">12</a>
</li><li class="li-indexenv"><code>HANDLE_CHARSETS</code>, <a href="#hevea_default594">12</a>
</li><li class="li-indexenv"><code>HANDLE_TILESETS</code>, <a href="#hevea_default593">12</a>
</li><li class="li-indexenv"><code>INSTALL_PVRZ</code>, <a href="#hevea_default598">12</a>
</li><li class="li-indexenv"><code>REMOVE_STORE_CURE</code>, <a href="#hevea_default610">12.1</a>
</li><li class="li-indexenv"><code>REMOVE_STORE_DRINK</code>, <a href="#hevea_default609">12.1</a>
</li><li class="li-indexenv"><code>REMOVE_STORE_ITEM_EX</code>, <a href="#hevea_default608">12.1</a>
</li><li class="li-indexenv"><code>REMOVE_STORE_PURCHASE</code>, <a href="#hevea_default611">12.1</a>
</li><li class="li-indexenv"><code>RES_OF_FILESPEC</code>, <a href="#hevea_default602">12</a>
</li><li class="li-indexenv"><code>UPDATE_PVRZ_INDICES</code>, <a href="#hevea_default597">12</a>
<br>
<br>
</li><li class="li-indexenv">^^, <a href="#hevea_default524">9</a>
<br>
<br>
</li><li class="li-indexenv">ABORT, <a href="#hevea_default293">9</a>
</li><li class="li-indexenv">ABS, <a href="#hevea_default513">9</a>
</li><li class="li-indexenv">ACTION_BASH_FOR, <a href="#hevea_default307">9</a>
</li><li class="li-indexenv">ACTION_CLEAR_ARRAY, <a href="#hevea_default244">9</a>
</li><li class="li-indexenv">ACTION_DEFINE_ARRAY, <a href="#hevea_default308">9</a>
</li><li class="li-indexenv">ACTION_DEFINE_ASSOCIATIVE_ARRAY, <a href="#hevea_default312">9</a>
</li><li class="li-indexenv">ACTION_FOR_EACH, <a href="#hevea_default313">9</a>
</li><li class="li-indexenv">ACTION_GET_STRREF, <a href="#hevea_default322">9</a>
</li><li class="li-indexenv">ACTION_GET_STRREF_F, <a href="#hevea_default323">9</a>
</li><li class="li-indexenv">ACTION_GET_STRREF_FS, <a href="#hevea_default325">9</a>
</li><li class="li-indexenv">ACTION_GET_STRREF_S, <a href="#hevea_default324">9</a>
</li><li class="li-indexenv">ACTION_IF, <a href="#hevea_default258">9</a>
</li><li class="li-indexenv">ACTION_INCLUDE, <a href="#hevea_default316">9</a>
</li><li class="li-indexenv">ACTION_MATCH, <a href="#hevea_default259">9</a>
</li><li class="li-indexenv">ACTION_PHP_EACH, <a href="#hevea_default314">9</a>
</li><li class="li-indexenv">ACTION_READLN, <a href="#hevea_default249">9</a>
</li><li class="li-indexenv">ACTION_REINCLUDE, <a href="#hevea_default318">9</a>
</li><li class="li-indexenv">ACTION_RERAISE, <a href="#hevea_default261">9</a>
</li><li class="li-indexenv">ACTION_SORT_ARRAY_INDICES, <a href="#hevea_default309">9</a>
</li><li class="li-indexenv">ACTION_TIME, <a href="#hevea_default336">9</a>
</li><li class="li-indexenv">ACTION_TO_LOWER, <a href="#hevea_default321">9</a>
</li><li class="li-indexenv">ACTION_TO_UPPER, <a href="#hevea_default320">9</a>
</li><li class="li-indexenv">ACTION_TRY, <a href="#hevea_default260">9</a>
</li><li class="li-indexenv">ADD_AREA_TYPE, <a href="#hevea_default280">9</a>
</li><li class="li-indexenv">ADD_CRE_ITEM, <a href="#hevea_default466">9</a>
</li><li class="li-indexenv">ADD_GAM_NPC, <a href="#hevea_default459">9</a>
</li><li class="li-indexenv">ADD_JOURNAL, <a href="#hevea_default283">9</a>
</li><li class="li-indexenv">ADD_KIT, <a href="#hevea_default276">9</a>
</li><li class="li-indexenv">ADD_KNOWN_SPELL, <a href="#hevea_default461">9</a>
</li><li class="li-indexenv">ADD_MAP_NOTE, <a href="#hevea_default460">9</a>
</li><li class="li-indexenv">ADD_MEMORIZED_SPELL, <a href="#hevea_default462">9</a>
</li><li class="li-indexenv">ADD_MUSIC, <a href="#hevea_default277">9</a>
</li><li class="li-indexenv">ADD_PROJECTILE, <a href="#hevea_default281">9</a>
</li><li class="li-indexenv">ADD_SCHOOL, <a href="#hevea_default278">9</a>
</li><li class="li-indexenv">ADD_SECTYPE, <a href="#hevea_default279">9</a>
</li><li class="li-indexenv">ADD_SPELL, <a href="#hevea_default282">9</a>
</li><li class="li-indexenv">ADD_STATE_TRIGGER, <a href="#hevea_default15">4</a>
</li><li class="li-indexenv">ADD_STORE_ITEM, <a href="#hevea_default441">9</a>
</li><li class="li-indexenv">ADD_TRANS_ACTION, <a href="#hevea_default17">4</a>
</li><li class="li-indexenv">ADD_TRANS_TRIGGER, <a href="#hevea_default16">4</a>
</li><li class="li-indexenv">ALLOW_MISSING, <a href="#hevea_default185">9</a>
</li><li class="li-indexenv">ALTER_TLK, <a href="#hevea_default289">9</a>
</li><li class="li-indexenv">ALTER_TLK_LIST, <a href="#hevea_default288">9</a>
</li><li class="li-indexenv">ALTER_TLK_RANGE, <a href="#hevea_default287">9</a>
</li><li class="li-indexenv">ALTER_TRANS, <a href="#hevea_default20">4</a>
</li><li class="li-indexenv">ALWAYS, <a href="#hevea_default187">9</a>
</li><li class="li-indexenv">AND, <a href="#hevea_default517">9</a>
</li><li class="li-indexenv">APPEND, <a href="#hevea_default5">4</a>, <a href="#hevea_default250">9</a>
</li><li class="li-indexenv">APPEND_COL, <a href="#hevea_default252">9</a>
</li><li class="li-indexenv">APPEND_COL_OUTER, <a href="#hevea_default253">9</a>
</li><li class="li-indexenv">APPEND_EARLY, <a href="#hevea_default6">4</a>
</li><li class="li-indexenv">APPEND_FILE, <a href="#hevea_default387">9</a>
</li><li class="li-indexenv">APPEND_FILE_EVALUATE, <a href="#hevea_default388">9</a>
</li><li class="li-indexenv">APPEND_OUTER, <a href="#hevea_default251">9</a>
</li><li class="li-indexenv">APPENDI, <a href="#hevea_default41">4</a>
</li><li class="li-indexenv">APPLY_BCS_PATCH, <a href="#hevea_default373">9</a>
</li><li class="li-indexenv">APPLY_BCS_PATCH_OR_COPY, <a href="#hevea_default374">9</a>
</li><li class="li-indexenv">ARE, <a href="#hevea_default618">16</a>
</li><li class="li-indexenv">ArrayIndicesSortType, <a href="#hevea_default348">9</a>
</li><li class="li-indexenv">ASK_EVERY_COMPONENT, <a href="#hevea_default186">9</a>
</li><li class="li-indexenv">AT_EXIT, <a href="#hevea_default262">9</a>
</li><li class="li-indexenv">AT_INTERACTIVE_EXIT, <a href="#hevea_default263">9</a>
</li><li class="li-indexenv">AT_INTERACTIVE_NOW, <a href="#hevea_default269">9</a>
</li><li class="li-indexenv">AT_INTERACTIVE_UNINSTALL, <a href="#hevea_default265">9</a>
</li><li class="li-indexenv">AT_INTERACTIVE_UNINSTALL_EXIT, <a href="#hevea_default267">9</a>
</li><li class="li-indexenv">AT_NOW, <a href="#hevea_default268">9</a>
</li><li class="li-indexenv">AT_UNINSTALL, <a href="#hevea_default264">9</a>
</li><li class="li-indexenv">AT_UNINSTALL_EXIT, <a href="#hevea_default266">9</a>
</li><li class="li-indexenv">AUTHOR, <a href="#hevea_default177">9</a>
</li><li class="li-indexenv">AUTO_EVAL_STRINGS, <a href="#hevea_default196">9</a>
</li><li class="li-indexenv">AUTO_TRA, <a href="#hevea_default184">9</a>
<br>
<br>
</li><li class="li-indexenv">BACKUP, <a href="#hevea_default176">9</a>
</li><li class="li-indexenv">BAF File, <a href="#hevea_default66">5</a>
</li><li class="li-indexenv">BAM, <a href="#hevea_default619">16</a>
</li><li class="li-indexenv">BAND, <a href="#hevea_default519">9</a>
</li><li class="li-indexenv">BASR, <a href="#hevea_default531">9</a>
</li><li class="li-indexenv">BCS, <a href="#hevea_default621">16</a>
</li><li class="li-indexenv">BEGIN, <a href="#hevea_default3">4</a>, <a href="#hevea_default200">9</a>
</li><li class="li-indexenv">BIFF, <a href="#hevea_default620">16</a>
</li><li class="li-indexenv">BIFF_IS_COMPRESSED, <a href="#hevea_default577">9</a>
</li><li class="li-indexenv">BLSL, <a href="#hevea_default527">9</a>
</li><li class="li-indexenv">BLSR, <a href="#hevea_default529">9</a>
</li><li class="li-indexenv">BNOT, <a href="#hevea_default525">9</a>
</li><li class="li-indexenv">BOR, <a href="#hevea_default521">9</a>
</li><li class="li-indexenv">BUFFER_LENGTH, <a href="#hevea_default563">9</a>
</li><li class="li-indexenv">BUT_ONLY, <a href="#hevea_default497">9</a>
</li><li class="li-indexenv">BUT_ONLY_IF_IT_CHANGES, <a href="#hevea_default496">9</a>
</li><li class="li-indexenv">BXOR, <a href="#hevea_default523">9</a>
</li><li class="li-indexenv">BYTE_AT, <a href="#hevea_default502">9</a>
<br>
<br>
</li><li class="li-indexenv">CASE_INSENSITIVE, <a href="#hevea_default344">9</a>
</li><li class="li-indexenv">CASE_SENSITIVE, <a href="#hevea_default343">9</a>
</li><li class="li-indexenv">CHAIN, <a href="#hevea_default7">4</a>
</li><li class="li-indexenv">CHAIN2, <a href="#hevea_default42">4</a>
</li><li class="li-indexenv">CLEAR_ARRAY, <a href="#hevea_default422">9</a>
</li><li class="li-indexenv">CLEAR_ARRAYS, <a href="#hevea_default239">9</a>
</li><li class="li-indexenv">CLEAR_CODES, <a href="#hevea_default240">9</a>
</li><li class="li-indexenv">CLEAR_EVERYTHING, <a href="#hevea_default242">9</a>
</li><li class="li-indexenv">CLEAR_IDS_MAP, <a href="#hevea_default243">9</a>
</li><li class="li-indexenv">CLEAR_INLINED, <a href="#hevea_default241">9</a>
</li><li class="li-indexenv">CLEAR_MEMORY, <a href="#hevea_default238">9</a>
</li><li class="li-indexenv">COMPILE, <a href="#hevea_default236">9</a>
</li><li class="li-indexenv">COMPILE_BAF_TO_BCS, <a href="#hevea_default450">9</a>
</li><li class="li-indexenv">COMPILE_D_TO_DLG, <a href="#hevea_default453">9</a>
</li><li class="li-indexenv">COMPONENT_NUMBER, <a href="#hevea_default585">9</a>
</li><li class="li-indexenv">COMPRESS_INTO_FILE, <a href="#hevea_default484">9</a>
</li><li class="li-indexenv">COMPRESS_INTO_VAR, <a href="#hevea_default485">9</a>
</li><li class="li-indexenv">COMPRESS_REPLACE_FILE, <a href="#hevea_default483">9</a>
</li><li class="li-indexenv">COPY, <a href="#hevea_default215">9</a>
</li><li class="li-indexenv">COPY_ALL_GAM_FILES, <a href="#hevea_default231">9</a>
</li><li class="li-indexenv">COPY_EXISTING, <a href="#hevea_default227">9</a>
</li><li class="li-indexenv">COPY_EXISTING_REGEXP, <a href="#hevea_default228">9</a>
</li><li class="li-indexenv">COPY_KIT, <a href="#hevea_default275">9</a>
</li><li class="li-indexenv">COPY_LARGE, <a href="#hevea_default229">9</a>
</li><li class="li-indexenv">COPY_RANDOM, <a href="#hevea_default230">9</a>
</li><li class="li-indexenv">COPY_TRANS, <a href="#hevea_default47">4</a>
</li><li class="li-indexenv">COPY_TRANS_LATE, <a href="#hevea_default48">4</a>
</li><li class="li-indexenv">COUNT_2DA_COLS, <a href="#hevea_default447">9</a>
</li><li class="li-indexenv">COUNT_2DA_ROWS, <a href="#hevea_default446">9</a>
</li><li class="li-indexenv">COUNT_REGEXP_INSTANCES, <a href="#hevea_default448">9</a>
</li><li class="li-indexenv">Code dumps, <a href="#hevea_default591">11</a>
</li><li class="li-indexenv">Component, <a href="#hevea_default199">9</a>
</li><li class="li-indexenv">Component Flag, <a href="#hevea_default201">9</a>
</li><li class="li-indexenv">CRE, <a href="#hevea_default622">16</a>
</li><li class="li-indexenv">CREATE, <a href="#hevea_default235">9</a>
</li><li class="li-indexenv">chainEpilogue, <a href="#hevea_default34">4</a>
</li><li class="li-indexenv">chainText, <a href="#hevea_default61">4</a>
</li><li class="li-indexenv">constant, <a href="#hevea_default616">15</a>
<br>
<br>
</li><li class="li-indexenv">D Action, <a href="#hevea_default2">4</a>
</li><li class="li-indexenv">D File, <a href="#hevea_default1">4</a>
</li><li class="li-indexenv">DECOMPILE_AND_PATCH, <a href="#hevea_default454">9</a>
</li><li class="li-indexenv">DECOMPILE_BCS_TO_BAF, <a href="#hevea_default451">9</a>
</li><li class="li-indexenv">DECOMPILE_DLG_TO_D, <a href="#hevea_default452">9</a>
</li><li class="li-indexenv">DECOMPRESS_BIFF, <a href="#hevea_default326">9</a>
</li><li class="li-indexenv">DECOMPRESS_INTO_FILE, <a href="#hevea_default481">9</a>
</li><li class="li-indexenv">DECOMPRESS_INTO_VAR, <a href="#hevea_default482">9</a>
</li><li class="li-indexenv">DECOMPRESS_REPLACE_FILE, <a href="#hevea_default480">9</a>
</li><li class="li-indexenv">DEFINE_ACTION_FUNCTION, <a href="#hevea_default329">9</a>
</li><li class="li-indexenv">DEFINE_ACTION_MACRO, <a href="#hevea_default327">9</a>
</li><li class="li-indexenv">DEFINE_ARRAY, <a href="#hevea_default416">9</a>
</li><li class="li-indexenv">DEFINE_ASSOCIATIVE_ARRAY, <a href="#hevea_default406">9</a>
</li><li class="li-indexenv">DEFINE_DIMORPHIC_FUNCTION, <a href="#hevea_default330">9</a>
</li><li class="li-indexenv">DEFINE_PATCH_FUNCTION, <a href="#hevea_default331">9</a>
</li><li class="li-indexenv">DEFINE_PATCH_MACRO, <a href="#hevea_default328">9</a>
</li><li class="li-indexenv">DELETE, <a href="#hevea_default233">9</a>
</li><li class="li-indexenv">DELETE_BYTES, <a href="#hevea_default392">9</a>
</li><li class="li-indexenv">DEPRECATED, <a href="#hevea_default202">9</a>
</li><li class="li-indexenv">DESIGNATED, <a href="#hevea_default210">9</a>
</li><li class="li-indexenv">DEST_DIRECTORY, <a href="#hevea_default221">9</a>
</li><li class="li-indexenv">DEST_EXT, <a href="#hevea_default225">9</a>
</li><li class="li-indexenv">DEST_FILE, <a href="#hevea_default223">9</a>
</li><li class="li-indexenv">DEST_FILESPEC, <a href="#hevea_default222">9</a>
</li><li class="li-indexenv">DEST_RES, <a href="#hevea_default224">9</a>
</li><li class="li-indexenv">DIRECTORY_EXISTS, <a href="#hevea_default573">9</a>
</li><li class="li-indexenv">DISABLE_FROM_KEY, <a href="#hevea_default234">9</a>
</li><li class="li-indexenv">DLG, <a href="#hevea_default0">3</a>
</li><li class="li-indexenv">DO, <a href="#hevea_default51">4</a>
</li><li class="li-indexenv">dActionWhen, <a href="#hevea_default31">4</a>
</li><li class="li-indexenv">directory-file-regexp, <a href="#hevea_default338">9</a>
<br>
<br>
</li><li class="li-indexenv">EDIT_SAV_FILE, <a href="#hevea_default479">9</a>
</li><li class="li-indexenv">EFF, <a href="#hevea_default623">16</a>
</li><li class="li-indexenv">ENGINE_IS, <a href="#hevea_default547">9</a>
</li><li class="li-indexenv">EVAL, <a href="#hevea_default372">9</a>
</li><li class="li-indexenv">EVALUATE_BUFFER, <a href="#hevea_default371">9</a>, <a href="#hevea_default582">9</a>
</li><li class="li-indexenv">EVALUATE_BUFFER_SPECIAL, <a href="#hevea_default370">9</a>
</li><li class="li-indexenv">EVALUATE_REGEXP, <a href="#hevea_default347">9</a>
</li><li class="li-indexenv">EXACT_MATCH, <a href="#hevea_default346">9</a>
</li><li class="li-indexenv">EXIT, <a href="#hevea_default60">4</a>
</li><li class="li-indexenv">EXTEND_BOTTOM, <a href="#hevea_default14">4</a>, <a href="#hevea_default255">9</a>
</li><li class="li-indexenv">EXTEND_BOTTOM_REGEXP, <a href="#hevea_default257">9</a>
</li><li class="li-indexenv">EXTEND_TOP, <a href="#hevea_default13">4</a>, <a href="#hevea_default254">9</a>
</li><li class="li-indexenv">EXTEND_TOP_REGEXP, <a href="#hevea_default256">9</a>
</li><li class="li-indexenv">EXTERN, <a href="#hevea_default59">4</a>
</li></ul></td><td class="c013"><ul class="indexenv"><li class="li-indexenv">FAIL, <a href="#hevea_default292">9</a>
</li><li class="li-indexenv">FILE_CONTAINS, <a href="#hevea_default569">9</a>
</li><li class="li-indexenv">FILE_CONTAINS_EVALUATED, <a href="#hevea_default570">9</a>
</li><li class="li-indexenv">FILE_EXISTS, <a href="#hevea_default572">9</a>
</li><li class="li-indexenv">FILE_EXISTS_IN_GAME, <a href="#hevea_default574">9</a>
</li><li class="li-indexenv">FILE_IS_IN_COMPRESSED_BIFF, <a href="#hevea_default576">9</a>
</li><li class="li-indexenv">FILE_MD5, <a href="#hevea_default575">9</a>
</li><li class="li-indexenv">FILE_SIZE, <a href="#hevea_default578">9</a>
</li><li class="li-indexenv">FLAGS, <a href="#hevea_default56">4</a>
</li><li class="li-indexenv">FOR, <a href="#hevea_default414">9</a>
</li><li class="li-indexenv">FORBID_COMPONENT, <a href="#hevea_default204">9</a>
</li><li class="li-indexenv">FORBID_FILE, <a href="#hevea_default291">9</a>
</li><li class="li-indexenv">FORCED_SUBCOMPONENT, <a href="#hevea_default207">9</a>
</li><li class="li-indexenv">Forced String Reference, <a href="#hevea_default63">4</a>
</li><li class="li-indexenv">fj_are_structure, <a href="#hevea_default612">12.2</a>
<br>
<br>
</li><li class="li-indexenv">GAM, <a href="#hevea_default624">16</a>
</li><li class="li-indexenv">GAME_INCLUDES, <a href="#hevea_default548">9</a>
</li><li class="li-indexenv">GAME_IS, <a href="#hevea_default546">9</a>
</li><li class="li-indexenv">GET_DIRECTORY_ARRAY, <a href="#hevea_default311">9</a>
</li><li class="li-indexenv">GET_FILE_ARRAY, <a href="#hevea_default310">9</a>
</li><li class="li-indexenv">GET_OFFSET_ARRAY, <a href="#hevea_default404">9</a>
</li><li class="li-indexenv">GET_OFFSET_ARRAY2, <a href="#hevea_default405">9</a>
</li><li class="li-indexenv">GET_STRREF, <a href="#hevea_default408">9</a>
</li><li class="li-indexenv">GET_STRREF_F, <a href="#hevea_default409">9</a>
</li><li class="li-indexenv">GET_STRREF_FS, <a href="#hevea_default411">9</a>
</li><li class="li-indexenv">GET_STRREF_S, <a href="#hevea_default410">9</a>
</li><li class="li-indexenv">GLOB, <a href="#hevea_default340">9</a>
</li><li class="li-indexenv">GOTO, <a href="#hevea_default58">4</a>
</li><li class="li-indexenv">GROUP, <a href="#hevea_default208">9</a>
<br>
<br>
</li><li class="li-indexenv">I_S_I, <a href="#hevea_default493">9</a>
</li><li class="li-indexenv">ID_OF_LABEL, <a href="#hevea_default557">9</a>
</li><li class="li-indexenv">IDS_OF_SYMBOL, <a href="#hevea_default549">9</a>
</li><li class="li-indexenv">IF, <a href="#hevea_default32">4</a>, <a href="#hevea_default494">9</a>
</li><li class="li-indexenv">IF_EXISTS, <a href="#hevea_default498">9</a>
</li><li class="li-indexenv">IF_SIZE_IS, <a href="#hevea_default492">9</a>
</li><li class="li-indexenv">INCLUDE, <a href="#hevea_default315">9</a>
</li><li class="li-indexenv">INDEX, <a href="#hevea_default564">9</a>
</li><li class="li-indexenv">INDEX_BUFFER, <a href="#hevea_default566">9</a>
</li><li class="li-indexenv">INNER_ACTION, <a href="#hevea_default478">9</a>
</li><li class="li-indexenv">INNER_PATCH, <a href="#hevea_default475">9</a>
</li><li class="li-indexenv">INNER_PATCH_FILE, <a href="#hevea_default477">9</a>
</li><li class="li-indexenv">INNER_PATCH_SAVE, <a href="#hevea_default476">9</a>
</li><li class="li-indexenv">INSERT_2DA_ROW, <a href="#hevea_default437">9</a>
</li><li class="li-indexenv">INSERT_BYTES, <a href="#hevea_default391">9</a>
</li><li class="li-indexenv">INSERT_FILE, <a href="#hevea_default386">9</a>
</li><li class="li-indexenv">INSTALL_BY_DEFAULT, <a href="#hevea_default209">9</a>
</li><li class="li-indexenv">INSTALL_ORDER, <a href="#hevea_default555">9</a>, <a href="#hevea_default556">9</a>
</li><li class="li-indexenv">INTERACTIVE, <a href="#hevea_default586">9</a>
</li><li class="li-indexenv">INTERJECT, <a href="#hevea_default8">4</a>
</li><li class="li-indexenv">INTERJECT_COPY_TRANS, <a href="#hevea_default9">4</a>
</li><li class="li-indexenv">INTERJECT_COPY_TRANS2, <a href="#hevea_default10">4</a>
</li><li class="li-indexenv">INTERJECT_COPY_TRANS3, <a href="#hevea_default11">4</a>
</li><li class="li-indexenv">INTERJECT_COPY_TRANS4, <a href="#hevea_default12">4</a>
</li><li class="li-indexenv">Infinity Engine action, <a href="#hevea_default72">5</a>
</li><li class="li-indexenv">Infinity Engine object, <a href="#hevea_default70">5</a>
</li><li class="li-indexenv">Infinity Engine trigger, <a href="#hevea_default69">5</a>
</li><li class="li-indexenv">IS_AN_INT, <a href="#hevea_default551">9</a>
</li><li class="li-indexenv">IS_SILENT, <a href="#hevea_default553">9</a>
</li><li class="li-indexenv">ITM, <a href="#hevea_default625">16</a>
</li><li class="li-indexenv">inlined, <a href="#hevea_default319">9</a>
<br>
<br>
</li><li class="li-indexenv">JOURNAL, <a href="#hevea_default53">4</a>
<br>
<br>
</li><li class="li-indexenv">KEY, <a href="#hevea_default626">16</a>
<br>
<br>
</li><li class="li-indexenv">LABEL, <a href="#hevea_default212">9</a>
</li><li class="li-indexenv">LAF, <a href="#hevea_default335">9</a>
</li><li class="li-indexenv">LAM, <a href="#hevea_default333">9</a>
</li><li class="li-indexenv">LANGUAGE, <a href="#hevea_default198">9</a>
</li><li class="li-indexenv">LAUNCH_ACTION_FUNCTION, <a href="#hevea_default334">9</a>
</li><li class="li-indexenv">LAUNCH_ACTION_MACRO, <a href="#hevea_default332">9</a>
</li><li class="li-indexenv">LAUNCH_PATCH_FUNCTION, <a href="#hevea_default488">9</a>
</li><li class="li-indexenv">LAUNCH_PATCH_MACRO, <a href="#hevea_default486">9</a>
</li><li class="li-indexenv">Language, <a href="#hevea_default197">9</a>
</li><li class="li-indexenv">LEXICOGRAPHICALLY, <a href="#hevea_default349">9</a>
</li><li class="li-indexenv">LOAD_TRA, <a href="#hevea_default271">9</a>
</li><li class="li-indexenv">LOG, <a href="#hevea_default296">9</a>
</li><li class="li-indexenv">LONG_AT, <a href="#hevea_default506">9</a>
</li><li class="li-indexenv">LOOKUP_IDS_SYMBOL_OF_INT, <a href="#hevea_default449">9</a>
</li><li class="li-indexenv">LPF, <a href="#hevea_default489">9</a>
</li><li class="li-indexenv">LPM, <a href="#hevea_default487">9</a>
<br>
<br>
</li><li class="li-indexenv">MAKE_BIFF, <a href="#hevea_default270">9</a>
</li><li class="li-indexenv">METADATA, <a href="#hevea_default213">9</a>
</li><li class="li-indexenv">MKDIR, <a href="#hevea_default247">9</a>
</li><li class="li-indexenv">MOD_FOLDER, <a href="#hevea_default182">9</a>
</li><li class="li-indexenv">MOD_IS_INSTALLED, <a href="#hevea_default554">9</a>
</li><li class="li-indexenv">MOD_VERSION, <a href="#hevea_default192">9</a>
</li><li class="li-indexenv">MODDER, <a href="#hevea_default190">9</a>
</li><li class="li-indexenv">MODULO, <a href="#hevea_default501">9</a>
</li><li class="li-indexenv">MOVE, <a href="#hevea_default232">9</a>
</li><li class="li-indexenv">Module Distribution, <a href="#hevea_default614">13</a>
</li><li class="li-indexenv">macros, <a href="#hevea_default590">10.17</a>
<br>
<br>
</li><li class="li-indexenv">NEXT_STRREF, <a href="#hevea_default561">9</a>
</li><li class="li-indexenv">NO_IF_EVAL_BUG, <a href="#hevea_default194">9</a>
</li><li class="li-indexenv">NO_LOG_RECORD, <a href="#hevea_default211">9</a>
</li><li class="li-indexenv">NOGLOB, <a href="#hevea_default341">9</a>
</li><li class="li-indexenv">NOT, <a href="#hevea_default512">9</a>
</li><li class="li-indexenv">NUMERICALLY, <a href="#hevea_default350">9</a>
</li><li class="li-indexenv">nonPausing, <a href="#hevea_default4">4</a>
<br>
<br>
</li><li class="li-indexenv">OR, <a href="#hevea_default515">9</a>
</li><li class="li-indexenv">OUTER_FOR, <a href="#hevea_default306">9</a>
</li><li class="li-indexenv">OUTER_INNER_PATCH, <a href="#hevea_default301">9</a>
</li><li class="li-indexenv">OUTER_INNER_PATCH_SAVE, <a href="#hevea_default303">9</a>
</li><li class="li-indexenv">OUTER_PATCH, <a href="#hevea_default302">9</a>
</li><li class="li-indexenv">OUTER_PATCH_SAVE, <a href="#hevea_default304">9</a>
</li><li class="li-indexenv">OUTER_SET, <a href="#hevea_default300">9</a>
</li><li class="li-indexenv">OUTER_SNPRINT, <a href="#hevea_default299">9</a>
</li><li class="li-indexenv">OUTER_SPRINT, <a href="#hevea_default298">9</a>
</li><li class="li-indexenv">OUTER_TEXT_SPRINT, <a href="#hevea_default297">9</a>
</li><li class="li-indexenv">OUTER_WHILE, <a href="#hevea_default305">9</a>
</li><li class="li-indexenv">offset, <a href="#hevea_default499">9</a>
</li><li class="li-indexenv">optcase, <a href="#hevea_default342">9</a>
</li><li class="li-indexenv">optexact, <a href="#hevea_default345">9</a>
</li><li class="li-indexenv">optGlob, <a href="#hevea_default339">9</a>
</li><li class="li-indexenv">optNoBackup, <a href="#hevea_default337">9</a>
<br>
<br>
</li><li class="li-indexenv">PATCH_ABORT, <a href="#hevea_default354">9</a>
</li><li class="li-indexenv">PATCH_BASH_FOR, <a href="#hevea_default415">9</a>
</li><li class="li-indexenv">PATCH_CLEAR_ARRAY, <a href="#hevea_default423">9</a>
</li><li class="li-indexenv">PATCH_DEFINE_ARRAY, <a href="#hevea_default417">9</a>
</li><li class="li-indexenv">PATCH_DEFINE_ASSOCIATIVE_ARRAY, <a href="#hevea_default407">9</a>
</li><li class="li-indexenv">PATCH_FAIL, <a href="#hevea_default353">9</a>
</li><li class="li-indexenv">PATCH_FOR_EACH, <a href="#hevea_default419">9</a>
</li><li class="li-indexenv">PATCH_IF, <a href="#hevea_default424">9</a>
</li><li class="li-indexenv">PATCH_INCLUDE, <a href="#hevea_default428">9</a>
</li><li class="li-indexenv">PATCH_LOG, <a href="#hevea_default357">9</a>
</li><li class="li-indexenv">PATCH_MATCH, <a href="#hevea_default425">9</a>
</li><li class="li-indexenv">PATCH_PHP_EACH, <a href="#hevea_default421">9</a>
</li><li class="li-indexenv">PATCH_PRINT, <a href="#hevea_default356">9</a>
</li><li class="li-indexenv">PATCH_RANDOM_SEED, <a href="#hevea_default440">9</a>
</li><li class="li-indexenv">PATCH_READLN, <a href="#hevea_default439">9</a>
</li><li class="li-indexenv">PATCH_REINCLUDE, <a href="#hevea_default429">9</a>
</li><li class="li-indexenv">PATCH_RERAISE, <a href="#hevea_default427">9</a>
</li><li class="li-indexenv">PATCH_SILENT, <a href="#hevea_default473">9</a>
</li><li class="li-indexenv">PATCH_TIME, <a href="#hevea_default490">9</a>
</li><li class="li-indexenv">PATCH_TRY, <a href="#hevea_default426">9</a>
</li><li class="li-indexenv">PATCH_VERBOSE, <a href="#hevea_default474">9</a>
</li><li class="li-indexenv">PATCH_WARN, <a href="#hevea_default355">9</a>
</li><li class="li-indexenv">PATCH_WITH_SCOPE, <a href="#hevea_default431">9</a>
</li><li class="li-indexenv">PATCH_WITH_TRA, <a href="#hevea_default430">9</a>
</li><li class="li-indexenv">PHP_EACH, <a href="#hevea_default420">9</a>
</li><li class="li-indexenv">PRETTY_PRINT_2DA, <a href="#hevea_default435">9</a>, <a href="#hevea_default436">9</a>
</li><li class="li-indexenv">PRINT, <a href="#hevea_default295">9</a>
</li><li class="li-indexenv">Prompt Customization, <a href="#hevea_default588">10.13</a>
</li><li class="li-indexenv">patch, <a href="#hevea_default351">9</a>
</li><li class="li-indexenv">prompts.tra, <a href="#hevea_default589">10.13</a>
<br>
<br>
</li><li class="li-indexenv">QUICK_MENU, <a href="#hevea_default195">9</a>
</li><li class="li-indexenv">QUOTE, <a href="#hevea_default367">9</a>
<br>
<br>
</li><li class="li-indexenv">R_A_T_P_R, <a href="#hevea_default30">4</a>
</li><li class="li-indexenv">R_B_B, <a href="#hevea_default390">9</a>
</li><li class="li-indexenv">RANDOM, <a href="#hevea_default562">9</a>
</li><li class="li-indexenv">RANDOM_SEED, <a href="#hevea_default248">9</a>
</li><li class="li-indexenv">READ_2DA_ENTRIES_NOW, <a href="#hevea_default444">9</a>
</li><li class="li-indexenv">READ_2DA_ENTRY, <a href="#hevea_default443">9</a>
</li><li class="li-indexenv">READ_2DA_ENTRY_FORMER, <a href="#hevea_default445">9</a>
</li><li class="li-indexenv">READ_ASCII, <a href="#hevea_default399">9</a>
</li><li class="li-indexenv">READ_BYTE, <a href="#hevea_default393">9</a>
</li><li class="li-indexenv">READ_LONG, <a href="#hevea_default397">9</a>
</li><li class="li-indexenv">READ_SBYTE, <a href="#hevea_default394">9</a>
</li><li class="li-indexenv">READ_SHORT, <a href="#hevea_default395">9</a>
</li><li class="li-indexenv">READ_SLONG, <a href="#hevea_default398">9</a>
</li><li class="li-indexenv">READ_SSHORT, <a href="#hevea_default396">9</a>
</li><li class="li-indexenv">READ_STRREF, <a href="#hevea_default400">9</a>
</li><li class="li-indexenv">READ_STRREF_F, <a href="#hevea_default401">9</a>
</li><li class="li-indexenv">READ_STRREF_FS, <a href="#hevea_default403">9</a>
</li><li class="li-indexenv">READ_STRREF_S, <a href="#hevea_default402">9</a>
</li><li class="li-indexenv">README, <a href="#hevea_default188">9</a>
</li><li class="li-indexenv">REFACTOR_BAF_TRIGGER, <a href="#hevea_default456">9</a>
</li><li class="li-indexenv">REFACTOR_D_TRIGGER, <a href="#hevea_default457">9</a>
</li><li class="li-indexenv">REFACTOR_TRIGGER, <a href="#hevea_default455">9</a>
</li><li class="li-indexenv">REINCLUDE, <a href="#hevea_default317">9</a>
</li><li class="li-indexenv">REMOVE_2DA_ROW, <a href="#hevea_default438">9</a>
</li><li class="li-indexenv">REMOVE_CRE_EFFECTS, <a href="#hevea_default470">9</a>
</li><li class="li-indexenv">REMOVE_CRE_ITEM, <a href="#hevea_default468">9</a>
</li><li class="li-indexenv">REMOVE_CRE_ITEMS, <a href="#hevea_default469">9</a>
</li><li class="li-indexenv">REMOVE_KNOWN_SPELL, <a href="#hevea_default463">9</a>
</li><li class="li-indexenv">REMOVE_KNOWN_SPELLS, <a href="#hevea_default471">9</a>
</li><li class="li-indexenv">REMOVE_MEMORIZED_SPELL, <a href="#hevea_default464">9</a>
</li><li class="li-indexenv">REMOVE_MEMORIZED_SPELLS, <a href="#hevea_default472">9</a>
</li><li class="li-indexenv">REMOVE_STORE_ITEM, <a href="#hevea_default442">9</a>
</li><li class="li-indexenv">REPLACE, <a href="#hevea_default21">4</a>, <a href="#hevea_default368">9</a>
</li><li class="li-indexenv">REPLACE_ACTION_TEXT, <a href="#hevea_default27">4</a>
</li><li class="li-indexenv">REPLACE_ACTION_TEXT_PROCESS, <a href="#hevea_default29">4</a>
</li><li class="li-indexenv">REPLACE_ACTION_TEXT_REGEXP, <a href="#hevea_default28">4</a>
</li><li class="li-indexenv">REPLACE_BCS_BLOCK, <a href="#hevea_default389">9</a>
</li><li class="li-indexenv">REPLACE_CRE_ITEM, <a href="#hevea_default467">9</a>
</li><li class="li-indexenv">REPLACE_EVALUATE, <a href="#hevea_default458">9</a>
</li><li class="li-indexenv">REPLACE_SAY, <a href="#hevea_default23">4</a>
</li><li class="li-indexenv">REPLACE_STATE_TRIGGER, <a href="#hevea_default24">4</a>
</li><li class="li-indexenv">REPLACE_TEXTUALLY, <a href="#hevea_default369">9</a>
</li><li class="li-indexenv">REPLACE_TRANS_ACTION, <a href="#hevea_default18">4</a>
</li><li class="li-indexenv">REPLACE_TRANS_TRIGGER, <a href="#hevea_default19">4</a>
</li><li class="li-indexenv">REPLACE_TRIGGER_TEXT, <a href="#hevea_default25">4</a>
</li><li class="li-indexenv">REPLACE_TRIGGER_TEXT_REGEXP, <a href="#hevea_default26">4</a>
</li><li class="li-indexenv">REPLY, <a href="#hevea_default50">4</a>
</li><li class="li-indexenv">REQUIRE_COMPONENT, <a href="#hevea_default203">9</a>
</li><li class="li-indexenv">REQUIRE_FILE, <a href="#hevea_default290">9</a>
</li><li class="li-indexenv">REQUIRE_PREDICATE, <a href="#hevea_default205">9</a>
</li><li class="li-indexenv">RESOLVE_STR_REF, <a href="#hevea_default560">9</a>
</li><li class="li-indexenv">RESOURCE_CONTAINS, <a href="#hevea_default571">9</a>
</li><li class="li-indexenv">RINDEX, <a href="#hevea_default565">9</a>
</li><li class="li-indexenv">RINDEX_BUFFER, <a href="#hevea_default567">9</a>
</li><li class="li-indexenv">reference, <a href="#hevea_default64">4</a>
</li><li class="li-indexenv">regexp, <a href="#hevea_default615">14</a>
</li><li class="li-indexenv">replyText, <a href="#hevea_default44">4</a>
<br>
<br>
</li><li class="li-indexenv">SAY, <a href="#hevea_default39">4</a>, <a href="#hevea_default352">9</a>
</li><li class="li-indexenv">SAY_EVALUATED, <a href="#hevea_default358">9</a>
</li><li class="li-indexenv">SBYTE_AT, <a href="#hevea_default503">9</a>
</li><li class="li-indexenv">SCRIPT_STYLE, <a href="#hevea_default193">9</a>
</li><li class="li-indexenv">SET, <a href="#hevea_default412">9</a>
</li><li class="li-indexenv">SET_2DA_ENTRIES_NOW, <a href="#hevea_default434">9</a>
</li><li class="li-indexenv">SET_2DA_ENTRY, <a href="#hevea_default432">9</a>
</li><li class="li-indexenv">SET_2DA_ENTRY_LATER, <a href="#hevea_default433">9</a>
</li><li class="li-indexenv">SET_BG2_PROFICIENCY, <a href="#hevea_default465">9</a>
</li><li class="li-indexenv">SET_WEIGHT, <a href="#hevea_default22">4</a>
</li><li class="li-indexenv">SHORT_AT, <a href="#hevea_default504">9</a>
</li><li class="li-indexenv">SILENT, <a href="#hevea_default245">9</a>
</li><li class="li-indexenv">SIZE_OF_FILE, <a href="#hevea_default579">9</a>
</li><li class="li-indexenv">SLONG_AT, <a href="#hevea_default507">9</a>
</li><li class="li-indexenv">SNPRINT, <a href="#hevea_default363">9</a>
</li><li class="li-indexenv">SOLVED_JOURNAL, <a href="#hevea_default54">4</a>
</li><li class="li-indexenv">SORT_ARRAY_INDICES, <a href="#hevea_default418">9</a>
</li><li class="li-indexenv">SOURCE_BIFF, <a href="#hevea_default365">9</a>
</li><li class="li-indexenv">SOURCE_DIRECTORY, <a href="#hevea_default216">9</a>
</li><li class="li-indexenv">SOURCE_EXT, <a href="#hevea_default220">9</a>
</li><li class="li-indexenv">SOURCE_FILE, <a href="#hevea_default218">9</a>
</li><li class="li-indexenv">SOURCE_FILESPEC, <a href="#hevea_default217">9</a>
</li><li class="li-indexenv">SOURCE_RES, <a href="#hevea_default219">9</a>
</li><li class="li-indexenv">SOURCE_SIZE, <a href="#hevea_default226">9</a>
</li><li class="li-indexenv">SPACES, <a href="#hevea_default366">9</a>
</li><li class="li-indexenv">SPL, <a href="#hevea_default627">16</a>
</li><li class="li-indexenv">SPRINT, <a href="#hevea_default362">9</a>
</li><li class="li-indexenv">SPRINTF, <a href="#hevea_default364">9</a>
</li><li class="li-indexenv">Special Thanks, <a href="#hevea_default629">18</a>
</li><li class="li-indexenv">SSHORT_AT, <a href="#hevea_default505">9</a>
</li><li class="li-indexenv">STATE_WHICH_SAYS, <a href="#hevea_default558">9</a>, <a href="#hevea_default559">9</a>
</li><li class="li-indexenv">STR_CMP, <a href="#hevea_default538">9</a>
</li><li class="li-indexenv">STR_EQ, <a href="#hevea_default542">9</a>
</li><li class="li-indexenv">STRING_COMPARE, <a href="#hevea_default537">9</a>
</li><li class="li-indexenv">STRING_COMPARE_CASE, <a href="#hevea_default539">9</a>
</li><li class="li-indexenv">STRING_COMPARE_REGEXP, <a href="#hevea_default544">9</a>
</li><li class="li-indexenv">STRING_CONTAINS_REGEXP, <a href="#hevea_default545">9</a>
</li><li class="li-indexenv">STRING_EQUAL, <a href="#hevea_default540">9</a>
</li><li class="li-indexenv">STRING_EQUAL_CASE, <a href="#hevea_default541">9</a>
</li><li class="li-indexenv">STRING_LENGTH, <a href="#hevea_default568">9</a>
</li><li class="li-indexenv">STRING_MATCHES_REGEXP, <a href="#hevea_default543">9</a>
</li><li class="li-indexenv">STRING_SET, <a href="#hevea_default284">9</a>
</li><li class="li-indexenv">STRING_SET_EVALUATE, <a href="#hevea_default285">9</a>
</li><li class="li-indexenv">STRING_SET_RANGE, <a href="#hevea_default286">9</a>
</li><li class="li-indexenv">String, <a href="#hevea_default65">4</a>
</li><li class="li-indexenv">SUBCOMPONENT, <a href="#hevea_default206">9</a>
</li><li class="li-indexenv">SUPPORT, <a href="#hevea_default178">9</a>
</li><li class="li-indexenv">sayText, <a href="#hevea_default43">4</a>
</li><li class="li-indexenv">sc#addWmpAre, <a href="#hevea_default613">12.3</a>
</li><li class="li-indexenv">script block, <a href="#hevea_default67">5</a>
</li><li class="li-indexenv">script response, <a href="#hevea_default71">5</a>
</li><li class="li-indexenv">script trigger, <a href="#hevea_default68">5</a>
</li><li class="li-indexenv">state, <a href="#hevea_default35">4</a>
</li><li class="li-indexenv">stateActionString, <a href="#hevea_default52">4</a>
</li><li class="li-indexenv">stateLabel, <a href="#hevea_default38">4</a>
</li><li class="li-indexenv">stateNumber, <a href="#hevea_default40">4</a>
</li><li class="li-indexenv">stateTriggerString, <a href="#hevea_default37">4</a>
<br>
<br>
</li><li class="li-indexenv">TEXT_SPRINT, <a href="#hevea_default361">9</a>
</li><li class="li-indexenv">TLK, <a href="#hevea_default628">16</a>
</li><li class="li-indexenv">TO_LOWER, <a href="#hevea_default360">9</a>
</li><li class="li-indexenv">TO_UPPER, <a href="#hevea_default359">9</a>
</li><li class="li-indexenv">TP2, <a href="#hevea_default174">9</a>
</li><li class="li-indexenv">TP2 Action, <a href="#hevea_default214">9</a>
</li><li class="li-indexenv">TP2 File, <a href="#hevea_default175">9</a>
</li><li class="li-indexenv">TP2 Flag, <a href="#hevea_default183">9</a>
</li><li class="li-indexenv">TP2_AUTHOR, <a href="#hevea_default179">9</a>
</li><li class="li-indexenv">TP2_BASE_NAME, <a href="#hevea_default181">9</a>
</li><li class="li-indexenv">TP2_FILE_NAME, <a href="#hevea_default180">9</a>
</li><li class="li-indexenv">TRA_ENTRY_EXISTS, <a href="#hevea_default552">9</a>
</li><li class="li-indexenv">text, <a href="#hevea_default62">4</a>
</li><li class="li-indexenv">transFeature, <a href="#hevea_default49">4</a>
</li><li class="li-indexenv">transition, <a href="#hevea_default45">4</a>
</li><li class="li-indexenv">transNext, <a href="#hevea_default57">4</a>
</li><li class="li-indexenv">transTriggerString, <a href="#hevea_default46">4</a>
<br>
<br>
</li><li class="li-indexenv">UNINSTALL, <a href="#hevea_default274">9</a>
</li><li class="li-indexenv">UNINSTALL_ORDER, <a href="#hevea_default189">9</a>
</li><li class="li-indexenv">UNLESS, <a href="#hevea_default33">4</a>, <a href="#hevea_default495">9</a>
</li><li class="li-indexenv">UNSOLVED_JOURNAL, <a href="#hevea_default55">4</a>
</li><li class="li-indexenv">USING, <a href="#hevea_default237">9</a>
<br>
<br>
</li><li class="li-indexenv">VALID_SCRIPT_ACTIONS, <a href="#hevea_default580">9</a>
</li><li class="li-indexenv">VALID_SCRIPT_TRIGGERS, <a href="#hevea_default581">9</a>
</li><li class="li-indexenv">VARIABLE_IS_SET, <a href="#hevea_default550">9</a>
</li><li class="li-indexenv">VERBOSE, <a href="#hevea_default246">9</a>
</li><li class="li-indexenv">VERSION, <a href="#hevea_default191">9</a>
</li><li class="li-indexenv">value, <a href="#hevea_default500">9</a>
</li><li class="li-indexenv">variable, <a href="#hevea_default587">9</a>
<br>
<br>
</li><li class="li-indexenv">WARN, <a href="#hevea_default294">9</a>
</li><li class="li-indexenv">WEIDU_ARCH, <a href="#hevea_default583">9</a>
</li><li class="li-indexenv">WEIDU_OS, <a href="#hevea_default584">9</a>
</li><li class="li-indexenv">WEIGHT, <a href="#hevea_default36">4</a>
</li><li class="li-indexenv">WHILE, <a href="#hevea_default413">9</a>
</li><li class="li-indexenv">WITH_SCOPE, <a href="#hevea_default273">9</a>
</li><li class="li-indexenv">WITH_TRA, <a href="#hevea_default272">9</a>
</li><li class="li-indexenv">WRITE_ASCII, <a href="#hevea_default378">9</a>
</li><li class="li-indexenv">WRITE_ASCII_LIST, <a href="#hevea_default379">9</a>
</li><li class="li-indexenv">WRITE_ASCII_TERMINATE, <a href="#hevea_default381">9</a>
</li><li class="li-indexenv">WRITE_ASCIIE, <a href="#hevea_default384">9</a>
</li><li class="li-indexenv">WRITE_ASCIIL, <a href="#hevea_default380">9</a>
</li><li class="li-indexenv">WRITE_ASCIIT, <a href="#hevea_default382">9</a>
</li><li class="li-indexenv">WRITE_BYTE, <a href="#hevea_default375">9</a>
</li><li class="li-indexenv">WRITE_EVALUATED_ASCII, <a href="#hevea_default383">9</a>
</li><li class="li-indexenv">WRITE_FILE, <a href="#hevea_default385">9</a>
</li><li class="li-indexenv">WRITE_LONG, <a href="#hevea_default377">9</a>
</li><li class="li-indexenv">WRITE_SHORT, <a href="#hevea_default376">9</a>
</li><li class="li-indexenv">when, <a href="#hevea_default491">9</a>
</li></ul></td></tr>
</table>
<!--TOC section id="sec67" Changes-->
<h2 class="section" id="sec67">22  Changes</h2><!--SEC END --><p>
See the file
<a href="README-WeiDU-Changes.txt"><span class="c003">README-WeiDU-Changes.txt</span></a>
for a description of how WeiDU
has changed over time.
</p><!--CUT END -->
<!--HTMLFOOT-->
<!--ENDHTML-->
<!--FOOTER-->
<hr style="height:2"><blockquote class="quote"><em>This document was translated from L<sup>A</sup>T<sub>E</sub>X by
</em><a href="http://hevea.inria.fr/index.html"><em>H<span style="font-size:small"><sup>E</sup></span>V<span style="font-size:small"><sup>E</sup></span>A</em></a><em>.</em></blockquote></body>
</html>
